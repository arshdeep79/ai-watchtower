(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const it of document.querySelectorAll('link[rel="modulepreload"]'))Z(it);new MutationObserver(it=>{for(const lt of it)if(lt.type==="childList")for(const R of lt.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&Z(R)}).observe(document,{childList:!0,subtree:!0});function U(it){const lt={};return it.integrity&&(lt.integrity=it.integrity),it.referrerPolicy&&(lt.referrerPolicy=it.referrerPolicy),it.crossOrigin==="use-credentials"?lt.credentials="include":it.crossOrigin==="anonymous"?lt.credentials="omit":lt.credentials="same-origin",lt}function Z(it){if(it.ep)return;it.ep=!0;const lt=U(it);fetch(it.href,lt)}})();function pm(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var $g={exports:{}},um={};var M_;function Uy(){if(M_)return um;M_=1;var b=Symbol.for("react.transitional.element"),A=Symbol.for("react.fragment");function U(Z,it,lt){var R=null;if(lt!==void 0&&(R=""+lt),it.key!==void 0&&(R=""+it.key),"key"in it){lt={};for(var d in it)d!=="key"&&(lt[d]=it[d])}else lt=it;return it=lt.ref,{$$typeof:b,type:Z,key:R,ref:it!==void 0?it:null,props:lt}}return um.Fragment=A,um.jsx=U,um.jsxs=U,um}var C_;function Gy(){return C_||(C_=1,$g.exports=Uy()),$g.exports}var Ht=Gy(),Xg={exports:{}},ei={};var A_;function qy(){if(A_)return ei;A_=1;var b=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),lt=Symbol.for("react.consumer"),R=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),dt=Symbol.for("react.suspense"),vt=Symbol.for("react.memo"),Wt=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),Bt=Symbol.iterator;function Gt(Tt){return Tt===null||typeof Tt!="object"?null:(Tt=Bt&&Tt[Bt]||Tt["@@iterator"],typeof Tt=="function"?Tt:null)}var se={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lt=Object.assign,_t={};function fe(Tt,Kt,ge){this.props=Tt,this.context=Kt,this.refs=_t,this.updater=ge||se}fe.prototype.isReactComponent={},fe.prototype.setState=function(Tt,Kt){if(typeof Tt!="object"&&typeof Tt!="function"&&Tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Tt,Kt,"setState")},fe.prototype.forceUpdate=function(Tt){this.updater.enqueueForceUpdate(this,Tt,"forceUpdate")};function me(){}me.prototype=fe.prototype;function le(Tt,Kt,ge){this.props=Tt,this.context=Kt,this.refs=_t,this.updater=ge||se}var mi=le.prototype=new me;mi.constructor=le,Lt(mi,fe.prototype),mi.isPureReactComponent=!0;var ue=Array.isArray;function Ye(){}var be={H:null,A:null,T:null,S:null},We=Object.prototype.hasOwnProperty;function ii(Tt,Kt,ge){var xe=ge.ref;return{$$typeof:b,type:Tt,key:Kt,ref:xe!==void 0?xe:null,props:ge}}function Pi(Tt,Kt){return ii(Tt.type,Kt,Tt.props)}function Wi(Tt){return typeof Tt=="object"&&Tt!==null&&Tt.$$typeof===b}function yi(Tt){var Kt={"=":"=0",":":"=2"};return"$"+Tt.replace(/[=:]/g,function(ge){return Kt[ge]})}var jn=/\/+/g;function cn(Tt,Kt){return typeof Tt=="object"&&Tt!==null&&Tt.key!=null?yi(""+Tt.key):Kt.toString(36)}function wr(Tt){switch(Tt.status){case"fulfilled":return Tt.value;case"rejected":throw Tt.reason;default:switch(typeof Tt.status=="string"?Tt.then(Ye,Ye):(Tt.status="pending",Tt.then(function(Kt){Tt.status==="pending"&&(Tt.status="fulfilled",Tt.value=Kt)},function(Kt){Tt.status==="pending"&&(Tt.status="rejected",Tt.reason=Kt)})),Tt.status){case"fulfilled":return Tt.value;case"rejected":throw Tt.reason}}throw Tt}function Ut(Tt,Kt,ge,xe,Ne){var ke=typeof Tt;(ke==="undefined"||ke==="boolean")&&(Tt=null);var Ke=!1;if(Tt===null)Ke=!0;else switch(ke){case"bigint":case"string":case"number":Ke=!0;break;case"object":switch(Tt.$$typeof){case b:case A:Ke=!0;break;case Wt:return Ke=Tt._init,Ut(Ke(Tt._payload),Kt,ge,xe,Ne)}}if(Ke)return Ne=Ne(Tt),Ke=xe===""?"."+cn(Tt,0):xe,ue(Ne)?(ge="",Ke!=null&&(ge=Ke.replace(jn,"$&/")+"/"),Ut(Ne,Kt,ge,"",function(fa){return fa})):Ne!=null&&(Wi(Ne)&&(Ne=Pi(Ne,ge+(Ne.key==null||Tt&&Tt.key===Ne.key?"":(""+Ne.key).replace(jn,"$&/")+"/")+Ke)),Kt.push(Ne)),1;Ke=0;var Mi=xe===""?".":xe+":";if(ue(Tt))for(var Xi=0;Xi<Tt.length;Xi++)xe=Tt[Xi],ke=Mi+cn(xe,Xi),Ke+=Ut(xe,Kt,ge,ke,Ne);else if(Xi=Gt(Tt),typeof Xi=="function")for(Tt=Xi.call(Tt),Xi=0;!(xe=Tt.next()).done;)xe=xe.value,ke=Mi+cn(xe,Xi++),Ke+=Ut(xe,Kt,ge,ke,Ne);else if(ke==="object"){if(typeof Tt.then=="function")return Ut(wr(Tt),Kt,ge,xe,Ne);throw Kt=String(Tt),Error("Objects are not valid as a React child (found: "+(Kt==="[object Object]"?"object with keys {"+Object.keys(Tt).join(", ")+"}":Kt)+"). If you meant to render a collection of children, use an array instead.")}return Ke}function ce(Tt,Kt,ge){if(Tt==null)return Tt;var xe=[],Ne=0;return Ut(Tt,xe,"","",function(ke){return Kt.call(ge,ke,Ne++)}),xe}function Oe(Tt){if(Tt._status===-1){var Kt=Tt._result;Kt=Kt(),Kt.then(function(ge){(Tt._status===0||Tt._status===-1)&&(Tt._status=1,Tt._result=ge)},function(ge){(Tt._status===0||Tt._status===-1)&&(Tt._status=2,Tt._result=ge)}),Tt._status===-1&&(Tt._status=0,Tt._result=Kt)}if(Tt._status===1)return Tt._result.default;throw Tt._result}var De=typeof reportError=="function"?reportError:function(Tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Kt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Tt=="object"&&Tt!==null&&typeof Tt.message=="string"?String(Tt.message):String(Tt),error:Tt});if(!window.dispatchEvent(Kt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Tt);return}console.error(Tt)},vi={map:ce,forEach:function(Tt,Kt,ge){ce(Tt,function(){Kt.apply(this,arguments)},ge)},count:function(Tt){var Kt=0;return ce(Tt,function(){Kt++}),Kt},toArray:function(Tt){return ce(Tt,function(Kt){return Kt})||[]},only:function(Tt){if(!Wi(Tt))throw Error("React.Children.only expected to receive a single React element child.");return Tt}};return ei.Activity=ee,ei.Children=vi,ei.Component=fe,ei.Fragment=U,ei.Profiler=it,ei.PureComponent=le,ei.StrictMode=Z,ei.Suspense=dt,ei.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=be,ei.__COMPILER_RUNTIME={__proto__:null,c:function(Tt){return be.H.useMemoCache(Tt)}},ei.cache=function(Tt){return function(){return Tt.apply(null,arguments)}},ei.cacheSignal=function(){return null},ei.cloneElement=function(Tt,Kt,ge){if(Tt==null)throw Error("The argument must be a React element, but you passed "+Tt+".");var xe=Lt({},Tt.props),Ne=Tt.key;if(Kt!=null)for(ke in Kt.key!==void 0&&(Ne=""+Kt.key),Kt)!We.call(Kt,ke)||ke==="key"||ke==="__self"||ke==="__source"||ke==="ref"&&Kt.ref===void 0||(xe[ke]=Kt[ke]);var ke=arguments.length-2;if(ke===1)xe.children=ge;else if(1<ke){for(var Ke=Array(ke),Mi=0;Mi<ke;Mi++)Ke[Mi]=arguments[Mi+2];xe.children=Ke}return ii(Tt.type,Ne,xe)},ei.createContext=function(Tt){return Tt={$$typeof:R,_currentValue:Tt,_currentValue2:Tt,_threadCount:0,Provider:null,Consumer:null},Tt.Provider=Tt,Tt.Consumer={$$typeof:lt,_context:Tt},Tt},ei.createElement=function(Tt,Kt,ge){var xe,Ne={},ke=null;if(Kt!=null)for(xe in Kt.key!==void 0&&(ke=""+Kt.key),Kt)We.call(Kt,xe)&&xe!=="key"&&xe!=="__self"&&xe!=="__source"&&(Ne[xe]=Kt[xe]);var Ke=arguments.length-2;if(Ke===1)Ne.children=ge;else if(1<Ke){for(var Mi=Array(Ke),Xi=0;Xi<Ke;Xi++)Mi[Xi]=arguments[Xi+2];Ne.children=Mi}if(Tt&&Tt.defaultProps)for(xe in Ke=Tt.defaultProps,Ke)Ne[xe]===void 0&&(Ne[xe]=Ke[xe]);return ii(Tt,ke,Ne)},ei.createRef=function(){return{current:null}},ei.forwardRef=function(Tt){return{$$typeof:d,render:Tt}},ei.isValidElement=Wi,ei.lazy=function(Tt){return{$$typeof:Wt,_payload:{_status:-1,_result:Tt},_init:Oe}},ei.memo=function(Tt,Kt){return{$$typeof:vt,type:Tt,compare:Kt===void 0?null:Kt}},ei.startTransition=function(Tt){var Kt=be.T,ge={};be.T=ge;try{var xe=Tt(),Ne=be.S;Ne!==null&&Ne(ge,xe),typeof xe=="object"&&xe!==null&&typeof xe.then=="function"&&xe.then(Ye,De)}catch(ke){De(ke)}finally{Kt!==null&&ge.types!==null&&(Kt.types=ge.types),be.T=Kt}},ei.unstable_useCacheRefresh=function(){return be.H.useCacheRefresh()},ei.use=function(Tt){return be.H.use(Tt)},ei.useActionState=function(Tt,Kt,ge){return be.H.useActionState(Tt,Kt,ge)},ei.useCallback=function(Tt,Kt){return be.H.useCallback(Tt,Kt)},ei.useContext=function(Tt){return be.H.useContext(Tt)},ei.useDebugValue=function(){},ei.useDeferredValue=function(Tt,Kt){return be.H.useDeferredValue(Tt,Kt)},ei.useEffect=function(Tt,Kt){return be.H.useEffect(Tt,Kt)},ei.useEffectEvent=function(Tt){return be.H.useEffectEvent(Tt)},ei.useId=function(){return be.H.useId()},ei.useImperativeHandle=function(Tt,Kt,ge){return be.H.useImperativeHandle(Tt,Kt,ge)},ei.useInsertionEffect=function(Tt,Kt){return be.H.useInsertionEffect(Tt,Kt)},ei.useLayoutEffect=function(Tt,Kt){return be.H.useLayoutEffect(Tt,Kt)},ei.useMemo=function(Tt,Kt){return be.H.useMemo(Tt,Kt)},ei.useOptimistic=function(Tt,Kt){return be.H.useOptimistic(Tt,Kt)},ei.useReducer=function(Tt,Kt,ge){return be.H.useReducer(Tt,Kt,ge)},ei.useRef=function(Tt){return be.H.useRef(Tt)},ei.useState=function(Tt){return be.H.useState(Tt)},ei.useSyncExternalStore=function(Tt,Kt,ge){return be.H.useSyncExternalStore(Tt,Kt,ge)},ei.useTransition=function(){return be.H.useTransition()},ei.version="19.2.0",ei}var D_;function c_(){return D_||(D_=1,Xg.exports=qy()),Xg.exports}var rn=c_();const cg=pm(rn);var Yg={exports:{}},cm={},Wg={exports:{}},Kg={};var I_;function Zy(){return I_||(I_=1,(function(b){function A(Ut,ce){var Oe=Ut.length;Ut.push(ce);t:for(;0<Oe;){var De=Oe-1>>>1,vi=Ut[De];if(0<it(vi,ce))Ut[De]=ce,Ut[Oe]=vi,Oe=De;else break t}}function U(Ut){return Ut.length===0?null:Ut[0]}function Z(Ut){if(Ut.length===0)return null;var ce=Ut[0],Oe=Ut.pop();if(Oe!==ce){Ut[0]=Oe;t:for(var De=0,vi=Ut.length,Tt=vi>>>1;De<Tt;){var Kt=2*(De+1)-1,ge=Ut[Kt],xe=Kt+1,Ne=Ut[xe];if(0>it(ge,Oe))xe<vi&&0>it(Ne,ge)?(Ut[De]=Ne,Ut[xe]=Oe,De=xe):(Ut[De]=ge,Ut[Kt]=Oe,De=Kt);else if(xe<vi&&0>it(Ne,Oe))Ut[De]=Ne,Ut[xe]=Oe,De=xe;else break t}}return ce}function it(Ut,ce){var Oe=Ut.sortIndex-ce.sortIndex;return Oe!==0?Oe:Ut.id-ce.id}if(b.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var lt=performance;b.unstable_now=function(){return lt.now()}}else{var R=Date,d=R.now();b.unstable_now=function(){return R.now()-d}}var dt=[],vt=[],Wt=1,ee=null,Bt=3,Gt=!1,se=!1,Lt=!1,_t=!1,fe=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;function mi(Ut){for(var ce=U(vt);ce!==null;){if(ce.callback===null)Z(vt);else if(ce.startTime<=Ut)Z(vt),ce.sortIndex=ce.expirationTime,A(dt,ce);else break;ce=U(vt)}}function ue(Ut){if(Lt=!1,mi(Ut),!se)if(U(dt)!==null)se=!0,Ye||(Ye=!0,yi());else{var ce=U(vt);ce!==null&&wr(ue,ce.startTime-Ut)}}var Ye=!1,be=-1,We=5,ii=-1;function Pi(){return _t?!0:!(b.unstable_now()-ii<We)}function Wi(){if(_t=!1,Ye){var Ut=b.unstable_now();ii=Ut;var ce=!0;try{t:{se=!1,Lt&&(Lt=!1,me(be),be=-1),Gt=!0;var Oe=Bt;try{e:{for(mi(Ut),ee=U(dt);ee!==null&&!(ee.expirationTime>Ut&&Pi());){var De=ee.callback;if(typeof De=="function"){ee.callback=null,Bt=ee.priorityLevel;var vi=De(ee.expirationTime<=Ut);if(Ut=b.unstable_now(),typeof vi=="function"){ee.callback=vi,mi(Ut),ce=!0;break e}ee===U(dt)&&Z(dt),mi(Ut)}else Z(dt);ee=U(dt)}if(ee!==null)ce=!0;else{var Tt=U(vt);Tt!==null&&wr(ue,Tt.startTime-Ut),ce=!1}}break t}finally{ee=null,Bt=Oe,Gt=!1}ce=void 0}}finally{ce?yi():Ye=!1}}}var yi;if(typeof le=="function")yi=function(){le(Wi)};else if(typeof MessageChannel<"u"){var jn=new MessageChannel,cn=jn.port2;jn.port1.onmessage=Wi,yi=function(){cn.postMessage(null)}}else yi=function(){fe(Wi,0)};function wr(Ut,ce){be=fe(function(){Ut(b.unstable_now())},ce)}b.unstable_IdlePriority=5,b.unstable_ImmediatePriority=1,b.unstable_LowPriority=4,b.unstable_NormalPriority=3,b.unstable_Profiling=null,b.unstable_UserBlockingPriority=2,b.unstable_cancelCallback=function(Ut){Ut.callback=null},b.unstable_forceFrameRate=function(Ut){0>Ut||125<Ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):We=0<Ut?Math.floor(1e3/Ut):5},b.unstable_getCurrentPriorityLevel=function(){return Bt},b.unstable_next=function(Ut){switch(Bt){case 1:case 2:case 3:var ce=3;break;default:ce=Bt}var Oe=Bt;Bt=ce;try{return Ut()}finally{Bt=Oe}},b.unstable_requestPaint=function(){_t=!0},b.unstable_runWithPriority=function(Ut,ce){switch(Ut){case 1:case 2:case 3:case 4:case 5:break;default:Ut=3}var Oe=Bt;Bt=Ut;try{return ce()}finally{Bt=Oe}},b.unstable_scheduleCallback=function(Ut,ce,Oe){var De=b.unstable_now();switch(typeof Oe=="object"&&Oe!==null?(Oe=Oe.delay,Oe=typeof Oe=="number"&&0<Oe?De+Oe:De):Oe=De,Ut){case 1:var vi=-1;break;case 2:vi=250;break;case 5:vi=1073741823;break;case 4:vi=1e4;break;default:vi=5e3}return vi=Oe+vi,Ut={id:Wt++,callback:ce,priorityLevel:Ut,startTime:Oe,expirationTime:vi,sortIndex:-1},Oe>De?(Ut.sortIndex=Oe,A(vt,Ut),U(dt)===null&&Ut===U(vt)&&(Lt?(me(be),be=-1):Lt=!0,wr(ue,Oe-De))):(Ut.sortIndex=vi,A(dt,Ut),se||Gt||(se=!0,Ye||(Ye=!0,yi()))),Ut},b.unstable_shouldYield=Pi,b.unstable_wrapCallback=function(Ut){var ce=Bt;return function(){var Oe=Bt;Bt=ce;try{return Ut.apply(this,arguments)}finally{Bt=Oe}}}})(Kg)),Kg}var z_;function Hy(){return z_||(z_=1,Wg.exports=Zy()),Wg.exports}var Qg={exports:{}},Da={};var P_;function $y(){if(P_)return Da;P_=1;var b=c_();function A(dt){var vt="https://react.dev/errors/"+dt;if(1<arguments.length){vt+="?args[]="+encodeURIComponent(arguments[1]);for(var Wt=2;Wt<arguments.length;Wt++)vt+="&args[]="+encodeURIComponent(arguments[Wt])}return"Minified React error #"+dt+"; visit "+vt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function U(){}var Z={d:{f:U,r:function(){throw Error(A(522))},D:U,C:U,L:U,m:U,X:U,S:U,M:U},p:0,findDOMNode:null},it=Symbol.for("react.portal");function lt(dt,vt,Wt){var ee=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:it,key:ee==null?null:""+ee,children:dt,containerInfo:vt,implementation:Wt}}var R=b.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(dt,vt){if(dt==="font")return"";if(typeof vt=="string")return vt==="use-credentials"?vt:""}return Da.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Z,Da.createPortal=function(dt,vt){var Wt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vt||vt.nodeType!==1&&vt.nodeType!==9&&vt.nodeType!==11)throw Error(A(299));return lt(dt,vt,null,Wt)},Da.flushSync=function(dt){var vt=R.T,Wt=Z.p;try{if(R.T=null,Z.p=2,dt)return dt()}finally{R.T=vt,Z.p=Wt,Z.d.f()}},Da.preconnect=function(dt,vt){typeof dt=="string"&&(vt?(vt=vt.crossOrigin,vt=typeof vt=="string"?vt==="use-credentials"?vt:"":void 0):vt=null,Z.d.C(dt,vt))},Da.prefetchDNS=function(dt){typeof dt=="string"&&Z.d.D(dt)},Da.preinit=function(dt,vt){if(typeof dt=="string"&&vt&&typeof vt.as=="string"){var Wt=vt.as,ee=d(Wt,vt.crossOrigin),Bt=typeof vt.integrity=="string"?vt.integrity:void 0,Gt=typeof vt.fetchPriority=="string"?vt.fetchPriority:void 0;Wt==="style"?Z.d.S(dt,typeof vt.precedence=="string"?vt.precedence:void 0,{crossOrigin:ee,integrity:Bt,fetchPriority:Gt}):Wt==="script"&&Z.d.X(dt,{crossOrigin:ee,integrity:Bt,fetchPriority:Gt,nonce:typeof vt.nonce=="string"?vt.nonce:void 0})}},Da.preinitModule=function(dt,vt){if(typeof dt=="string")if(typeof vt=="object"&&vt!==null){if(vt.as==null||vt.as==="script"){var Wt=d(vt.as,vt.crossOrigin);Z.d.M(dt,{crossOrigin:Wt,integrity:typeof vt.integrity=="string"?vt.integrity:void 0,nonce:typeof vt.nonce=="string"?vt.nonce:void 0})}}else vt==null&&Z.d.M(dt)},Da.preload=function(dt,vt){if(typeof dt=="string"&&typeof vt=="object"&&vt!==null&&typeof vt.as=="string"){var Wt=vt.as,ee=d(Wt,vt.crossOrigin);Z.d.L(dt,Wt,{crossOrigin:ee,integrity:typeof vt.integrity=="string"?vt.integrity:void 0,nonce:typeof vt.nonce=="string"?vt.nonce:void 0,type:typeof vt.type=="string"?vt.type:void 0,fetchPriority:typeof vt.fetchPriority=="string"?vt.fetchPriority:void 0,referrerPolicy:typeof vt.referrerPolicy=="string"?vt.referrerPolicy:void 0,imageSrcSet:typeof vt.imageSrcSet=="string"?vt.imageSrcSet:void 0,imageSizes:typeof vt.imageSizes=="string"?vt.imageSizes:void 0,media:typeof vt.media=="string"?vt.media:void 0})}},Da.preloadModule=function(dt,vt){if(typeof dt=="string")if(vt){var Wt=d(vt.as,vt.crossOrigin);Z.d.m(dt,{as:typeof vt.as=="string"&&vt.as!=="script"?vt.as:void 0,crossOrigin:Wt,integrity:typeof vt.integrity=="string"?vt.integrity:void 0})}else Z.d.m(dt)},Da.requestFormReset=function(dt){Z.d.r(dt)},Da.unstable_batchedUpdates=function(dt,vt){return dt(vt)},Da.useFormState=function(dt,vt,Wt){return R.H.useFormState(dt,vt,Wt)},Da.useFormStatus=function(){return R.H.useHostTransitionStatus()},Da.version="19.2.0",Da}var R_;function Xy(){if(R_)return Qg.exports;R_=1;function b(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b)}catch(A){console.error(A)}}return b(),Qg.exports=$y(),Qg.exports}var L_;function Yy(){if(L_)return cm;L_=1;var b=Hy(),A=c_(),U=Xy();function Z(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function it(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function lt(n){var s=n,c=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(c=s.return),n=s.return;while(n)}return s.tag===3?c:null}function R(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function d(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function dt(n){if(lt(n)!==n)throw Error(Z(188))}function vt(n){var s=n.alternate;if(!s){if(s=lt(n),s===null)throw Error(Z(188));return s!==n?null:n}for(var c=n,_=s;;){var w=c.return;if(w===null)break;var M=w.alternate;if(M===null){if(_=w.return,_!==null){c=_;continue}break}if(w.child===M.child){for(M=w.child;M;){if(M===c)return dt(w),n;if(M===_)return dt(w),s;M=M.sibling}throw Error(Z(188))}if(c.return!==_.return)c=w,_=M;else{for(var F=!1,Y=w.child;Y;){if(Y===c){F=!0,c=w,_=M;break}if(Y===_){F=!0,_=w,c=M;break}Y=Y.sibling}if(!F){for(Y=M.child;Y;){if(Y===c){F=!0,c=M,_=w;break}if(Y===_){F=!0,_=M,c=w;break}Y=Y.sibling}if(!F)throw Error(Z(189))}}if(c.alternate!==_)throw Error(Z(190))}if(c.tag!==3)throw Error(Z(188));return c.stateNode.current===c?n:s}function Wt(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=Wt(n),s!==null)return s;n=n.sibling}return null}var ee=Object.assign,Bt=Symbol.for("react.element"),Gt=Symbol.for("react.transitional.element"),se=Symbol.for("react.portal"),Lt=Symbol.for("react.fragment"),_t=Symbol.for("react.strict_mode"),fe=Symbol.for("react.profiler"),me=Symbol.for("react.consumer"),le=Symbol.for("react.context"),mi=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Ye=Symbol.for("react.suspense_list"),be=Symbol.for("react.memo"),We=Symbol.for("react.lazy"),ii=Symbol.for("react.activity"),Pi=Symbol.for("react.memo_cache_sentinel"),Wi=Symbol.iterator;function yi(n){return n===null||typeof n!="object"?null:(n=Wi&&n[Wi]||n["@@iterator"],typeof n=="function"?n:null)}var jn=Symbol.for("react.client.reference");function cn(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===jn?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Lt:return"Fragment";case fe:return"Profiler";case _t:return"StrictMode";case ue:return"Suspense";case Ye:return"SuspenseList";case ii:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case se:return"Portal";case le:return n.displayName||"Context";case me:return(n._context.displayName||"Context")+".Consumer";case mi:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case be:return s=n.displayName||null,s!==null?s:cn(n.type)||"Memo";case We:s=n._payload,n=n._init;try{return cn(n(s))}catch{}}return null}var wr=Array.isArray,Ut=A.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ce=U.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Oe={pending:!1,data:null,method:null,action:null},De=[],vi=-1;function Tt(n){return{current:n}}function Kt(n){0>vi||(n.current=De[vi],De[vi]=null,vi--)}function ge(n,s){vi++,De[vi]=n.current,n.current=s}var xe=Tt(null),Ne=Tt(null),ke=Tt(null),Ke=Tt(null);function Mi(n,s){switch(ge(ke,s),ge(Ne,n),ge(xe,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?Np(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=Np(s),n=Nf(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}Kt(xe),ge(xe,n)}function Xi(){Kt(xe),Kt(Ne),Kt(ke)}function fa(n){n.memoizedState!==null&&ge(Ke,n);var s=xe.current,c=Nf(s,n.type);s!==c&&(ge(Ne,n),ge(xe,c))}function es(n){Ne.current===n&&(Kt(xe),Kt(Ne)),Ke.current===n&&(Kt(Ke),Ec._currentValue=Oe)}var Or,Fl;function Ci(n){if(Or===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Or=s&&s[1]||"",Fl=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Or+n+Fl}var Kr=!1;function pa(n,s){if(!n||Kr)return"";Kr=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var Jt=function(){throw Error()};if(Object.defineProperty(Jt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Jt,[])}catch(Nt){var kt=Nt}Reflect.construct(n,[],Jt)}else{try{Jt.call()}catch(Nt){kt=Nt}n.call(Jt.prototype)}}else{try{throw Error()}catch(Nt){kt=Nt}(Jt=n())&&typeof Jt.catch=="function"&&Jt.catch(function(){})}}catch(Nt){if(Nt&&kt&&typeof Nt.stack=="string")return[Nt.stack,kt.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=_.DetermineComponentFrameRoot(),F=M[0],Y=M[1];if(F&&Y){var mt=F.split(`
`),Rt=Y.split(`
`);for(w=_=0;_<mt.length&&!mt[_].includes("DetermineComponentFrameRoot");)_++;for(;w<Rt.length&&!Rt[w].includes("DetermineComponentFrameRoot");)w++;if(_===mt.length||w===Rt.length)for(_=mt.length-1,w=Rt.length-1;1<=_&&0<=w&&mt[_]!==Rt[w];)w--;for(;1<=_&&0<=w;_--,w--)if(mt[_]!==Rt[w]){if(_!==1||w!==1)do if(_--,w--,0>w||mt[_]!==Rt[w]){var Zt=`
`+mt[_].replace(" at new "," at ");return n.displayName&&Zt.includes("<anonymous>")&&(Zt=Zt.replace("<anonymous>",n.displayName)),Zt}while(1<=_&&0<=w);break}}}finally{Kr=!1,Error.prepareStackTrace=c}return(c=n?n.displayName||n.name:"")?Ci(c):""}function an(n,s){switch(n.tag){case 26:case 27:case 5:return Ci(n.type);case 16:return Ci("Lazy");case 13:return n.child!==s&&s!==null?Ci("Suspense Fallback"):Ci("Suspense");case 19:return Ci("SuspenseList");case 0:case 15:return pa(n.type,!1);case 11:return pa(n.type.render,!1);case 1:return pa(n.type,!0);case 31:return Ci("Activity");default:return""}}function za(n){try{var s="",c=null;do s+=an(n,c),c=n,n=n.return;while(n);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var ma=Object.prototype.hasOwnProperty,co=b.unstable_scheduleCallback,is=b.unstable_cancelCallback,ns=b.unstable_shouldYield,ho=b.unstable_requestPaint,Vn=b.unstable_now,kr=b.unstable_getCurrentPriorityLevel,Nl=b.unstable_ImmediatePriority,jl=b.unstable_UserBlockingPriority,rs=b.unstable_NormalPriority,Vl=b.unstable_LowPriority,Rs=b.unstable_IdlePriority,Ul=b.log,Ho=b.unstable_setDisableYieldValue,Tr=null,Ki=null;function ft(n){if(typeof Ul=="function"&&Ho(n),Ki&&typeof Ki.setStrictMode=="function")try{Ki.setStrictMode(Tr,n)}catch{}}var j=Math.clz32?Math.clz32:st,q=Math.log,$=Math.LN2;function st(n){return n>>>=0,n===0?32:31-(q(n)/$|0)|0}var ut=256,St=262144,J=4194304;function xt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Pt(n,s,c){var _=n.pendingLanes;if(_===0)return 0;var w=0,M=n.suspendedLanes,F=n.pingedLanes;n=n.warmLanes;var Y=_&134217727;return Y!==0?(_=Y&~M,_!==0?w=xt(_):(F&=Y,F!==0?w=xt(F):c||(c=Y&~n,c!==0&&(w=xt(c))))):(Y=_&~M,Y!==0?w=xt(Y):F!==0?w=xt(F):c||(c=_&~n,c!==0&&(w=xt(c)))),w===0?0:s!==0&&s!==w&&(s&M)===0&&(M=w&-w,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:w}function Ot(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Ft(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pe(){var n=J;return J<<=1,(J&62914560)===0&&(J=4194304),n}function Te(n){for(var s=[],c=0;31>c;c++)s.push(n);return s}function Be(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function hn(n,s,c,_,w,M){var F=n.pendingLanes;n.pendingLanes=c,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=c,n.entangledLanes&=c,n.errorRecoveryDisabledLanes&=c,n.shellSuspendCounter=0;var Y=n.entanglements,mt=n.expirationTimes,Rt=n.hiddenUpdates;for(c=F&~c;0<c;){var Zt=31-j(c),Jt=1<<Zt;Y[Zt]=0,mt[Zt]=-1;var kt=Rt[Zt];if(kt!==null)for(Rt[Zt]=null,Zt=0;Zt<kt.length;Zt++){var Nt=kt[Zt];Nt!==null&&(Nt.lane&=-536870913)}c&=~Jt}_!==0&&He(n,_,0),M!==0&&w===0&&n.tag!==0&&(n.suspendedLanes|=M&~(F&~s))}function He(n,s,c){n.pendingLanes|=s,n.suspendedLanes&=~s;var _=31-j(s);n.entangledLanes|=s,n.entanglements[_]=n.entanglements[_]|1073741824|c&261930}function di(n,s){var c=n.entangledLanes|=s;for(n=n.entanglements;c;){var _=31-j(c),w=1<<_;w&s|n[_]&s&&(n[_]|=s),c&=~w}}function Ri(n,s){var c=s&-s;return c=(c&42)!==0?1:te(c),(c&(n.suspendedLanes|s))!==0?0:c}function te(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Li(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Oi(){var n=ce.p;return n!==0?n:(n=window.event,n===void 0?32:ng(n.type))}function En(n,s){var c=ce.p;try{return ce.p=n,s()}finally{ce.p=c}}var fi=Math.random().toString(36).slice(2),$t="__reactFiber$"+fi,he="__reactProps$"+fi,Se="__reactContainer$"+fi,fr="__reactEvents$"+fi,$o="__reactListeners$"+fi,Qn="__reactHandles$"+fi,Pe="__reactResources$"+fi,Qr="__reactMarker$"+fi;function fo(n){delete n[$t],delete n[he],delete n[fr],delete n[$o],delete n[Qn]}function Pa(n){var s=n[$t];if(s)return s;for(var c=n.parentNode;c;){if(s=c[Se]||c[$t]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(n=Gp(n);n!==null;){if(c=n[$t])return c;n=Gp(n)}return s}n=c,c=n.parentNode}return null}function pr(n){if(n=n[$t]||n[Se]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function Ra(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(Z(33))}function La(n){var s=n[Pe];return s||(s=n[Pe]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function dn(n){n[Qr]=!0}var Br=new Set,ki={};function Xo(n,s){Sr(n,s),Sr(n+"Capture",s)}function Sr(n,s){for(ki[n]=s,n=0;n<s.length;n++)Br.add(s[n])}var Iu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qi={},Ls={};function kh(n){return ma.call(Ls,n)?!0:ma.call(Qi,n)?!1:Iu.test(n)?Ls[n]=!0:(Qi[n]=!0,!1)}function Os(n,s,c){if(kh(s))if(c===null)n.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+c)}}function Gl(n,s,c){if(c===null)n.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+c)}}function Fr(n,s,c,_){if(_===null)n.removeAttribute(c);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(c);return}n.setAttributeNS(s,c,""+_)}}function Jr(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Bh(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function tp(n,s,c){var _=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var w=_.get,M=_.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return w.call(this)},set:function(F){c=""+F,M.call(this,F)}}),Object.defineProperty(n,s,{enumerable:_.enumerable}),{getValue:function(){return c},setValue:function(F){c=""+F},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Pc(n){if(!n._valueTracker){var s=Bh(n)?"checked":"value";n._valueTracker=tp(n,s,""+n[s])}}function Fh(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var c=s.getValue(),_="";return n&&(_=Bh(n)?n.checked?"true":"false":n.value),n=_,n!==c?(s.setValue(n),!0):!1}function zu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Nh=/[\n"\\]/g;function Nr(n){return n.replace(Nh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Rc(n,s,c,_,w,M,F,Y){n.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?n.type=F:n.removeAttribute("type"),s!=null?F==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+Jr(s)):n.value!==""+Jr(s)&&(n.value=""+Jr(s)):F!=="submit"&&F!=="reset"||n.removeAttribute("value"),s!=null?Pu(n,F,Jr(s)):c!=null?Pu(n,F,Jr(c)):_!=null&&n.removeAttribute("value"),w==null&&M!=null&&(n.defaultChecked=!!M),w!=null&&(n.checked=w&&typeof w!="function"&&typeof w!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?n.name=""+Jr(Y):n.removeAttribute("name")}function Lc(n,s,c,_,w,M,F,Y){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(n.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){Pc(n);return}c=c!=null?""+Jr(c):"",s=s!=null?""+Jr(s):c,Y||s===n.value||(n.value=s),n.defaultValue=s}_=_??w,_=typeof _!="function"&&typeof _!="symbol"&&!!_,n.checked=Y?n.checked:!!_,n.defaultChecked=!!_,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(n.name=F),Pc(n)}function Pu(n,s,c){s==="number"&&zu(n.ownerDocument)===n||n.defaultValue===""+c||(n.defaultValue=""+c)}function Yo(n,s,c,_){if(n=n.options,s){s={};for(var w=0;w<c.length;w++)s["$"+c[w]]=!0;for(c=0;c<n.length;c++)w=s.hasOwnProperty("$"+n[c].value),n[c].selected!==w&&(n[c].selected=w),w&&_&&(n[c].defaultSelected=!0)}else{for(c=""+Jr(c),s=null,w=0;w<n.length;w++){if(n[w].value===c){n[w].selected=!0,_&&(n[w].defaultSelected=!0);return}s!==null||n[w].disabled||(s=n[w])}s!==null&&(s.selected=!0)}}function as(n,s,c){if(s!=null&&(s=""+Jr(s),s!==n.value&&(n.value=s),c==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=c!=null?""+Jr(c):""}function Ru(n,s,c,_){if(s==null){if(_!=null){if(c!=null)throw Error(Z(92));if(wr(_)){if(1<_.length)throw Error(Z(93));_=_[0]}c=_}c==null&&(c=""),s=c}c=Jr(s),n.defaultValue=c,_=n.textContent,_===c&&_!==""&&_!==null&&(n.value=_),Pc(n)}function Wo(n,s){if(s){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=s;return}}n.textContent=s}var ss=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jh(n,s,c){var _=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?_?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":_?n.setProperty(s,c):typeof c!="number"||c===0||ss.has(s)?s==="float"?n.cssFloat=c:n[s]=(""+c).trim():n[s]=c+"px"}function $d(n,s,c){if(s!=null&&typeof s!="object")throw Error(Z(62));if(n=n.style,c!=null){for(var _ in c)!c.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?n.setProperty(_,""):_==="float"?n.cssFloat="":n[_]="");for(var w in s)_=s[w],s.hasOwnProperty(w)&&c[w]!==_&&jh(n,w,_)}else for(var M in s)s.hasOwnProperty(M)&&jh(n,M,s[M])}function os(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ko=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Qe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Er(n){return Qe.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function Ge(){}var ls=null;function vn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Mn=null,Cn=null;function Pn(n){var s=pr(n);if(s&&(n=s.stateNode)){var c=n[he]||null;t:switch(n=s.stateNode,s.type){case"input":if(Rc(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Nr(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var _=c[s];if(_!==n&&_.form===n.form){var w=_[he]||null;if(!w)throw Error(Z(90));Rc(_,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(s=0;s<c.length;s++)_=c[s],_.form===n.form&&Fh(_)}break t;case"textarea":as(n,c.value,c.defaultValue);break t;case"select":s=c.value,s!=null&&Yo(n,!!c.multiple,s,!1)}}}var Ii=!1;function Lu(n,s,c){if(Ii)return n(s,c);Ii=!0;try{var _=n(s);return _}finally{if(Ii=!1,(Mn!==null||Cn!==null)&&(vh(),Mn&&(s=Mn,n=Cn,Cn=Mn=null,Pn(s),n)))for(s=0;s<n.length;s++)Pn(n[s])}}function Un(n,s){var c=n.stateNode;if(c===null)return null;var _=c[he]||null;if(_===null)return null;c=_[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(n=n.type,_=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!_;break t;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error(Z(231,s,typeof c));return c}var xn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jn=!1;if(xn)try{var ql={};Object.defineProperty(ql,"passive",{get:function(){Jn=!0}}),window.addEventListener("test",ql,ql),window.removeEventListener("test",ql,ql)}catch{Jn=!1}var Mr=null,Bi=null,ks=null;function Bs(){if(ks)return ks;var n,s=Bi,c=s.length,_,w="value"in Mr?Mr.value:Mr.textContent,M=w.length;for(n=0;n<c&&s[n]===w[n];n++);var F=c-n;for(_=1;_<=F&&s[c-_]===w[M-_];_++);return ks=w.slice(n,1<_?1-_:void 0)}function po(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function rr(){return!0}function Gi(){return!1}function fn(n){function s(c,_,w,M,F){this._reactName=c,this._targetInst=w,this.type=_,this.nativeEvent=M,this.target=F,this.currentTarget=null;for(var Y in n)n.hasOwnProperty(Y)&&(c=n[Y],this[Y]=c?c(M):M[Y]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?rr:Gi,this.isPropagationStopped=Gi,this}return ee(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=rr)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=rr)},persist:function(){},isPersistent:rr}),s}var $e={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ve=fn($e),us=ee({},$e,{view:0,detail:0}),ri=fn(us),mo,ta,Fs,cs=ee({},us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bc,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Fs&&(Fs&&n.type==="mousemove"?(mo=n.screenX-Fs.screenX,ta=n.screenY-Fs.screenY):ta=mo=0,Fs=n),mo)},movementY:function(n){return"movementY"in n?n.movementY:ta}}),Ou=fn(cs),ku=ee({},cs,{dataTransfer:0}),Bu=fn(ku),Oc=ee({},us,{relatedTarget:0}),go=fn(Oc),Xd=ee({},$e,{animationName:0,elapsedTime:0,pseudoElement:0}),hs=fn(Xd),ar=ee({},$e,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),kc=fn(ar),Yd=ee({},$e,{data:0}),tr=fn(Yd),Rn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Oa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vh(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Zl[n])?!!s[n]:!1}function Bc(){return Vh}var ka=ee({},us,{key:function(n){if(n.key){var s=Rn[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=po(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Oa[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bc,charCode:function(n){return n.type==="keypress"?po(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?po(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Fc=fn(ka),Uh=ee({},cs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wd=fn(Uh),Kd=ee({},us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bc}),Nc=fn(Kd),jc=ee({},$e,{propertyName:0,elapsedTime:0,pseudoElement:0}),jr=fn(jc),Vc=ee({},cs,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Qo=fn(Vc),Gh=ee({},$e,{newState:0,oldState:0}),Fu=fn(Gh),ds=[9,13,27,32],qh=xn&&"CompositionEvent"in window,Jo=null;xn&&"documentMode"in document&&(Jo=document.documentMode);var Nu=xn&&"TextEvent"in window&&!Jo,Ns=xn&&(!qh||Jo&&8<Jo&&11>=Jo),Qd=" ",Hl=!1;function Zh(n,s){switch(n){case"keyup":return ds.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tl(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var el=!1;function Jd(n,s){switch(n){case"compositionend":return tl(s);case"keypress":return s.which!==32?null:(Hl=!0,Qd);case"textInput":return n=s.data,n===Qd&&Hl?null:n;default:return null}}function ep(n,s){if(el)return n==="compositionend"||!qh&&Zh(n,s)?(n=Bs(),ks=Bi=Mr=null,el=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ns&&s.locale!=="ko"?null:s.data;default:return null}}var tf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uc(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!tf[n.type]:s==="textarea"}function Hh(n,s,c,_){Mn?Cn?Cn.push(_):Cn=[_]:Mn=_,s=zd(s,"onChange"),0<s.length&&(c=new Ve("onChange","change",null,c,_),n.push({event:c,listeners:s}))}var il=null,nl=null;function $h(n){Al(n,0)}function fs(n){var s=Ra(n);if(Fh(s))return n}function Xh(n,s){if(n==="change")return s}var Yh=!1;if(xn){var rl;if(xn){var $l="oninput"in document;if(!$l){var Xl=document.createElement("div");Xl.setAttribute("oninput","return;"),$l=typeof Xl.oninput=="function"}rl=$l}else rl=!1;Yh=rl&&(!document.documentMode||9<document.documentMode)}function ef(){il&&(il.detachEvent("onpropertychange",nf),nl=il=null)}function nf(n){if(n.propertyName==="value"&&fs(nl)){var s=[];Hh(s,nl,n,vn(n)),Lu($h,s)}}function rf(n,s,c){n==="focusin"?(ef(),il=s,nl=c,il.attachEvent("onpropertychange",nf)):n==="focusout"&&ef()}function Gc(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return fs(nl)}function Wh(n,s){if(n==="click")return fs(s)}function Kh(n,s){if(n==="input"||n==="change")return fs(s)}function af(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var sr=typeof Object.is=="function"?Object.is:af;function Vr(n,s){if(sr(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var c=Object.keys(n),_=Object.keys(s);if(c.length!==_.length)return!1;for(_=0;_<c.length;_++){var w=c[_];if(!ma.call(s,w)||!sr(n[w],s[w]))return!1}return!0}function qc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Zc(n,s){var c=qc(n);n=0;for(var _;c;){if(c.nodeType===3){if(_=n+c.textContent.length,n<=s&&_>=s)return{node:c,offset:s-n};n=_}t:{for(;c;){if(c.nextSibling){c=c.nextSibling;break t}c=c.parentNode}c=void 0}c=qc(c)}}function Hc(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Hc(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function $c(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=zu(n.document);s instanceof n.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)n=s.contentWindow;else break;s=zu(n.document)}return s}function ju(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var al=xn&&"documentMode"in document&&11>=document.documentMode,_o=null,Qh=null,ai=null,Jh=!1;function sf(n,s,c){var _=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Jh||_o==null||_o!==zu(_)||(_=_o,"selectionStart"in _&&ju(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),ai&&Vr(ai,_)||(ai=_,_=zd(Qh,"onSelect"),0<_.length&&(s=new Ve("onSelect","select",null,s,c),n.push({event:s,listeners:_}),s.target=_o)))}function yo(n,s){var c={};return c[n.toLowerCase()]=s.toLowerCase(),c["Webkit"+n]="webkit"+s,c["Moz"+n]="moz"+s,c}var Yl={animationend:yo("Animation","AnimationEnd"),animationiteration:yo("Animation","AnimationIteration"),animationstart:yo("Animation","AnimationStart"),transitionrun:yo("Transition","TransitionRun"),transitionstart:yo("Transition","TransitionStart"),transitioncancel:yo("Transition","TransitionCancel"),transitionend:yo("Transition","TransitionEnd")},Xc={},Vu={};xn&&(Vu=document.createElement("div").style,"AnimationEvent"in window||(delete Yl.animationend.animation,delete Yl.animationiteration.animation,delete Yl.animationstart.animation),"TransitionEvent"in window||delete Yl.transitionend.transition);function ps(n){if(Xc[n])return Xc[n];if(!Yl[n])return n;var s=Yl[n],c;for(c in s)if(s.hasOwnProperty(c)&&c in Vu)return Xc[n]=s[c];return n}var Uu=ps("animationend"),Yc=ps("animationiteration"),vo=ps("animationstart"),Gu=ps("transitionrun"),Wl=ps("transitionstart"),ga=ps("transitioncancel"),td=ps("transitionend"),ed=new Map,qu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");qu.push("scrollEnd");function or(n,s){ed.set(n,s),Xo(s,[n])}var sl=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Cr=[],ms=0,Kl=0;function Zu(){for(var n=ms,s=Kl=ms=0;s<n;){var c=Cr[s];Cr[s++]=null;var _=Cr[s];Cr[s++]=null;var w=Cr[s];Cr[s++]=null;var M=Cr[s];if(Cr[s++]=null,_!==null&&w!==null){var F=_.pending;F===null?w.next=w:(w.next=F.next,F.next=w),_.pending=w}M!==0&&Wc(c,w,M)}}function js(n,s,c,_){Cr[ms++]=n,Cr[ms++]=s,Cr[ms++]=c,Cr[ms++]=_,Kl|=_,n.lanes|=_,n=n.alternate,n!==null&&(n.lanes|=_)}function xo(n,s,c,_){return js(n,s,c,_),qe(n)}function bo(n,s){return js(n,null,null,s),qe(n)}function Wc(n,s,c){n.lanes|=c;var _=n.alternate;_!==null&&(_.lanes|=c);for(var w=!1,M=n.return;M!==null;)M.childLanes|=c,_=M.alternate,_!==null&&(_.childLanes|=c),M.tag===22&&(n=M.stateNode,n===null||n._visibility&1||(w=!0)),n=M,M=M.return;return n.tag===3?(M=n.stateNode,w&&s!==null&&(w=31-j(c),n=M.hiddenUpdates,_=n[w],_===null?n[w]=[s]:_.push(s),s.lane=c|536870912),M):null}function qe(n){if(50<Ml)throw Ml=0,bp=null,Error(Z(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Vs={};function ip(n,s,c,_){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ur(n,s,c,_){return new ip(n,s,c,_)}function ol(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ba(n,s){var c=n.alternate;return c===null?(c=Ur(n.tag,s,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=s,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&65011712,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,s=n.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c.refCleanup=n.refCleanup,c}function of(n,s){n.flags&=65011714;var c=n.alternate;return c===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=c.childLanes,n.lanes=c.lanes,n.child=c.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=c.memoizedProps,n.memoizedState=c.memoizedState,n.updateQueue=c.updateQueue,n.type=c.type,s=c.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function Hu(n,s,c,_,w,M){var F=0;if(_=n,typeof n=="function")ol(n)&&(F=1);else if(typeof n=="string")F=Yp(n,c,xe.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case ii:return n=Ur(31,c,s,w),n.elementType=ii,n.lanes=M,n;case Lt:return ll(c.children,w,M,s);case _t:F=8,w|=24;break;case fe:return n=Ur(12,c,s,w|2),n.elementType=fe,n.lanes=M,n;case ue:return n=Ur(13,c,s,w),n.elementType=ue,n.lanes=M,n;case Ye:return n=Ur(19,c,s,w),n.elementType=Ye,n.lanes=M,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case le:F=10;break t;case me:F=9;break t;case mi:F=11;break t;case be:F=14;break t;case We:F=16,_=null;break t}F=29,c=Error(Z(130,n===null?"null":typeof n,"")),_=null}return s=Ur(F,c,s,w),s.elementType=n,s.type=_,s.lanes=M,s}function ll(n,s,c,_){return n=Ur(7,n,_,s),n.lanes=c,n}function Ql(n,s,c){return n=Ur(6,n,null,s),n.lanes=c,n}function $u(n){var s=Ur(18,null,null,0);return s.stateNode=n,s}function Jl(n,s,c){return s=Ur(4,n.children!==null?n.children:[],n.key,s),s.lanes=c,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var wo=new WeakMap;function Ar(n,s){if(typeof n=="object"&&n!==null){var c=wo.get(n);return c!==void 0?c:(s={value:n,source:s,stack:za(s)},wo.set(n,s),s)}return{value:n,source:s,stack:za(s)}}var ul=[],Us=0,cl=null,To=0,lr=[],Dr=0,Gs=null,Gr=1,gs="";function Fa(n,s){ul[Us++]=To,ul[Us++]=cl,cl=n,To=s}function tu(n,s,c){lr[Dr++]=Gr,lr[Dr++]=gs,lr[Dr++]=Gs,Gs=n;var _=Gr;n=gs;var w=32-j(_)-1;_&=~(1<<w),c+=1;var M=32-j(s)+w;if(30<M){var F=w-w%5;M=(_&(1<<F)-1).toString(32),_>>=F,w-=F,Gr=1<<32-j(s)+w|c<<w|_,gs=M+n}else Gr=1<<M|c<<w|_,gs=n}function eu(n){n.return!==null&&(Fa(n,1),tu(n,1,0))}function Kc(n){for(;n===cl;)cl=ul[--Us],ul[Us]=null,To=ul[--Us],ul[Us]=null;for(;n===Gs;)Gs=lr[--Dr],lr[Dr]=null,gs=lr[--Dr],lr[Dr]=null,Gr=lr[--Dr],lr[Dr]=null}function id(n,s){lr[Dr++]=Gr,lr[Dr++]=gs,lr[Dr++]=Gs,Gr=s.id,gs=s.overflow,Gs=n}var Ln=null,qi=null,si=!1,_s=null,ci=!1,Na=Error(Z(519));function An(n){var s=Error(Z(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw qs(Ar(s,n)),Na}function iu(n){var s=n.stateNode,c=n.type,_=n.memoizedProps;switch(s[$t]=n,s[he]=_,c){case"dialog":oi("cancel",s),oi("close",s);break;case"iframe":case"object":case"embed":oi("load",s);break;case"video":case"audio":for(c=0;c<Dd.length;c++)oi(Dd[c],s);break;case"source":oi("error",s);break;case"img":case"image":case"link":oi("error",s),oi("load",s);break;case"details":oi("toggle",s);break;case"input":oi("invalid",s),Lc(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":oi("invalid",s);break;case"textarea":oi("invalid",s),Ru(s,_.value,_.defaultValue,_.children)}c=_.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||_.suppressHydrationWarning===!0||xc(s.textContent,c)?(_.popover!=null&&(oi("beforetoggle",s),oi("toggle",s)),_.onScroll!=null&&oi("scroll",s),_.onScrollEnd!=null&&oi("scrollend",s),_.onClick!=null&&(s.onclick=Ge),s=!0):s=!1,s||An(n,!0)}function So(n){for(Ln=n.return;Ln;)switch(Ln.tag){case 5:case 31:case 13:ci=!1;return;case 27:case 3:ci=!0;return;default:Ln=Ln.return}}function hl(n){if(n!==Ln)return!1;if(!si)return So(n),si=!0,!1;var s=n.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=n.type,c=!(c!=="form"&&c!=="button")||Ld(n.type,n.memoizedProps)),c=!c),c&&qi&&An(n),So(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));qi=Wm(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));qi=Wm(n)}else s===27?(s=qi,Yn(n.type)?(n=bu,bu=null,qi=n):qi=s):qi=Ln?vr(n.stateNode.nextSibling):null;return!0}function _a(){qi=Ln=null,si=!1}function Xu(){var n=_s;return n!==null&&(sa===null?sa=n:sa.push.apply(sa,n),_s=null),n}function qs(n){_s===null?_s=[n]:_s.push(n)}var Yu=Tt(null),Eo=null,ja=null;function ys(n,s,c){ge(Yu,s._currentValue),s._currentValue=c}function ea(n){n._currentValue=Yu.current,Kt(Yu)}function Qc(n,s,c){for(;n!==null;){var _=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),n===c)break;n=n.return}}function vs(n,s,c,_){var w=n.child;for(w!==null&&(w.return=n);w!==null;){var M=w.dependencies;if(M!==null){var F=w.child;M=M.firstContext;t:for(;M!==null;){var Y=M;M=w;for(var mt=0;mt<s.length;mt++)if(Y.context===s[mt]){M.lanes|=c,Y=M.alternate,Y!==null&&(Y.lanes|=c),Qc(M.return,c,n),_||(F=null);break t}M=Y.next}}else if(w.tag===18){if(F=w.return,F===null)throw Error(Z(341));F.lanes|=c,M=F.alternate,M!==null&&(M.lanes|=c),Qc(F,c,n),F=null}else F=w.child;if(F!==null)F.return=w;else for(F=w;F!==null;){if(F===n){F=null;break}if(w=F.sibling,w!==null){w.return=F.return,F=w;break}F=F.return}w=F}}function Mo(n,s,c,_){n=null;for(var w=s,M=!1;w!==null;){if(!M){if((w.flags&524288)!==0)M=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var F=w.alternate;if(F===null)throw Error(Z(387));if(F=F.memoizedProps,F!==null){var Y=w.type;sr(w.pendingProps.value,F.value)||(n!==null?n.push(Y):n=[Y])}}else if(w===Ke.current){if(F=w.alternate,F===null)throw Error(Z(387));F.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(n!==null?n.push(Ec):n=[Ec])}w=w.return}n!==null&&vs(s,n,c,_),s.flags|=262144}function Wu(n){for(n=n.firstContext;n!==null;){if(!sr(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Zs(n){Eo=n,ja=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Gn(n){return nd(Eo,n)}function Hs(n,s){return Eo===null&&Zs(n),nd(n,s)}function nd(n,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},ja===null){if(n===null)throw Error(Z(308));ja=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else ja=ja.next=s;return c}var lf=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(c,_){n.push(_)}};this.abort=function(){s.aborted=!0,n.forEach(function(c){return c()})}},uf=b.unstable_scheduleCallback,Jc=b.unstable_NormalPriority,Dn={$$typeof:le,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qr(){return{controller:new lf,data:new Map,refCount:0}}function qn(n){n.refCount--,n.refCount===0&&uf(Jc,function(){n.controller.abort()})}var xs=null,Ji=0,bs=0,ya=null;function np(n,s){if(xs===null){var c=xs=[];Ji=0,bs=Cd(),ya={status:"pending",value:void 0,then:function(_){c.push(_)}}}return Ji++,s.then(cf,cf),s}function cf(){if(--Ji===0&&xs!==null){ya!==null&&(ya.status="fulfilled");var n=xs;xs=null,bs=0,ya=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function Ku(n,s){var c=[],_={status:"pending",value:null,reason:null,then:function(w){c.push(w)}};return n.then(function(){_.status="fulfilled",_.value=s;for(var w=0;w<c.length;w++)(0,c[w])(s)},function(w){for(_.status="rejected",_.reason=w,w=0;w<c.length;w++)(0,c[w])(void 0)}),_}var rd=Ut.S;Ut.S=function(n,s){Lm=Vn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&np(n,s),rd!==null&&rd(n,s)};var ws=Tt(null);function dl(){var n=ws.current;return n!==null?n:$i.pooledCache}function Zr(n,s){s===null?ge(ws,ws.current):ge(ws,s.pool)}function de(){var n=dl();return n===null?null:{parent:Dn._currentValue,pool:n}}var Va=Error(Z(460)),Qu=Error(Z(474)),Ju=Error(Z(542)),Co={then:function(){}};function Ts(n){return n=n.status,n==="fulfilled"||n==="rejected"}function th(n,s,c){switch(c=n[c],c===void 0?n.push(s):c!==s&&(s.then(Ge,Ge),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,nu(n),n;default:if(typeof s.status=="string")s.then(Ge,Ge);else{if(n=$i,n!==null&&100<n.shellSuspendCounter)throw Error(Z(482));n=s,n.status="pending",n.then(function(_){if(s.status==="pending"){var w=s;w.status="fulfilled",w.value=_}},function(_){if(s.status==="pending"){var w=s;w.status="rejected",w.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,nu(n),n}throw va=s,Va}}function fl(n){try{var s=n._init;return s(n._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(va=c,Va):c}}var va=null;function ad(){if(va===null)throw Error(Z(459));var n=va;return va=null,n}function nu(n){if(n===Va||n===Ju)throw Error(Z(483))}var $s=null,pl=0;function tc(n){var s=pl;return pl+=1,$s===null&&($s=[]),th($s,n,s)}function ru(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function au(n,s){throw s.$$typeof===Bt?Error(Z(525)):(n=Object.prototype.toString.call(s),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function eh(n){function s(Et,wt){if(n){var zt=Et.deletions;zt===null?(Et.deletions=[wt],Et.flags|=16):zt.push(wt)}}function c(Et,wt){if(!n)return null;for(;wt!==null;)s(Et,wt),wt=wt.sibling;return null}function _(Et){for(var wt=new Map;Et!==null;)Et.key!==null?wt.set(Et.key,Et):wt.set(Et.index,Et),Et=Et.sibling;return wt}function w(Et,wt){return Et=Ba(Et,wt),Et.index=0,Et.sibling=null,Et}function M(Et,wt,zt){return Et.index=zt,n?(zt=Et.alternate,zt!==null?(zt=zt.index,zt<wt?(Et.flags|=67108866,wt):zt):(Et.flags|=67108866,wt)):(Et.flags|=1048576,wt)}function F(Et){return n&&Et.alternate===null&&(Et.flags|=67108866),Et}function Y(Et,wt,zt,Yt){return wt===null||wt.tag!==6?(wt=Ql(zt,Et.mode,Yt),wt.return=Et,wt):(wt=w(wt,zt),wt.return=Et,wt)}function mt(Et,wt,zt,Yt){var ze=zt.type;return ze===Lt?Zt(Et,wt,zt.props.children,Yt,zt.key):wt!==null&&(wt.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===We&&fl(ze)===wt.type)?(wt=w(wt,zt.props),ru(wt,zt),wt.return=Et,wt):(wt=Hu(zt.type,zt.key,zt.props,null,Et.mode,Yt),ru(wt,zt),wt.return=Et,wt)}function Rt(Et,wt,zt,Yt){return wt===null||wt.tag!==4||wt.stateNode.containerInfo!==zt.containerInfo||wt.stateNode.implementation!==zt.implementation?(wt=Jl(zt,Et.mode,Yt),wt.return=Et,wt):(wt=w(wt,zt.children||[]),wt.return=Et,wt)}function Zt(Et,wt,zt,Yt,ze){return wt===null||wt.tag!==7?(wt=ll(zt,Et.mode,Yt,ze),wt.return=Et,wt):(wt=w(wt,zt),wt.return=Et,wt)}function Jt(Et,wt,zt){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return wt=Ql(""+wt,Et.mode,zt),wt.return=Et,wt;if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case Gt:return zt=Hu(wt.type,wt.key,wt.props,null,Et.mode,zt),ru(zt,wt),zt.return=Et,zt;case se:return wt=Jl(wt,Et.mode,zt),wt.return=Et,wt;case We:return wt=fl(wt),Jt(Et,wt,zt)}if(wr(wt)||yi(wt))return wt=ll(wt,Et.mode,zt,null),wt.return=Et,wt;if(typeof wt.then=="function")return Jt(Et,tc(wt),zt);if(wt.$$typeof===le)return Jt(Et,Hs(Et,wt),zt);au(Et,wt)}return null}function kt(Et,wt,zt,Yt){var ze=wt!==null?wt.key:null;if(typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint")return ze!==null?null:Y(Et,wt,""+zt,Yt);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case Gt:return zt.key===ze?mt(Et,wt,zt,Yt):null;case se:return zt.key===ze?Rt(Et,wt,zt,Yt):null;case We:return zt=fl(zt),kt(Et,wt,zt,Yt)}if(wr(zt)||yi(zt))return ze!==null?null:Zt(Et,wt,zt,Yt,null);if(typeof zt.then=="function")return kt(Et,wt,tc(zt),Yt);if(zt.$$typeof===le)return kt(Et,wt,Hs(Et,zt),Yt);au(Et,zt)}return null}function Nt(Et,wt,zt,Yt,ze){if(typeof Yt=="string"&&Yt!==""||typeof Yt=="number"||typeof Yt=="bigint")return Et=Et.get(zt)||null,Y(wt,Et,""+Yt,ze);if(typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case Gt:return Et=Et.get(Yt.key===null?zt:Yt.key)||null,mt(wt,Et,Yt,ze);case se:return Et=Et.get(Yt.key===null?zt:Yt.key)||null,Rt(wt,Et,Yt,ze);case We:return Yt=fl(Yt),Nt(Et,wt,zt,Yt,ze)}if(wr(Yt)||yi(Yt))return Et=Et.get(zt)||null,Zt(wt,Et,Yt,ze,null);if(typeof Yt.then=="function")return Nt(Et,wt,zt,tc(Yt),ze);if(Yt.$$typeof===le)return Nt(Et,wt,zt,Hs(wt,Yt),ze);au(wt,Yt)}return null}function we(Et,wt,zt,Yt){for(var ze=null,_i=null,Ee=wt,Xe=wt=0,li=null;Ee!==null&&Xe<zt.length;Xe++){Ee.index>Xe?(li=Ee,Ee=null):li=Ee.sibling;var wi=kt(Et,Ee,zt[Xe],Yt);if(wi===null){Ee===null&&(Ee=li);break}n&&Ee&&wi.alternate===null&&s(Et,Ee),wt=M(wi,wt,Xe),_i===null?ze=wi:_i.sibling=wi,_i=wi,Ee=li}if(Xe===zt.length)return c(Et,Ee),si&&Fa(Et,Xe),ze;if(Ee===null){for(;Xe<zt.length;Xe++)Ee=Jt(Et,zt[Xe],Yt),Ee!==null&&(wt=M(Ee,wt,Xe),_i===null?ze=Ee:_i.sibling=Ee,_i=Ee);return si&&Fa(Et,Xe),ze}for(Ee=_(Ee);Xe<zt.length;Xe++)li=Nt(Ee,Et,Xe,zt[Xe],Yt),li!==null&&(n&&li.alternate!==null&&Ee.delete(li.key===null?Xe:li.key),wt=M(li,wt,Xe),_i===null?ze=li:_i.sibling=li,_i=li);return n&&Ee.forEach(function(Mu){return s(Et,Mu)}),si&&Fa(Et,Xe),ze}function Fe(Et,wt,zt,Yt){if(zt==null)throw Error(Z(151));for(var ze=null,_i=null,Ee=wt,Xe=wt=0,li=null,wi=zt.next();Ee!==null&&!wi.done;Xe++,wi=zt.next()){Ee.index>Xe?(li=Ee,Ee=null):li=Ee.sibling;var Mu=kt(Et,Ee,wi.value,Yt);if(Mu===null){Ee===null&&(Ee=li);break}n&&Ee&&Mu.alternate===null&&s(Et,Ee),wt=M(Mu,wt,Xe),_i===null?ze=Mu:_i.sibling=Mu,_i=Mu,Ee=li}if(wi.done)return c(Et,Ee),si&&Fa(Et,Xe),ze;if(Ee===null){for(;!wi.done;Xe++,wi=zt.next())wi=Jt(Et,wi.value,Yt),wi!==null&&(wt=M(wi,wt,Xe),_i===null?ze=wi:_i.sibling=wi,_i=wi);return si&&Fa(Et,Xe),ze}for(Ee=_(Ee);!wi.done;Xe++,wi=zt.next())wi=Nt(Ee,Et,Xe,wi.value,Yt),wi!==null&&(n&&wi.alternate!==null&&Ee.delete(wi.key===null?Xe:wi.key),wt=M(wi,wt,Xe),_i===null?ze=wi:_i.sibling=wi,_i=wi);return n&&Ee.forEach(function(r){return s(Et,r)}),si&&Fa(Et,Xe),ze}function Ui(Et,wt,zt,Yt){if(typeof zt=="object"&&zt!==null&&zt.type===Lt&&zt.key===null&&(zt=zt.props.children),typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case Gt:t:{for(var ze=zt.key;wt!==null;){if(wt.key===ze){if(ze=zt.type,ze===Lt){if(wt.tag===7){c(Et,wt.sibling),Yt=w(wt,zt.props.children),Yt.return=Et,Et=Yt;break t}}else if(wt.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===We&&fl(ze)===wt.type){c(Et,wt.sibling),Yt=w(wt,zt.props),ru(Yt,zt),Yt.return=Et,Et=Yt;break t}c(Et,wt);break}else s(Et,wt);wt=wt.sibling}zt.type===Lt?(Yt=ll(zt.props.children,Et.mode,Yt,zt.key),Yt.return=Et,Et=Yt):(Yt=Hu(zt.type,zt.key,zt.props,null,Et.mode,Yt),ru(Yt,zt),Yt.return=Et,Et=Yt)}return F(Et);case se:t:{for(ze=zt.key;wt!==null;){if(wt.key===ze)if(wt.tag===4&&wt.stateNode.containerInfo===zt.containerInfo&&wt.stateNode.implementation===zt.implementation){c(Et,wt.sibling),Yt=w(wt,zt.children||[]),Yt.return=Et,Et=Yt;break t}else{c(Et,wt);break}else s(Et,wt);wt=wt.sibling}Yt=Jl(zt,Et.mode,Yt),Yt.return=Et,Et=Yt}return F(Et);case We:return zt=fl(zt),Ui(Et,wt,zt,Yt)}if(wr(zt))return we(Et,wt,zt,Yt);if(yi(zt)){if(ze=yi(zt),typeof ze!="function")throw Error(Z(150));return zt=ze.call(zt),Fe(Et,wt,zt,Yt)}if(typeof zt.then=="function")return Ui(Et,wt,tc(zt),Yt);if(zt.$$typeof===le)return Ui(Et,wt,Hs(Et,zt),Yt);au(Et,zt)}return typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint"?(zt=""+zt,wt!==null&&wt.tag===6?(c(Et,wt.sibling),Yt=w(wt,zt),Yt.return=Et,Et=Yt):(c(Et,wt),Yt=Ql(zt,Et.mode,Yt),Yt.return=Et,Et=Yt),F(Et)):c(Et,wt)}return function(Et,wt,zt,Yt){try{pl=0;var ze=Ui(Et,wt,zt,Yt);return $s=null,ze}catch(Ee){if(Ee===Va||Ee===Ju)throw Ee;var _i=Ur(29,Ee,null,Et.mode);return _i.lanes=Yt,_i.return=Et,_i}finally{}}}var Xs=eh(!0),hf=eh(!1),Ys=!1;function Ss(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Si(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ao(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function xa(n,s,c){var _=n.updateQueue;if(_===null)return null;if(_=_.shared,(gi&2)!==0){var w=_.pending;return w===null?s.next=s:(s.next=w.next,w.next=s),_.pending=s,s=qe(n),Wc(n,null,c),s}return js(n,_,s,c),qe(n)}function Ws(n,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var _=s.lanes;_&=n.pendingLanes,c|=_,s.lanes=c,di(n,c)}}function ec(n,s){var c=n.updateQueue,_=n.alternate;if(_!==null&&(_=_.updateQueue,c===_)){var w=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var F={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?w=M=F:M=M.next=F,c=c.next}while(c!==null);M===null?w=M=s:M=M.next=s}else w=M=s;c={baseState:_.baseState,firstBaseUpdate:w,lastBaseUpdate:M,shared:_.shared,callbacks:_.callbacks},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=s:n.next=s,c.lastBaseUpdate=s}var ih=!1;function ml(){if(ih){var n=ya;if(n!==null)throw n}}function gl(n,s,c,_){ih=!1;var w=n.updateQueue;Ys=!1;var M=w.firstBaseUpdate,F=w.lastBaseUpdate,Y=w.shared.pending;if(Y!==null){w.shared.pending=null;var mt=Y,Rt=mt.next;mt.next=null,F===null?M=Rt:F.next=Rt,F=mt;var Zt=n.alternate;Zt!==null&&(Zt=Zt.updateQueue,Y=Zt.lastBaseUpdate,Y!==F&&(Y===null?Zt.firstBaseUpdate=Rt:Y.next=Rt,Zt.lastBaseUpdate=mt))}if(M!==null){var Jt=w.baseState;F=0,Zt=Rt=mt=null,Y=M;do{var kt=Y.lane&-536870913,Nt=kt!==Y.lane;if(Nt?(pi&kt)===kt:(_&kt)===kt){kt!==0&&kt===bs&&(ih=!0),Zt!==null&&(Zt=Zt.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});t:{var we=n,Fe=Y;kt=s;var Ui=c;switch(Fe.tag){case 1:if(we=Fe.payload,typeof we=="function"){Jt=we.call(Ui,Jt,kt);break t}Jt=we;break t;case 3:we.flags=we.flags&-65537|128;case 0:if(we=Fe.payload,kt=typeof we=="function"?we.call(Ui,Jt,kt):we,kt==null)break t;Jt=ee({},Jt,kt);break t;case 2:Ys=!0}}kt=Y.callback,kt!==null&&(n.flags|=64,Nt&&(n.flags|=8192),Nt=w.callbacks,Nt===null?w.callbacks=[kt]:Nt.push(kt))}else Nt={lane:kt,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Zt===null?(Rt=Zt=Nt,mt=Jt):Zt=Zt.next=Nt,F|=kt;if(Y=Y.next,Y===null){if(Y=w.shared.pending,Y===null)break;Nt=Y,Y=Nt.next,Nt.next=null,w.lastBaseUpdate=Nt,w.shared.pending=null}}while(!0);Zt===null&&(mt=Jt),w.baseState=mt,w.firstBaseUpdate=Rt,w.lastBaseUpdate=Zt,M===null&&(w.shared.lanes=0),_u|=F,n.lanes=F,n.memoizedState=Jt}}function sd(n,s){if(typeof n!="function")throw Error(Z(191,n));n.call(s)}function ba(n,s){var c=n.callbacks;if(c!==null)for(n.callbacks=null,n=0;n<c.length;n++)sd(c[n],s)}var wa=Tt(null),ye=Tt(0);function Ae(n,s){n=Bo,ge(ye,n),ge(wa,s),Bo=n|s.baseLanes}function _l(){ge(ye,Bo),ge(wa,wa.current)}function nh(){Bo=ye.current,Kt(wa),Kt(ye)}var ur=Tt(null),Zi=null;function Zn(n){var s=n.alternate;ge(tn,tn.current&1),ge(ur,n),Zi===null&&(s===null||wa.current!==null||s.memoizedState!==null)&&(Zi=n)}function rh(n){ge(tn,tn.current),ge(ur,n),Zi===null&&(Zi=n)}function df(n){n.tag===22?(ge(tn,tn.current),ge(ur,n),Zi===null&&(Zi=n)):Do()}function Do(){ge(tn,tn.current),ge(ur,ur.current)}function ia(n){Kt(ur),Zi===n&&(Zi=null),Kt(tn)}var tn=Tt(0);function xi(n){for(var s=n;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Sh(c)||Up(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ai=0,Ze=null,bi=null,sn=null,su=!1,Io=!1,Ir=!1,Ks=0,Qs=0,Js=null,ic=0;function on(){throw Error(Z(321))}function zo(n,s){if(s===null)return!1;for(var c=0;c<s.length&&c<n.length;c++)if(!sr(n[c],s[c]))return!1;return!0}function to(n,s,c,_,w,M){return Ai=M,Ze=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Ut.H=n===null||n.memoizedState===null?ld:io,Ir=!1,M=c(_,w),Ir=!1,Io&&(M=nc(s,c,_,w)),ah(n),M}function ah(n){Ut.H=uu;var s=bi!==null&&bi.next!==null;if(Ai=0,sn=bi=Ze=null,su=!1,Qs=0,Js=null,s)throw Error(Z(300));n===null||Hn||(n=n.dependencies,n!==null&&Wu(n)&&(Hn=!0))}function nc(n,s,c,_){Ze=n;var w=0;do{if(Io&&(Js=null),Qs=0,Io=!1,25<=w)throw Error(Z(301));if(w+=1,sn=bi=null,n.updateQueue!=null){var M=n.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Ut.H=ff,M=s(c,_)}while(Io);return M}function yl(){var n=Ut.H,s=n.useState()[0];return s=typeof s.then=="function"?a(s):s,n=n.useState()[0],(bi!==null?bi.memoizedState:null)!==n&&(Ze.flags|=1024),s}function ou(){var n=Ks!==0;return Ks=0,n}function rc(n,s,c){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~c}function lu(n){if(su){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}su=!1}Ai=0,sn=bi=Ze=null,Io=!1,Qs=Ks=0,Js=null}function er(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Ze.memoizedState=sn=n:sn=sn.next=n,sn}function m(){if(bi===null){var n=Ze.alternate;n=n!==null?n.memoizedState:null}else n=bi.next;var s=sn===null?Ze.memoizedState:sn.next;if(s!==null)sn=s,bi=n;else{if(n===null)throw Ze.alternate===null?Error(Z(467)):Error(Z(310));bi=n,n={memoizedState:bi.memoizedState,baseState:bi.baseState,baseQueue:bi.baseQueue,queue:bi.queue,next:null},sn===null?Ze.memoizedState=sn=n:sn=sn.next=n}return sn}function e(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function a(n){var s=Qs;return Qs+=1,Js===null&&(Js=[]),n=th(Js,n,s),s=Ze,(sn===null?s.memoizedState:sn.next)===null&&(s=s.alternate,Ut.H=s===null||s.memoizedState===null?ld:io),n}function u(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return a(n);if(n.$$typeof===le)return Gn(n)}throw Error(Z(438,String(n)))}function f(n){var s=null,c=Ze.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var _=Ze.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(w){return w.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=e(),Ze.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(n),_=0;_<n;_++)c[_]=Pi;return s.index++,c}function g(n,s){return typeof s=="function"?s(n):s}function v(n){var s=m();return T(s,bi,n)}function T(n,s,c){var _=n.queue;if(_===null)throw Error(Z(311));_.lastRenderedReducer=c;var w=n.baseQueue,M=_.pending;if(M!==null){if(w!==null){var F=w.next;w.next=M.next,M.next=F}s.baseQueue=w=M,_.pending=null}if(M=n.baseState,w===null)n.memoizedState=M;else{s=w.next;var Y=F=null,mt=null,Rt=s,Zt=!1;do{var Jt=Rt.lane&-536870913;if(Jt!==Rt.lane?(pi&Jt)===Jt:(Ai&Jt)===Jt){var kt=Rt.revertLane;if(kt===0)mt!==null&&(mt=mt.next={lane:0,revertLane:0,gesture:null,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),Jt===bs&&(Zt=!0);else if((Ai&kt)===kt){Rt=Rt.next,kt===bs&&(Zt=!0);continue}else Jt={lane:0,revertLane:Rt.revertLane,gesture:null,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null},mt===null?(Y=mt=Jt,F=M):mt=mt.next=Jt,Ze.lanes|=kt,_u|=kt;Jt=Rt.action,Ir&&c(M,Jt),M=Rt.hasEagerState?Rt.eagerState:c(M,Jt)}else kt={lane:Jt,revertLane:Rt.revertLane,gesture:Rt.gesture,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null},mt===null?(Y=mt=kt,F=M):mt=mt.next=kt,Ze.lanes|=Jt,_u|=Jt;Rt=Rt.next}while(Rt!==null&&Rt!==s);if(mt===null?F=M:mt.next=Y,!sr(M,n.memoizedState)&&(Hn=!0,Zt&&(c=ya,c!==null)))throw c;n.memoizedState=M,n.baseState=F,n.baseQueue=mt,_.lastRenderedState=M}return w===null&&(_.lanes=0),[n.memoizedState,_.dispatch]}function E(n){var s=m(),c=s.queue;if(c===null)throw Error(Z(311));c.lastRenderedReducer=n;var _=c.dispatch,w=c.pending,M=s.memoizedState;if(w!==null){c.pending=null;var F=w=w.next;do M=n(M,F.action),F=F.next;while(F!==w);sr(M,s.memoizedState)||(Hn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,_]}function D(n,s,c){var _=Ze,w=m(),M=si;if(M){if(c===void 0)throw Error(Z(407));c=c()}else c=s();var F=!sr((bi||w).memoizedState,c);if(F&&(w.memoizedState=c,Hn=!0),w=w.queue,Re(k.bind(null,_,w,n),[n]),w.getSnapshot!==s||F||sn!==null&&sn.memoizedState.tag&1){if(_.flags|=2048,ie(9,{destroy:void 0},B.bind(null,_,w,c,s),null),$i===null)throw Error(Z(349));M||(Ai&127)!==0||z(_,s,c)}return c}function z(n,s,c){n.flags|=16384,n={getSnapshot:s,value:c},s=Ze.updateQueue,s===null?(s=e(),Ze.updateQueue=s,s.stores=[n]):(c=s.stores,c===null?s.stores=[n]:c.push(n))}function B(n,s,c,_){s.value=c,s.getSnapshot=_,V(s)&&H(n)}function k(n,s,c){return c(function(){V(s)&&H(n)})}function V(n){var s=n.getSnapshot;n=n.value;try{var c=s();return!sr(n,c)}catch{return!0}}function H(n){var s=bo(n,2);s!==null&&oa(s,n,2)}function W(n){var s=er();if(typeof n=="function"){var c=n;if(n=c(),Ir){ft(!0);try{c()}finally{ft(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:n},s}function Q(n,s,c,_){return n.baseState=c,T(n,bi,typeof _=="function"?_:g)}function et(n,s,c,_,w){if(Ei(n))throw Error(Z(485));if(n=s.action,n!==null){var M={payload:w,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){M.listeners.push(F)}};Ut.T!==null?c(!0):M.isTransition=!1,_(M),c=s.pending,c===null?(M.next=s.pending=M,at(s,M)):(M.next=c.next,s.pending=c.next=M)}}function at(n,s){var c=s.action,_=s.payload,w=n.state;if(s.isTransition){var M=Ut.T,F={};Ut.T=F;try{var Y=c(w,_),mt=Ut.S;mt!==null&&mt(F,Y),ct(n,s,Y)}catch(Rt){ht(n,s,Rt)}finally{M!==null&&F.types!==null&&(M.types=F.types),Ut.T=M}}else try{M=c(w,_),ct(n,s,M)}catch(Rt){ht(n,s,Rt)}}function ct(n,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(_){nt(n,s,_)},function(_){return ht(n,s,_)}):nt(n,s,c)}function nt(n,s,c){s.status="fulfilled",s.value=c,pt(s),n.state=c,s=n.pending,s!==null&&(c=s.next,c===s?n.pending=null:(c=c.next,s.next=c,at(n,c)))}function ht(n,s,c){var _=n.pending;if(n.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=c,pt(s),s=s.next;while(s!==_)}n.action=null}function pt(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function ot(n,s){return s}function bt(n,s){if(si){var c=$i.formState;if(c!==null){t:{var _=Ze;if(si){if(qi){e:{for(var w=qi,M=ci;w.nodeType!==8;){if(!M){w=null;break e}if(w=vr(w.nextSibling),w===null){w=null;break e}}M=w.data,w=M==="F!"||M==="F"?w:null}if(w){qi=vr(w.nextSibling),_=w.data==="F!";break t}}An(_)}_=!1}_&&(s=c[0])}}return c=er(),c.memoizedState=c.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ot,lastRenderedState:s},c.queue=_,c=ln.bind(null,Ze,_),_.dispatch=c,_=W(!1),M=wn.bind(null,Ze,!1,_.queue),_=er(),w={state:s,dispatch:null,action:n,pending:null},_.queue=w,c=et.bind(null,Ze,w,M,c),w.dispatch=c,_.memoizedState=n,[s,c,!1]}function It(n){var s=m();return Mt(s,bi,n)}function Mt(n,s,c){if(s=T(n,s,ot)[0],n=v(g)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=a(s)}catch(F){throw F===Va?Ju:F}else _=s;s=m();var w=s.queue,M=w.dispatch;return c!==s.memoizedState&&(Ze.flags|=2048,ie(9,{destroy:void 0},Ct.bind(null,w,c),null)),[_,M,n]}function Ct(n,s){n.action=s}function At(n){var s=m(),c=bi;if(c!==null)return Mt(s,c,n);m(),s=s.memoizedState,c=m();var _=c.queue.dispatch;return c.memoizedState=n,[s,_,!1]}function ie(n,s,c,_){return n={tag:n,create:c,deps:_,inst:s,next:null},s=Ze.updateQueue,s===null&&(s=e(),Ze.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=n.next=n:(_=c.next,c.next=n,n.next=_,s.lastEffect=n),n}function ne(){return m().memoizedState}function qt(n,s,c,_){var w=er();Ze.flags|=n,w.memoizedState=ie(1|s,{destroy:void 0},c,_===void 0?null:_)}function _e(n,s,c,_){var w=m();_=_===void 0?null:_;var M=w.memoizedState.inst;bi!==null&&_!==null&&zo(_,bi.memoizedState.deps)?w.memoizedState=ie(s,M,c,_):(Ze.flags|=n,w.memoizedState=ie(1|s,M,c,_))}function je(n,s){qt(8390656,8,n,s)}function Re(n,s){_e(2048,8,n,s)}function Hi(n){Ze.flags|=4;var s=Ze.updateQueue;if(s===null)s=e(),Ze.updateQueue=s,s.events=[n];else{var c=s.events;c===null?s.events=[n]:c.push(n)}}function Fi(n){var s=m().memoizedState;return Hi({ref:s,nextImpl:n}),function(){if((gi&2)!==0)throw Error(Z(440));return s.impl.apply(void 0,arguments)}}function en(n,s){return _e(4,2,n,s)}function zi(n,s){return _e(4,4,n,s)}function In(n,s){if(typeof s=="function"){n=n();var c=s(n);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Yi(n,s,c){c=c!=null?c.concat([n]):null,_e(4,4,In.bind(null,s,n),c)}function pn(){}function mn(n,s){var c=m();s=s===void 0?null:s;var _=c.memoizedState;return s!==null&&zo(s,_[1])?_[0]:(c.memoizedState=[n,s],n)}function bn(n,s){var c=m();s=s===void 0?null:s;var _=c.memoizedState;if(s!==null&&zo(s,_[1]))return _[0];if(_=n(),Ir){ft(!0);try{n()}finally{ft(!1)}}return c.memoizedState=[_,s],_}function mr(n,s,c){return c===void 0||(Ai&1073741824)!==0&&(pi&261930)===0?n.memoizedState=s:(n.memoizedState=c,n=wp(),Ze.lanes|=n,_u|=n,c)}function Es(n,s,c,_){return sr(c,s)?c:wa.current!==null?(n=mr(n,c,_),sr(n,s)||(Hn=!0),n):(Ai&42)===0||(Ai&1073741824)!==0&&(pi&261930)===0?(Hn=!0,n.memoizedState=c):(n=wp(),Ze.lanes|=n,_u|=n,s)}function Ua(n,s,c,_,w){var M=ce.p;ce.p=M!==0&&8>M?M:8;var F=Ut.T,Y={};Ut.T=Y,wn(n,!1,s,c);try{var mt=w(),Rt=Ut.S;if(Rt!==null&&Rt(Y,mt),mt!==null&&typeof mt=="object"&&typeof mt.then=="function"){var Zt=Ku(mt,_);Ni(n,s,Zt,Ha(n))}else Ni(n,s,_,Ha(n))}catch(Jt){Ni(n,s,{then:function(){},status:"rejected",reason:Jt},Ha())}finally{ce.p=M,F!==null&&Y.types!==null&&(F.types=Y.types),Ut.T=F}}function Po(){}function Ms(n,s,c,_){if(n.tag!==5)throw Error(Z(476));var w=Ro(n).queue;Ua(n,w,s,Oe,c===null?Po:function(){return na(n),c(_)})}function Ro(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:Oe,baseState:Oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:Oe},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:c},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function na(n){var s=Ro(n);s.next===null&&(s=n.alternate.memoizedState),Ni(n,s.next.queue,{},Ha())}function Ga(){return Gn(Ec)}function Hr(){return m().memoizedState}function Cs(){return m().memoizedState}function vl(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var c=Ha();n=Ao(c);var _=xa(s,n,c);_!==null&&(oa(_,s,c),Ws(_,s,c)),s={cache:qr()},n.payload=s;return}s=s.return}}function xl(n,s,c){var _=Ha();c={lane:_,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Ei(n)?eo(s,c):(c=xo(n,s,c,_),c!==null&&(oa(c,n,_),od(c,s,_)))}function ln(n,s,c){var _=Ha();Ni(n,s,c,_)}function Ni(n,s,c,_){var w={lane:_,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ei(n))eo(s,w);else{var M=n.alternate;if(n.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var F=s.lastRenderedState,Y=M(F,c);if(w.hasEagerState=!0,w.eagerState=Y,sr(Y,F))return js(n,s,w,0),$i===null&&Zu(),!1}catch{}finally{}if(c=xo(n,s,w,_),c!==null)return oa(c,n,_),od(c,s,_),!0}return!1}function wn(n,s,c,_){if(_={lane:2,revertLane:Cd(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},Ei(n)){if(s)throw Error(Z(479))}else s=xo(n,c,_,2),s!==null&&oa(s,n,2)}function Ei(n){var s=n.alternate;return n===Ze||s!==null&&s===Ze}function eo(n,s){Io=su=!0;var c=n.pending;c===null?s.next=s:(s.next=c.next,c.next=s),n.pending=s}function od(n,s,c){if((c&4194048)!==0){var _=s.lanes;_&=n.pendingLanes,c|=_,s.lanes=c,di(n,c)}}var uu={readContext:Gn,use:u,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useLayoutEffect:on,useInsertionEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useSyncExternalStore:on,useId:on,useHostTransitionStatus:on,useFormState:on,useActionState:on,useOptimistic:on,useMemoCache:on,useCacheRefresh:on};uu.useEffectEvent=on;var ld={readContext:Gn,use:u,useCallback:function(n,s){return er().memoizedState=[n,s===void 0?null:s],n},useContext:Gn,useEffect:je,useImperativeHandle:function(n,s,c){c=c!=null?c.concat([n]):null,qt(4194308,4,In.bind(null,s,n),c)},useLayoutEffect:function(n,s){return qt(4194308,4,n,s)},useInsertionEffect:function(n,s){qt(4,2,n,s)},useMemo:function(n,s){var c=er();s=s===void 0?null:s;var _=n();if(Ir){ft(!0);try{n()}finally{ft(!1)}}return c.memoizedState=[_,s],_},useReducer:function(n,s,c){var _=er();if(c!==void 0){var w=c(s);if(Ir){ft(!0);try{c(s)}finally{ft(!1)}}}else w=s;return _.memoizedState=_.baseState=w,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:w},_.queue=n,n=n.dispatch=xl.bind(null,Ze,n),[_.memoizedState,n]},useRef:function(n){var s=er();return n={current:n},s.memoizedState=n},useState:function(n){n=W(n);var s=n.queue,c=ln.bind(null,Ze,s);return s.dispatch=c,[n.memoizedState,c]},useDebugValue:pn,useDeferredValue:function(n,s){var c=er();return mr(c,n,s)},useTransition:function(){var n=W(!1);return n=Ua.bind(null,Ze,n.queue,!0,!1),er().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,c){var _=Ze,w=er();if(si){if(c===void 0)throw Error(Z(407));c=c()}else{if(c=s(),$i===null)throw Error(Z(349));(pi&127)!==0||z(_,s,c)}w.memoizedState=c;var M={value:c,getSnapshot:s};return w.queue=M,je(k.bind(null,_,M,n),[n]),_.flags|=2048,ie(9,{destroy:void 0},B.bind(null,_,M,c,s),null),c},useId:function(){var n=er(),s=$i.identifierPrefix;if(si){var c=gs,_=Gr;c=(_&~(1<<32-j(_)-1)).toString(32)+c,s="_"+s+"R_"+c,c=Ks++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=ic++,s="_"+s+"r_"+c.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Ga,useFormState:bt,useActionState:bt,useOptimistic:function(n){var s=er();s.memoizedState=s.baseState=n;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=wn.bind(null,Ze,!0,c),c.dispatch=s,[n,s]},useMemoCache:f,useCacheRefresh:function(){return er().memoizedState=vl.bind(null,Ze)},useEffectEvent:function(n){var s=er(),c={impl:n};return s.memoizedState=c,function(){if((gi&2)!==0)throw Error(Z(440));return c.impl.apply(void 0,arguments)}}},io={readContext:Gn,use:u,useCallback:mn,useContext:Gn,useEffect:Re,useImperativeHandle:Yi,useInsertionEffect:en,useLayoutEffect:zi,useMemo:bn,useReducer:v,useRef:ne,useState:function(){return v(g)},useDebugValue:pn,useDeferredValue:function(n,s){var c=m();return Es(c,bi.memoizedState,n,s)},useTransition:function(){var n=v(g)[0],s=m().memoizedState;return[typeof n=="boolean"?n:a(n),s]},useSyncExternalStore:D,useId:Hr,useHostTransitionStatus:Ga,useFormState:It,useActionState:It,useOptimistic:function(n,s){var c=m();return Q(c,bi,n,s)},useMemoCache:f,useCacheRefresh:Cs};io.useEffectEvent=Fi;var ff={readContext:Gn,use:u,useCallback:mn,useContext:Gn,useEffect:Re,useImperativeHandle:Yi,useInsertionEffect:en,useLayoutEffect:zi,useMemo:bn,useReducer:E,useRef:ne,useState:function(){return E(g)},useDebugValue:pn,useDeferredValue:function(n,s){var c=m();return bi===null?mr(c,n,s):Es(c,bi.memoizedState,n,s)},useTransition:function(){var n=E(g)[0],s=m().memoizedState;return[typeof n=="boolean"?n:a(n),s]},useSyncExternalStore:D,useId:Hr,useHostTransitionStatus:Ga,useFormState:At,useActionState:At,useOptimistic:function(n,s){var c=m();return bi!==null?Q(c,bi,n,s):(c.baseState=n,[n,c.queue.dispatch])},useMemoCache:f,useCacheRefresh:Cs};ff.useEffectEvent=Fi;function As(n,s,c,_){s=n.memoizedState,c=c(_,s),c=c==null?s:ee({},s,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var cu={enqueueSetState:function(n,s,c){n=n._reactInternals;var _=Ha(),w=Ao(_);w.payload=s,c!=null&&(w.callback=c),s=xa(n,w,_),s!==null&&(oa(s,n,_),Ws(s,n,_))},enqueueReplaceState:function(n,s,c){n=n._reactInternals;var _=Ha(),w=Ao(_);w.tag=1,w.payload=s,c!=null&&(w.callback=c),s=xa(n,w,_),s!==null&&(oa(s,n,_),Ws(s,n,_))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var c=Ha(),_=Ao(c);_.tag=2,s!=null&&(_.callback=s),s=xa(n,_,c),s!==null&&(oa(s,n,c),Ws(s,n,c))}};function sh(n,s,c,_,w,M,F){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(_,M,F):s.prototype&&s.prototype.isPureReactComponent?!Vr(c,_)||!Vr(w,M):!0}function no(n,s,c,_){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,_),s.state!==n&&cu.enqueueReplaceState(s,s.state,null)}function zr(n,s){var c=s;if("ref"in s){c={};for(var _ in s)_!=="ref"&&(c[_]=s[_])}if(n=n.defaultProps){c===s&&(c=ee({},c));for(var w in n)c[w]===void 0&&(c[w]=n[w])}return c}function oh(n){sl(n)}function lh(n){console.error(n)}function pf(n){sl(n)}function ud(n,s){try{var c=n.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function cd(n,s,c){try{var _=n.onCaughtError;_(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function mf(n,s,c){return c=Ao(c),c.tag=3,c.payload={element:null},c.callback=function(){ud(n,s)},c}function ym(n){return n=Ao(n),n.tag=3,n}function gf(n,s,c,_){var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var M=_.value;n.payload=function(){return w(M)},n.callback=function(){cd(s,c,_)}}var F=c.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(n.callback=function(){cd(s,c,_),typeof w!="function"&&(El===null?El=new Set([this]):El.add(this));var Y=_.stack;this.componentDidCatch(_.value,{componentStack:Y!==null?Y:""})})}function Eg(n,s,c,_,w){if(c.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=c.alternate,s!==null&&Mo(s,c,w,!0),c=ur.current,c!==null){switch(c.tag){case 31:case 13:return Zi===null?If():c.alternate===null&&On===0&&(On=3),c.flags&=-257,c.flags|=65536,c.lanes=w,_===Co?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([_]):s.add(_),Ap(n,_,w)),!1;case 22:return c.flags|=65536,_===Co?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([_]):c.add(_)),Ap(n,_,w)),!1}throw Error(Z(435,c.tag))}return Ap(n,_,w),If(),!1}if(si)return s=ur.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=w,_!==Na&&(n=Error(Z(422),{cause:_}),qs(Ar(n,c)))):(_!==Na&&(s=Error(Z(423),{cause:_}),qs(Ar(s,c))),n=n.current.alternate,n.flags|=65536,w&=-w,n.lanes|=w,_=Ar(_,c),w=mf(n.stateNode,_,w),ec(n,w),On!==4&&(On=2)),!1;var M=Error(Z(520),{cause:_});if(M=Ar(M,c),fc===null?fc=[M]:fc.push(M),On!==4&&(On=2),s===null)return!0;_=Ar(_,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,n=w&-w,c.lanes|=n,n=mf(c.stateNode,_,n),ec(c,n),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(El===null||!El.has(M))))return c.flags|=65536,w&=-w,c.lanes|=w,w=ym(w),gf(w,n,c,_),ec(c,w),!1}c=c.return}while(c!==null);return!1}var hd=Error(Z(461)),Hn=!1;function gr(n,s,c,_){s.child=n===null?hf(s,null,c,_):Xs(s,n.child,c,_)}function ac(n,s,c,_,w){c=c.render;var M=s.ref;if("ref"in _){var F={};for(var Y in _)Y!=="ref"&&(F[Y]=_[Y])}else F=_;return Zs(s),_=to(n,s,c,F,M,w),Y=ou(),n!==null&&!Hn?(rc(n,s,w),ro(n,s,w)):(si&&Y&&eu(s),s.flags|=1,gr(n,s,_,w),s.child)}function vm(n,s,c,_,w){if(n===null){var M=c.type;return typeof M=="function"&&!ol(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,sc(n,s,M,_,w)):(n=Hu(c.type,null,_,s,s.mode,w),n.ref=s.ref,n.return=s,s.child=n)}if(M=n.child,!lp(n,w)){var F=M.memoizedProps;if(c=c.compare,c=c!==null?c:Vr,c(F,_)&&n.ref===s.ref)return ro(n,s,w)}return s.flags|=1,n=Ba(M,_),n.ref=s.ref,n.return=s,s.child=n}function sc(n,s,c,_,w){if(n!==null){var M=n.memoizedProps;if(Vr(M,_)&&n.ref===s.ref)if(Hn=!1,s.pendingProps=_=M,lp(n,w))(n.flags&131072)!==0&&(Hn=!0);else return s.lanes=n.lanes,ro(n,s,w)}return pd(n,s,c,_,w)}function dd(n,s,c,_){var w=_.children,M=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,n!==null){for(_=s.child=n.child,w=0;_!==null;)w=w|_.lanes|_.childLanes,_=_.sibling;_=w&~M}else _=0,s.child=null;return xm(n,s,M,c,_)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Zr(s,M!==null?M.cachePool:null),M!==null?Ae(s,M):_l(),df(s);else return _=s.lanes=536870912,xm(n,s,M!==null?M.baseLanes|c:c,c,_)}else M!==null?(Zr(s,M.cachePool),Ae(s,M),Do(),s.memoizedState=null):(n!==null&&Zr(s,null),_l(),Do());return gr(n,s,w,c),s.child}function hu(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function xm(n,s,c,_,w){var M=dl();return M=M===null?null:{parent:Dn._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},n!==null&&Zr(s,null),_l(),df(s),n!==null&&Mo(n,s,_,!0),s.childLanes=w,null}function _f(n,s){return s=gd({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function bm(n,s,c){return Xs(s,n.child,null,c),n=_f(s,s.pendingProps),n.flags|=2,ia(s),s.memoizedState=null,n}function Mg(n,s,c){var _=s.pendingProps,w=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(si){if(_.mode==="hidden")return n=_f(s,_),s.lanes=536870912,hu(null,n);if(rh(s),(n=qi)?(n=kn(n,ci),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Gs!==null?{id:Gr,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},c=$u(n),c.return=s,s.child=c,Ln=s,qi=null)):n=null,n===null)throw An(s);return s.lanes=536870912,null}return _f(s,_)}var M=n.memoizedState;if(M!==null){var F=M.dehydrated;if(rh(s),w)if(s.flags&256)s.flags&=-257,s=bm(n,s,c);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(Z(558));else if(Hn||Mo(n,s,c,!1),w=(c&n.childLanes)!==0,Hn||w){if(_=$i,_!==null&&(F=Ri(_,c),F!==0&&F!==M.retryLane))throw M.retryLane=F,bo(n,F),oa(_,n,F),hd;If(),s=bm(n,s,c)}else n=M.treeContext,qi=vr(F.nextSibling),Ln=s,si=!0,_s=null,ci=!1,n!==null&&id(s,n),s=_f(s,_),s.flags|=4096;return s}return n=Ba(n.child,{mode:_.mode,children:_.children}),n.ref=s.ref,s.child=n,n.return=s,n}function fd(n,s){var c=s.ref;if(c===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(Z(284));(n===null||n.ref!==c)&&(s.flags|=4194816)}}function pd(n,s,c,_,w){return Zs(s),c=to(n,s,c,_,void 0,w),_=ou(),n!==null&&!Hn?(rc(n,s,w),ro(n,s,w)):(si&&_&&eu(s),s.flags|=1,gr(n,s,c,w),s.child)}function rp(n,s,c,_,w,M){return Zs(s),s.updateQueue=null,c=nc(s,_,c,w),ah(n),_=ou(),n!==null&&!Hn?(rc(n,s,M),ro(n,s,M)):(si&&_&&eu(s),s.flags|=1,gr(n,s,c,M),s.child)}function ap(n,s,c,_,w){if(Zs(s),s.stateNode===null){var M=Vs,F=c.contextType;typeof F=="object"&&F!==null&&(M=Gn(F)),M=new c(_,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=cu,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=_,M.state=s.memoizedState,M.refs={},Ss(s),F=c.contextType,M.context=typeof F=="object"&&F!==null?Gn(F):Vs,M.state=s.memoizedState,F=c.getDerivedStateFromProps,typeof F=="function"&&(As(s,c,F,_),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(F=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),F!==M.state&&cu.enqueueReplaceState(M,M.state,null),gl(s,_,M,w),ml(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(n===null){M=s.stateNode;var Y=s.memoizedProps,mt=zr(c,Y);M.props=mt;var Rt=M.context,Zt=c.contextType;F=Vs,typeof Zt=="object"&&Zt!==null&&(F=Gn(Zt));var Jt=c.getDerivedStateFromProps;Zt=typeof Jt=="function"||typeof M.getSnapshotBeforeUpdate=="function",Y=s.pendingProps!==Y,Zt||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Y||Rt!==F)&&no(s,M,_,F),Ys=!1;var kt=s.memoizedState;M.state=kt,gl(s,_,M,w),ml(),Rt=s.memoizedState,Y||kt!==Rt||Ys?(typeof Jt=="function"&&(As(s,c,Jt,_),Rt=s.memoizedState),(mt=Ys||sh(s,c,mt,_,kt,Rt,F))?(Zt||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Rt),M.props=_,M.state=Rt,M.context=F,_=mt):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{M=s.stateNode,Si(n,s),F=s.memoizedProps,Zt=zr(c,F),M.props=Zt,Jt=s.pendingProps,kt=M.context,Rt=c.contextType,mt=Vs,typeof Rt=="object"&&Rt!==null&&(mt=Gn(Rt)),Y=c.getDerivedStateFromProps,(Rt=typeof Y=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(F!==Jt||kt!==mt)&&no(s,M,_,mt),Ys=!1,kt=s.memoizedState,M.state=kt,gl(s,_,M,w),ml();var Nt=s.memoizedState;F!==Jt||kt!==Nt||Ys||n!==null&&n.dependencies!==null&&Wu(n.dependencies)?(typeof Y=="function"&&(As(s,c,Y,_),Nt=s.memoizedState),(Zt=Ys||sh(s,c,Zt,_,kt,Nt,mt)||n!==null&&n.dependencies!==null&&Wu(n.dependencies))?(Rt||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(_,Nt,mt),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(_,Nt,mt)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||F===n.memoizedProps&&kt===n.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||F===n.memoizedProps&&kt===n.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=Nt),M.props=_,M.state=Nt,M.context=mt,_=Zt):(typeof M.componentDidUpdate!="function"||F===n.memoizedProps&&kt===n.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||F===n.memoizedProps&&kt===n.memoizedState||(s.flags|=1024),_=!1)}return M=_,fd(n,s),_=(s.flags&128)!==0,M||_?(M=s.stateNode,c=_&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,n!==null&&_?(s.child=Xs(s,n.child,null,w),s.child=Xs(s,null,c,w)):gr(n,s,c,w),s.memoizedState=M.state,n=s.child):n=ro(n,s,w),n}function wm(n,s,c,_){return _a(),s.flags|=256,gr(n,s,c,_),s.child}var sp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function yf(n){return{baseLanes:n,cachePool:de()}}function vf(n,s,c){return n=n!==null?n.childLanes&~c:0,s&&(n|=Za),n}function Tm(n,s,c){var _=s.pendingProps,w=!1,M=(s.flags&128)!==0,F;if((F=M)||(F=n!==null&&n.memoizedState===null?!1:(tn.current&2)!==0),F&&(w=!0,s.flags&=-129),F=(s.flags&32)!==0,s.flags&=-33,n===null){if(si){if(w?Zn(s):Do(),(n=qi)?(n=kn(n,ci),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Gs!==null?{id:Gr,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},c=$u(n),c.return=s,s.child=c,Ln=s,qi=null)):n=null,n===null)throw An(s);return Up(n)?s.lanes=32:s.lanes=536870912,null}var Y=_.children;return _=_.fallback,w?(Do(),w=s.mode,Y=gd({mode:"hidden",children:Y},w),_=ll(_,w,c,null),Y.return=s,_.return=s,Y.sibling=_,s.child=Y,_=s.child,_.memoizedState=yf(c),_.childLanes=vf(n,F,c),s.memoizedState=sp,hu(null,_)):(Zn(s),md(s,Y))}var mt=n.memoizedState;if(mt!==null&&(Y=mt.dehydrated,Y!==null)){if(M)s.flags&256?(Zn(s),s.flags&=-257,s=_d(n,s,c)):s.memoizedState!==null?(Do(),s.child=n.child,s.flags|=128,s=null):(Do(),Y=_.fallback,w=s.mode,_=gd({mode:"visible",children:_.children},w),Y=ll(Y,w,c,null),Y.flags|=2,_.return=s,Y.return=s,_.sibling=Y,s.child=_,Xs(s,n.child,null,c),_=s.child,_.memoizedState=yf(c),_.childLanes=vf(n,F,c),s.memoizedState=sp,s=hu(null,_));else if(Zn(s),Up(Y)){if(F=Y.nextSibling&&Y.nextSibling.dataset,F)var Rt=F.dgst;F=Rt,_=Error(Z(419)),_.stack="",_.digest=F,qs({value:_,source:null,stack:null}),s=_d(n,s,c)}else if(Hn||Mo(n,s,c,!1),F=(c&n.childLanes)!==0,Hn||F){if(F=$i,F!==null&&(_=Ri(F,c),_!==0&&_!==mt.retryLane))throw mt.retryLane=_,bo(n,_),oa(F,n,_),hd;Sh(Y)||If(),s=_d(n,s,c)}else Sh(Y)?(s.flags|=192,s.child=n.child,s=null):(n=mt.treeContext,qi=vr(Y.nextSibling),Ln=s,si=!0,_s=null,ci=!1,n!==null&&id(s,n),s=md(s,_.children),s.flags|=4096);return s}return w?(Do(),Y=_.fallback,w=s.mode,mt=n.child,Rt=mt.sibling,_=Ba(mt,{mode:"hidden",children:_.children}),_.subtreeFlags=mt.subtreeFlags&65011712,Rt!==null?Y=Ba(Rt,Y):(Y=ll(Y,w,c,null),Y.flags|=2),Y.return=s,_.return=s,_.sibling=Y,s.child=_,hu(null,_),_=s.child,Y=n.child.memoizedState,Y===null?Y=yf(c):(w=Y.cachePool,w!==null?(mt=Dn._currentValue,w=w.parent!==mt?{parent:mt,pool:mt}:w):w=de(),Y={baseLanes:Y.baseLanes|c,cachePool:w}),_.memoizedState=Y,_.childLanes=vf(n,F,c),s.memoizedState=sp,hu(n.child,_)):(Zn(s),c=n.child,n=c.sibling,c=Ba(c,{mode:"visible",children:_.children}),c.return=s,c.sibling=null,n!==null&&(F=s.deletions,F===null?(s.deletions=[n],s.flags|=16):F.push(n)),s.child=c,s.memoizedState=null,c)}function md(n,s){return s=gd({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function gd(n,s){return n=Ur(22,n,null,s),n.lanes=0,n}function _d(n,s,c){return Xs(s,n.child,null,c),n=md(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function uh(n,s,c){n.lanes|=s;var _=n.alternate;_!==null&&(_.lanes|=s),Qc(n.return,s,c)}function Pr(n,s,c,_,w,M){var F=n.memoizedState;F===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:c,tailMode:w,treeForkCount:M}:(F.isBackwards=s,F.rendering=null,F.renderingStartTime=0,F.last=_,F.tail=c,F.tailMode=w,F.treeForkCount=M)}function op(n,s,c){var _=s.pendingProps,w=_.revealOrder,M=_.tail;_=_.children;var F=tn.current,Y=(F&2)!==0;if(Y?(F=F&1|2,s.flags|=128):F&=1,ge(tn,F),gr(n,s,_,c),_=si?To:0,!Y&&n!==null&&(n.flags&128)!==0)t:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&uh(n,c,s);else if(n.tag===19)uh(n,c,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break t;for(;n.sibling===null;){if(n.return===null||n.return===s)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(w){case"forwards":for(c=s.child,w=null;c!==null;)n=c.alternate,n!==null&&xi(n)===null&&(w=c),c=c.sibling;c=w,c===null?(w=s.child,s.child=null):(w=c.sibling,c.sibling=null),Pr(s,!1,w,c,M,_);break;case"backwards":case"unstable_legacy-backwards":for(c=null,w=s.child,s.child=null;w!==null;){if(n=w.alternate,n!==null&&xi(n)===null){s.child=w;break}n=w.sibling,w.sibling=c,c=w,w=n}Pr(s,!0,c,null,M,_);break;case"together":Pr(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function ro(n,s,c){if(n!==null&&(s.dependencies=n.dependencies),_u|=s.lanes,(c&s.childLanes)===0)if(n!==null){if(Mo(n,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(Z(153));if(s.child!==null){for(n=s.child,c=Ba(n,n.pendingProps),s.child=c,c.return=s;n.sibling!==null;)n=n.sibling,c=c.sibling=Ba(n,n.pendingProps),c.return=s;c.sibling=null}return s.child}function lp(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Wu(n)))}function Sm(n,s,c){switch(s.tag){case 3:Mi(s,s.stateNode.containerInfo),ys(s,Dn,n.memoizedState.cache),_a();break;case 27:case 5:fa(s);break;case 4:Mi(s,s.stateNode.containerInfo);break;case 10:ys(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,rh(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Zn(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Tm(n,s,c):(Zn(s),n=ro(n,s,c),n!==null?n.sibling:null);Zn(s);break;case 19:var w=(n.flags&128)!==0;if(_=(c&s.childLanes)!==0,_||(Mo(n,s,c,!1),_=(c&s.childLanes)!==0),w){if(_)return op(n,s,c);s.flags|=128}if(w=s.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),ge(tn,tn.current),_)break;return null;case 22:return s.lanes=0,dd(n,s,c,s.pendingProps);case 24:ys(s,Dn,n.memoizedState.cache)}return ro(n,s,c)}function Em(n,s,c){if(n!==null)if(n.memoizedProps!==s.pendingProps)Hn=!0;else{if(!lp(n,c)&&(s.flags&128)===0)return Hn=!1,Sm(n,s,c);Hn=(n.flags&131072)!==0}else Hn=!1,si&&(s.flags&1048576)!==0&&tu(s,To,s.index);switch(s.lanes=0,s.tag){case 16:t:{var _=s.pendingProps;if(n=fl(s.elementType),s.type=n,typeof n=="function")ol(n)?(_=zr(n,_),s.tag=1,s=ap(null,s,n,_,c)):(s.tag=0,s=pd(null,s,n,_,c));else{if(n!=null){var w=n.$$typeof;if(w===mi){s.tag=11,s=ac(null,s,n,_,c);break t}else if(w===be){s.tag=14,s=vm(null,s,n,_,c);break t}}throw s=cn(n)||n,Error(Z(306,s,""))}}return s;case 0:return pd(n,s,s.type,s.pendingProps,c);case 1:return _=s.type,w=zr(_,s.pendingProps),ap(n,s,_,w,c);case 3:t:{if(Mi(s,s.stateNode.containerInfo),n===null)throw Error(Z(387));_=s.pendingProps;var M=s.memoizedState;w=M.element,Si(n,s),gl(s,_,null,c);var F=s.memoizedState;if(_=F.cache,ys(s,Dn,_),_!==M.cache&&vs(s,[Dn],c,!0),ml(),_=F.element,M.isDehydrated)if(M={element:_,isDehydrated:!1,cache:F.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=wm(n,s,_,c);break t}else if(_!==w){w=Ar(Error(Z(424)),s),qs(w),s=wm(n,s,_,c);break t}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(qi=vr(n.firstChild),Ln=s,si=!0,_s=null,ci=!0,c=hf(s,null,_,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(_a(),_===w){s=ro(n,s,c);break t}gr(n,s,_,c)}s=s.child}return s;case 26:return fd(n,s),n===null?(c=Hp(s.type,null,s.pendingProps,null))?s.memoizedState=c:si||(c=s.type,n=s.pendingProps,_=Th(ke.current).createElement(c),_[$t]=s,_[he]=n,yr(_,c,n),dn(_),s.stateNode=_):s.memoizedState=Hp(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return fa(s),n===null&&si&&(_=s.stateNode=qp(s.type,s.pendingProps,ke.current),Ln=s,ci=!0,w=qi,Yn(s.type)?(bu=w,qi=vr(_.firstChild)):qi=w),gr(n,s,s.pendingProps.children,c),fd(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&si&&((w=_=qi)&&(_=Ya(_,s.type,s.pendingProps,ci),_!==null?(s.stateNode=_,Ln=s,qi=vr(_.firstChild),ci=!1,w=!0):w=!1),w||An(s)),fa(s),w=s.type,M=s.pendingProps,F=n!==null?n.memoizedProps:null,_=M.children,Ld(w,M)?_=null:F!==null&&Ld(w,F)&&(s.flags|=32),s.memoizedState!==null&&(w=to(n,s,yl,null,null,c),Ec._currentValue=w),fd(n,s),gr(n,s,_,c),s.child;case 6:return n===null&&si&&((n=c=qi)&&(c=Vp(c,s.pendingProps,ci),c!==null?(s.stateNode=c,Ln=s,qi=null,n=!0):n=!1),n||An(s)),null;case 13:return Tm(n,s,c);case 4:return Mi(s,s.stateNode.containerInfo),_=s.pendingProps,n===null?s.child=Xs(s,null,_,c):gr(n,s,_,c),s.child;case 11:return ac(n,s,s.type,s.pendingProps,c);case 7:return gr(n,s,s.pendingProps,c),s.child;case 8:return gr(n,s,s.pendingProps.children,c),s.child;case 12:return gr(n,s,s.pendingProps.children,c),s.child;case 10:return _=s.pendingProps,ys(s,s.type,_.value),gr(n,s,_.children,c),s.child;case 9:return w=s.type._context,_=s.pendingProps.children,Zs(s),w=Gn(w),_=_(w),s.flags|=1,gr(n,s,_,c),s.child;case 14:return vm(n,s,s.type,s.pendingProps,c);case 15:return sc(n,s,s.type,s.pendingProps,c);case 19:return op(n,s,c);case 31:return Mg(n,s,c);case 22:return dd(n,s,c,s.pendingProps);case 24:return Zs(s),_=Gn(Dn),n===null?(w=dl(),w===null&&(w=$i,M=qr(),w.pooledCache=M,M.refCount++,M!==null&&(w.pooledCacheLanes|=c),w=M),s.memoizedState={parent:_,cache:w},Ss(s),ys(s,Dn,w)):((n.lanes&c)!==0&&(Si(n,s),gl(s,null,null,c),ml()),w=n.memoizedState,M=s.memoizedState,w.parent!==_?(w={parent:_,cache:_},s.memoizedState=w,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=w),ys(s,Dn,_)):(_=M.cache,ys(s,Dn,_),_!==w.cache&&vs(s,[Dn],c,!0))),gr(n,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Z(156,s.tag))}function bl(n){n.flags|=4}function xf(n,s,c,_,w){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(w&335544128)===w)if(n.stateNode.complete)n.flags|=8192;else if(gc())n.flags|=8192;else throw va=Co,Qu}else n.flags&=-16777217}function Mm(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Wp(s))if(gc())n.flags|=8192;else throw va=Co,Qu}function ch(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?pe():536870912,n.lanes|=s,dc|=s)}function hh(n,s){if(!si)switch(n.tailMode){case"hidden":s=n.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var _=null;c!==null;)c.alternate!==null&&(_=c),c=c.sibling;_===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:_.sibling=null}}function un(n){var s=n.alternate!==null&&n.alternate.child===n.child,c=0,_=0;if(s)for(var w=n.child;w!==null;)c|=w.lanes|w.childLanes,_|=w.subtreeFlags&65011712,_|=w.flags&65011712,w.return=n,w=w.sibling;else for(w=n.child;w!==null;)c|=w.lanes|w.childLanes,_|=w.subtreeFlags,_|=w.flags,w.return=n,w=w.sibling;return n.subtreeFlags|=_,n.childLanes=c,s}function Cg(n,s,c){var _=s.pendingProps;switch(Kc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(s),null;case 1:return un(s),null;case 3:return c=s.stateNode,_=null,n!==null&&(_=n.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),ea(Dn),Xi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(n===null||n.child===null)&&(hl(s)?bl(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Xu())),un(s),null;case 26:var w=s.type,M=s.memoizedState;return n===null?(bl(s),M!==null?(un(s),Mm(s,M)):(un(s),xf(s,w,null,_,c))):M?M!==n.memoizedState?(bl(s),un(s),Mm(s,M)):(un(s),s.flags&=-16777217):(n=n.memoizedProps,n!==_&&bl(s),un(s),xf(s,w,n,_,c)),null;case 27:if(es(s),c=ke.current,w=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==_&&bl(s);else{if(!_){if(s.stateNode===null)throw Error(Z(166));return un(s),null}n=xe.current,hl(s)?iu(s):(n=qp(w,_,c),s.stateNode=n,bl(s))}return un(s),null;case 5:if(es(s),w=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==_&&bl(s);else{if(!_){if(s.stateNode===null)throw Error(Z(166));return un(s),null}if(M=xe.current,hl(s))iu(s);else{var F=Th(ke.current);switch(M){case 1:M=F.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:M=F.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":M=F.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":M=F.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":M=F.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof _.is=="string"?F.createElement("select",{is:_.is}):F.createElement("select"),_.multiple?M.multiple=!0:_.size&&(M.size=_.size);break;default:M=typeof _.is=="string"?F.createElement(w,{is:_.is}):F.createElement(w)}}M[$t]=s,M[he]=_;t:for(F=s.child;F!==null;){if(F.tag===5||F.tag===6)M.appendChild(F.stateNode);else if(F.tag!==4&&F.tag!==27&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===s)break t;for(;F.sibling===null;){if(F.return===null||F.return===s)break t;F=F.return}F.sibling.return=F.return,F=F.sibling}s.stateNode=M;t:switch(yr(M,w,_),w){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break t;case"img":_=!0;break t;default:_=!1}_&&bl(s)}}return un(s),xf(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,c),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==_&&bl(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(Z(166));if(n=ke.current,hl(s)){if(n=s.stateNode,c=s.memoizedProps,_=null,w=Ln,w!==null)switch(w.tag){case 27:case 5:_=w.memoizedProps}n[$t]=s,n=!!(n.nodeValue===c||_!==null&&_.suppressHydrationWarning===!0||xc(n.nodeValue,c)),n||An(s,!0)}else n=Th(n).createTextNode(_),n[$t]=s,s.stateNode=n}return un(s),null;case 31:if(c=s.memoizedState,n===null||n.memoizedState!==null){if(_=hl(s),c!==null){if(n===null){if(!_)throw Error(Z(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(557));n[$t]=s}else _a(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;un(s),n=!1}else c=Xu(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=c),n=!0;if(!n)return s.flags&256?(ia(s),s):(ia(s),null);if((s.flags&128)!==0)throw Error(Z(558))}return un(s),null;case 13:if(_=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(w=hl(s),_!==null&&_.dehydrated!==null){if(n===null){if(!w)throw Error(Z(318));if(w=s.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(Z(317));w[$t]=s}else _a(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;un(s),w=!1}else w=Xu(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=w),w=!0;if(!w)return s.flags&256?(ia(s),s):(ia(s),null)}return ia(s),(s.flags&128)!==0?(s.lanes=c,s):(c=_!==null,n=n!==null&&n.memoizedState!==null,c&&(_=s.child,w=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(w=_.alternate.memoizedState.cachePool.pool),M=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(M=_.memoizedState.cachePool.pool),M!==w&&(_.flags|=2048)),c!==n&&c&&(s.child.flags|=8192),ch(s,s.updateQueue),un(s),null);case 4:return Xi(),n===null&&Bf(s.stateNode.containerInfo),un(s),null;case 10:return ea(s.type),un(s),null;case 19:if(Kt(tn),_=s.memoizedState,_===null)return un(s),null;if(w=(s.flags&128)!==0,M=_.rendering,M===null)if(w)hh(_,!1);else{if(On!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(M=xi(n),M!==null){for(s.flags|=128,hh(_,!1),n=M.updateQueue,s.updateQueue=n,ch(s,n),s.subtreeFlags=0,n=c,c=s.child;c!==null;)of(c,n),c=c.sibling;return ge(tn,tn.current&1|2),si&&Fa(s,_.treeForkCount),s.child}n=n.sibling}_.tail!==null&&Vn()>pc&&(s.flags|=128,w=!0,hh(_,!1),s.lanes=4194304)}else{if(!w)if(n=xi(M),n!==null){if(s.flags|=128,w=!0,n=n.updateQueue,s.updateQueue=n,ch(s,n),hh(_,!0),_.tail===null&&_.tailMode==="hidden"&&!M.alternate&&!si)return un(s),null}else 2*Vn()-_.renderingStartTime>pc&&c!==536870912&&(s.flags|=128,w=!0,hh(_,!1),s.lanes=4194304);_.isBackwards?(M.sibling=s.child,s.child=M):(n=_.last,n!==null?n.sibling=M:s.child=M,_.last=M)}return _.tail!==null?(n=_.tail,_.rendering=n,_.tail=n.sibling,_.renderingStartTime=Vn(),n.sibling=null,c=tn.current,ge(tn,w?c&1|2:c&1),si&&Fa(s,_.treeForkCount),n):(un(s),null);case 22:case 23:return ia(s),nh(),_=s.memoizedState!==null,n!==null?n.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(c&536870912)!==0&&(s.flags&128)===0&&(un(s),s.subtreeFlags&6&&(s.flags|=8192)):un(s),c=s.updateQueue,c!==null&&ch(s,c.retryQueue),c=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==c&&(s.flags|=2048),n!==null&&Kt(ws),null;case 24:return c=null,n!==null&&(c=n.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ea(Dn),un(s),null;case 25:return null;case 30:return null}throw Error(Z(156,s.tag))}function Ag(n,s){switch(Kc(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return ea(Dn),Xi(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return es(s),null;case 31:if(s.memoizedState!==null){if(ia(s),s.alternate===null)throw Error(Z(340));_a()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(ia(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(Z(340));_a()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return Kt(tn),null;case 4:return Xi(),null;case 10:return ea(s.type),null;case 22:case 23:return ia(s),nh(),n!==null&&Kt(ws),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return ea(Dn),null;case 25:return null;default:return null}}function Cm(n,s){switch(Kc(s),s.tag){case 3:ea(Dn),Xi();break;case 26:case 27:case 5:es(s);break;case 4:Xi();break;case 31:s.memoizedState!==null&&ia(s);break;case 13:ia(s);break;case 19:Kt(tn);break;case 10:ea(s.type);break;case 22:case 23:ia(s),nh(),n!==null&&Kt(ws);break;case 24:ea(Dn)}}function du(n,s){try{var c=s.updateQueue,_=c!==null?c.lastEffect:null;if(_!==null){var w=_.next;c=w;do{if((c.tag&n)===n){_=void 0;var M=c.create,F=c.inst;_=M(),F.destroy=_}c=c.next}while(c!==w)}}catch(Y){Vi(s,s.return,Y)}}function Lo(n,s,c){try{var _=s.updateQueue,w=_!==null?_.lastEffect:null;if(w!==null){var M=w.next;_=M;do{if((_.tag&n)===n){var F=_.inst,Y=F.destroy;if(Y!==void 0){F.destroy=void 0,w=s;var mt=c,Rt=Y;try{Rt()}catch(Zt){Vi(w,mt,Zt)}}}_=_.next}while(_!==M)}}catch(Zt){Vi(s,s.return,Zt)}}function up(n){var s=n.updateQueue;if(s!==null){var c=n.stateNode;try{ba(s,c)}catch(_){Vi(n,n.return,_)}}}function fu(n,s,c){c.props=zr(n.type,n.memoizedProps),c.state=n.memoizedState;try{c.componentWillUnmount()}catch(_){Vi(n,s,_)}}function wl(n,s){try{var c=n.ref;if(c!==null){switch(n.tag){case 26:case 27:case 5:var _=n.stateNode;break;case 30:_=n.stateNode;break;default:_=n.stateNode}typeof c=="function"?n.refCleanup=c(_):c.current=_}}catch(w){Vi(n,s,w)}}function Oo(n,s){var c=n.ref,_=n.refCleanup;if(c!==null)if(typeof _=="function")try{_()}catch(w){Vi(n,s,w)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(w){Vi(n,s,w)}else c.current=null}function Am(n){var s=n.type,c=n.memoizedProps,_=n.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&_.focus();break t;case"img":c.src?_.src=c.src:c.srcSet&&(_.srcset=c.srcSet)}}catch(w){Vi(n,n.return,w)}}function cp(n,s,c){try{var _=n.stateNode;Xm(_,n.type,c,s),_[he]=s}catch(w){Vi(n,n.return,w)}}function Dm(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Yn(n.type)||n.tag===4}function hp(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||Dm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Yn(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function dp(n,s,c){var _=n.tag;if(_===5||_===6)n=n.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(n,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(n),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Ge));else if(_!==4&&(_===27&&Yn(n.type)&&(c=n.stateNode,s=null),n=n.child,n!==null))for(dp(n,s,c),n=n.sibling;n!==null;)dp(n,s,c),n=n.sibling}function bf(n,s,c){var _=n.tag;if(_===5||_===6)n=n.stateNode,s?c.insertBefore(n,s):c.appendChild(n);else if(_!==4&&(_===27&&Yn(n.type)&&(c=n.stateNode),n=n.child,n!==null))for(bf(n,s,c),n=n.sibling;n!==null;)bf(n,s,c),n=n.sibling}function wf(n){var s=n.stateNode,c=n.memoizedProps;try{for(var _=n.type,w=s.attributes;w.length;)s.removeAttributeNode(w[0]);yr(s,_,c),s[$t]=n,s[he]=c}catch(M){Vi(n,n.return,M)}}var Tl=!1,$n=!1,oc=!1,Im=typeof WeakSet=="function"?WeakSet:Set,ni=null;function dh(n,s){if(n=n.containerInfo,wh=qf,n=$c(n),ju(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else t:{c=(c=n.ownerDocument)&&c.defaultView||window;var _=c.getSelection&&c.getSelection();if(_&&_.rangeCount!==0){c=_.anchorNode;var w=_.anchorOffset,M=_.focusNode;_=_.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break t}var F=0,Y=-1,mt=-1,Rt=0,Zt=0,Jt=n,kt=null;e:for(;;){for(var Nt;Jt!==c||w!==0&&Jt.nodeType!==3||(Y=F+w),Jt!==M||_!==0&&Jt.nodeType!==3||(mt=F+_),Jt.nodeType===3&&(F+=Jt.nodeValue.length),(Nt=Jt.firstChild)!==null;)kt=Jt,Jt=Nt;for(;;){if(Jt===n)break e;if(kt===c&&++Rt===w&&(Y=F),kt===M&&++Zt===_&&(mt=F),(Nt=Jt.nextSibling)!==null)break;Jt=kt,kt=Jt.parentNode}Jt=Nt}c=Y===-1||mt===-1?null:{start:Y,end:mt}}else c=null}c=c||{start:0,end:0}}else c=null;for(Rd={focusedElem:n,selectionRange:c},qf=!1,ni=s;ni!==null;)if(s=ni,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,ni=n;else for(;ni!==null;){switch(s=ni,M=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(c=0;c<n.length;c++)w=n[c],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&M!==null){n=void 0,c=s,w=M.memoizedProps,M=M.memoizedState,_=c.stateNode;try{var we=zr(c.type,w);n=_.getSnapshotBeforeUpdate(we,M),_.__reactInternalSnapshotBeforeUpdate=n}catch(Fe){Vi(c,c.return,Fe)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,c=n.nodeType,c===9)jf(n);else if(c===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":jf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(Z(163))}if(n=s.sibling,n!==null){n.return=s.return,ni=n;break}ni=s.return}}function fp(n,s,c){var _=c.flags;switch(c.tag){case 0:case 11:case 15:Sl(n,c),_&4&&du(5,c);break;case 1:if(Sl(n,c),_&4)if(n=c.stateNode,s===null)try{n.componentDidMount()}catch(F){Vi(c,c.return,F)}else{var w=zr(c.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(w,s,n.__reactInternalSnapshotBeforeUpdate)}catch(F){Vi(c,c.return,F)}}_&64&&up(c),_&512&&wl(c,c.return);break;case 3:if(Sl(n,c),_&64&&(n=c.updateQueue,n!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{ba(n,s)}catch(F){Vi(c,c.return,F)}}break;case 27:s===null&&_&4&&wf(c);case 26:case 5:Sl(n,c),s===null&&_&4&&Am(c),_&512&&wl(c,c.return);break;case 12:Sl(n,c);break;case 31:Sl(n,c),_&4&&fh(n,c);break;case 13:Sl(n,c),_&4&&Tf(n,c),_&64&&(n=c.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(c=Lg.bind(null,c),Ym(n,c))));break;case 22:if(_=c.memoizedState!==null||Tl,!_){s=s!==null&&s.memoizedState!==null||$n,w=Tl;var M=$n;Tl=_,($n=s)&&!M?qa(n,c,(c.subtreeFlags&8772)!==0):Sl(n,c),Tl=w,$n=M}break;case 30:break;default:Sl(n,c)}}function yd(n){var s=n.alternate;s!==null&&(n.alternate=null,yd(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&fo(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var nn=null,_r=!1;function ko(n,s,c){for(c=c.child;c!==null;)pp(n,s,c),c=c.sibling}function pp(n,s,c){if(Ki&&typeof Ki.onCommitFiberUnmount=="function")try{Ki.onCommitFiberUnmount(Tr,c)}catch{}switch(c.tag){case 26:$n||Oo(c,s),ko(n,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:$n||Oo(c,s);var _=nn,w=_r;Yn(c.type)&&(nn=c.stateNode,_r=!1),ko(n,s,c),Eh(c.stateNode),nn=_,_r=w;break;case 5:$n||Oo(c,s);case 6:if(_=nn,w=_r,nn=null,ko(n,s,c),nn=_,_r=w,nn!==null)if(_r)try{(nn.nodeType===9?nn.body:nn.nodeName==="HTML"?nn.ownerDocument.body:nn).removeChild(c.stateNode)}catch(M){Vi(c,s,M)}else try{nn.removeChild(c.stateNode)}catch(M){Vi(c,s,M)}break;case 18:nn!==null&&(_r?(n=nn,Wn(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,c.stateNode),Ph(n)):Wn(nn,c.stateNode));break;case 4:_=nn,w=_r,nn=c.stateNode.containerInfo,_r=!0,ko(n,s,c),nn=_,_r=w;break;case 0:case 11:case 14:case 15:Lo(2,c,s),$n||Lo(4,c,s),ko(n,s,c);break;case 1:$n||(Oo(c,s),_=c.stateNode,typeof _.componentWillUnmount=="function"&&fu(c,s,_)),ko(n,s,c);break;case 21:ko(n,s,c);break;case 22:$n=(_=$n)||c.memoizedState!==null,ko(n,s,c),$n=_;break;default:ko(n,s,c)}}function fh(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{Ph(n)}catch(c){Vi(s,s.return,c)}}}function Tf(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Ph(n)}catch(c){Vi(s,s.return,c)}}function ph(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new Im),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new Im),s;default:throw Error(Z(435,n.tag))}}function lc(n,s){var c=ph(n);s.forEach(function(_){if(!c.has(_)){c.add(_);var w=Og.bind(null,n,_);_.then(w,w)}})}function cr(n,s){var c=s.deletions;if(c!==null)for(var _=0;_<c.length;_++){var w=c[_],M=n,F=s,Y=F;t:for(;Y!==null;){switch(Y.tag){case 27:if(Yn(Y.type)){nn=Y.stateNode,_r=!1;break t}break;case 5:nn=Y.stateNode,_r=!1;break t;case 3:case 4:nn=Y.stateNode.containerInfo,_r=!0;break t}Y=Y.return}if(nn===null)throw Error(Z(160));pp(M,F,w),nn=null,_r=!1,M=w.alternate,M!==null&&(M.return=null),w.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)zm(s,n),s=s.sibling}var ra=null;function zm(n,s){var c=n.alternate,_=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:cr(s,n),aa(n),_&4&&(Lo(3,n,n.return),du(3,n),Lo(5,n,n.return));break;case 1:cr(s,n),aa(n),_&512&&($n||c===null||Oo(c,c.return)),_&64&&Tl&&(n=n.updateQueue,n!==null&&(_=n.callbacks,_!==null&&(c=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=c===null?_:c.concat(_))));break;case 26:var w=ra;if(cr(s,n),aa(n),_&512&&($n||c===null||Oo(c,c.return)),_&4){var M=c!==null?c.memoizedState:null;if(_=n.memoizedState,c===null)if(_===null)if(n.stateNode===null){t:{_=n.type,c=n.memoizedProps,w=w.ownerDocument||w;e:switch(_){case"title":M=w.getElementsByTagName("title")[0],(!M||M[Qr]||M[$t]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=w.createElement(_),w.head.insertBefore(M,w.querySelector("head > title"))),yr(M,_,c),M[$t]=n,dn(M),_=M;break t;case"link":var F=Bd("link","href",w).get(_+(c.href||""));if(F){for(var Y=0;Y<F.length;Y++)if(M=F[Y],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){F.splice(Y,1);break e}}M=w.createElement(_),yr(M,_,c),w.head.appendChild(M);break;case"meta":if(F=Bd("meta","content",w).get(_+(c.content||""))){for(Y=0;Y<F.length;Y++)if(M=F[Y],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){F.splice(Y,1);break e}}M=w.createElement(_),yr(M,_,c),w.head.appendChild(M);break;default:throw Error(Z(468,_))}M[$t]=n,dn(M),_=M}n.stateNode=_}else Jm(w,n.type,n.stateNode);else n.stateNode=Xp(w,_,n.memoizedProps);else M!==_?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,_===null?Jm(w,n.type,n.stateNode):Xp(w,_,n.memoizedProps)):_===null&&n.stateNode!==null&&cp(n,n.memoizedProps,c.memoizedProps)}break;case 27:cr(s,n),aa(n),_&512&&($n||c===null||Oo(c,c.return)),c!==null&&_&4&&cp(n,n.memoizedProps,c.memoizedProps);break;case 5:if(cr(s,n),aa(n),_&512&&($n||c===null||Oo(c,c.return)),n.flags&32){w=n.stateNode;try{Wo(w,"")}catch(we){Vi(n,n.return,we)}}_&4&&n.stateNode!=null&&(w=n.memoizedProps,cp(n,w,c!==null?c.memoizedProps:w)),_&1024&&(oc=!0);break;case 6:if(cr(s,n),aa(n),_&4){if(n.stateNode===null)throw Error(Z(162));_=n.memoizedProps,c=n.stateNode;try{c.nodeValue=_}catch(we){Vi(n,n.return,we)}}break;case 3:if(Sc=null,w=ra,ra=so(s.containerInfo),cr(s,n),ra=w,aa(n),_&4&&c!==null&&c.memoizedState.isDehydrated)try{Ph(s.containerInfo)}catch(we){Vi(n,n.return,we)}oc&&(oc=!1,pu(n));break;case 4:_=ra,ra=so(n.stateNode.containerInfo),cr(s,n),aa(n),ra=_;break;case 12:cr(s,n),aa(n);break;case 31:cr(s,n),aa(n),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,lc(n,_)));break;case 13:cr(s,n),aa(n),n.child.flags&8192&&n.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Td=Vn()),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,lc(n,_)));break;case 22:w=n.memoizedState!==null;var mt=c!==null&&c.memoizedState!==null,Rt=Tl,Zt=$n;if(Tl=Rt||w,$n=Zt||mt,cr(s,n),$n=Zt,Tl=Rt,aa(n),_&8192)t:for(s=n.stateNode,s._visibility=w?s._visibility&-2:s._visibility|1,w&&(c===null||mt||Tl||$n||mu(n)),c=null,s=n;;){if(s.tag===5||s.tag===26){if(c===null){mt=c=s;try{if(M=mt.stateNode,w)F=M.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{Y=mt.stateNode;var Jt=mt.memoizedProps.style,kt=Jt!=null&&Jt.hasOwnProperty("display")?Jt.display:null;Y.style.display=kt==null||typeof kt=="boolean"?"":(""+kt).trim()}}catch(we){Vi(mt,mt.return,we)}}}else if(s.tag===6){if(c===null){mt=s;try{mt.stateNode.nodeValue=w?"":mt.memoizedProps}catch(we){Vi(mt,mt.return,we)}}}else if(s.tag===18){if(c===null){mt=s;try{var Nt=mt.stateNode;w?Kn(Nt,!0):Kn(mt.stateNode,!1)}catch(we){Vi(mt,mt.return,we)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break t;for(;s.sibling===null;){if(s.return===null||s.return===n)break t;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=n.updateQueue,_!==null&&(c=_.retryQueue,c!==null&&(_.retryQueue=null,lc(n,c))));break;case 19:cr(s,n),aa(n),_&4&&(_=n.updateQueue,_!==null&&(n.updateQueue=null,lc(n,_)));break;case 30:break;case 21:break;default:cr(s,n),aa(n)}}function aa(n){var s=n.flags;if(s&2){try{for(var c,_=n.return;_!==null;){if(Dm(_)){c=_;break}_=_.return}if(c==null)throw Error(Z(160));switch(c.tag){case 27:var w=c.stateNode,M=hp(n);bf(n,M,w);break;case 5:var F=c.stateNode;c.flags&32&&(Wo(F,""),c.flags&=-33);var Y=hp(n);bf(n,Y,F);break;case 3:case 4:var mt=c.stateNode.containerInfo,Rt=hp(n);dp(n,Rt,mt);break;default:throw Error(Z(161))}}catch(Zt){Vi(n,n.return,Zt)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function pu(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;pu(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Sl(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fp(n,s.alternate,s),s=s.sibling}function mu(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:Lo(4,s,s.return),mu(s);break;case 1:Oo(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&fu(s,s.return,c),mu(s);break;case 27:Eh(s.stateNode);case 26:case 5:Oo(s,s.return),mu(s);break;case 22:s.memoizedState===null&&mu(s);break;case 30:mu(s);break;default:mu(s)}n=n.sibling}}function qa(n,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,w=n,M=s,F=M.flags;switch(M.tag){case 0:case 11:case 15:qa(w,M,c),du(4,M);break;case 1:if(qa(w,M,c),_=M,w=_.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Rt){Vi(_,_.return,Rt)}if(_=M,w=_.updateQueue,w!==null){var Y=_.stateNode;try{var mt=w.shared.hiddenCallbacks;if(mt!==null)for(w.shared.hiddenCallbacks=null,w=0;w<mt.length;w++)sd(mt[w],Y)}catch(Rt){Vi(_,_.return,Rt)}}c&&F&64&&up(M),wl(M,M.return);break;case 27:wf(M);case 26:case 5:qa(w,M,c),c&&_===null&&F&4&&Am(M),wl(M,M.return);break;case 12:qa(w,M,c);break;case 31:qa(w,M,c),c&&F&4&&fh(w,M);break;case 13:qa(w,M,c),c&&F&4&&Tf(w,M);break;case 22:M.memoizedState===null&&qa(w,M,c),wl(M,M.return);break;case 30:break;default:qa(w,M,c)}s=s.sibling}}function vd(n,s){var c=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==c&&(n!=null&&n.refCount++,c!=null&&qn(c))}function Sf(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&qn(n))}function Ds(n,s,c,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Pm(n,s,c,_),s=s.sibling}function Pm(n,s,c,_){var w=s.flags;switch(s.tag){case 0:case 11:case 15:Ds(n,s,c,_),w&2048&&du(9,s);break;case 1:Ds(n,s,c,_);break;case 3:Ds(n,s,c,_),w&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&qn(n)));break;case 12:if(w&2048){Ds(n,s,c,_),n=s.stateNode;try{var M=s.memoizedProps,F=M.id,Y=M.onPostCommit;typeof Y=="function"&&Y(F,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(mt){Vi(s,s.return,mt)}}else Ds(n,s,c,_);break;case 31:Ds(n,s,c,_);break;case 13:Ds(n,s,c,_);break;case 23:break;case 22:M=s.stateNode,F=s.alternate,s.memoizedState!==null?M._visibility&2?Ds(n,s,c,_):xd(n,s):M._visibility&2?Ds(n,s,c,_):(M._visibility|=2,mh(n,s,c,_,(s.subtreeFlags&10256)!==0||!1)),w&2048&&vd(F,s);break;case 24:Ds(n,s,c,_),w&2048&&Sf(s.alternate,s);break;default:Ds(n,s,c,_)}}function mh(n,s,c,_,w){for(w=w&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=n,F=s,Y=c,mt=_,Rt=F.flags;switch(F.tag){case 0:case 11:case 15:mh(M,F,Y,mt,w),du(8,F);break;case 23:break;case 22:var Zt=F.stateNode;F.memoizedState!==null?Zt._visibility&2?mh(M,F,Y,mt,w):xd(M,F):(Zt._visibility|=2,mh(M,F,Y,mt,w)),w&&Rt&2048&&vd(F.alternate,F);break;case 24:mh(M,F,Y,mt,w),w&&Rt&2048&&Sf(F.alternate,F);break;default:mh(M,F,Y,mt,w)}s=s.sibling}}function xd(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=n,_=s,w=_.flags;switch(_.tag){case 22:xd(c,_),w&2048&&vd(_.alternate,_);break;case 24:xd(c,_),w&2048&&Sf(_.alternate,_);break;default:xd(c,_)}s=s.sibling}}var bd=8192;function gh(n,s,c){if(n.subtreeFlags&bd)for(n=n.child;n!==null;)uc(n,s,c),n=n.sibling}function uc(n,s,c){switch(n.tag){case 26:gh(n,s,c),n.flags&bd&&n.memoizedState!==null&&Ug(c,ra,n.memoizedState,n.memoizedProps);break;case 5:gh(n,s,c);break;case 3:case 4:var _=ra;ra=so(n.stateNode.containerInfo),gh(n,s,c),ra=_;break;case 22:n.memoizedState===null&&(_=n.alternate,_!==null&&_.memoizedState!==null?(_=bd,bd=16777216,gh(n,s,c),bd=_):gh(n,s,c));break;default:gh(n,s,c)}}function Rm(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function wd(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var _=s[c];ni=_,gp(_,n)}Rm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)mp(n),n=n.sibling}function mp(n){switch(n.tag){case 0:case 11:case 15:wd(n),n.flags&2048&&Lo(9,n,n.return);break;case 3:wd(n);break;case 12:wd(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,Ef(n)):wd(n);break;default:wd(n)}}function Ef(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var _=s[c];ni=_,gp(_,n)}Rm(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:Lo(8,s,s.return),Ef(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Ef(s));break;default:Ef(s)}n=n.sibling}}function gp(n,s){for(;ni!==null;){var c=ni;switch(c.tag){case 0:case 11:case 15:Lo(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var _=c.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:qn(c.memoizedState.cache)}if(_=c.child,_!==null)_.return=c,ni=_;else t:for(c=n;ni!==null;){_=ni;var w=_.sibling,M=_.return;if(yd(_),_===c){ni=null;break t}if(w!==null){w.return=M,ni=w;break t}ni=M}}}var Dg={getCacheForType:function(n){var s=Gn(Dn),c=s.data.get(n);return c===void 0&&(c=n(),s.data.set(n,c)),c},cacheSignal:function(){return Gn(Dn).controller.signal}},_p=typeof WeakMap=="function"?WeakMap:Map,gi=0,$i=null,hi=null,pi=0,ji=0,Ta=null,gu=!1,_h=!1,cc=!1,Bo=0,On=0,_u=0,hc=0,yp=0,Za=0,dc=0,fc=null,sa=null,Mf=!1,Td=0,Lm=0,pc=1/0,Cf=null,El=null,hr=0,yu=null,yh=null,Fo=0,vp=0,xp=null,Xn=null,Ml=0,bp=null;function Ha(){return(gi&2)!==0&&pi!==0?pi&-pi:Ut.T!==null?Cd():Oi()}function wp(){if(Za===0)if((pi&536870912)===0||si){var n=St;St<<=1,(St&3932160)===0&&(St=262144),Za=n}else Za=536870912;return n=ur.current,n!==null&&(n.flags|=32),Za}function oa(n,s,c){(n===$i&&(ji===2||ji===9)||n.cancelPendingCommit!==null)&&(mc(n,0),$a(n,pi,Za,!1)),Be(n,c),((gi&2)===0||n!==$i)&&(n===$i&&((gi&2)===0&&(hc|=c),On===4&&$a(n,pi,Za,!1)),Xa(n))}function Om(n,s,c){if((gi&6)!==0)throw Error(Z(327));var _=!c&&(s&127)===0&&(s&n.expiredLanes)===0||Ot(n,s),w=_?zg(n,s):Ep(n,s,!0),M=_;do{if(w===0){_h&&!_&&$a(n,s,0,!1);break}else{if(c=n.current.alternate,M&&!km(c)){w=Ep(n,s,!1),M=!1;continue}if(w===2){if(M=s,n.errorRecoveryDisabledLanes&M)var F=0;else F=n.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){s=F;t:{var Y=n;w=fc;var mt=Y.current.memoizedState.isDehydrated;if(mt&&(mc(Y,F).flags|=256),F=Ep(Y,F,!1),F!==2){if(cc&&!mt){Y.errorRecoveryDisabledLanes|=M,hc|=M,w=4;break t}M=sa,sa=w,M!==null&&(sa===null?sa=M:sa.push.apply(sa,M))}w=F}if(M=!1,w!==2)continue}}if(w===1){mc(n,0),$a(n,s,0,!0);break}t:{switch(_=n,M=w,M){case 0:case 1:throw Error(Z(345));case 4:if((s&4194048)!==s)break;case 6:$a(_,s,Za,!gu);break t;case 2:sa=null;break;case 3:case 5:break;default:throw Error(Z(329))}if((s&62914560)===s&&(w=Td+300-Vn(),10<w)){if($a(_,s,Za,!gu),Pt(_,0,!0)!==0)break t;Fo=s,_.timeoutHandle=dr(Tp.bind(null,_,c,sa,Cf,Mf,s,Za,hc,dc,gu,M,"Throttled",-0,0),w);break t}Tp(_,c,sa,Cf,Mf,s,Za,hc,dc,gu,M,null,-0,0)}}break}while(!0);Xa(n)}function Tp(n,s,c,_,w,M,F,Y,mt,Rt,Zt,Jt,kt,Nt){if(n.timeoutHandle=-1,Jt=s.subtreeFlags,Jt&8192||(Jt&16785408)===16785408){Jt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ge},uc(s,M,Jt);var we=(M&62914560)===M?Td-Vn():(M&4194048)===M?Lm-Vn():0;if(we=tg(Jt,we),we!==null){Fo=M,n.cancelPendingCommit=we(Vm.bind(null,n,s,M,c,_,w,F,Y,mt,Zt,Jt,null,kt,Nt)),$a(n,M,F,!Rt);return}}Vm(n,s,M,c,_,w,F,Y,mt)}function km(n){for(var s=n;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var _=0;_<c.length;_++){var w=c[_],M=w.getSnapshot;w=w.value;try{if(!sr(M(),w))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function $a(n,s,c,_){s&=~yp,s&=~hc,n.suspendedLanes|=s,n.pingedLanes&=~s,_&&(n.warmLanes|=s),_=n.expirationTimes;for(var w=s;0<w;){var M=31-j(w),F=1<<M;_[M]=-1,w&=~F}c!==0&&He(n,c,s)}function vh(){return(gi&6)===0?(yc(0),!1):!0}function Af(){if(hi!==null){if(ji===0)var n=hi.return;else n=hi,ja=Eo=null,lu(n),$s=null,pl=0,n=hi;for(;n!==null;)Cm(n.alternate,n),n=n.return;hi=null}}function mc(n,s){var c=n.timeoutHandle;c!==-1&&(n.timeoutHandle=-1,Je(c)),c=n.cancelPendingCommit,c!==null&&(n.cancelPendingCommit=null,c()),Fo=0,Af(),$i=n,hi=c=Ba(n.current,null),pi=s,ji=0,Ta=null,gu=!1,_h=Ot(n,s),cc=!1,dc=Za=yp=hc=_u=On=0,sa=fc=null,Mf=!1,(s&8)!==0&&(s|=s&32);var _=n.entangledLanes;if(_!==0)for(n=n.entanglements,_&=s;0<_;){var w=31-j(_),M=1<<w;s|=n[w],_&=~M}return Bo=s,Zu(),c}function Df(n,s){Ze=null,Ut.H=uu,s===Va||s===Ju?(s=ad(),ji=3):s===Qu?(s=ad(),ji=4):ji=s===hd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ta=s,hi===null&&(On=1,ud(n,Ar(s,n.current)))}function gc(){var n=ur.current;return n===null?!0:(pi&4194048)===pi?Zi===null:(pi&62914560)===pi||(pi&536870912)!==0?n===Zi:!1}function Sp(){var n=Ut.H;return Ut.H=uu,n===null?uu:n}function Bm(){var n=Ut.A;return Ut.A=Dg,n}function If(){On=4,gu||(pi&4194048)!==pi&&ur.current!==null||(_h=!0),(_u&134217727)===0&&(hc&134217727)===0||$i===null||$a($i,pi,Za,!1)}function Ep(n,s,c){var _=gi;gi|=2;var w=Sp(),M=Bm();($i!==n||pi!==s)&&(Cf=null,mc(n,s)),s=!1;var F=On;t:do try{if(ji!==0&&hi!==null){var Y=hi,mt=Ta;switch(ji){case 8:Af(),F=6;break t;case 3:case 2:case 9:case 6:ur.current===null&&(s=!0);var Rt=ji;if(ji=0,Ta=null,xh(n,Y,mt,Rt),c&&_h){F=0;break t}break;default:Rt=ji,ji=0,Ta=null,xh(n,Y,mt,Rt)}}Ig(),F=On;break}catch(Zt){Df(n,Zt)}while(!0);return s&&n.shellSuspendCounter++,ja=Eo=null,gi=_,Ut.H=w,Ut.A=M,hi===null&&($i=null,pi=0,Zu()),F}function Ig(){for(;hi!==null;)Fm(hi)}function zg(n,s){var c=gi;gi|=2;var _=Sp(),w=Bm();$i!==n||pi!==s?(Cf=null,pc=Vn()+500,mc(n,s)):_h=Ot(n,s);t:do try{if(ji!==0&&hi!==null){s=hi;var M=Ta;e:switch(ji){case 1:ji=0,Ta=null,xh(n,s,M,1);break;case 2:case 9:if(Ts(M)){ji=0,Ta=null,Nm(s);break}s=function(){ji!==2&&ji!==9||$i!==n||(ji=7),Xa(n)},M.then(s,s);break t;case 3:ji=7;break t;case 4:ji=5;break t;case 7:Ts(M)?(ji=0,Ta=null,Nm(s)):(ji=0,Ta=null,xh(n,s,M,7));break;case 5:var F=null;switch(hi.tag){case 26:F=hi.memoizedState;case 5:case 27:var Y=hi;if(F?Wp(F):Y.stateNode.complete){ji=0,Ta=null;var mt=Y.sibling;if(mt!==null)hi=mt;else{var Rt=Y.return;Rt!==null?(hi=Rt,zf(Rt)):hi=null}break e}}ji=0,Ta=null,xh(n,s,M,5);break;case 6:ji=0,Ta=null,xh(n,s,M,6);break;case 8:Af(),On=6;break t;default:throw Error(Z(462))}}Pg();break}catch(Zt){Df(n,Zt)}while(!0);return ja=Eo=null,Ut.H=_,Ut.A=w,gi=c,hi!==null?0:($i=null,pi=0,Zu(),On)}function Pg(){for(;hi!==null&&!ns();)Fm(hi)}function Fm(n){var s=Em(n.alternate,n,Bo);n.memoizedProps=n.pendingProps,s===null?zf(n):hi=s}function Nm(n){var s=n,c=s.alternate;switch(s.tag){case 15:case 0:s=rp(c,s,s.pendingProps,s.type,void 0,pi);break;case 11:s=rp(c,s,s.pendingProps,s.type.render,s.ref,pi);break;case 5:lu(s);default:Cm(c,s),s=hi=of(s,Bo),s=Em(c,s,Bo)}n.memoizedProps=n.pendingProps,s===null?zf(n):hi=s}function xh(n,s,c,_){ja=Eo=null,lu(s),$s=null,pl=0;var w=s.return;try{if(Eg(n,w,s,c,pi)){On=1,ud(n,Ar(c,n.current)),hi=null;return}}catch(M){if(w!==null)throw hi=w,M;On=1,ud(n,Ar(c,n.current)),hi=null;return}s.flags&32768?(si||_===1?n=!0:_h||(pi&536870912)!==0?n=!1:(gu=n=!0,(_===2||_===9||_===3||_===6)&&(_=ur.current,_!==null&&_.tag===13&&(_.flags|=16384))),jm(s,n)):zf(s)}function zf(n){var s=n;do{if((s.flags&32768)!==0){jm(s,gu);return}n=s.return;var c=Cg(s.alternate,s,Bo);if(c!==null){hi=c;return}if(s=s.sibling,s!==null){hi=s;return}hi=s=n}while(s!==null);On===0&&(On=5)}function jm(n,s){do{var c=Ag(n.alternate,n);if(c!==null){c.flags&=32767,hi=c;return}if(c=n.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(n=n.sibling,n!==null)){hi=n;return}hi=n=c}while(n!==null);On=6,hi=null}function Vm(n,s,c,_,w,M,F,Y,mt){n.cancelPendingCommit=null;do _c();while(hr!==0);if((gi&6)!==0)throw Error(Z(327));if(s!==null){if(s===n.current)throw Error(Z(177));if(M=s.lanes|s.childLanes,M|=Kl,hn(n,c,M,F,Y,mt),n===$i&&(hi=$i=null,pi=0),yh=s,yu=n,Fo=c,vp=M,xp=w,Xn=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,qm(rs,function(){return Rf(),null})):(n.callbackNode=null,n.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=Ut.T,Ut.T=null,w=ce.p,ce.p=2,F=gi,gi|=4;try{dh(n,s,c)}finally{gi=F,ce.p=w,Ut.T=_}}hr=1,Mp(),Pf(),Cp()}}function Mp(){if(hr===1){hr=0;var n=yu,s=yh,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Ut.T,Ut.T=null;var _=ce.p;ce.p=2;var w=gi;gi|=4;try{zm(s,n);var M=Rd,F=$c(n.containerInfo),Y=M.focusedElem,mt=M.selectionRange;if(F!==Y&&Y&&Y.ownerDocument&&Hc(Y.ownerDocument.documentElement,Y)){if(mt!==null&&ju(Y)){var Rt=mt.start,Zt=mt.end;if(Zt===void 0&&(Zt=Rt),"selectionStart"in Y)Y.selectionStart=Rt,Y.selectionEnd=Math.min(Zt,Y.value.length);else{var Jt=Y.ownerDocument||document,kt=Jt&&Jt.defaultView||window;if(kt.getSelection){var Nt=kt.getSelection(),we=Y.textContent.length,Fe=Math.min(mt.start,we),Ui=mt.end===void 0?Fe:Math.min(mt.end,we);!Nt.extend&&Fe>Ui&&(F=Ui,Ui=Fe,Fe=F);var Et=Zc(Y,Fe),wt=Zc(Y,Ui);if(Et&&wt&&(Nt.rangeCount!==1||Nt.anchorNode!==Et.node||Nt.anchorOffset!==Et.offset||Nt.focusNode!==wt.node||Nt.focusOffset!==wt.offset)){var zt=Jt.createRange();zt.setStart(Et.node,Et.offset),Nt.removeAllRanges(),Fe>Ui?(Nt.addRange(zt),Nt.extend(wt.node,wt.offset)):(zt.setEnd(wt.node,wt.offset),Nt.addRange(zt))}}}}for(Jt=[],Nt=Y;Nt=Nt.parentNode;)Nt.nodeType===1&&Jt.push({element:Nt,left:Nt.scrollLeft,top:Nt.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<Jt.length;Y++){var Yt=Jt[Y];Yt.element.scrollLeft=Yt.left,Yt.element.scrollTop=Yt.top}}qf=!!wh,Rd=wh=null}finally{gi=w,ce.p=_,Ut.T=c}}n.current=s,hr=2}}function Pf(){if(hr===2){hr=0;var n=yu,s=yh,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Ut.T,Ut.T=null;var _=ce.p;ce.p=2;var w=gi;gi|=4;try{fp(n,s.alternate,s)}finally{gi=w,ce.p=_,Ut.T=c}}hr=3}}function Cp(){if(hr===4||hr===3){hr=0,ho();var n=yu,s=yh,c=Fo,_=Xn;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?hr=5:(hr=0,yh=yu=null,Cl(n,n.pendingLanes));var w=n.pendingLanes;if(w===0&&(El=null),Li(c),s=s.stateNode,Ki&&typeof Ki.onCommitFiberRoot=="function")try{Ki.onCommitFiberRoot(Tr,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=Ut.T,w=ce.p,ce.p=2,Ut.T=null;try{for(var M=n.onRecoverableError,F=0;F<_.length;F++){var Y=_[F];M(Y.value,{componentStack:Y.stack})}}finally{Ut.T=s,ce.p=w}}(Fo&3)!==0&&_c(),Xa(n),w=n.pendingLanes,(c&261930)!==0&&(w&42)!==0?n===bp?Ml++:(Ml=0,bp=n):Ml=0,yc(0)}}function Cl(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,qn(s)))}function _c(){return Mp(),Pf(),Cp(),Rf()}function Rf(){if(hr!==5)return!1;var n=yu,s=vp;vp=0;var c=Li(Fo),_=Ut.T,w=ce.p;try{ce.p=32>c?32:c,Ut.T=null,c=xp,xp=null;var M=yu,F=Fo;if(hr=0,yh=yu=null,Fo=0,(gi&6)!==0)throw Error(Z(331));var Y=gi;if(gi|=4,mp(M.current),Pm(M,M.current,F,c),gi=Y,yc(0,!1),Ki&&typeof Ki.onPostCommitFiberRoot=="function")try{Ki.onPostCommitFiberRoot(Tr,M)}catch{}return!0}finally{ce.p=w,Ut.T=_,Cl(n,s)}}function Um(n,s,c){s=Ar(c,s),s=mf(n.stateNode,s,2),n=xa(n,s,2),n!==null&&(Be(n,2),Xa(n))}function Vi(n,s,c){if(n.tag===3)Um(n,n,c);else for(;s!==null;){if(s.tag===3){Um(s,n,c);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(El===null||!El.has(_))){n=Ar(c,n),c=ym(2),_=xa(s,c,2),_!==null&&(gf(c,_,s,n),Be(_,2),Xa(_));break}}s=s.return}}function Ap(n,s,c){var _=n.pingCache;if(_===null){_=n.pingCache=new _p;var w=new Set;_.set(s,w)}else w=_.get(s),w===void 0&&(w=new Set,_.set(s,w));w.has(c)||(cc=!0,w.add(c),n=Rg.bind(null,n,s,c),s.then(n,n))}function Rg(n,s,c){var _=n.pingCache;_!==null&&_.delete(s),n.pingedLanes|=n.suspendedLanes&c,n.warmLanes&=~c,$i===n&&(pi&c)===c&&(On===4||On===3&&(pi&62914560)===pi&&300>Vn()-Td?(gi&2)===0&&mc(n,0):yp|=c,dc===pi&&(dc=0)),Xa(n)}function Gm(n,s){s===0&&(s=pe()),n=bo(n,s),n!==null&&(Be(n,s),Xa(n))}function Lg(n){var s=n.memoizedState,c=0;s!==null&&(c=s.retryLane),Gm(n,c)}function Og(n,s){var c=0;switch(n.tag){case 31:case 13:var _=n.stateNode,w=n.memoizedState;w!==null&&(c=w.retryLane);break;case 19:_=n.stateNode;break;case 22:_=n.stateNode._retryCache;break;default:throw Error(Z(314))}_!==null&&_.delete(s),Gm(n,c)}function qm(n,s){return co(n,s)}var Sd=null,Sa=null,No=!1,Ed=!1,Md=!1,vu=0;function Xa(n){n!==Sa&&n.next===null&&(Sa===null?Sd=Sa=n:Sa=Sa.next=n),Ed=!0,No||(No=!0,Zm())}function yc(n,s){if(!Md&&Ed){Md=!0;do for(var c=!1,_=Sd;_!==null;){if(n!==0){var w=_.pendingLanes;if(w===0)var M=0;else{var F=_.suspendedLanes,Y=_.pingedLanes;M=(1<<31-j(42|n)+1)-1,M&=w&~(F&~Y),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,Dp(_,M))}else M=pi,M=Pt(_,_===$i?M:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(M&3)===0||Ot(_,M)||(c=!0,Dp(_,M));_=_.next}while(c);Md=!1}}function kg(){Lf()}function Lf(){Ed=No=!1;var n=0;vu!==0&&Ng()&&(n=vu);for(var s=Vn(),c=null,_=Sd;_!==null;){var w=_.next,M=Of(_,s);M===0?(_.next=null,c===null?Sd=w:c.next=w,w===null&&(Sa=c)):(c=_,(n!==0||(M&3)!==0)&&(Ed=!0)),_=w}hr!==0&&hr!==5||yc(n),vu!==0&&(vu=0)}function Of(n,s){for(var c=n.suspendedLanes,_=n.pingedLanes,w=n.expirationTimes,M=n.pendingLanes&-62914561;0<M;){var F=31-j(M),Y=1<<F,mt=w[F];mt===-1?((Y&c)===0||(Y&_)!==0)&&(w[F]=Ft(Y,s)):mt<=s&&(n.expiredLanes|=Y),M&=~Y}if(s=$i,c=pi,c=Pt(n,n===s?c:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),_=n.callbackNode,c===0||n===s&&(ji===2||ji===9)||n.cancelPendingCommit!==null)return _!==null&&_!==null&&is(_),n.callbackNode=null,n.callbackPriority=0;if((c&3)===0||Ot(n,c)){if(s=c&-c,s===n.callbackPriority)return s;switch(_!==null&&is(_),Li(c)){case 2:case 8:c=jl;break;case 32:c=rs;break;case 268435456:c=Rs;break;default:c=rs}return _=vc.bind(null,n),c=co(c,_),n.callbackPriority=s,n.callbackNode=c,s}return _!==null&&_!==null&&is(_),n.callbackPriority=2,n.callbackNode=null,2}function vc(n,s){if(hr!==0&&hr!==5)return n.callbackNode=null,n.callbackPriority=0,null;var c=n.callbackNode;if(_c()&&n.callbackNode!==c)return null;var _=pi;return _=Pt(n,n===$i?_:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),_===0?null:(Om(n,_,s),Of(n,Vn()),n.callbackNode!=null&&n.callbackNode===c?vc.bind(null,n):null)}function Dp(n,s){if(_c())return null;Om(n,s,!0)}function Zm(){ao(function(){(gi&6)!==0?co(Nl,kg):Lf()})}function Cd(){if(vu===0){var n=bs;n===0&&(n=ut,ut<<=1,(ut&261888)===0&&(ut=256)),vu=n}return vu}function Ip(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Er(""+n)}function Ad(n,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,n.id&&c.setAttribute("form",n.id),s.parentNode.insertBefore(c,s),n=new FormData(n),c.parentNode.removeChild(c),n}function Hm(n,s,c,_,w){if(s==="submit"&&c&&c.stateNode===w){var M=Ip((w[he]||null).action),F=_.submitter;F&&(s=(s=F[he]||null)?Ip(s.formAction):F.getAttribute("formAction"),s!==null&&(M=s,F=null));var Y=new Ve("action","action",null,_,w);n.push({event:Y,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(vu!==0){var mt=F?Ad(w,F):new FormData(w);Ms(c,{pending:!0,data:mt,method:w.method,action:M},null,mt)}}else typeof M=="function"&&(Y.preventDefault(),mt=F?Ad(w,F):new FormData(w),Ms(c,{pending:!0,data:mt,method:w.method,action:M},M,mt))},currentTarget:w}]})}}for(var zp=0;zp<qu.length;zp++){var Pp=qu[zp],Bg=Pp.toLowerCase(),Fg=Pp[0].toUpperCase()+Pp.slice(1);or(Bg,"on"+Fg)}or(Uu,"onAnimationEnd"),or(Yc,"onAnimationIteration"),or(vo,"onAnimationStart"),or("dblclick","onDoubleClick"),or("focusin","onFocus"),or("focusout","onBlur"),or(Gu,"onTransitionRun"),or(Wl,"onTransitionStart"),or(ga,"onTransitionCancel"),or(td,"onTransitionEnd"),Sr("onMouseEnter",["mouseout","mouseover"]),Sr("onMouseLeave",["mouseout","mouseover"]),Sr("onPointerEnter",["pointerout","pointerover"]),Sr("onPointerLeave",["pointerout","pointerover"]),Xo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Rp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Dd));function Al(n,s){s=(s&4)!==0;for(var c=0;c<n.length;c++){var _=n[c],w=_.event;_=_.listeners;t:{var M=void 0;if(s)for(var F=_.length-1;0<=F;F--){var Y=_[F],mt=Y.instance,Rt=Y.currentTarget;if(Y=Y.listener,mt!==M&&w.isPropagationStopped())break t;M=Y,w.currentTarget=Rt;try{M(w)}catch(Zt){sl(Zt)}w.currentTarget=null,M=mt}else for(F=0;F<_.length;F++){if(Y=_[F],mt=Y.instance,Rt=Y.currentTarget,Y=Y.listener,mt!==M&&w.isPropagationStopped())break t;M=Y,w.currentTarget=Rt;try{M(w)}catch(Zt){sl(Zt)}w.currentTarget=null,M=mt}}}}function oi(n,s){var c=s[fr];c===void 0&&(c=s[fr]=new Set);var _=n+"__bubble";c.has(_)||(Lp(s,n,2,!1),c.add(_))}function kf(n,s,c){var _=0;s&&(_|=4),Lp(c,n,_,s)}var Id="_reactListening"+Math.random().toString(36).slice(2);function Bf(n){if(!n[Id]){n[Id]=!0,Br.forEach(function(c){c!=="selectionchange"&&(Rp.has(c)||kf(c,!1,n),kf(c,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[Id]||(s[Id]=!0,kf("selectionchange",!1,s))}}function Lp(n,s,c,_){switch(ng(s)){case 2:var w=eg;break;case 8:w=ig;break;default:w=im}c=w.bind(null,s,c,n),w=void 0,!Jn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(w=!0),_?w!==void 0?n.addEventListener(s,c,{capture:!0,passive:w}):n.addEventListener(s,c,!0):w!==void 0?n.addEventListener(s,c,{passive:w}):n.addEventListener(s,c,!1)}function Ff(n,s,c,_,w){var M=_;if((s&1)===0&&(s&2)===0&&_!==null)t:for(;;){if(_===null)return;var F=_.tag;if(F===3||F===4){var Y=_.stateNode.containerInfo;if(Y===w)break;if(F===4)for(F=_.return;F!==null;){var mt=F.tag;if((mt===3||mt===4)&&F.stateNode.containerInfo===w)return;F=F.return}for(;Y!==null;){if(F=Pa(Y),F===null)return;if(mt=F.tag,mt===5||mt===6||mt===26||mt===27){_=M=F;continue t}Y=Y.parentNode}}_=_.return}Lu(function(){var Rt=M,Zt=vn(c),Jt=[];t:{var kt=ed.get(n);if(kt!==void 0){var Nt=Ve,we=n;switch(n){case"keypress":if(po(c)===0)break t;case"keydown":case"keyup":Nt=Fc;break;case"focusin":we="focus",Nt=go;break;case"focusout":we="blur",Nt=go;break;case"beforeblur":case"afterblur":Nt=go;break;case"click":if(c.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Nt=Ou;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Nt=Bu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Nt=Nc;break;case Uu:case Yc:case vo:Nt=hs;break;case td:Nt=jr;break;case"scroll":case"scrollend":Nt=ri;break;case"wheel":Nt=Qo;break;case"copy":case"cut":case"paste":Nt=kc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Nt=Wd;break;case"toggle":case"beforetoggle":Nt=Fu}var Fe=(s&4)!==0,Ui=!Fe&&(n==="scroll"||n==="scrollend"),Et=Fe?kt!==null?kt+"Capture":null:kt;Fe=[];for(var wt=Rt,zt;wt!==null;){var Yt=wt;if(zt=Yt.stateNode,Yt=Yt.tag,Yt!==5&&Yt!==26&&Yt!==27||zt===null||Et===null||(Yt=Un(wt,Et),Yt!=null&&Fe.push(xu(wt,Yt,zt))),Ui)break;wt=wt.return}0<Fe.length&&(kt=new Nt(kt,we,null,c,Zt),Jt.push({event:kt,listeners:Fe}))}}if((s&7)===0){t:{if(kt=n==="mouseover"||n==="pointerover",Nt=n==="mouseout"||n==="pointerout",kt&&c!==ls&&(we=c.relatedTarget||c.fromElement)&&(Pa(we)||we[Se]))break t;if((Nt||kt)&&(kt=Zt.window===Zt?Zt:(kt=Zt.ownerDocument)?kt.defaultView||kt.parentWindow:window,Nt?(we=c.relatedTarget||c.toElement,Nt=Rt,we=we?Pa(we):null,we!==null&&(Ui=lt(we),Fe=we.tag,we!==Ui||Fe!==5&&Fe!==27&&Fe!==6)&&(we=null)):(Nt=null,we=Rt),Nt!==we)){if(Fe=Ou,Yt="onMouseLeave",Et="onMouseEnter",wt="mouse",(n==="pointerout"||n==="pointerover")&&(Fe=Wd,Yt="onPointerLeave",Et="onPointerEnter",wt="pointer"),Ui=Nt==null?kt:Ra(Nt),zt=we==null?kt:Ra(we),kt=new Fe(Yt,wt+"leave",Nt,c,Zt),kt.target=Ui,kt.relatedTarget=zt,Yt=null,Pa(Zt)===Rt&&(Fe=new Fe(Et,wt+"enter",we,c,Zt),Fe.target=zt,Fe.relatedTarget=Ui,Yt=Fe),Ui=Yt,Nt&&we)e:{for(Fe=Pd,Et=Nt,wt=we,zt=0,Yt=Et;Yt;Yt=Fe(Yt))zt++;Yt=0;for(var ze=wt;ze;ze=Fe(ze))Yt++;for(;0<zt-Yt;)Et=Fe(Et),zt--;for(;0<Yt-zt;)wt=Fe(wt),Yt--;for(;zt--;){if(Et===wt||wt!==null&&Et===wt.alternate){Fe=Et;break e}Et=Fe(Et),wt=Fe(wt)}Fe=null}else Fe=null;Nt!==null&&Op(Jt,kt,Nt,Fe,!1),we!==null&&Ui!==null&&Op(Jt,Ui,we,Fe,!0)}}t:{if(kt=Rt?Ra(Rt):window,Nt=kt.nodeName&&kt.nodeName.toLowerCase(),Nt==="select"||Nt==="input"&&kt.type==="file")var _i=Xh;else if(Uc(kt))if(Yh)_i=Kh;else{_i=Gc;var Ee=rf}else Nt=kt.nodeName,!Nt||Nt.toLowerCase()!=="input"||kt.type!=="checkbox"&&kt.type!=="radio"?Rt&&os(Rt.elementType)&&(_i=Xh):_i=Wh;if(_i&&(_i=_i(n,Rt))){Hh(Jt,_i,c,Zt);break t}Ee&&Ee(n,kt,Rt),n==="focusout"&&Rt&&kt.type==="number"&&Rt.memoizedProps.value!=null&&Pu(kt,"number",kt.value)}switch(Ee=Rt?Ra(Rt):window,n){case"focusin":(Uc(Ee)||Ee.contentEditable==="true")&&(_o=Ee,Qh=Rt,ai=null);break;case"focusout":ai=Qh=_o=null;break;case"mousedown":Jh=!0;break;case"contextmenu":case"mouseup":case"dragend":Jh=!1,sf(Jt,c,Zt);break;case"selectionchange":if(al)break;case"keydown":case"keyup":sf(Jt,c,Zt)}var Xe;if(qh)t:{switch(n){case"compositionstart":var li="onCompositionStart";break t;case"compositionend":li="onCompositionEnd";break t;case"compositionupdate":li="onCompositionUpdate";break t}li=void 0}else el?Zh(n,c)&&(li="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(li="onCompositionStart");li&&(Ns&&c.locale!=="ko"&&(el||li!=="onCompositionStart"?li==="onCompositionEnd"&&el&&(Xe=Bs()):(Mr=Zt,Bi="value"in Mr?Mr.value:Mr.textContent,el=!0)),Ee=zd(Rt,li),0<Ee.length&&(li=new tr(li,n,null,c,Zt),Jt.push({event:li,listeners:Ee}),Xe?li.data=Xe:(Xe=tl(c),Xe!==null&&(li.data=Xe)))),(Xe=Nu?Jd(n,c):ep(n,c))&&(li=zd(Rt,"onBeforeInput"),0<li.length&&(Ee=new tr("onBeforeInput","beforeinput",null,c,Zt),Jt.push({event:Ee,listeners:li}),Ee.data=Xe)),Hm(Jt,n,Rt,c,Zt)}Al(Jt,s)})}function xu(n,s,c){return{instance:n,listener:s,currentTarget:c}}function zd(n,s){for(var c=s+"Capture",_=[];n!==null;){var w=n,M=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||M===null||(w=Un(n,c),w!=null&&_.unshift(xu(n,w,M)),w=Un(n,s),w!=null&&_.push(xu(n,w,M))),n.tag===3)return _;n=n.return}return[]}function Pd(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Op(n,s,c,_,w){for(var M=s._reactName,F=[];c!==null&&c!==_;){var Y=c,mt=Y.alternate,Rt=Y.stateNode;if(Y=Y.tag,mt!==null&&mt===_)break;Y!==5&&Y!==26&&Y!==27||Rt===null||(mt=Rt,w?(Rt=Un(c,M),Rt!=null&&F.unshift(xu(c,Rt,mt))):w||(Rt=Un(c,M),Rt!=null&&F.push(xu(c,Rt,mt)))),c=c.return}F.length!==0&&n.push({event:s,listeners:F})}var kp=/\r\n?/g,$m=/\u0000|\uFFFD/g;function Ea(n){return(typeof n=="string"?n:""+n).replace(kp,`
`).replace($m,"")}function xc(n,s){return s=Ea(s),Ea(n)===s}function Di(n,s,c,_,w,M){switch(c){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Wo(n,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Wo(n,""+_);break;case"className":Gl(n,"class",_);break;case"tabIndex":Gl(n,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":Gl(n,c,_);break;case"style":$d(n,_,M);break;case"data":if(s!=="object"){Gl(n,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||c!=="href")){n.removeAttribute(c);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){n.removeAttribute(c);break}_=Er(""+_),n.setAttribute(c,_);break;case"action":case"formAction":if(typeof _=="function"){n.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&Di(n,s,"name",w.name,w,null),Di(n,s,"formEncType",w.formEncType,w,null),Di(n,s,"formMethod",w.formMethod,w,null),Di(n,s,"formTarget",w.formTarget,w,null)):(Di(n,s,"encType",w.encType,w,null),Di(n,s,"method",w.method,w,null),Di(n,s,"target",w.target,w,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){n.removeAttribute(c);break}_=Er(""+_),n.setAttribute(c,_);break;case"onClick":_!=null&&(n.onclick=Ge);break;case"onScroll":_!=null&&oi("scroll",n);break;case"onScrollEnd":_!=null&&oi("scrollend",n);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(Z(61));if(c=_.__html,c!=null){if(w.children!=null)throw Error(Z(60));n.innerHTML=c}}break;case"multiple":n.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":n.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){n.removeAttribute("xlink:href");break}c=Er(""+_),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(c,""+_):n.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(c,""):n.removeAttribute(c);break;case"capture":case"download":_===!0?n.setAttribute(c,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?n.setAttribute(c,_):n.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?n.setAttribute(c,_):n.removeAttribute(c);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?n.removeAttribute(c):n.setAttribute(c,_);break;case"popover":oi("beforetoggle",n),oi("toggle",n),Os(n,"popover",_);break;case"xlinkActuate":Fr(n,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Fr(n,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Fr(n,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Fr(n,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Fr(n,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Fr(n,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Fr(n,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Fr(n,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Fr(n,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Os(n,"is",_);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ko.get(c)||c,Os(n,c,_))}}function Bp(n,s,c,_,w,M){switch(c){case"style":$d(n,_,M);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(Z(61));if(c=_.__html,c!=null){if(w.children!=null)throw Error(Z(60));n.innerHTML=c}}break;case"children":typeof _=="string"?Wo(n,_):(typeof _=="number"||typeof _=="bigint")&&Wo(n,""+_);break;case"onScroll":_!=null&&oi("scroll",n);break;case"onScrollEnd":_!=null&&oi("scrollend",n);break;case"onClick":_!=null&&(n.onclick=Ge);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ki.hasOwnProperty(c))t:{if(c[0]==="o"&&c[1]==="n"&&(w=c.endsWith("Capture"),s=c.slice(2,w?c.length-7:void 0),M=n[he]||null,M=M!=null?M[c]:null,typeof M=="function"&&n.removeEventListener(s,M,w),typeof _=="function")){typeof M!="function"&&M!==null&&(c in n?n[c]=null:n.hasAttribute(c)&&n.removeAttribute(c)),n.addEventListener(s,_,w);break t}c in n?n[c]=_:_===!0?n.setAttribute(c,""):Os(n,c,_)}}}function yr(n,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":oi("error",n),oi("load",n);var _=!1,w=!1,M;for(M in c)if(c.hasOwnProperty(M)){var F=c[M];if(F!=null)switch(M){case"src":_=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,s));default:Di(n,s,M,F,c,null)}}w&&Di(n,s,"srcSet",c.srcSet,c,null),_&&Di(n,s,"src",c.src,c,null);return;case"input":oi("invalid",n);var Y=M=F=w=null,mt=null,Rt=null;for(_ in c)if(c.hasOwnProperty(_)){var Zt=c[_];if(Zt!=null)switch(_){case"name":w=Zt;break;case"type":F=Zt;break;case"checked":mt=Zt;break;case"defaultChecked":Rt=Zt;break;case"value":M=Zt;break;case"defaultValue":Y=Zt;break;case"children":case"dangerouslySetInnerHTML":if(Zt!=null)throw Error(Z(137,s));break;default:Di(n,s,_,Zt,c,null)}}Lc(n,M,Y,mt,Rt,F,w,!1);return;case"select":oi("invalid",n),_=F=M=null;for(w in c)if(c.hasOwnProperty(w)&&(Y=c[w],Y!=null))switch(w){case"value":M=Y;break;case"defaultValue":F=Y;break;case"multiple":_=Y;default:Di(n,s,w,Y,c,null)}s=M,c=F,n.multiple=!!_,s!=null?Yo(n,!!_,s,!1):c!=null&&Yo(n,!!_,c,!0);return;case"textarea":oi("invalid",n),M=w=_=null;for(F in c)if(c.hasOwnProperty(F)&&(Y=c[F],Y!=null))switch(F){case"value":_=Y;break;case"defaultValue":w=Y;break;case"children":M=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(Z(91));break;default:Di(n,s,F,Y,c,null)}Ru(n,_,w,M);return;case"option":for(mt in c)if(c.hasOwnProperty(mt)&&(_=c[mt],_!=null))switch(mt){case"selected":n.selected=_&&typeof _!="function"&&typeof _!="symbol";break;default:Di(n,s,mt,_,c,null)}return;case"dialog":oi("beforetoggle",n),oi("toggle",n),oi("cancel",n),oi("close",n);break;case"iframe":case"object":oi("load",n);break;case"video":case"audio":for(_=0;_<Dd.length;_++)oi(Dd[_],n);break;case"image":oi("error",n),oi("load",n);break;case"details":oi("toggle",n);break;case"embed":case"source":case"link":oi("error",n),oi("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Rt in c)if(c.hasOwnProperty(Rt)&&(_=c[Rt],_!=null))switch(Rt){case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,s));default:Di(n,s,Rt,_,c,null)}return;default:if(os(s)){for(Zt in c)c.hasOwnProperty(Zt)&&(_=c[Zt],_!==void 0&&Bp(n,s,Zt,_,c,void 0));return}}for(Y in c)c.hasOwnProperty(Y)&&(_=c[Y],_!=null&&Di(n,s,Y,_,c,null))}function Xm(n,s,c,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,M=null,F=null,Y=null,mt=null,Rt=null,Zt=null;for(Nt in c){var Jt=c[Nt];if(c.hasOwnProperty(Nt)&&Jt!=null)switch(Nt){case"checked":break;case"value":break;case"defaultValue":mt=Jt;default:_.hasOwnProperty(Nt)||Di(n,s,Nt,null,_,Jt)}}for(var kt in _){var Nt=_[kt];if(Jt=c[kt],_.hasOwnProperty(kt)&&(Nt!=null||Jt!=null))switch(kt){case"type":M=Nt;break;case"name":w=Nt;break;case"checked":Rt=Nt;break;case"defaultChecked":Zt=Nt;break;case"value":F=Nt;break;case"defaultValue":Y=Nt;break;case"children":case"dangerouslySetInnerHTML":if(Nt!=null)throw Error(Z(137,s));break;default:Nt!==Jt&&Di(n,s,kt,Nt,_,Jt)}}Rc(n,F,Y,mt,Rt,Zt,M,w);return;case"select":Nt=F=Y=kt=null;for(M in c)if(mt=c[M],c.hasOwnProperty(M)&&mt!=null)switch(M){case"value":break;case"multiple":Nt=mt;default:_.hasOwnProperty(M)||Di(n,s,M,null,_,mt)}for(w in _)if(M=_[w],mt=c[w],_.hasOwnProperty(w)&&(M!=null||mt!=null))switch(w){case"value":kt=M;break;case"defaultValue":Y=M;break;case"multiple":F=M;default:M!==mt&&Di(n,s,w,M,_,mt)}s=Y,c=F,_=Nt,kt!=null?Yo(n,!!c,kt,!1):!!_!=!!c&&(s!=null?Yo(n,!!c,s,!0):Yo(n,!!c,c?[]:"",!1));return;case"textarea":Nt=kt=null;for(Y in c)if(w=c[Y],c.hasOwnProperty(Y)&&w!=null&&!_.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:Di(n,s,Y,null,_,w)}for(F in _)if(w=_[F],M=c[F],_.hasOwnProperty(F)&&(w!=null||M!=null))switch(F){case"value":kt=w;break;case"defaultValue":Nt=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(Z(91));break;default:w!==M&&Di(n,s,F,w,_,M)}as(n,kt,Nt);return;case"option":for(var we in c)if(kt=c[we],c.hasOwnProperty(we)&&kt!=null&&!_.hasOwnProperty(we))switch(we){case"selected":n.selected=!1;break;default:Di(n,s,we,null,_,kt)}for(mt in _)if(kt=_[mt],Nt=c[mt],_.hasOwnProperty(mt)&&kt!==Nt&&(kt!=null||Nt!=null))switch(mt){case"selected":n.selected=kt&&typeof kt!="function"&&typeof kt!="symbol";break;default:Di(n,s,mt,kt,_,Nt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Fe in c)kt=c[Fe],c.hasOwnProperty(Fe)&&kt!=null&&!_.hasOwnProperty(Fe)&&Di(n,s,Fe,null,_,kt);for(Rt in _)if(kt=_[Rt],Nt=c[Rt],_.hasOwnProperty(Rt)&&kt!==Nt&&(kt!=null||Nt!=null))switch(Rt){case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(Z(137,s));break;default:Di(n,s,Rt,kt,_,Nt)}return;default:if(os(s)){for(var Ui in c)kt=c[Ui],c.hasOwnProperty(Ui)&&kt!==void 0&&!_.hasOwnProperty(Ui)&&Bp(n,s,Ui,void 0,_,kt);for(Zt in _)kt=_[Zt],Nt=c[Zt],!_.hasOwnProperty(Zt)||kt===Nt||kt===void 0&&Nt===void 0||Bp(n,s,Zt,kt,_,Nt);return}}for(var Et in c)kt=c[Et],c.hasOwnProperty(Et)&&kt!=null&&!_.hasOwnProperty(Et)&&Di(n,s,Et,null,_,kt);for(Jt in _)kt=_[Jt],Nt=c[Jt],!_.hasOwnProperty(Jt)||kt===Nt||kt==null&&Nt==null||Di(n,s,Jt,kt,_,Nt)}function Fp(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function bh(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,c=performance.getEntriesByType("resource"),_=0;_<c.length;_++){var w=c[_],M=w.transferSize,F=w.initiatorType,Y=w.duration;if(M&&Y&&Fp(F)){for(F=0,Y=w.responseEnd,_+=1;_<c.length;_++){var mt=c[_],Rt=mt.startTime;if(Rt>Y)break;var Zt=mt.transferSize,Jt=mt.initiatorType;Zt&&Fp(Jt)&&(mt=mt.responseEnd,F+=Zt*(mt<Y?1:(Y-Rt)/(mt-Rt)))}if(--_,s+=8*(M+F)/(w.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var wh=null,Rd=null;function Th(n){return n.nodeType===9?n:n.ownerDocument}function Np(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Nf(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function Ld(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var jp=null;function Ng(){var n=window.event;return n&&n.type==="popstate"?n===jp?!1:(jp=n,!0):(jp=null,!1)}var dr=typeof setTimeout=="function"?setTimeout:void 0,Je=typeof clearTimeout=="function"?clearTimeout:void 0,jo=typeof Promise=="function"?Promise:void 0,ao=typeof queueMicrotask=="function"?queueMicrotask:typeof jo<"u"?function(n){return jo.resolve(null).then(n).catch(bc)}:dr;function bc(n){setTimeout(function(){throw n})}function Yn(n){return n==="head"}function Wn(n,s){var c=s,_=0;do{var w=c.nextSibling;if(n.removeChild(c),w&&w.nodeType===8)if(c=w.data,c==="/$"||c==="/&"){if(_===0){n.removeChild(w),Ph(s);return}_--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")_++;else if(c==="html")Eh(n.ownerDocument.documentElement);else if(c==="head"){c=n.ownerDocument.head,Eh(c);for(var M=c.firstChild;M;){var F=M.nextSibling,Y=M.nodeName;M[Qr]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=F}}else c==="body"&&Eh(n.ownerDocument.body);c=w}while(c);Ph(s)}function Kn(n,s){var c=n;n=0;do{var _=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),_&&_.nodeType===8)if(c=_.data,c==="/$"){if(n===0)break;n--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||n++;c=_}while(c)}function jf(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":jf(c),fo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}n.removeChild(c)}}function Ya(n,s,c,_){for(;n.nodeType===1;){var w=c;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(_){if(!n[Qr])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(M=n.getAttribute("rel"),M==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(M!==w.rel||n.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||n.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||n.getAttribute("title")!==(w.title==null?null:w.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(M=n.getAttribute("src"),(M!==(w.src==null?null:w.src)||n.getAttribute("type")!==(w.type==null?null:w.type)||n.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&M&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var M=w.name==null?null:""+w.name;if(w.type==="hidden"&&n.getAttribute("name")===M)return n}else return n;if(n=vr(n.nextSibling),n===null)break}return null}function Vp(n,s,c){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!c||(n=vr(n.nextSibling),n===null))return null;return n}function kn(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=vr(n.nextSibling),n===null))return null;return n}function Sh(n){return n.data==="$?"||n.data==="$~"}function Up(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Ym(n,s){var c=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||c.readyState!=="loading")s();else{var _=function(){s(),c.removeEventListener("DOMContentLoaded",_)};c.addEventListener("DOMContentLoaded",_),n._reactRetry=_}}function vr(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var bu=null;function Wm(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"||c==="/&"){if(s===0)return vr(n.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}n=n.nextSibling}return null}function Gp(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return n;s--}else c!=="/$"&&c!=="/&"||s++}n=n.previousSibling}return null}function qp(n,s,c){switch(s=Th(c),n){case"html":if(n=s.documentElement,!n)throw Error(Z(452));return n;case"head":if(n=s.head,!n)throw Error(Z(453));return n;case"body":if(n=s.body,!n)throw Error(Z(454));return n;default:throw Error(Z(451))}}function Eh(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);fo(n)}var Ma=new Map,Zp=new Set;function so(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var la=ce.d;ce.d={f:Vf,r:Od,D:Ue,C:Km,L:Qm,m:Mh,X:Ch,S:jg,M:Vg};function Vf(){var n=la.f(),s=vh();return n||s}function Od(n){var s=pr(n);s!==null&&s.tag===5&&s.type==="form"?na(s):la.r(n)}var Bn=typeof document>"u"?null:document;function Is(n,s,c){var _=Bn;if(_&&typeof s=="string"&&s){var w=Nr(s);w='link[rel="'+n+'"][href="'+w+'"]',typeof c=="string"&&(w+='[crossorigin="'+c+'"]'),Zp.has(w)||(Zp.add(w),n={rel:n,crossOrigin:c,href:s},_.querySelector(w)===null&&(s=_.createElement("link"),yr(s,"link",n),dn(s),_.head.appendChild(s)))}}function Ue(n){la.D(n),Is("dns-prefetch",n,null)}function Km(n,s){la.C(n,s),Is("preconnect",n,s)}function Qm(n,s,c){la.L(n,s,c);var _=Bn;if(_&&n&&s){var w='link[rel="preload"][as="'+Nr(s)+'"]';s==="image"&&c&&c.imageSrcSet?(w+='[imagesrcset="'+Nr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(w+='[imagesizes="'+Nr(c.imageSizes)+'"]')):w+='[href="'+Nr(n)+'"]';var M=w;switch(s){case"style":M=Dl(n);break;case"script":M=Tu(n)}Ma.has(M)||(n=ee({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:n,as:s},c),Ma.set(M,n),_.querySelector(w)!==null||s==="style"&&_.querySelector(wu(M))||s==="script"&&_.querySelector(wc(M))||(s=_.createElement("link"),yr(s,"link",n),dn(s),_.head.appendChild(s)))}}function Mh(n,s){la.m(n,s);var c=Bn;if(c&&n){var _=s&&typeof s.as=="string"?s.as:"script",w='link[rel="modulepreload"][as="'+Nr(_)+'"][href="'+Nr(n)+'"]',M=w;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=Tu(n)}if(!Ma.has(M)&&(n=ee({rel:"modulepreload",href:n},s),Ma.set(M,n),c.querySelector(w)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(wc(M)))return}_=c.createElement("link"),yr(_,"link",n),dn(_),c.head.appendChild(_)}}}function jg(n,s,c){la.S(n,s,c);var _=Bn;if(_&&n){var w=La(_).hoistableStyles,M=Dl(n);s=s||"default";var F=w.get(M);if(!F){var Y={loading:0,preload:null};if(F=_.querySelector(wu(M)))Y.loading=5;else{n=ee({rel:"stylesheet",href:n,"data-precedence":s},c),(c=Ma.get(M))&&Tc(n,c);var mt=F=_.createElement("link");dn(mt),yr(mt,"link",n),mt._p=new Promise(function(Rt,Zt){mt.onload=Rt,mt.onerror=Zt}),mt.addEventListener("load",function(){Y.loading|=1}),mt.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,Su(F,s,_)}F={type:"stylesheet",instance:F,count:1,state:Y},w.set(M,F)}}}function Ch(n,s){la.X(n,s);var c=Bn;if(c&&n){var _=La(c).hoistableScripts,w=Tu(n),M=_.get(w);M||(M=c.querySelector(wc(w)),M||(n=ee({src:n,async:!0},s),(s=Ma.get(w))&&Uf(n,s),M=c.createElement("script"),dn(M),yr(M,"link",n),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},_.set(w,M))}}function Vg(n,s){la.M(n,s);var c=Bn;if(c&&n){var _=La(c).hoistableScripts,w=Tu(n),M=_.get(w);M||(M=c.querySelector(wc(w)),M||(n=ee({src:n,async:!0,type:"module"},s),(s=Ma.get(w))&&Uf(n,s),M=c.createElement("script"),dn(M),yr(M,"link",n),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},_.set(w,M))}}function Hp(n,s,c,_){var w=(w=ke.current)?so(w):null;if(!w)throw Error(Z(446));switch(n){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=Dl(c.href),c=La(w).hoistableStyles,_=c.get(s),_||(_={type:"style",instance:null,count:0,state:null},c.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){n=Dl(c.href);var M=La(w).hoistableStyles,F=M.get(n);if(F||(w=w.ownerDocument||w,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(n,F),(M=w.querySelector(wu(n)))&&!M._p&&(F.instance=M,F.state.loading=5),Ma.has(n)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ma.set(n,c),M||$p(w,n,c,F.state))),s&&_===null)throw Error(Z(528,""));return F}if(s&&_!==null)throw Error(Z(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Tu(c),c=La(w).hoistableScripts,_=c.get(s),_||(_={type:"script",instance:null,count:0,state:null},c.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(Z(444,n))}}function Dl(n){return'href="'+Nr(n)+'"'}function wu(n){return'link[rel="stylesheet"]['+n+"]"}function kd(n){return ee({},n,{"data-precedence":n.precedence,precedence:null})}function $p(n,s,c,_){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=n.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),yr(s,"link",c),dn(s),n.head.appendChild(s))}function Tu(n){return'[src="'+Nr(n)+'"]'}function wc(n){return"script[async]"+n}function Xp(n,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var _=n.querySelector('style[data-href~="'+Nr(c.href)+'"]');if(_)return s.instance=_,dn(_),_;var w=ee({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return _=(n.ownerDocument||n).createElement("style"),dn(_),yr(_,"style",w),Su(_,c.precedence,n),s.instance=_;case"stylesheet":w=Dl(c.href);var M=n.querySelector(wu(w));if(M)return s.state.loading|=4,s.instance=M,dn(M),M;_=kd(c),(w=Ma.get(w))&&Tc(_,w),M=(n.ownerDocument||n).createElement("link"),dn(M);var F=M;return F._p=new Promise(function(Y,mt){F.onload=Y,F.onerror=mt}),yr(M,"link",_),s.state.loading|=4,Su(M,c.precedence,n),s.instance=M;case"script":return M=Tu(c.src),(w=n.querySelector(wc(M)))?(s.instance=w,dn(w),w):(_=c,(w=Ma.get(M))&&(_=ee({},c),Uf(_,w)),n=n.ownerDocument||n,w=n.createElement("script"),dn(w),yr(w,"link",_),n.head.appendChild(w),s.instance=w);case"void":return null;default:throw Error(Z(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,Su(_,c.precedence,n));return s.instance}function Su(n,s,c){for(var _=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=_.length?_[_.length-1]:null,M=w,F=0;F<_.length;F++){var Y=_[F];if(Y.dataset.precedence===s)M=Y;else if(M!==w)break}M?M.parentNode.insertBefore(n,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(n,s.firstChild))}function Tc(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function Uf(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var Sc=null;function Bd(n,s,c){if(Sc===null){var _=new Map,w=Sc=new Map;w.set(c,_)}else w=Sc,_=w.get(c),_||(_=new Map,w.set(c,_));if(_.has(n))return _;for(_.set(n,null),c=c.getElementsByTagName(n),w=0;w<c.length;w++){var M=c[w];if(!(M[Qr]||M[$t]||n==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var F=M.getAttribute(s)||"";F=n+F;var Y=_.get(F);Y?Y.push(M):_.set(F,[M])}}return _}function Jm(n,s,c){n=n.ownerDocument||n,n.head.insertBefore(c,s==="title"?n.querySelector("head > title"):null)}function Yp(n,s,c){if(c===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Wp(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function Ug(n,s,c,_){if(c.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=Dl(_.href),M=s.querySelector(wu(w));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=Gf.bind(n),s.then(n,n)),c.state.loading|=4,c.instance=M,dn(M);return}M=s.ownerDocument||s,_=kd(_),(w=Ma.get(w))&&Tc(_,w),M=M.createElement("link"),dn(M);var F=M;F._p=new Promise(function(Y,mt){F.onload=Y,F.onerror=mt}),yr(M,"link",_),c.instance=M}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(n.count++,c=Gf.bind(n),s.addEventListener("load",c),s.addEventListener("error",c))}}var Kp=0;function tg(n,s){return n.stylesheets&&n.count===0&&Fd(n,n.stylesheets),0<n.count||0<n.imgCount?function(c){var _=setTimeout(function(){if(n.stylesheets&&Fd(n,n.stylesheets),n.unsuspend){var M=n.unsuspend;n.unsuspend=null,M()}},6e4+s);0<n.imgBytes&&Kp===0&&(Kp=62500*bh());var w=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Fd(n,n.stylesheets),n.unsuspend)){var M=n.unsuspend;n.unsuspend=null,M()}},(n.imgBytes>Kp?50:800)+s);return n.unsuspend=c,function(){n.unsuspend=null,clearTimeout(_),clearTimeout(w)}}:null}function Gf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Fd(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Eu=null;function Fd(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Eu=new Map,s.forEach(Gg,n),Eu=null,Gf.call(n))}function Gg(n,s){if(!(s.state.loading&4)){var c=Eu.get(n);if(c)var _=c.get(null);else{c=new Map,Eu.set(n,c);for(var w=n.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<w.length;M++){var F=w[M];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(c.set(F.dataset.precedence,F),_=F)}_&&c.set(null,_)}w=s.instance,F=w.getAttribute("data-precedence"),M=c.get(F)||_,M===_&&c.set(null,w),c.set(F,w),this.count++,_=Gf.bind(this),w.addEventListener("load",_),w.addEventListener("error",_),M?M.parentNode.insertBefore(w,M.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(w,n.firstChild)),s.state.loading|=4}}var Ec={$$typeof:le,Provider:null,Consumer:null,_currentValue:Oe,_currentValue2:Oe,_threadCount:0};function Qp(n,s,c,_,w,M,F,Y,mt){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=_,this.onUncaughtError=w,this.onCaughtError=M,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=mt,this.incompleteTransitions=new Map}function Jp(n,s,c,_,w,M,F,Y,mt,Rt,Zt,Jt){return n=new Qp(n,s,c,F,mt,Rt,Zt,Jt,Y),s=1,M===!0&&(s|=24),M=Ur(3,null,null,s),n.current=M,M.stateNode=n,s=qr(),s.refCount++,n.pooledCache=s,s.refCount++,M.memoizedState={element:_,isDehydrated:c,cache:s},Ss(M),n}function Mc(n){return n?(n=Vs,n):Vs}function tm(n,s,c,_,w,M){w=Mc(w),_.context===null?_.context=w:_.pendingContext=w,_=Ao(s),_.payload={element:c},M=M===void 0?null:M,M!==null&&(_.callback=M),c=xa(n,_,s),c!==null&&(oa(c,n,s),Ws(c,n,s))}function Ah(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<s?c:s}}function em(n,s){Ah(n,s),(n=n.alternate)&&Ah(n,s)}function Dh(n){if(n.tag===13||n.tag===31){var s=bo(n,67108864);s!==null&&oa(s,n,67108864),em(n,67108864)}}function Nd(n){if(n.tag===13||n.tag===31){var s=Ha();s=te(s);var c=bo(n,s);c!==null&&oa(c,n,s),em(n,s)}}var qf=!0;function eg(n,s,c,_){var w=Ut.T;Ut.T=null;var M=ce.p;try{ce.p=2,im(n,s,c,_)}finally{ce.p=M,Ut.T=w}}function ig(n,s,c,_){var w=Ut.T;Ut.T=null;var M=ce.p;try{ce.p=8,im(n,s,c,_)}finally{ce.p=M,Ut.T=w}}function im(n,s,c,_){if(qf){var w=nm(_);if(w===null)Ff(n,s,_,Zf,c),ag(n,_);else if(qg(w,n,s,c,_))_.stopPropagation();else if(ag(n,_),s&4&&-1<rg.indexOf(n)){for(;w!==null;){var M=pr(w);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var F=xt(M.pendingLanes);if(F!==0){var Y=M;for(Y.pendingLanes|=2,Y.entangledLanes|=2;F;){var mt=1<<31-j(F);Y.entanglements[1]|=mt,F&=~mt}Xa(M),(gi&6)===0&&(pc=Vn()+500,yc(0))}}break;case 31:case 13:Y=bo(M,2),Y!==null&&oa(Y,M,2),vh(),em(M,2)}if(M=nm(_),M===null&&Ff(n,s,_,Zf,c),M===w)break;w=M}w!==null&&_.stopPropagation()}else Ff(n,s,_,null,c)}}function nm(n){return n=vn(n),rm(n)}var Zf=null;function rm(n){if(Zf=null,n=Pa(n),n!==null){var s=lt(n);if(s===null)n=null;else{var c=s.tag;if(c===13){if(n=R(s),n!==null)return n;n=null}else if(c===31){if(n=d(s),n!==null)return n;n=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Zf=n,null}function ng(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kr()){case Nl:return 2;case jl:return 8;case rs:case Vl:return 32;case Rs:return 268435456;default:return 32}default:return 32}}var Hf=!1,Ca=null,Vo=null,Il=null,Ih=new Map,jd=new Map,zl=[],rg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ag(n,s){switch(n){case"focusin":case"focusout":Ca=null;break;case"dragenter":case"dragleave":Vo=null;break;case"mouseover":case"mouseout":Il=null;break;case"pointerover":case"pointerout":Ih.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":jd.delete(s.pointerId)}}function zh(n,s,c,_,w,M){return n===null||n.nativeEvent!==M?(n={blockedOn:s,domEventName:c,eventSystemFlags:_,nativeEvent:M,targetContainers:[w]},s!==null&&(s=pr(s),s!==null&&Dh(s)),n):(n.eventSystemFlags|=_,s=n.targetContainers,w!==null&&s.indexOf(w)===-1&&s.push(w),n)}function qg(n,s,c,_,w){switch(s){case"focusin":return Ca=zh(Ca,n,s,c,_,w),!0;case"dragenter":return Vo=zh(Vo,n,s,c,_,w),!0;case"mouseover":return Il=zh(Il,n,s,c,_,w),!0;case"pointerover":var M=w.pointerId;return Ih.set(M,zh(Ih.get(M)||null,n,s,c,_,w)),!0;case"gotpointercapture":return M=w.pointerId,jd.set(M,zh(jd.get(M)||null,n,s,c,_,w)),!0}return!1}function sg(n){var s=Pa(n.target);if(s!==null){var c=lt(s);if(c!==null){if(s=c.tag,s===13){if(s=R(c),s!==null){n.blockedOn=s,En(n.priority,function(){Nd(c)});return}}else if(s===31){if(s=d(c),s!==null){n.blockedOn=s,En(n.priority,function(){Nd(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function oo(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var c=nm(n.nativeEvent);if(c===null){c=n.nativeEvent;var _=new c.constructor(c.type,c);ls=_,c.target.dispatchEvent(_),ls=null}else return s=pr(c),s!==null&&Dh(s),n.blockedOn=c,!1;s.shift()}return!0}function am(n,s,c){oo(n)&&c.delete(s)}function og(){Hf=!1,Ca!==null&&oo(Ca)&&(Ca=null),Vo!==null&&oo(Vo)&&(Vo=null),Il!==null&&oo(Il)&&(Il=null),Ih.forEach(am),jd.forEach(am)}function Vd(n,s){n.blockedOn===s&&(n.blockedOn=null,Hf||(Hf=!0,b.unstable_scheduleCallback(b.unstable_NormalPriority,og)))}var Ud=null;function lg(n){Ud!==n&&(Ud=n,b.unstable_scheduleCallback(b.unstable_NormalPriority,function(){Ud===n&&(Ud=null);for(var s=0;s<n.length;s+=3){var c=n[s],_=n[s+1],w=n[s+2];if(typeof _!="function"){if(rm(_||c)===null)continue;break}var M=pr(c);M!==null&&(n.splice(s,3),s-=3,Ms(M,{pending:!0,data:w,method:c.method,action:_},_,w))}}))}function Ph(n){function s(mt){return Vd(mt,n)}Ca!==null&&Vd(Ca,n),Vo!==null&&Vd(Vo,n),Il!==null&&Vd(Il,n),Ih.forEach(s),jd.forEach(s);for(var c=0;c<zl.length;c++){var _=zl[c];_.blockedOn===n&&(_.blockedOn=null)}for(;0<zl.length&&(c=zl[0],c.blockedOn===null);)sg(c),c.blockedOn===null&&zl.shift();if(c=(n.ownerDocument||n).$$reactFormReplay,c!=null)for(_=0;_<c.length;_+=3){var w=c[_],M=c[_+1],F=w[he]||null;if(typeof M=="function")F||lg(c);else if(F){var Y=null;if(M&&M.hasAttribute("formAction")){if(w=M,F=M[he]||null)Y=F.formAction;else if(rm(w)!==null)continue}else Y=F.action;typeof Y=="function"?c[_+1]=Y:(c.splice(_,3),_-=3),lg(c)}}}function sm(){function n(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(F){return w=F})},focusReset:"manual",scroll:"manual"})}function s(){w!==null&&(w(),w=null),_||setTimeout(c,20)}function c(){if(!_&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,w=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){_=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),w!==null&&(w(),w=null)}}}function $f(n){this._internalRoot=n}Cc.prototype.render=$f.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(Z(409));var c=s.current,_=Ha();tm(c,_,n,s,null,null)},Cc.prototype.unmount=$f.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;tm(n.current,2,null,n,null,null),vh(),s[Se]=null}};function Cc(n){this._internalRoot=n}Cc.prototype.unstable_scheduleHydration=function(n){if(n){var s=Oi();n={blockedOn:null,target:n,priority:s};for(var c=0;c<zl.length&&s!==0&&s<zl[c].priority;c++);zl.splice(c,0,n),c===0&&sg(n)}};var om=A.version;if(om!=="19.2.0")throw Error(Z(527,om,"19.2.0"));ce.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=vt(s),n=n!==null?Wt(n):null,n=n===null?null:n.stateNode,n};var Xf={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Ut,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ac.isDisabled&&Ac.supportsFiber)try{Tr=Ac.inject(Xf),Ki=Ac}catch{}}return cm.createRoot=function(n,s){if(!it(n))throw Error(Z(299));var c=!1,_="",w=oh,M=lh,F=pf;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(w=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(F=s.onRecoverableError)),s=Jp(n,1,!1,null,null,c,_,null,w,M,F,sm),n[Se]=s.current,Bf(n),new $f(s)},cm.hydrateRoot=function(n,s,c){if(!it(n))throw Error(Z(299));var _=!1,w="",M=oh,F=lh,Y=pf,mt=null;return c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(F=c.onCaughtError),c.onRecoverableError!==void 0&&(Y=c.onRecoverableError),c.formState!==void 0&&(mt=c.formState)),s=Jp(n,1,!0,s,c??null,_,w,mt,M,F,Y,sm),s.context=Mc(null),c=s.current,_=Ha(),_=te(_),w=Ao(_),w.callback=null,xa(c,w,_),c=_,s.current.lanes=c,Be(s,c),Xa(s),n[Se]=s.current,Bf(n),new Cc(s)},cm.version="19.2.0",cm}var O_;function Wy(){if(O_)return Yg.exports;O_=1;function b(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b)}catch(A){console.error(A)}}return b(),Yg.exports=Yy(),Yg.exports}var Ky=Wy(),pg={exports:{}};var Qy=pg.exports,k_;function Jy(){return k_||(k_=1,(function(b,A){(function(U,Z){b.exports=Z()})(Qy,(function(){var U={},Z={};function it(R,d,dt){if(Z[R]=dt,R==="index"){var vt="var sharedModule = {}; ("+Z.shared+")(sharedModule); ("+Z.worker+")(sharedModule);",Wt={};return Z.shared(Wt),Z.index(U,Wt),typeof window<"u"&&U.setWorkerUrl(window.URL.createObjectURL(new Blob([vt],{type:"text/javascript"}))),U}}it("shared",["exports"],(function(R){function d(r,t,i,o){return new(i||(i=Promise))((function(l,h){function p(S){try{x(o.next(S))}catch(C){h(C)}}function y(S){try{x(o.throw(S))}catch(C){h(C)}}function x(S){var C;S.done?l(S.value):(C=S.value,C instanceof i?C:new i((function(I){I(C)}))).then(p,y)}x((o=o.apply(r,t||[])).next())}))}function dt(r,t){this.x=r,this.y=t}function vt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Wt,ee;typeof SuppressedError=="function"&&SuppressedError,dt.prototype={clone(){return new dt(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,t){return this.clone()._rotateAround(r,t)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult(r){const t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const t=Math.cos(r),i=Math.sin(r),o=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=o,this},_rotateAround(r,t){const i=Math.cos(r),o=Math.sin(r),l=t.y+o*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-o*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:dt},dt.convert=function(r){if(r instanceof dt)return r;if(Array.isArray(r))return new dt(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new dt(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var Bt=(function(){if(ee)return Wt;function r(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return ee=1,Wt=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var h=this.sampleCurveX(o)-t;if(Math.abs(h)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var y=0,x=1;for(o=t,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-t)<i));l++)t>h?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Wt})(),Gt=vt(Bt);let se,Lt;function _t(){return se==null&&(se=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),se}function fe(){if(Lt==null&&(Lt=!1,_t())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const l=4*o;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){Lt=!0;break}}}return Lt||!1}var me=1e-6,le=typeof Float32Array<"u"?Float32Array:Array;function mi(){var r=new le(9);return le!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ue(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ye(){var r=new le(3);return le!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function be(r){var t=r[0],i=r[1],o=r[2];return Math.sqrt(t*t+i*i+o*o)}function We(r,t,i){var o=new le(3);return o[0]=r,o[1]=t,o[2]=i,o}function ii(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r}function Pi(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r}function Wi(r,t,i){var o=t[0],l=t[1],h=t[2],p=i[0],y=i[1],x=i[2];return r[0]=l*x-h*y,r[1]=h*p-o*x,r[2]=o*y-l*p,r}var yi,jn=be;function cn(r,t,i){var o=t[0],l=t[1],h=t[2],p=t[3];return r[0]=i[0]*o+i[4]*l+i[8]*h+i[12]*p,r[1]=i[1]*o+i[5]*l+i[9]*h+i[13]*p,r[2]=i[2]*o+i[6]*l+i[10]*h+i[14]*p,r[3]=i[3]*o+i[7]*l+i[11]*h+i[15]*p,r}function wr(){var r=new le(4);return le!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ut(r,t,i,o){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",h=Math.PI/360;t*=h,o*=h,i*=h;var p=Math.sin(t),y=Math.cos(t),x=Math.sin(i),S=Math.cos(i),C=Math.sin(o),I=Math.cos(o);switch(l){case"xyz":r[0]=p*S*I+y*x*C,r[1]=y*x*I-p*S*C,r[2]=y*S*C+p*x*I,r[3]=y*S*I-p*x*C;break;case"xzy":r[0]=p*S*I-y*x*C,r[1]=y*x*I-p*S*C,r[2]=y*S*C+p*x*I,r[3]=y*S*I+p*x*C;break;case"yxz":r[0]=p*S*I+y*x*C,r[1]=y*x*I-p*S*C,r[2]=y*S*C-p*x*I,r[3]=y*S*I+p*x*C;break;case"yzx":r[0]=p*S*I+y*x*C,r[1]=y*x*I+p*S*C,r[2]=y*S*C-p*x*I,r[3]=y*S*I-p*x*C;break;case"zxy":r[0]=p*S*I-y*x*C,r[1]=y*x*I+p*S*C,r[2]=y*S*C+p*x*I,r[3]=y*S*I-p*x*C;break;case"zyx":r[0]=p*S*I-y*x*C,r[1]=y*x*I+p*S*C,r[2]=y*S*C-p*x*I,r[3]=y*S*I+p*x*C;break;default:throw new Error("Unknown angle order "+l)}return r}function ce(){var r=new le(2);return le!=Float32Array&&(r[0]=0,r[1]=0),r}function Oe(r,t){var i=new le(2);return i[0]=r,i[1]=t,i}Ye(),yi=new le(4),le!=Float32Array&&(yi[0]=0,yi[1]=0,yi[2]=0,yi[3]=0),Ye(),We(1,0,0),We(0,1,0),wr(),wr(),mi(),ce();const De=8192;function vi(r,t,i){return t*(De/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}function Tt(r,t){return(r%t+t)%t}function Kt(r,t,i){return r*(1-i)+t*i}function ge(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,i=t*r;return 4*(r<.5?i:3*(r-t)+i-.75)}function xe(r,t,i,o){const l=new Gt(r,t,i,o);return h=>l.solve(h)}const Ne=xe(.25,.1,.25,1);function ke(r,t,i){return Math.min(i,Math.max(t,r))}function Ke(r,t,i){const o=i-t,l=((r-t)%o+o)%o+t;return l===t?i:l}function Mi(r,...t){for(const i of t)for(const o in i)r[o]=i[o];return r}let Xi=1;function fa(r,t,i){const o={};for(const l in r)o[l]=t.call(this,r[l],l,r);return o}function es(r,t,i){const o={};for(const l in r)t.call(this,r[l],l,r)&&(o[l]=r[l]);return o}function Or(r){return Array.isArray(r)?r.map(Or):typeof r=="object"&&r?fa(r,Or):r}const Fl={};function Ci(r){Fl[r]||(typeof console<"u"&&console.warn(r),Fl[r]=!0)}function Kr(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function pa(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let an=null;function za(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ma="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function co(r,t,i,o,l){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(r,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*l*4);if(yield h.copyTo(x,(function(S,C,I,P,L){const O=4*Math.max(-C,0),N=(Math.max(0,I)-I)*P*4+O,G=4*P,X=Math.max(0,C),rt=Math.max(0,I);return{rect:{x:X,y:rt,width:Math.min(S.width,C+P)-X,height:Math.min(S.height,I+L)-rt},layout:[{offset:N,stride:G}]}})(r,t,i,o,l)),y)for(let S=0;S<x.length;S+=4){const C=x[S];x[S]=x[S+2],x[S+2]=C}return x}finally{h.close()}}))}let is,ns;function ho(r,t,i,o){return r.addEventListener(t,i,o),{unsubscribe:()=>{r.removeEventListener(t,i,o)}}}function Vn(r){return r*Math.PI/180}function kr(r){return r/Math.PI*180}const Nl={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},jl={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},rs="AbortError";function Vl(){return new Error(rs)}const Rs={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ul(r){return Rs.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Ho="global-dispatcher";class Tr extends Error{constructor(t,i,o,l){super(`AJAXError: ${i} (${t}): ${o}`),this.status=t,this.statusText=i,this.url=o,this.body=l}}const Ki=()=>pa(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ft=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Ul(r.url);if(o)return o(r,t);if(pa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Ho},t)}if(!(/^file:/.test(i=r.url)||/^file:/.test(Ki())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,l){return d(this,void 0,void 0,(function*(){const h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ki(),signal:l.signal});let p,y;o.type!=="json"||h.headers.has("Accept")||h.headers.set("Accept","application/json");try{p=yield fetch(h)}catch(S){throw new Tr(0,S.message,o.url,new Blob)}if(!p.ok){const S=yield p.blob();throw new Tr(p.status,p.statusText,o.url,S)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;if(l.signal.aborted)throw Vl();return{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(r,t);if(pa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Ho},t)}var i;return(function(o,l){return new Promise(((h,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const S in o.headers)x.setRequestHeader(S,o.headers[S]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!l.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let S=x.response;if(o.type==="json")try{S=JSON.parse(x.response)}catch(C){return void p(C)}h({data:S,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const S=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new Tr(x.status,x.statusText,o.url,S))}},l.signal.addEventListener("abort",(()=>{x.abort(),p(Vl())})),x.send(o.body)}))})(r,t)};function j(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function q(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function $(r,t,i){if(i&&i[r]){const o=i[r].indexOf(t);o!==-1&&i[r].splice(o,1)}}class st{constructor(t,i={}){Mi(this,i),this.type=t}}class ut extends st{constructor(t,i={}){super("error",Mi({error:t},i))}}class St{on(t,i){return this._listeners=this._listeners||{},q(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return $(t,i,this._listeners),$(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},q(t,i,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,i){typeof t=="string"&&(t=new st(t,i||{}));const o=t.type;if(this.listens(o)){t.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of l)y.call(this,t);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of h)$(o,y,this._oneTimeListeners),y.call(this,t);const p=this._eventedParent;p&&(Mi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof ut&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var J={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pt(r,t){const i={};for(const o in r)o!=="ref"&&(i[o]=r[o]);return xt.forEach((o=>{o in t&&(i[o]=t[o])})),i}function Ot(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!Ot(r[i],t[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const i in r)if(!Ot(r[i],t[i]))return!1;return!0}return r===t}function Ft(r,t){r.push(t)}function pe(r,t,i){Ft(i,{command:"addSource",args:[r,t[r]]})}function Te(r,t,i){Ft(t,{command:"removeSource",args:[r]}),i[r]=!0}function Be(r,t,i,o){Te(r,i,o),pe(r,t,i)}function hn(r,t,i){let o;for(o in r[i])if(Object.prototype.hasOwnProperty.call(r[i],o)&&o!=="data"&&!Ot(r[i][o],t[i][o]))return!1;for(o in t[i])if(Object.prototype.hasOwnProperty.call(t[i],o)&&o!=="data"&&!Ot(r[i][o],t[i][o]))return!1;return!0}function He(r,t,i,o,l,h){r=r||{},t=t||{};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(Ot(r[p],t[p])||i.push({command:h,args:[o,p,t[p],l]}));for(const p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(r,p)&&(Ot(r[p],t[p])||i.push({command:h,args:[o,p,t[p],l]}))}function di(r){return r.id}function Ri(r,t){return r[t.id]=t,r}class te{constructor(t,i,o,l){this.message=(t?`${t}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function Li(r,...t){for(const i of t)for(const o in i)r[o]=i[o];return r}class Oi extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class En{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(t){return new En(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const fi={kind:"null"},$t={kind:"number"},he={kind:"string"},Se={kind:"boolean"},fr={kind:"color"},$o={kind:"projectionDefinition"},Qn={kind:"object"},Pe={kind:"value"},Qr={kind:"collator"},fo={kind:"formatted"},Pa={kind:"padding"},pr={kind:"colorArray"},Ra={kind:"numberArray"},La={kind:"resolvedImage"},dn={kind:"variableAnchorOffsetCollection"};function Br(r,t){return{kind:"array",itemType:r,N:t}}function ki(r){if(r.kind==="array"){const t=ki(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Xo=[fi,$t,he,Se,fr,$o,fo,Qn,Br(Pe),Pa,Ra,pr,La,dn];function Sr(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Sr(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of Xo)if(!Sr(i,t))return null}}return`Expected ${ki(r)} but found ${ki(t)} instead.`}function Iu(r,t){return t.some((i=>i.kind===r.kind))}function Qi(r,t){return t.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Ls(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const kh=.96422,Os=.82521,Gl=4/29,Fr=6/29,Jr=3*Fr*Fr,Bh=Fr*Fr*Fr,tp=Math.PI/180,Pc=180/Math.PI;function Fh(r){return(r%=360)<0&&(r+=360),r}function zu([r,t,i,o]){let l,h;const p=Nr((.2225045*(r=Nh(r))+.7168786*(t=Nh(t))+.0606169*(i=Nh(i)))/1);r===t&&t===i?l=h=p:(l=Nr((.4360747*r+.3850649*t+.1430804*i)/kh),h=Nr((.0139322*r+.0971045*t+.7141733*i)/Os));const y=116*p-16;return[y<0?0:y,500*(l-p),200*(p-h),o]}function Nh(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Nr(r){return r>Bh?Math.pow(r,1/3):r/Jr+Gl}function Rc([r,t,i,o]){let l=(r+16)/116,h=isNaN(t)?l:l+t/500,p=isNaN(i)?l:l-i/200;return l=1*Pu(l),h=kh*Pu(h),p=Os*Pu(p),[Lc(3.1338561*h-1.6168667*l-.4906146*p),Lc(-.9787684*h+1.9161415*l+.033454*p),Lc(.0719453*h-.2289914*l+1.4052427*p),o]}function Lc(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Pu(r){return r>Fr?r*r*r:Jr*(r-Gl)}const Yo=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function as(r,t){return Yo(r,t)?r[t]:void 0}function Ru(r){return parseInt(r.padEnd(2,r),16)/255}function Wo(r,t){return ss(t?r/100:r,0,1)}function ss(r,t,i){return Math.min(Math.max(t,r),i)}function jh(r){return!r.some(Number.isNaN)}const $d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function os(r,t,i){return r+i*(t-r)}function Ko(r,t,i){return r.map(((o,l)=>os(o,t[l],i)))}class Qe{constructor(t,i,o,l=1,h=!0){this.r=t,this.g=i,this.b=o,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,i,o,l]))}static parse(t){if(t instanceof Qe)return t;if(typeof t!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=as($d,o);if(l){const[p,y,x]=l;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[Ru(o.slice(y,y+=p)),Ru(o.slice(y,y+=p)),Ru(o.slice(y,y+=p)),Ru(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,S,C,I,P,L,O,N,G,X,rt]=p,K=[C||" ",L||" ",G].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const tt=[S,P,N].join(""),gt=tt==="%%%"?100:tt===""?255:0;if(gt){const yt=[ss(+x/gt,0,1),ss(+I/gt,0,1),ss(+O/gt,0,1),X?Wo(+X,rt):1];if(jh(yt))return yt}}return}}const h=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,y,x,S,C,I,P,L,O]=h,N=[x||" ",C||" ",P].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const G=[+y,ss(+S,0,100),ss(+I,0,100),L?Wo(+L,O):1];if(jh(G))return(function([X,rt,K,tt]){function gt(yt){const Dt=(yt+X/30)%12,Xt=rt*Math.min(K,1-K);return K-Xt*Math.max(-1,Math.min(Dt-3,9-Dt,1))}return X=Fh(X),rt/=100,K/=100,[gt(0),gt(8),gt(4),tt]})(G)}}})(t);return i?new Qe(...i,!1):void 0}get rgb(){const{r:t,g:i,b:o,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[t/h,i/h,o/h,l])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[i,o,l,h]=zu(t),p=Math.sqrt(o*o+l*l);return[Math.round(1e4*p)?Fh(Math.atan2(l,o)*Pc):NaN,p,i,h]})(this.rgb))}get lab(){return this.overwriteGetter("lab",zu(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,o,l]=this.rgb;return`rgba(${[t,i,o].map((h=>Math.round(255*h))).join(",")},${l})`}static interpolate(t,i,o,l="rgb"){switch(l){case"rgb":{const[h,p,y,x]=Ko(t.rgb,i.rgb,o);return new Qe(h,p,y,x,!1)}case"hcl":{const[h,p,y,x]=t.hcl,[S,C,I,P]=i.hcl;let L,O;if(isNaN(h)||isNaN(S))isNaN(h)?isNaN(S)?L=NaN:(L=S,y!==1&&y!==0||(O=C)):(L=h,I!==1&&I!==0||(O=p));else{let K=S-h;S>h&&K>180?K-=360:S<h&&h-S>180&&(K+=360),L=h+o*K}const[N,G,X,rt]=(function([K,tt,gt,yt]){return K=isNaN(K)?0:K*tp,Rc([gt,Math.cos(K)*tt,Math.sin(K)*tt,yt])})([L,O??os(p,C,o),os(y,I,o),os(x,P,o)]);return new Qe(N,G,X,rt,!1)}case"lab":{const[h,p,y,x]=Rc(Ko(t.lab,i.lab,o));return new Qe(h,p,y,x,!1)}}}}Qe.black=new Qe(0,0,0,1),Qe.white=new Qe(1,1,1,1),Qe.transparent=new Qe(0,0,0,0),Qe.red=new Qe(1,0,0,1);class Er{constructor(t,i,o){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ge=["bottom","center","top"];class ls{constructor(t,i,o,l,h,p){this.text=t,this.image=i,this.scale=o,this.fontStack=l,this.textColor=h,this.verticalAlign=p}}class vn{constructor(t){this.sections=t}static fromString(t){return new vn([new ls(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof vn?t:vn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Mn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mn)return t;if(typeof t=="number")return new Mn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Mn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new Mn(Ko(t.values,i.values,o))}}class Cn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Cn)return t;if(typeof t=="number")return new Cn([t]);if(Array.isArray(t)){for(const i of t)if(typeof i!="number")return;return new Cn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new Cn(Ko(t.values,i.values,o))}}class Pn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pn)return t;if(typeof t=="string"){const o=Qe.parse(t);return o?new Pn([o]):void 0}if(!Array.isArray(t))return;const i=[];for(const o of t){if(typeof o!="string")return;const l=Qe.parse(o);if(!l)return;i.push(l)}return new Pn(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o,l="rgb"){const h=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<t.values.length;p++)h.push(Qe.interpolate(t.values[p],i.values[p],o,l));return new Pn(h)}}class Ii extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Lu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Un)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const o=t[i],l=t[i+1];if(typeof o!="string"||!Lu.has(o)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Un(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){const l=t.values,h=i.values;if(l.length!==h.length)throw new Ii(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<l.length;y+=2){if(l[y]!==h[y])throw new Ii(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${h[y]}`);p.push(l[y]);const[x,S]=l[y+1],[C,I]=h[y+1];p.push([os(x,C,o),os(S,I,o)])}return new Un(p)}}class xn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new xn({name:t,available:!1}):null}}class Jn{constructor(t,i,o){this.from=t,this.to=i,this.transition=o}static interpolate(t,i,o){return new Jn(t,i,o)}static parse(t){return t instanceof Jn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Jn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Jn(t.from,t.to,t.transition):typeof t=="string"?new Jn(t,t,1):void 0}}function ql(r,t,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,i,o]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mr(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Jn||r instanceof Qe||r instanceof Er||r instanceof vn||r instanceof Mn||r instanceof Cn||r instanceof Pn||r instanceof Un||r instanceof xn)return!0;if(Array.isArray(r)){for(const t of r)if(!Mr(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Mr(r[t]))return!1;return!0}return!1}function Bi(r){if(r===null)return fi;if(typeof r=="string")return he;if(typeof r=="boolean")return Se;if(typeof r=="number")return $t;if(r instanceof Qe)return fr;if(r instanceof Jn)return $o;if(r instanceof Er)return Qr;if(r instanceof vn)return fo;if(r instanceof Mn)return Pa;if(r instanceof Cn)return Ra;if(r instanceof Pn)return pr;if(r instanceof Un)return dn;if(r instanceof xn)return La;if(Array.isArray(r)){const t=r.length;let i;for(const o of r){const l=Bi(o);if(i){if(i===l)continue;i=Pe;break}i=l}return Br(i||Pe,t)}return Qn}function ks(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Qe||r instanceof Jn||r instanceof vn||r instanceof Mn||r instanceof Cn||r instanceof Pn||r instanceof Un||r instanceof xn?r.toString():JSON.stringify(r)}class Bs{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Mr(t[1]))return i.error("invalid value");const o=t[1];let l=Bi(o);const h=i.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Bs(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const po={string:he,number:$t,boolean:Se,object:Qn};class rr{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o,l=1;const h=t[0];if(h==="array"){let y,x;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in po)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=po[S],l++}else y=Pe;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],l++}o=Br(y,x)}else{if(!po[h])throw new Error(`Types doesn't contain name = ${h}`);o=po[h]}const p=[];for(;l<t.length;l++){const y=i.parse(t[l],l,Pe);if(!y)return null;p.push(y)}return new rr(o,p)}evaluate(t){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(t);if(!Sr(this.type,Bi(o)))return o;if(i===this.args.length-1)throw new Ii(`Expected value to be of type ${ki(this.type)}, but found ${ki(Bi(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Gi={"to-boolean":Se,"to-color":fr,"to-number":$t,"to-string":he};class fn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[0];if(!Gi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return i.error("Expected one argument.");const l=Gi[o],h=[];for(let p=1;p<t.length;p++){const y=i.parse(t[p],p,Pe);if(!y)return null;h.push(y)}return new fn(l,h)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,o;for(const l of this.args){if(i=l.evaluate(t),o=null,i instanceof Qe)return i;if(typeof i=="string"){const h=t.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ql(i[0],i[1],i[2],i[3]),!o))return new Qe(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ii(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(t);const l=Mn.parse(i);if(l)return l}throw new Ii(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=Cn.parse(i);if(l)return l}throw new Ii(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=Pn.parse(i);if(l)return l}throw new Ii(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(t);const l=Un.parse(i);if(l)return l}throw new Ii(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(t),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new Ii(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return vn.fromString(ks(this.args[0].evaluate(t)));case"resolvedImage":return xn.fromString(ks(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ks(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const $e=["Unknown","Point","LineString","Polygon"];class Ve{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$e[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Qe.parse(t),this._parseColorCache.set(t,i)),i}}class us{constructor(t,i,o=[],l,h=new En,p=[]){this.registry=t,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._isConstant=i}parse(t,i,o,l,h={}){return i?this.concat(i,o,l)._parse(t,h):this._parse(t,h)}_parse(t,i){function o(l,h,p){return p==="assert"?new rr(h,[l]):p==="coerce"?new fn(h,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(t,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof Bs)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Ve;try{p=new Bs(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,o){const l=typeof t=="number"?this.path.concat(t):this.path,h=o?this.scope.concat(o):this.scope;return new us(this.registry,this._isConstant,l,i||null,h,this.errors)}error(t,...i){const o=`${this.key}${i.map((l=>`[${l}]`)).join("")}`;this.errors.push(new Oi(o,t))}checkSubtype(t,i){const o=Sr(t,i);return o&&this.error(o),o}}class ri{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let h=1;h<t.length-1;h+=2){const p=t[h];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=i.parse(t[h+1],h+1);if(!y)return null;o.push([p,y])}const l=i.parse(t[t.length-1],t.length-1,i.expectedType,o);return l?new ri(o,l):null}outputDefined(){return this.result.outputDefined()}}class mo{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=t[1];return i.scope.has(o)?new mo(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ta{constructor(t,i,o){this.type=t,this.index=i,this.input=o}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,$t),l=i.parse(t[2],2,Br(i.expectedType||Pe));return o&&l?new ta(l.type.itemType,o,l):null}evaluate(t){const i=this.index.evaluate(t),o=this.input.evaluate(t);if(i<0)throw new Ii(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ii(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ii(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Fs{constructor(t,i){this.type=Se,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Pe),l=i.parse(t[2],2,Pe);return o&&l?Iu(o.type,[Se,he,$t,fi,Pe])?new Fs(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(o.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Qi(i,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${ki(Bi(i))} instead.`);if(!Qi(o,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${ki(Bi(o))} instead.`);return o.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class cs{constructor(t,i,o){this.type=$t,this.needle=t,this.haystack=i,this.fromIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Pe),l=i.parse(t[2],2,Pe);if(!o||!l)return null;if(!Iu(o.type,[Se,he,$t,fi,Pe]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(o.type)} instead`);if(t.length===4){const h=i.parse(t[3],3,$t);return h?new cs(o,l,h):null}return new cs(o,l)}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Qi(i,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${ki(Bi(i))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Qi(o,["string"])){const h=o.indexOf(i,l);return h===-1?-1:[...o.slice(0,h)].length}if(Qi(o,["array"]))return o.indexOf(i,l);throw new Ii(`Expected second argument to be of type array or string, but found ${ki(Bi(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ou{constructor(t,i,o,l,h,p){this.inputType=t,this.type=i,this.input=o,this.cases=l,this.outputs=h,this.otherwise=p}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h={},p=[];for(let S=2;S<t.length-1;S+=2){let C=t[S];const I=t[S+1];Array.isArray(C)||(C=[C]);const P=i.concat(S);if(C.length===0)return P.error("Expected at least one branch label.");for(const O of C){if(typeof O!="number"&&typeof O!="string")return P.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return P.error("Numeric branch labels must be integer values.");if(o){if(P.checkSubtype(o,Bi(O)))return null}else o=Bi(O);if(h[String(O)]!==void 0)return P.error("Branch labels must be unique.");h[String(O)]=p.length}const L=i.parse(I,S,l);if(!L)return null;l=l||L.type,p.push(L)}const y=i.parse(t[1],1,Pe);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,l);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new Ou(o,l,y,h,p,x):null}evaluate(t){const i=this.input.evaluate(t);return(Bi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ku{constructor(t,i,o){this.type=t,this.branches=i,this.otherwise=o}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let p=1;p<t.length-1;p+=2){const y=i.parse(t[p],p,Se);if(!y)return null;const x=i.parse(t[p+1],p+1,o);if(!x)return null;l.push([y,x]),o=o||x.type}const h=i.parse(t[t.length-1],t.length-1,o);if(!h)return null;if(!o)throw new Error("Can't infer output type");return new ku(o,l,h)}evaluate(t){for(const[i,o]of this.branches)if(i.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,o]of this.branches)t(i),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class Bu{constructor(t,i,o,l){this.type=t,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Pe),l=i.parse(t[2],2,$t);if(!o||!l)return null;if(!Iu(o.type,[Br(Pe),he,Pe]))return i.error(`Expected first argument to be of type array or string, but found ${ki(o.type)} instead`);if(t.length===4){const h=i.parse(t[3],3,$t);return h?new Bu(o.type,o,l,h):null}return new Bu(o.type,o,l)}evaluate(t){const i=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Qi(i,["string"]))return[...i].slice(o,l).join("");if(Qi(i,["array"]))return i.slice(o,l);throw new Ii(`Expected first argument to be of type array or string, but found ${ki(Bi(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Oc(r,t){const i=r.length-1;let o,l,h=0,p=i,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),o=r[y],l=r[y+1],o<=t){if(y===i||t<l)return y;h=y+1}else{if(!(o>t))throw new Ii("Input is not a number.");p=y-1}return 0}class go{constructor(t,i,o){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[l,h]of o)this.labels.push(l),this.outputs.push(h)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(t[1],1,$t);if(!o)return null;const l=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let p=1;p<t.length;p+=2){const y=p===1?-1/0:t[p],x=t[p+1],S=p,C=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const I=i.parse(x,C,h);if(!I)return null;h=h||I.type,l.push([y,I])}return new go(h,o,l)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const h=i.length;return l>=i[h-1]?o[h-1].evaluate(t):o[Oc(i,l)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Xd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var hs,ar,kc=(function(){if(ar)return hs;function r(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return ar=1,hs=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var h=this.sampleCurveX(o)-t;if(Math.abs(h)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var y=0,x=1;for(o=t,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-t)<i));l++)t>h?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},hs})(),Yd=Xd(kc);class tr{constructor(t,i,o,l,h){this.type=t,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(t,i,o,l){let h=0;if(t.name==="exponential")h=Rn(i,t.base,o,l);else if(t.name==="linear")h=Rn(i,1,o,l);else if(t.name==="cubic-bezier"){const p=t.controlPoints;h=new Yd(p[0],p[1],p[2],p[3]).solve(Rn(i,1,o,l))}return h}static parse(t,i){let[o,l,h,...p]=t;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const S=l[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const S=l.slice(1);if(S.length!==4||S.some((C=>typeof C!="number"||C<0||C>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,$t),!h)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==pr?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=fr;for(let S=0;S<p.length;S+=2){const C=p[S],I=p[S+1],P=S+3,L=S+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const O=i.parse(I,L,x);if(!O)return null;x=x||O.type,y.push([C,O])}return Ls(x,$t)||Ls(x,$o)||Ls(x,fr)||Ls(x,Pa)||Ls(x,Ra)||Ls(x,pr)||Ls(x,dn)||Ls(x,Br($t))?new tr(x,o,l,h,y):i.error(`Type ${ki(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const h=i.length;if(l>=i[h-1])return o[h-1].evaluate(t);const p=Oc(i,l),y=tr.interpolationFactor(this.interpolation,l,i[p],i[p+1]),x=o[p].evaluate(t),S=o[p+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return os(x,S,y);case"color":return Qe.interpolate(x,S,y);case"padding":return Mn.interpolate(x,S,y);case"colorArray":return Pn.interpolate(x,S,y);case"numberArray":return Cn.interpolate(x,S,y);case"variableAnchorOffsetCollection":return Un.interpolate(x,S,y);case"array":return Ko(x,S,y);case"projectionDefinition":return Jn.interpolate(x,S,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Qe.interpolate(x,S,y,"hcl");case"colorArray":return Pn.interpolate(x,S,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Qe.interpolate(x,S,y,"lab");case"colorArray":return Pn.interpolate(x,S,y,"lab")}}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Rn(r,t,i,o){const l=o-i,h=r-i;return l===0?0:t===1?h/l:(Math.pow(t,h)-1)/(Math.pow(t,l)-1)}const Oa={color:Qe.interpolate,number:os,padding:Mn.interpolate,numberArray:Cn.interpolate,colorArray:Pn.interpolate,variableAnchorOffsetCollection:Un.interpolate,array:Ko};class Zl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const h=[];for(const y of t.slice(1)){const x=i.parse(y,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,h.push(x)}if(!o)throw new Error("No output type");const p=l&&h.some((y=>Sr(l,y.type)));return new Zl(p?Pe:o,h)}evaluate(t){let i,o=null,l=0;for(const h of this.args)if(l++,o=h.evaluate(t),o&&o instanceof xn&&!o.available&&(i||(i=o.name),o=null,l===this.args.length&&(o=i)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Vh(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Bc(r,t,i,o){return o.compare(t,i)===0}function ka(r,t,i){const o=r!=="=="&&r!=="!=";return class ry{constructor(h,p,y){this.type=Se,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let x=p.parse(h[1],1,Pe);if(!x)return null;if(!Vh(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ki(x.type)}'.`);let S=p.parse(h[2],2,Pe);if(!S)return null;if(!Vh(y,S.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ki(S.type)}'.`);if(x.type.kind!==S.type.kind&&x.type.kind!=="value"&&S.type.kind!=="value")return p.error(`Cannot compare types '${ki(x.type)}' and '${ki(S.type)}'.`);o&&(x.type.kind==="value"&&S.type.kind!=="value"?x=new rr(S.type,[x]):x.type.kind!=="value"&&S.type.kind==="value"&&(S=new rr(x.type,[S])));let C=null;if(h.length===4){if(x.type.kind!=="string"&&S.type.kind!=="string"&&x.type.kind!=="value"&&S.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(C=p.parse(h[3],3,Qr),!C)return null}return new ry(x,S,C)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const x=Bi(p),S=Bi(y);if(x.kind!==S.kind||x.kind!=="string"&&x.kind!=="number")throw new Ii(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${S.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Bi(p),S=Bi(y);if(x.kind!=="string"||S.kind!=="string")return t(h,p,y)}return this.collator?i(h,p,y,this.collator.evaluate(h)):t(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const Fc=ka("==",(function(r,t,i){return t===i}),Bc),Uh=ka("!=",(function(r,t,i){return t!==i}),(function(r,t,i,o){return!Bc(0,t,i,o)})),Wd=ka("<",(function(r,t,i){return t<i}),(function(r,t,i,o){return o.compare(t,i)<0})),Kd=ka(">",(function(r,t,i){return t>i}),(function(r,t,i,o){return o.compare(t,i)>0})),Nc=ka("<=",(function(r,t,i){return t<=i}),(function(r,t,i,o){return o.compare(t,i)<=0})),jc=ka(">=",(function(r,t,i){return t>=i}),(function(r,t,i,o){return o.compare(t,i)>=0}));class jr{constructor(t,i,o){this.type=Qr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Se);if(!l)return null;const h=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Se);if(!h)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,he),!p)?null:new jr(l,h,p)}evaluate(t){return new Er(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Vc{constructor(t,i,o,l,h){this.type=he,this.number=t,this.locale=i,this.currency=o,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const o=i.parse(t[1],1,$t);if(!o)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=i.parse(l.locale,1,he),!h))return null;let p=null;if(l.currency&&(p=i.parse(l.currency,1,he),!p))return null;let y=null;if(l["min-fraction-digits"]&&(y=i.parse(l["min-fraction-digits"],1,$t),!y))return null;let x=null;return l["max-fraction-digits"]&&(x=i.parse(l["max-fraction-digits"],1,$t),!x)?null:new Vc(o,h,p,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Qo{constructor(t){this.type=fo,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=t.length-1;++p){const y=t[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,$t),!x))return null;let S=null;if(y["text-font"]&&(S=i.parse(y["text-font"],1,Br(he)),!S))return null;let C=null;if(y["text-color"]&&(C=i.parse(y["text-color"],1,fr),!C))return null;let I=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!Ge.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(I=i.parse(y["vertical-align"],1,he),!I)return null}const P=l[l.length-1];P.scale=x,P.font=S,P.textColor=C,P.verticalAlign=I}else{const x=i.parse(t[p],1,Pe);if(!x)return null;const S=x.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Qo(l)}evaluate(t){return new vn(this.sections.map((i=>{const o=i.content.evaluate(t);return Bi(o)===La?new ls("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new ls(ks(o),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class Gh{constructor(t){this.type=La,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const o=i.parse(t[1],1,he);return o?new Gh(o):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),o=xn.fromString(i);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(i)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Fu{constructor(t){this.type=$t,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=i.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ki(o.type)} instead.`):new Fu(o):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ii(`Expected value to be of type string or array, but found ${ki(Bi(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ds=8192;function qh(r,t){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(i*l*ds),Math.round(o*l*ds)]}function Jo(r,t){const i=Math.pow(2,t.z);return[(l=(r[0]/ds+t.x)/i,360*l-180),(o=(r[1]/ds+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,l}function Nu(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Ns(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Qd(r,t,i){const o=r[0]-t[0],l=r[1]-t[1],h=r[0]-i[0],p=r[1]-i[1];return o*p-h*l==0&&o*h<=0&&l*p<=0}function Hl(r,t,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(h=[t[0]-r[0],t[1]-r[1]])[1]-l[1]*h[0]!=0&&!(!tf(r,t,i,o)||!tf(i,o,r,t));var l,h}function Zh(r,t,i){for(const o of i)for(let l=0;l<o.length-1;++l)if(Hl(r,t,o[l],o[l+1]))return!0;return!1}function tl(r,t,i=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(Qd(r,y[x],y[x+1]))return i;(h=y[x])[1]>(l=r)[1]!=(p=y[x+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(o=!o)}var l,h,p;return o}function el(r,t){for(const i of t)if(tl(r,i))return!0;return!1}function Jd(r,t){for(const i of r)if(!tl(i,t))return!1;for(let i=0;i<r.length-1;++i)if(Zh(r[i],r[i+1],t))return!1;return!0}function ep(r,t){for(const i of t)if(Jd(r,i))return!0;return!1}function tf(r,t,i,o){const l=o[0]-i[0],h=o[1]-i[1],p=(r[0]-i[0])*h-l*(r[1]-i[1]),y=(t[0]-i[0])*h-l*(t[1]-i[1]);return p>0&&y<0||p<0&&y>0}function Uc(r,t,i){const o=[];for(let l=0;l<r.length;l++){const h=[];for(let p=0;p<r[l].length;p++){const y=qh(r[l][p],i);Nu(t,y),h.push(y)}o.push(h)}return o}function Hh(r,t,i){const o=[];for(let l=0;l<r.length;l++){const h=Uc(r[l],t,i);o.push(h)}return o}function il(r,t,i,o){if(r[0]<i[0]||r[0]>i[2]){const l=.5*o;let h=r[0]-i[0]>l?-o:i[0]-r[0]>l?o:0;h===0&&(h=r[0]-i[2]>l?-o:i[2]-r[0]>l?o:0),r[0]+=h}Nu(t,r)}function nl(r,t,i,o){const l=Math.pow(2,o.z)*ds,h=[o.x*ds,o.y*ds],p=[];for(const y of r)for(const x of y){const S=[x.x+h[0],x.y+h[1]];il(S,t,i,l),p.push(S)}return p}function $h(r,t,i,o){const l=Math.pow(2,o.z)*ds,h=[o.x*ds,o.y*ds],p=[];for(const x of r){const S=[];for(const C of x){const I=[C.x+h[0],C.y+h[1]];Nu(t,I),S.push(I)}p.push(S)}if(t[2]-t[0]<=l/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const S of x)il(S,t,i,l)}var y;return p}class fs{constructor(t,i){this.type=Se,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mr(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const l=[];for(const h of o.features){const{type:p,coordinates:y}=h.geometry;p==="Polygon"&&l.push(y),p==="MultiPolygon"&&l.push(...y)}if(l.length)return new fs(o,{type:"MultiPolygon",coordinates:l})}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new fs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new fs(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Uc(o.coordinates,h,p),x=nl(i.geometry(),l,h,p);if(!Ns(l,h))return!1;for(const S of x)if(!tl(S,y))return!1}if(o.type==="MultiPolygon"){const y=Hh(o.coordinates,h,p),x=nl(i.geometry(),l,h,p);if(!Ns(l,h))return!1;for(const S of x)if(!el(S,y))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Uc(o.coordinates,h,p),x=$h(i.geometry(),l,h,p);if(!Ns(l,h))return!1;for(const S of x)if(!Jd(S,y))return!1}if(o.type==="MultiPolygon"){const y=Hh(o.coordinates,h,p),x=$h(i.geometry(),l,h,p);if(!Ns(l,h))return!1;for(const S of x)if(!ep(S,y))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xh=class{constructor(r=[],t=(i,o)=>i<o?-1:i>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:i}=this,o=t[r];for(;r>0;){const l=r-1>>1,h=t[l];if(i(o,h)>=0)break;t[r]=h,r=l}t[r]=o}_down(r){const{data:t,compare:i}=this,o=this.length>>1,l=t[r];for(;r<o;){let h=1+(r<<1);const p=h+1;if(p<this.length&&i(t[p],t[h])<0&&(h=p),i(t[h],l)>=0)break;t[r]=t[h],r=h}t[r]=l}};function Yh(r,t,i=0,o=r.length-1,l=$l){for(;o>i;){if(o-i>600){const x=o-i+1,S=t-i+1,C=Math.log(x),I=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*I*(x-I)/x)*(S-x/2<0?-1:1);Yh(r,t,Math.max(i,Math.floor(t-S*I/x+P)),Math.min(o,Math.floor(t+(x-S)*I/x+P)),l)}const h=r[t];let p=i,y=o;for(rl(r,i,t),l(r[o],h)>0&&rl(r,i,o);p<y;){for(rl(r,p,y),p++,y--;l(r[p],h)<0;)p++;for(;l(r[y],h)>0;)y--}l(r[i],h)===0?rl(r,i,y):(y++,rl(r,y,o)),y<=t&&(i=y+1),t<=y&&(o=y-1)}}function rl(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}function $l(r,t){return r<t?-1:r>t?1:0}function Xl(r,t){if(r.length<=1)return[r];const i=[];let o,l;for(const h of r){const p=nf(h);p!==0&&(h.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(o&&i.push(o),o=[h]):o.push(h))}if(o&&i.push(o),t>1)for(let h=0;h<i.length;h++)i[h].length<=t||(Yh(i[h],t,1,i[h].length-1,ef),i[h]=i[h].slice(0,t));return i}function ef(r,t){return t.area-r.area}function nf(r){let t=0;for(let i,o,l=0,h=r.length,p=h-1;l<h;p=l++)i=r[l],o=r[p],t+=(o.x-i.x)*(i.y+o.y);return t}const rf=1/298.257223563,Gc=rf*(2-rf),Wh=Math.PI/180;class Kh{constructor(t){const i=6378.137*Wh*1e3,o=Math.cos(t*Wh),l=1/(1-Gc*(1-o*o)),h=Math.sqrt(l);this.kx=i*h*o,this.ky=i*h*l*(1-Gc)}distance(t,i){const o=this.wrap(t[0]-i[0])*this.kx,l=(t[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}pointOnLine(t,i){let o,l,h,p,y=1/0;for(let x=0;x<t.length-1;x++){let S=t[x][0],C=t[x][1],I=this.wrap(t[x+1][0]-S)*this.kx,P=(t[x+1][1]-C)*this.ky,L=0;I===0&&P===0||(L=(this.wrap(i[0]-S)*this.kx*I+(i[1]-C)*this.ky*P)/(I*I+P*P),L>1?(S=t[x+1][0],C=t[x+1][1]):L>0&&(S+=I/this.kx*L,C+=P/this.ky*L)),I=this.wrap(i[0]-S)*this.kx,P=(i[1]-C)*this.ky;const O=I*I+P*P;O<y&&(y=O,o=S,l=C,h=x,p=L)}return{point:[o,l],index:h,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function af(r,t){return t[0]-r[0]}function sr(r){return r[1]-r[0]+1}function Vr(r,t){return r[1]>=r[0]&&r[1]<t}function qc(r,t){if(r[0]>r[1])return[null,null];const i=sr(r);if(t){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Zc(r,t){if(!Vr(t,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Nu(i,r[o]);return i}function Hc(r){const t=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const o of i)Nu(t,o);return t}function $c(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function ju(r,t,i){if(!$c(r)||!$c(t))return NaN;let o=0,l=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(l=r[1]-t[3]),r[3]<t[1]&&(l=t[1]-r[3]),i.distance([0,0],[o,l])}function al(r,t,i){const o=i.pointOnLine(t,r);return i.distance(r,o.point)}function _o(r,t,i,o,l){const h=Math.min(al(r,[i,o],l),al(t,[i,o],l)),p=Math.min(al(i,[r,t],l),al(o,[r,t],l));return Math.min(h,p)}function Qh(r,t,i,o,l){if(!Vr(t,r.length)||!Vr(o,i.length))return 1/0;let h=1/0;for(let p=t[0];p<t[1];++p){const y=r[p],x=r[p+1];for(let S=o[0];S<o[1];++S){const C=i[S],I=i[S+1];if(Hl(y,x,C,I))return 0;h=Math.min(h,_o(y,x,C,I,l))}}return h}function ai(r,t,i,o,l){if(!Vr(t,r.length)||!Vr(o,i.length))return NaN;let h=1/0;for(let p=t[0];p<=t[1];++p)for(let y=o[0];y<=o[1];++y)if(h=Math.min(h,l.distance(r[p],i[y])),h===0)return h;return h}function Jh(r,t,i){if(tl(r,t,!0))return 0;let o=1/0;for(const l of t){const h=l[0],p=l[l.length-1];if(h!==p&&(o=Math.min(o,al(r,[p,h],i)),o===0))return o;const y=i.pointOnLine(l,r);if(o=Math.min(o,i.distance(r,y.point)),o===0)return o}return o}function sf(r,t,i,o){if(!Vr(t,r.length))return NaN;for(let h=t[0];h<=t[1];++h)if(tl(r[h],i,!0))return 0;let l=1/0;for(let h=t[0];h<t[1];++h){const p=r[h],y=r[h+1];for(const x of i)for(let S=0,C=x.length,I=C-1;S<C;I=S++){const P=x[I],L=x[S];if(Hl(p,y,P,L))return 0;l=Math.min(l,_o(p,y,P,L,o))}}return l}function yo(r,t){for(const i of r)for(const o of i)if(tl(o,t,!0))return!0;return!1}function Yl(r,t,i,o=1/0){const l=Hc(r),h=Hc(t);if(o!==1/0&&ju(l,h,i)>=o)return o;if(Ns(l,h)){if(yo(r,t))return 0}else if(yo(t,r))return 0;let p=1/0;for(const y of r)for(let x=0,S=y.length,C=S-1;x<S;C=x++){const I=y[C],P=y[x];for(const L of t)for(let O=0,N=L.length,G=N-1;O<N;G=O++){const X=L[G],rt=L[O];if(Hl(I,P,X,rt))return 0;p=Math.min(p,_o(I,P,X,rt,i))}}return p}function Xc(r,t,i,o,l,h){if(!h)return;const p=ju(Zc(o,h),l,i);p<t&&r.push([p,h,[0,0]])}function Vu(r,t,i,o,l,h,p){if(!h||!p)return;const y=ju(Zc(o,h),Zc(l,p),i);y<t&&r.push([y,h,p])}function ps(r,t,i,o,l=1/0){let h=Math.min(o.distance(r[0],i[0][0]),l);if(h===0)return h;const p=new Xh([[0,[0,r.length-1],[0,0]]],af),y=Hc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=h)continue;const S=x[1],C=t?50:100;if(sr(S)<=C){if(!Vr(S,r.length))return NaN;if(t){const I=sf(r,S,i,o);if(isNaN(I)||I===0)return I;h=Math.min(h,I)}else for(let I=S[0];I<=S[1];++I){const P=Jh(r[I],i,o);if(h=Math.min(h,P),h===0)return 0}}else{const I=qc(S,t);Xc(p,h,o,r,y,I[0]),Xc(p,h,o,r,y,I[1])}}return h}function Uu(r,t,i,o,l,h=1/0){let p=Math.min(h,l.distance(r[0],i[0]));if(p===0)return p;const y=new Xh([[0,[0,r.length-1],[0,i.length-1]]],af);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const S=x[1],C=x[2],I=t?50:100,P=o?50:100;if(sr(S)<=I&&sr(C)<=P){if(!Vr(S,r.length)&&Vr(C,i.length))return NaN;let L;if(t&&o)L=Qh(r,S,i,C,l),p=Math.min(p,L);else if(t&&!o){const O=r.slice(S[0],S[1]+1);for(let N=C[0];N<=C[1];++N)if(L=al(i[N],O,l),p=Math.min(p,L),p===0)return p}else if(!t&&o){const O=i.slice(C[0],C[1]+1);for(let N=S[0];N<=S[1];++N)if(L=al(r[N],O,l),p=Math.min(p,L),p===0)return p}else L=ai(r,S,i,C,l),p=Math.min(p,L)}else{const L=qc(S,t),O=qc(C,o);Vu(y,p,l,r,i,L[0],O[0]),Vu(y,p,l,r,i,L[0],O[1]),Vu(y,p,l,r,i,L[1],O[0]),Vu(y,p,l,r,i,L[1],O[1])}}return p}function Yc(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class vo{constructor(t,i){this.type=$t,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mr(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new vo(o,o.features.map((l=>Yc(l.geometry))).flat());if(o.type==="Feature")return new vo(o,Yc(o.geometry));if("type"in o&&"coordinates"in o)return new vo(o,Yc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,o){const l=i.geometry(),h=l.flat().map((x=>Jo([x.x,x.y],i.canonical)));if(l.length===0)return NaN;const p=new Kh(h[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Uu(h,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Uu(h,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,ps(h,!1,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,o){const l=i.geometry(),h=l.flat().map((x=>Jo([x.x,x.y],i.canonical)));if(l.length===0)return NaN;const p=new Kh(h[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Uu(h,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Uu(h,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,ps(h,!0,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,o){const l=i.geometry();if(l.length===0||l[0].length===0)return NaN;const h=Xl(l,0).map((x=>x.map((S=>S.map((C=>Jo([C.x,C.y],i.canonical))))))),p=new Kh(h[0][0][0][1]);let y=1/0;for(const x of o)for(const S of h){switch(x.type){case"Point":y=Math.min(y,ps([x.coordinates],!1,S,p,y));break;case"LineString":y=Math.min(y,ps(x.coordinates,!0,S,p,y));break;case"Polygon":y=Math.min(y,Yl(S,x.coordinates,p,y))}if(y===0)return y}return y})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Gu{constructor(t){this.type=Pe,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Gu(o)}evaluate(t){var i;const o=(i=t.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?as(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Wl={"==":Fc,"!=":Uh,">":Kd,"<":Wd,">=":jc,"<=":Nc,array:rr,at:ta,boolean:rr,case:ku,coalesce:Zl,collator:jr,format:Qo,image:Gh,in:Fs,"index-of":cs,interpolate:tr,"interpolate-hcl":tr,"interpolate-lab":tr,length:Fu,let:ri,literal:Bs,match:Ou,number:rr,"number-format":Vc,object:rr,slice:Bu,step:go,string:rr,"to-boolean":fn,"to-color":fn,"to-number":fn,"to-string":fn,var:mo,within:fs,distance:vo,"global-state":Gu};class ga{constructor(t,i,o,l){this.name=t,this.type=i,this._evaluate=o,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const o=t[0],l=ga.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter((([S])=>!Array.isArray(S)||S.length===t.length-1));let x=null;for(const[S,C]of y){x=new us(i.registry,sl,i.path,null,i.scope);const I=[];let P=!1;for(let L=1;L<t.length;L++){const O=t[L],N=Array.isArray(S)?S[L-1]:S.type,G=x.parse(O,1+I.length,N);if(!G){P=!0;break}I.push(G)}if(!P)if(Array.isArray(S)&&S.length!==I.length)x.error(`Expected ${S.length} arguments, but found ${I.length} instead.`);else{for(let L=0;L<I.length;L++){const O=Array.isArray(S)?S[L]:S.type,N=I[L];x.concat(L+1).checkSubtype(O,N.type)}if(x.errors.length===0)return new ga(o,h,C,I)}}if(y.length===1)i.errors.push(...x.errors);else{const S=(y.length?y:p).map((([I])=>{return P=I,Array.isArray(P)?`(${P.map(ki).join(", ")})`:`(${ki(P.type)}...)`;var P})).join(" | "),C=[];for(let I=1;I<t.length;I++){const P=i.parse(t[I],1+C.length);if(!P)return null;C.push(ki(P.type))}i.error(`Expected arguments of type ${S}, but found (${C.join(", ")}) instead.`)}return null}static register(t,i){ga.definitions=i;for(const o in i)t[o]=ga}}function td(r,[t,i,o,l]){t=t.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const h=l?l.evaluate(r):1,p=ql(t,i,o,h);if(p)throw new Ii(p);return new Qe(t/255,i/255,o/255,h,!1)}function ed(r,t){return r in t}function qu(r,t){const i=t[r];return i===void 0?null:i}function or(r){return{type:r}}function sl(r){if(r instanceof mo)return sl(r.boundExpression);if(r instanceof ga&&r.name==="error"||r instanceof jr||r instanceof fs||r instanceof vo||r instanceof Gu)return!1;const t=r instanceof fn||r instanceof rr;let i=!0;return r.eachChild((o=>{i=t?i&&sl(o):i&&o instanceof Bs})),!!i&&Cr(r)&&Kl(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Cr(r){if(r instanceof ga&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fs||r instanceof vo)return!1;let t=!0;return r.eachChild((i=>{t&&!Cr(i)&&(t=!1)})),t}function ms(r){if(r instanceof ga&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((i=>{t&&!ms(i)&&(t=!1)})),t}function Kl(r,t){if(r instanceof ga&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((o=>{i&&!Kl(o,t)&&(i=!1)})),i}function Zu(r){return{result:"success",value:r}}function js(r){return{result:"error",value:r}}function xo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function bo(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Wc(r){return!!r.expression&&r.expression.interpolated}function qe(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Vs(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Bi(r)===Qn}function ip(r){return r}function Ur(r,t){const i=r.stops&&typeof r.stops[0][0]=="object",o=i||!(i||r.property!==void 0),l=r.type||(Wc(t)?"exponential":"interval"),h=(function(C){switch(C.type){case"color":return Qe.parse;case"padding":return Mn.parse;case"numberArray":return Cn.parse;case"colorArray":return Pn.parse;default:return null}})(t);if(h&&((r=Li({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],h(C[1])]))),r.default=h(r.default?r.default:t.default)),r.colorSpace&&(p=r.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var p;const y=(function(C){switch(C){case"exponential":return Hu;case"interval":return of;case"categorical":return Ba;case"identity":return ll;default:throw new Error(`Unknown function type "${C}"`)}})(l);let x,S;if(l==="categorical"){x=Object.create(null);for(const C of r.stops)x[C[0]]=C[1];S=typeof r.stops[0][0]}if(i){const C={},I=[];for(let O=0;O<r.stops.length;O++){const N=r.stops[O],G=N[0].zoom;C[G]===void 0&&(C[G]={zoom:G,type:r.type,property:r.property,default:r.default,stops:[]},I.push(G)),C[G].stops.push([N[0].value,N[1]])}const P=[];for(const O of I)P.push([C[O].zoom,Ur(C[O],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:tr.interpolationFactor.bind(void 0,L),zoomStops:P.map((O=>O[0])),evaluate:({zoom:O},N)=>Hu({stops:P,base:r.base},t,O).evaluate(O,N)}}if(o){const C=l==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:tr.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map((I=>I[0])),evaluate:({zoom:I})=>y(r,t,I,x,S)}}return{kind:"source",evaluate(C,I){const P=I&&I.properties?I.properties[r.property]:void 0;return P===void 0?ol(r.default,t.default):y(r,t,P,x,S)}}}function ol(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function Ba(r,t,i,o,l){return ol(typeof i===l?o[i]:void 0,r.default,t.default)}function of(r,t,i){if(qe(i)!=="number")return ol(r.default,t.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const l=Oc(r.stops.map((h=>h[0])),i);return r.stops[l][1]}function Hu(r,t,i){const o=r.base!==void 0?r.base:1;if(qe(i)!=="number")return ol(r.default,t.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const h=Oc(r.stops.map((C=>C[0])),i),p=(function(C,I,P,L){const O=L-P,N=C-P;return O===0?0:I===1?N/O:(Math.pow(I,N)-1)/(Math.pow(I,O)-1)})(i,o,r.stops[h][0],r.stops[h+1][0]),y=r.stops[h][1],x=r.stops[h+1][1],S=Oa[t.type]||ip;return typeof y.evaluate=="function"?{evaluate(...C){const I=y.evaluate.apply(void 0,C),P=x.evaluate.apply(void 0,C);if(I!==void 0&&P!==void 0)return S(I,P,p,r.colorSpace)}}:S(y,x,p,r.colorSpace)}function ll(r,t,i){switch(t.type){case"color":i=Qe.parse(i);break;case"formatted":i=vn.fromString(i.toString());break;case"resolvedImage":i=xn.fromString(i.toString());break;case"padding":i=Mn.parse(i);break;case"colorArray":i=Pn.parse(i);break;case"numberArray":i=Cn.parse(i);break;default:qe(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return ol(i,r.default,t.default)}ga.register(Wl,{error:[{kind:"error"},[he],(r,[t])=>{throw new Ii(t.evaluate(r))}],typeof:[he,[Pe],(r,[t])=>ki(Bi(t.evaluate(r)))],"to-rgba":[Br($t,4),[fr],(r,[t])=>{const[i,o,l,h]=t.evaluate(r).rgb;return[255*i,255*o,255*l,h]}],rgb:[fr,[$t,$t,$t],td],rgba:[fr,[$t,$t,$t,$t],td],has:{type:Se,overloads:[[[he],(r,[t])=>ed(t.evaluate(r),r.properties())],[[he,Qn],(r,[t,i])=>ed(t.evaluate(r),i.evaluate(r))]]},get:{type:Pe,overloads:[[[he],(r,[t])=>qu(t.evaluate(r),r.properties())],[[he,Qn],(r,[t,i])=>qu(t.evaluate(r),i.evaluate(r))]]},"feature-state":[Pe,[he],(r,[t])=>qu(t.evaluate(r),r.featureState||{})],properties:[Qn,[],r=>r.properties()],"geometry-type":[he,[],r=>r.geometryType()],id:[Pe,[],r=>r.id()],zoom:[$t,[],r=>r.globals.zoom],"heatmap-density":[$t,[],r=>r.globals.heatmapDensity||0],elevation:[$t,[],r=>r.globals.elevation||0],"line-progress":[$t,[],r=>r.globals.lineProgress||0],accumulated:[Pe,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[$t,or($t),(r,t)=>{let i=0;for(const o of t)i+=o.evaluate(r);return i}],"*":[$t,or($t),(r,t)=>{let i=1;for(const o of t)i*=o.evaluate(r);return i}],"-":{type:$t,overloads:[[[$t,$t],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[$t],(r,[t])=>-t.evaluate(r)]]},"/":[$t,[$t,$t],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[$t,[$t,$t],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[$t,[$t],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[$t,[$t],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[$t,[$t],(r,[t])=>Math.log(t.evaluate(r))],log2:[$t,[$t],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[$t,[$t],(r,[t])=>Math.sin(t.evaluate(r))],cos:[$t,[$t],(r,[t])=>Math.cos(t.evaluate(r))],tan:[$t,[$t],(r,[t])=>Math.tan(t.evaluate(r))],asin:[$t,[$t],(r,[t])=>Math.asin(t.evaluate(r))],acos:[$t,[$t],(r,[t])=>Math.acos(t.evaluate(r))],atan:[$t,[$t],(r,[t])=>Math.atan(t.evaluate(r))],min:[$t,or($t),(r,t)=>Math.min(...t.map((i=>i.evaluate(r))))],max:[$t,or($t),(r,t)=>Math.max(...t.map((i=>i.evaluate(r))))],abs:[$t,[$t],(r,[t])=>Math.abs(t.evaluate(r))],round:[$t,[$t],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[$t,[$t],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[$t,[$t],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Se,[he,Pe],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[Se,[Pe],(r,[t])=>r.id()===t.value],"filter-type-==":[Se,[he],(r,[t])=>r.geometryType()===t.value],"filter-<":[Se,[he,Pe],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[Se,[Pe],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i<o}],"filter->":[Se,[he,Pe],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[Se,[Pe],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i>o}],"filter-<=":[Se,[he,Pe],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[Se,[Pe],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i<=o}],"filter->=":[Se,[he,Pe],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[Se,[Pe],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i>=o}],"filter-has":[Se,[Pe],(r,[t])=>t.value in r.properties()],"filter-has-id":[Se,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Se,[Br(he)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Se,[Br(Pe)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Se,[he,Br(Pe)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Se,[he,Br(Pe)],(r,[t,i])=>(function(o,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===o)return!0;l[y]>o?p=y-1:h=y+1}return!1})(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Se,overloads:[[[Se,Se],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[or(Se),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Se,overloads:[[[Se,Se],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[or(Se),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[Se,[Se],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Se,[he],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[he,[he],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[he,[he],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[he,or(Pe),(r,t)=>t.map((i=>ks(i.evaluate(r)))).join("")],"resolved-locale":[he,[Qr],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ql{constructor(t,i,o){this.expression=t,this._warningHistory={},this._evaluator=new Ve,this._defaultValue=i?(function(l){if(l.type==="color"&&Vs(l.default))return new Qe(0,0,0,0);switch(l.type){case"color":return Qe.parse(l.default)||null;case"padding":return Mn.parse(l.default)||null;case"numberArray":return Cn.parse(l.default)||null;case"colorArray":return Pn.parse(l.default)||null;case"variableAnchorOffsetCollection":return Un.parse(l.default)||null;case"projectionDefinition":return Jn.parse(l.default)||null;default:return l.default===void 0?null:l.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=lr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,i,o,l,h,p){this._globalState&&(t=lr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function $u(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Wl}function Jl(r,t,i){const o=new us(Wl,sl,[],t?(function(h){const p={color:fr,string:he,number:$t,enum:he,boolean:Se,formatted:fo,padding:Pa,numberArray:Ra,colorArray:pr,projectionDefinition:$o,resolvedImage:La,variableAnchorOffsetCollection:dn};return h.type==="array"?Br(p[h.value]||Pe,h.length):p[h.type]})(t):void 0),l=o.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Zu(new Ql(l,t,i)):js(o.errors)}class wo{constructor(t,i,o){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!ms(i.expression),this.globalStateRefs=To(i.expression),this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,h,p)}evaluate(t,i,o,l,h,p){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,h,p)}}class Ar{constructor(t,i,o,l,h){this.kind=t,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ms(i.expression),this.globalStateRefs=To(i.expression),this.interpolationType=l,this._globalState=h}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,h,p)}evaluate(t,i,o,l,h,p){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,h,p)}interpolationFactor(t,i,o){return this.interpolationType?tr.interpolationFactor(this.interpolationType,t,i,o):0}}function ul(r,t,i){const o=Jl(r,t,i);if(o.result==="error")return o;const l=o.value.expression,h=Cr(l);if(!h&&!xo(t))return js([new Oi("","data expressions not supported")]);const p=Kl(l,["zoom"]);if(!p&&!bo(t))return js([new Oi("","zoom expressions not supported")]);const y=cl(l);return y||p?y instanceof Oi?js([y]):y instanceof tr&&!Wc(t)?js([new Oi("",'"interpolate" expressions cannot be used with this property')]):Zu(y?new Ar(h?"camera":"composite",o.value,y.labels,y instanceof tr?y.interpolation:void 0,i):new wo(h?"constant":"source",o.value,i)):js([new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Us{constructor(t,i){this._parameters=t,this._specification=i,Li(this,Ur(this._parameters,this._specification))}static deserialize(t){return new Us(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function cl(r){let t=null;if(r instanceof ri)t=cl(r.result);else if(r instanceof Zl){for(const i of r.args)if(t=cl(i),t)break}else(r instanceof go||r instanceof tr)&&r.input instanceof ga&&r.input.name==="zoom"&&(t=r);return t instanceof Oi||r.eachChild((i=>{const o=cl(i);o instanceof Oi?t=o:!t&&o?t=new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function To(r,t=new Set){return r instanceof Gu&&t.add(r.key),r.eachChild((i=>{To(i,t)})),t}function lr(r,t){const{zoom:i,heatmapDensity:o,elevation:l,lineProgress:h,isSupportedScript:p,accumulated:y}=r??{};return{zoom:i,heatmapDensity:o,elevation:l,lineProgress:h,isSupportedScript:p,accumulated:y,globalState:t}}function Dr(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Dr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Gs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gr(r,t){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Dr(r)||(r=tu(r));const i=Jl(r,Gs,t);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,l,h)=>i.value.evaluate(o,l,{},h),needGeometry:Fa(r),getGlobalStateRefs:()=>To(i.value.expression)}}function gs(r,t){return r<t?-1:r>t?1:0}function Fa(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Fa(r[t]))return!0;return!1}function tu(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?eu(r[1],r[2],"=="):t==="!="?Ln(eu(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?eu(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(tu))):t==="all"?["all"].concat(r.slice(1).map(tu)):t==="none"?["all"].concat(r.slice(1).map(tu).map(Ln)):t==="in"?Kc(r[1],r.slice(2)):t==="!in"?Ln(Kc(r[1],r.slice(2))):t==="has"?id(r[1]):t!=="!has"||Ln(id(r[1]));var i}function eu(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function Kc(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((i=>typeof i!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(gs)]]:["filter-in-small",r,["literal",t]]}}function id(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ln(r){return["!",r]}function qi(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let l="[";for(const h of r)l+=`${qi(h)},`;return`${l}]`}const i=Object.keys(r).sort();let o="{";for(let l=0;l<i.length;l++)o+=`${JSON.stringify(i[l])}:${qi(r[i[l]])},`;return`${o}}`}function si(r){let t="";for(const i of xt)t+=`/${qi(r[i])}`;return t}function _s(r){const t=r.value;return t?[new te(r.key,t,"constants have been deprecated as of v8")]:[]}function ci(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Na(r){if(Array.isArray(r))return r.map(Na);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=Na(r[i]);return t}return ci(r)}function An(r){const t=r.key,i=r.value,o=r.valueSpec||{},l=r.objectElementValidators||{},h=r.style,p=r.styleSpec,y=r.validateSpec;let x=[];const S=qe(i);if(S!=="object")return[new te(t,i,`object expected, ${S} found`)];for(const C in i){const I=C.split(".")[0],P=as(o,I)||o["*"];let L;if(as(l,I))L=l[I];else if(as(o,I))L=y;else if(l["*"])L=l["*"];else{if(!o["*"]){x.push(new te(t,i[C],`unknown property "${C}"`));continue}L=y}x=x.concat(L({key:(t&&`${t}.`)+C,value:i[C],valueSpec:P,style:h,styleSpec:p,object:i,objectKey:C,validateSpec:y},i))}for(const C in o)l[C]||o[C].required&&o[C].default===void 0&&i[C]===void 0&&x.push(new te(t,i,`missing required property "${C}"`));return x}function iu(r){const t=r.value,i=r.valueSpec,o=r.style,l=r.styleSpec,h=r.key,p=r.arrayElementValidator||r.validateSpec;if(qe(t)!=="array")return[new te(h,t,`array expected, ${qe(t)} found`)];if(i.length&&t.length!==i.length)return[new te(h,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new te(h,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values};l.$version<7&&(y.function=i.function),qe(i.value)==="object"&&(y=i.value);let x=[];for(let S=0;S<t.length;S++)x=x.concat(p({array:t,arrayIndex:S,value:t[S],valueSpec:y,validateSpec:r.validateSpec,style:o,styleSpec:l,key:`${h}[${S}]`}));return x}function So(r){const t=r.key,i=r.value,o=r.valueSpec;let l=qe(i);return l==="number"&&i!=i&&(l="NaN"),l!=="number"?[new te(t,i,`number expected, ${l} found`)]:"minimum"in o&&i<o.minimum?[new te(t,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new te(t,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function hl(r){const t=r.valueSpec,i=ci(r.value.type);let o,l,h,p={};const y=i!=="categorical"&&r.value.property===void 0,x=!y,S=qe(r.value.stops)==="array"&&qe(r.value.stops[0])==="array"&&qe(r.value.stops[0][0])==="object",C=An({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(L){if(i==="identity")return[new te(L.key,L.value,'identity function may not have a "stops" property')];let O=[];const N=L.value;return O=O.concat(iu({key:L.key,value:N,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:I})),qe(N)==="array"&&N.length===0&&O.push(new te(L.key,N,"array must have at least one stop")),O},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return i==="identity"&&y&&C.push(new te(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||C.push(new te(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!Wc(r.valueSpec)&&C.push(new te(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!xo(r.valueSpec)?C.push(new te(r.key,r.value,"property functions not supported")):y&&!bo(r.valueSpec)&&C.push(new te(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!S||r.value.property!==void 0||C.push(new te(r.key,r.value,'"property" property is required')),C;function I(L){let O=[];const N=L.value,G=L.key;if(qe(N)!=="array")return[new te(G,N,`array expected, ${qe(N)} found`)];if(N.length!==2)return[new te(G,N,`array length 2 expected, length ${N.length} found`)];if(S){if(qe(N[0])!=="object")return[new te(G,N,`object expected, ${qe(N[0])} found`)];if(N[0].zoom===void 0)return[new te(G,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new te(G,N,"object stop key must have value")];if(h&&h>ci(N[0].zoom))return[new te(G,N[0].zoom,"stop zoom values must appear in ascending order")];ci(N[0].zoom)!==h&&(h=ci(N[0].zoom),l=void 0,p={}),O=O.concat(An({key:`${G}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:So,value:P}}))}else O=O.concat(P({key:`${G}[0]`,value:N[0],validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},N));return $u(Na(N[1]))?O.concat([new te(`${G}[1]`,N[1],"expressions are not allowed in function stops.")]):O.concat(L.validateSpec({key:`${G}[1]`,value:N[1],valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function P(L,O){const N=qe(L.value),G=ci(L.value),X=L.value!==null?L.value:O;if(o){if(N!==o)return[new te(L.key,X,`${N} stop domain type must match previous stop domain type ${o}`)]}else o=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new te(L.key,X,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let rt=`number expected, ${N} found`;return xo(t)&&i===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new te(L.key,X,rt)]}return i!=="categorical"||N!=="number"||isFinite(G)&&Math.floor(G)===G?i!=="categorical"&&N==="number"&&l!==void 0&&G<l?[new te(L.key,X,"stop domain values must appear in ascending order")]:(l=G,i==="categorical"&&G in p?[new te(L.key,X,"stop domain values must be unique")]:(p[G]=!0,[])):[new te(L.key,X,`integer expected, found ${G}`)]}}function _a(r){const t=(r.expressionContext==="property"?ul:Jl)(Na(r.value),r.valueSpec);if(t.result==="error")return t.value.map((o=>new te(`${r.key}${o.key}`,r.value,o.message)));const i=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new te(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ms(i))return[new te(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!ms(i))return[new te(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Kl(i,["zoom","feature-state"]))return[new te(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Cr(i))return[new te(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xu(r){const t=r.key,i=r.value,o=qe(i);return o!=="string"?[new te(t,i,`color expected, ${o} found`)]:Qe.parse(String(i))?[]:[new te(t,i,`color expected, "${i}" found`)]}function qs(r){const t=r.key,i=r.value,o=r.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(ci(i))===-1&&l.push(new te(t,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(ci(i))===-1&&l.push(new te(t,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),l}function Yu(r){return Dr(Na(r.value))?_a(Li({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Eo(r)}function Eo(r){const t=r.value,i=r.key;if(qe(t)!=="array")return[new te(i,t,`array expected, ${qe(t)} found`)];const o=r.styleSpec;let l,h=[];if(t.length<1)return[new te(i,t,"filter array must have at least 1 element")];switch(h=h.concat(qs({key:`${i}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),ci(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ci(t[1])==="$type"&&h.push(new te(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&h.push(new te(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=qe(t[1]),l!=="string"&&h.push(new te(`${i}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=qe(t[p]),ci(t[1])==="$type"?h=h.concat(qs({key:`${i}[${p}]`,value:t[p],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new te(`${i}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)h=h.concat(Eo({key:`${i}[${p}]`,value:t[p],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":l=qe(t[1]),t.length!==2?h.push(new te(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new te(`${i}[1]`,t[1],`string expected, ${l} found`))}return h}function ja(r,t){const i=r.key,o=r.validateSpec,l=r.style,h=r.styleSpec,p=r.value,y=r.objectKey,x=h[`${t}_${r.layerType}`];if(!x)return[];const S=y.match(/^(.*)-transition$/);if(t==="paint"&&S&&x[S[1]]&&x[S[1]].transition)return o({key:i,value:p,valueSpec:h.transition,style:l,styleSpec:h});const C=r.valueSpec||x[y];if(!C)return[new te(i,p,`unknown property "${y}"`)];let I;if(qe(p)==="string"&&xo(C)&&!C.tokens&&(I=/^{([^}]+)}$/.exec(p)))return[new te(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const P=[];return r.layerType==="symbol"&&y==="text-font"&&Vs(Na(p))&&ci(p.type)==="identity"&&P.push(new te(i,p,'"text-font" does not support identity functions')),P.concat(o({key:r.key,value:p,valueSpec:C,style:l,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:y}))}function ys(r){return ja(r,"paint")}function ea(r){return ja(r,"layout")}function Qc(r){let t=[];const i=r.value,o=r.key,l=r.style,h=r.styleSpec;if(qe(i)!=="object")return[new te(o,i,`object expected, ${qe(i)} found`)];i.type||i.ref||t.push(new te(o,i,'either "type" or "ref" is required'));let p=ci(i.type);const y=ci(i.ref);if(i.id){const x=ci(i.id);for(let S=0;S<r.arrayIndex;S++){const C=l.layers[S];ci(C.id)===x&&t.push(new te(o,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((S=>{S in i&&t.push(new te(o,i[S],`"${S}" is prohibited for ref layers`))})),l.layers.forEach((S=>{ci(S.id)===y&&(x=S)})),x?x.ref?t.push(new te(o,i.ref,"ref cannot reference another ref layer")):p=ci(x.type):t.push(new te(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=l.sources&&l.sources[i.source],S=x&&ci(x.type);x?S==="vector"&&p==="raster"?t.push(new te(o,i.source,`layer "${i.id}" requires a raster source`)):S!=="raster-dem"&&p==="hillshade"||S!=="raster-dem"&&p==="color-relief"?t.push(new te(o,i.source,`layer "${i.id}" requires a raster-dem source`)):S==="raster"&&p!=="raster"?t.push(new te(o,i.source,`layer "${i.id}" requires a vector source`)):S!=="vector"||i["source-layer"]?S==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?t.push(new te(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||S==="geojson"&&x.lineMetrics||t.push(new te(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new te(o,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new te(o,i.source,`source "${i.source}" not found`))}else t.push(new te(o,i,'missing required property "source"'));return t=t.concat(An({key:o,value:i,valueSpec:h.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:i.type,valueSpec:h.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:Yu,layout:x=>An({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":S=>ea(Li({layerType:p},S))}}),paint:x=>An({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":S=>ys(Li({layerType:p},S))}})}})),t}function vs(r){const t=r.value,i=r.key,o=qe(t);return o!=="string"?[new te(i,t,`string expected, ${o} found`)]:[]}const Mo={promoteId:function({key:r,value:t}){if(qe(t)==="string")return vs({key:r,value:t});{const i=[];for(const o in t)i.push(...vs({key:`${r}.${o}`,value:t[o]}));return i}}};function Wu(r){const t=r.value,i=r.key,o=r.styleSpec,l=r.style,h=r.validateSpec;if(!t.type)return[new te(i,t,'"type" is required')];const p=ci(t.type);let y;switch(p){case"vector":case"raster":return y=An({key:i,value:t,valueSpec:o[`source_${p.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Mo,validateSpec:h}),y;case"raster-dem":return y=(function(x){var S;const C=(S=x.sourceName)!==null&&S!==void 0?S:"",I=x.value,P=x.styleSpec,L=P.source_raster_dem,O=x.style;let N=[];const G=qe(I);if(I===void 0)return N;if(G!=="object")return N.push(new te("source_raster_dem",I,`object expected, ${G} found`)),N;const X=ci(I.encoding)==="custom",rt=["redFactor","greenFactor","blueFactor","baseShift"],K=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const tt in I)!X&&rt.includes(tt)?N.push(new te(tt,I[tt],`In "${C}": "${tt}" is only valid when "encoding" is set to "custom". ${K} encoding found`)):L[tt]?N=N.concat(x.validateSpec({key:tt,value:I[tt],valueSpec:L[tt],validateSpec:x.validateSpec,style:O,styleSpec:P})):N.push(new te(tt,I[tt],`unknown property "${tt}"`));return N})({sourceName:i,value:t,style:r.style,styleSpec:o,validateSpec:h}),y;case"geojson":if(y=An({key:i,value:t,valueSpec:o.source_geojson,style:l,styleSpec:o,validateSpec:h,objectElementValidators:Mo}),t.cluster)for(const x in t.clusterProperties){const[S,C]=t.clusterProperties[x],I=typeof S=="string"?[S,["accumulated"],["get",x]]:S;y.push(..._a({key:`${i}.${x}.map`,value:C,expressionContext:"cluster-map"})),y.push(..._a({key:`${i}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return An({key:i,value:t,valueSpec:o.source_video,style:l,validateSpec:h,styleSpec:o});case"image":return An({key:i,value:t,valueSpec:o.source_image,style:l,validateSpec:h,styleSpec:o});case"canvas":return[new te(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qs({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Zs(r){const t=r.value,i=r.styleSpec,o=i.light,l=r.style;let h=[];const p=qe(t);if(t===void 0)return h;if(p!=="object")return h=h.concat([new te("light",t,`object expected, ${p} found`)]),h;for(const y in t){const x=y.match(/^(.*)-transition$/);h=h.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:i.transition,validateSpec:r.validateSpec,style:l,styleSpec:i}):o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:l,styleSpec:i}):[new te(y,t[y],`unknown property "${y}"`)])}return h}function Gn(r){const t=r.value,i=r.styleSpec,o=i.sky,l=r.style,h=qe(t);if(t===void 0)return[];if(h!=="object")return[new te("sky",t,`object expected, ${h} found`)];let p=[];for(const y in t)p=p.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new te(y,t[y],`unknown property "${y}"`)]);return p}function Hs(r){const t=r.value,i=r.styleSpec,o=i.terrain,l=r.style;let h=[];const p=qe(t);if(t===void 0)return h;if(p!=="object")return h=h.concat([new te("terrain",t,`object expected, ${p} found`)]),h;for(const y in t)h=h.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:l,styleSpec:i}):[new te(y,t[y],`unknown property "${y}"`)]);return h}function nd(r){let t=[];const i=r.value,o=r.key;if(Array.isArray(i)){const l=[],h=[];for(const p in i)i[p].id&&l.includes(i[p].id)&&t.push(new te(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),l.push(i[p].id),i[p].url&&h.includes(i[p].url)&&t.push(new te(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),h.push(i[p].url),t=t.concat(An({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return vs({key:o,value:i})}function lf(r){return t=r.value,t&&t.constructor===Object?[]:[new te(r.key,r.value,`object expected, ${qe(r.value)} found`)];var t}const uf={"*":()=>[],array:iu,boolean:function(r){const t=r.value,i=r.key,o=qe(t);return o!=="boolean"?[new te(i,t,`boolean expected, ${o} found`)]:[]},number:So,color:Xu,constants:_s,enum:qs,filter:Yu,function:hl,layer:Qc,object:An,source:Wu,light:Zs,sky:Gn,terrain:Hs,projection:function(r){const t=r.value,i=r.styleSpec,o=i.projection,l=r.style,h=qe(t);if(t===void 0)return[];if(h!=="object")return[new te("projection",t,`object expected, ${h} found`)];let p=[];for(const y in t)p=p.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new te(y,t[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(r){const t=r.key;let i=r.value;i=i instanceof String?i.valueOf():i;const o=qe(i);return o!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(i)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(i)?["array","string"].includes(o)?[]:[new te(t,i,`projection expected, invalid type "${o}" found`)]:[new te(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:vs,formatted:function(r){return vs(r).length===0?[]:_a(r)},resolvedImage:function(r){return vs(r).length===0?[]:_a(r)},padding:function(r){const t=r.key,i=r.value;if(qe(i)==="array"){if(i.length<1||i.length>4)return[new te(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let l=[];for(let h=0;h<i.length;h++)l=l.concat(r.validateSpec({key:`${t}[${h}]`,value:i[h],validateSpec:r.validateSpec,valueSpec:o}));return l}return So({key:t,value:i,valueSpec:{}})},numberArray:function(r){const t=r.key,i=r.value;if(qe(i)==="array"){const o={type:"number"};if(i.length<1)return[new te(t,i,"array length at least 1 expected, length 0 found")];let l=[];for(let h=0;h<i.length;h++)l=l.concat(r.validateSpec({key:`${t}[${h}]`,value:i[h],validateSpec:r.validateSpec,valueSpec:o}));return l}return So({key:t,value:i,valueSpec:{}})},colorArray:function(r){const t=r.key,i=r.value;if(qe(i)==="array"){if(i.length<1)return[new te(t,i,"array length at least 1 expected, length 0 found")];let o=[];for(let l=0;l<i.length;l++)o=o.concat(Xu({key:`${t}[${l}]`,value:i[l]}));return o}return Xu({key:t,value:i})},variableAnchorOffsetCollection:function(r){const t=r.key,i=r.value,o=qe(i),l=r.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new te(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<i.length;p+=2)h=h.concat(qs({key:`${t}[${p}]`,value:i[p],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(iu({key:`${t}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:l}));return h},sprite:nd,state:lf};function Jc(r){const t=r.value,i=r.valueSpec,o=r.styleSpec;return r.validateSpec=Jc,i.expression&&Vs(ci(t))?hl(r):i.expression&&$u(Na(t))?_a(r):i.type&&uf[i.type]?uf[i.type](r):An(Li({},r,{valueSpec:i.type?o[i.type]:i}))}function Dn(r){const t=r.value,i=r.key,o=vs(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new te(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new te(i,t,'"glyphs" url must include a "{range}" token'))),o}function qr(r,t=J){let i=[];return i=i.concat(Jc({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:Jc,objectElementValidators:{glyphs:Dn,"*":()=>[]}})),r.constants&&(i=i.concat(_s({key:"constants",value:r.constants}))),xs(i)}function qn(r){return function(t){return r(Object.assign({},t,{validateSpec:Jc}))}}function xs(r){return[].concat(r).sort(((t,i)=>t.line-i.line))}function Ji(r){return function(...t){return xs(r.apply(this,t))}}qr.source=Ji(qn(Wu)),qr.sprite=Ji(qn(nd)),qr.glyphs=Ji(qn(Dn)),qr.light=Ji(qn(Zs)),qr.sky=Ji(qn(Gn)),qr.terrain=Ji(qn(Hs)),qr.state=Ji(qn(lf)),qr.layer=Ji(qn(Qc)),qr.filter=Ji(qn(Yu)),qr.paintProperty=Ji(qn(ys)),qr.layoutProperty=Ji(qn(ea));const bs=J,ya=qr,np=ya.light,cf=ya.sky,Ku=ya.paintProperty,rd=ya.layoutProperty;function ws(r,t){let i=!1;if(t&&t.length)for(const o of t)r.fire(new ut(new Error(o.message))),i=!0;return i}class dl{constructor(t,i,o){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const S=p[3+x],C=p[3+x+1];l.push(S===C?null:p.subarray(S,C))}const y=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=o,this.scale=i/t,this.uid=0;const h=o/i*t;this.min=-h,this.max=t+h}insert(t,i,o,l,h){this._forEachCell(i,o,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,o,l,h,p){this.cells[h].push(p)}query(t,i,o,l,h){const p=this.min,y=this.max;if(t<=p&&i<=p&&y<=o&&y<=l&&!h)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,o,l,this._queryCell,x,{},h),x}}_queryCell(t,i,o,l,h,p,y,x){const S=this.cells[h];if(S!==null){const C=this.keys,I=this.bboxes;for(let P=0;P<S.length;P++){const L=S[P];if(y[L]===void 0){const O=4*L;(x?x(I[O+0],I[O+1],I[O+2],I[O+3]):t<=I[O+2]&&i<=I[O+3]&&o>=I[O+0]&&l>=I[O+1])?(y[L]=!0,p.push(C[L])):y[L]=!1}}}}_forEachCell(t,i,o,l,h,p,y,x){const S=this._convertToCellCoord(t),C=this._convertToCellCoord(i),I=this._convertToCellCoord(o),P=this._convertToCellCoord(l);for(let L=S;L<=I;L++)for(let O=C;O<=P;O++){const N=this.d*O+L;if((!x||x(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&h.call(this,t,i,o,l,N,p,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const l=new Int32Array(i+o+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=i;for(let p=0;p<t.length;p++){const y=t[p];l[3+p]=h,l.set(y,h),h+=y.length}return l[3+t.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+t.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(t,i){const o=t.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(t){return new dl(t.buffer)}}const Zr={};function de(r,t,i={}){if(Zr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Zr[r]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}de("Object",Object),de("Set",Set),de("TransferableGridIndex",dl),de("Color",Qe),de("Error",Error),de("AJAXError",Tr),de("ResolvedImage",xn),de("StylePropertyFunction",Us),de("StyleExpression",Ql,{omit:["_evaluator"]}),de("ZoomDependentExpression",Ar),de("ZoomConstantExpression",wo),de("CompoundExpression",ga,{omit:["_evaluate"]});for(const r in Wl)Wl[r]._classRegistryKey||de(`Expression_${r}`,Wl[r]);function Va(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Qu(r){return r.$name||r.constructor._classRegistryKey}function Ju(r){return!(function(t){if(t===null||typeof t!="object")return!1;const i=Qu(t);return!(!i||i==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Va(r)||za(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Co(r,t){if(Ju(r))return(Va(r)||za(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const h=[];for(const p of r)h.push(Co(p,t));return h}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const i=Qu(r);if(!i)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Zr[i])throw new Error(`${i} is not registered.`);const{klass:o}=Zr[i],l=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in r){if(!r.hasOwnProperty(h)||Zr[i].omit.indexOf(h)>=0)continue;const p=r[h];l[h]=Zr[i].shallow.indexOf(h)>=0?p:Co(p,t)}r instanceof Error&&(l.message=r.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}function Ts(r){if(Ju(r))return r;if(Array.isArray(r))return r.map(Ts);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Qu(r)||"Object";if(!Zr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Zr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const l of Object.keys(r)){if(l==="$name")continue;const h=r[l];o[l]=Zr[t].shallow.indexOf(l)>=0?h:Ts(h)}return o}class th{constructor(){this.first=!0}update(t,i){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}function fl(r){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function va(r){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function ad(r){return/\s/u.test(String.fromCodePoint(r))}function nu(r){for(const t of r)if(va(t.codePointAt(0)))return!0;return!1}function $s(r){for(const t of r)if(!ru(t.codePointAt(0)))return!1;return!0}function pl(r){const t=r.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(t.join("|"),"u")}const tc=pl(["Arab","Dupl","Mong","Ougr","Syrc"]);function ru(r){return!tc.test(String.fromCodePoint(r))}function au(r){return!(va(r)||(t=r,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}const eh=pl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Xs(r){return eh.test(String.fromCodePoint(r))}function hf(r,t){return!(!t&&Xs(r)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(r)))}function Ys(r){for(const t of r)if(Xs(t.codePointAt(0)))return!0;return!1}const Ss=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(Ss.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const i=r.pluginURL,o=new Promise((h=>{this.loadScriptResolve=h}));t(i);const l=new Promise((h=>setTimeout((()=>h()),this.TIMEOUT)));if(yield Promise.race([o,l]),this.isParsed()){const h={pluginStatus:"loaded",pluginURL:i};return this.setState(h),h}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Si{constructor(t,i){this.isSupportedScript=Ao,this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new th,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new th,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Ao(r){return(function(t,i){for(const o of t)if(!hf(o.codePointAt(0),i))return!1;return!0})(r,Ss.getRTLTextPluginStatus()==="loaded")}const xa="-transition";class Ws{constructor(t,i,o){this.property=t,this.value=i,this.expression=(function(l,h,p){if(Vs(l))return new Us(l,h);if($u(l)){const y=ul(l,h,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=l;return h.type==="color"&&typeof l=="string"?y=Qe.parse(l):h.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?h.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?h.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?y=Un.parse(l):h.type==="projectionDefinition"&&typeof l=="string"&&(y=Jn.parse(l)):y=Pn.parse(l):y=Cn.parse(l):y=Mn.parse(l),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?t.specification.default:i,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,o){return this.property.possiblyEvaluate(this,t,i,o)}}class ec{constructor(t,i){this.property=t,this.value=new Ws(t,void 0,i)}transitioned(t,i){return new ml(this.property,this.value,i,Mi({},t.transition,this.transition),t.now)}untransitioned(){return new ml(this.property,this.value,null,{},0)}}class ih{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=i}getValue(t){return Or(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ec(this._values[t].property,this._globalState)),this._values[t].value=new Ws(this._values[t].property,i===null?void 0:Or(i),this._globalState)}getTransition(t){return Or(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ec(this._values[t].property,this._globalState)),this._values[t].transition=Or(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o);const l=this.getTransition(i);l!==void 0&&(t[`${i}${xa}`]=l)}return t}transitioned(t,i){const o=new gl(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(t,i._values[l]);return o}untransitioned(){const t=new gl(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class ml{constructor(t,i,o,l,h){this.property=t,this.value=i,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(t,i,o){const l=t.now||0,h=this.value.possiblyEvaluate(t,i,o),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(t,i,o);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,i,o),h,ge(y))}}return h}}class gl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,o){const l=new wa(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,i,o);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class sd{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=i}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Or(this._values[t].value)}setValue(t,i){this._values[t]=new Ws(this._values[t].property,i===null?void 0:Or(i),this._globalState)}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o)}return t}possiblyEvaluate(t,i,o){const l=new wa(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,i,o);return l}}class ba{constructor(t,i,o){this.property=t,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,o,l){return this.property.evaluate(this.value,this.parameters,t,i,o,l)}}class wa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ye{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,o){const l=Oa[this.specification.type];return l?l(t,i,o):t}}class Ae{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,o,l){return new ba(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},o,l)}:t.expression,i)}interpolate(t,i,o){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new ba(this,{kind:"constant",value:void 0},t.parameters);const l=Oa[this.specification.type];if(l){const h=l(t.value.value,i.value.value,o);return new ba(this,{kind:"constant",value:h},t.parameters)}return t}evaluate(t,i,o,l,h,p){return t.kind==="constant"?t.value:t.evaluate(i,o,l,h,p)}}class _l extends Ae{possiblyEvaluate(t,i,o,l){if(t.value===void 0)return new ba(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const h=t.expression.evaluate(i,null,{},o,l),p=t.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,y=this._calculate(p,p,p,i);return new ba(this,{kind:"constant",value:y},i)}if(t.expression.kind==="camera"){const h=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new ba(this,{kind:"constant",value:h},i)}return new ba(this,t.expression,i)}evaluate(t,i,o,l,h,p){if(t.kind==="source"){const y=t.evaluate(i,o,l,h,p);return this._calculate(y,y,y,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},o,l),t.evaluate({zoom:Math.floor(i.zoom)},o,l),t.evaluate({zoom:Math.floor(i.zoom)+1},o,l),i):t.value}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class nh{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const h=t.expression.evaluate(i,null,{},o,l);return this._calculate(h,h,h,i)}return this._calculate(t.expression.evaluate(new Si(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Si(Math.floor(i.zoom),i)),t.expression.evaluate(new Si(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class ur{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){return!!t.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class Zi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const o=t[i];o.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new Ws(o,void 0,void 0),h=this.defaultTransitionablePropertyValues[i]=new ec(o,void 0);this.defaultTransitioningPropertyValues[i]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate({})}}}de("DataDrivenProperty",Ae),de("DataConstantProperty",ye),de("CrossFadedDataDrivenProperty",_l),de("CrossFadedProperty",nh),de("ColorRampProperty",ur);class Zn extends St{constructor(t,i,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Gr(t.filter,o)),i.layout&&(this._unevaluatedLayout=new sd(i.layout,o)),i.paint)){this._transitionablePaint=new ih(i.paint,o);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wa(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=Gr(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const l of o.getGlobalStateRefs())t.add(l)}for(const i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}getPaintAffectingGlobalStateRefs(){var t;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const l=this._transitionablePaint._values[o].value;for(const h of l.getGlobalStateRefs()){const p=(t=i.get(h))!==null&&t!==void 0?t:[];p.push({name:o,value:l.value}),i.set(h,p)}}return i}setLayoutProperty(t,i,o={}){i!=null&&this._validate(rd,`layers.${this.id}.layout.${t}`,t,i,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(xa)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,o={}){if(i!=null&&this._validate(Ku,`layers.${this.id}.paint.${t}`,t,i,o))return!1;if(t.endsWith(xa))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const l=this._transitionablePaint._values[t],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),y=l.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,o){return!1}isHidden(t,i=!1){return!!(this.minzoom&&t<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),es(t,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(t,i,o,l,h={}){return(!h||h.validate!==!1)&&ws(this,t.call(ya,{key:i,layerType:this.type,objectKey:o,value:l,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof ba&&xo(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let rh;var df={get paint(){return rh=rh||new Zi({"raster-opacity":new ye(J.paint_raster["raster-opacity"]),"raster-hue-rotate":new ye(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ye(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ye(J.paint_raster["raster-brightness-max"]),"raster-saturation":new ye(J.paint_raster["raster-saturation"]),"raster-contrast":new ye(J.paint_raster["raster-contrast"]),"raster-resampling":new ye(J.paint_raster["raster-resampling"]),"raster-fade-duration":new ye(J.paint_raster["raster-fade-duration"])})}};class Do extends Zn{constructor(t,i){super(t,df,i)}}const ia={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class tn{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ai(r,t=1){let i=0,o=0;return{members:r.map((l=>{const h=ia[l.type].BYTES_PER_ELEMENT,p=i=Ze(i,Math.max(t,h)),y=l.components||1;return o=Math.max(o,h),i+=h*y,{name:l.name,type:l.type,components:y,offset:p}})),size:Ze(i,Math.max(o,t)),alignment:t}}function Ze(r,t){return Math.ceil(r/t)*t}class bi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.int16[l+0]=i,this.int16[l+1]=o,t}}bi.prototype.bytesPerElement=4,de("StructArrayLayout2i4",bi);class sn extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=l,t}}sn.prototype.bytesPerElement=6,de("StructArrayLayout3i6",sn);class su extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,l)}emplace(t,i,o,l,h){const p=4*t;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=l,this.int16[p+3]=h,t}}su.prototype.bytesPerElement=8,de("StructArrayLayout4i8",su);class Io extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=y,t}}Io.prototype.bytesPerElement=12,de("StructArrayLayout2i4i12",Io);class Ir extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=4*t,S=8*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[S+4]=l,this.uint8[S+5]=h,this.uint8[S+6]=p,this.uint8[S+7]=y,t}}Ir.prototype.bytesPerElement=8,de("StructArrayLayout2i4ub8",Ir);class Ks extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.float32[l+0]=i,this.float32[l+1]=o,t}}Ks.prototype.bytesPerElement=8,de("StructArrayLayout2f8",Ks);class Qs extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,S,C){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,o,l,h,p,y,x,S,C)}emplace(t,i,o,l,h,p,y,x,S,C,I){const P=10*t;return this.uint16[P+0]=i,this.uint16[P+1]=o,this.uint16[P+2]=l,this.uint16[P+3]=h,this.uint16[P+4]=p,this.uint16[P+5]=y,this.uint16[P+6]=x,this.uint16[P+7]=S,this.uint16[P+8]=C,this.uint16[P+9]=I,t}}Qs.prototype.bytesPerElement=20,de("StructArrayLayout10ui20",Qs);class Js extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x){const S=this.length;return this.resize(S+1),this.emplace(S,t,i,o,l,h,p,y,x)}emplace(t,i,o,l,h,p,y,x,S){const C=8*t;return this.uint16[C+0]=i,this.uint16[C+1]=o,this.uint16[C+2]=l,this.uint16[C+3]=h,this.uint16[C+4]=p,this.uint16[C+5]=y,this.uint16[C+6]=x,this.uint16[C+7]=S,t}}Js.prototype.bytesPerElement=16,de("StructArrayLayout8ui16",Js);class ic extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,S,C,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,t,i,o,l,h,p,y,x,S,C,I,P)}emplace(t,i,o,l,h,p,y,x,S,C,I,P,L){const O=12*t;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=l,this.int16[O+3]=h,this.uint16[O+4]=p,this.uint16[O+5]=y,this.uint16[O+6]=x,this.uint16[O+7]=S,this.int16[O+8]=C,this.int16[O+9]=I,this.int16[O+10]=P,this.int16[O+11]=L,t}}ic.prototype.bytesPerElement=24,de("StructArrayLayout4i4ui4i24",ic);class on extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=l,t}}on.prototype.bytesPerElement=12,de("StructArrayLayout3f12",on);class zo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}zo.prototype.bytesPerElement=4,de("StructArrayLayout1ul4",zo);class to extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,S){const C=this.length;return this.resize(C+1),this.emplace(C,t,i,o,l,h,p,y,x,S)}emplace(t,i,o,l,h,p,y,x,S,C){const I=10*t,P=5*t;return this.int16[I+0]=i,this.int16[I+1]=o,this.int16[I+2]=l,this.int16[I+3]=h,this.int16[I+4]=p,this.int16[I+5]=y,this.uint32[P+3]=x,this.uint16[I+8]=S,this.uint16[I+9]=C,t}}to.prototype.bytesPerElement=20,de("StructArrayLayout6i1ul2ui20",to);class ah extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=y,t}}ah.prototype.bytesPerElement=12,de("StructArrayLayout2i2i2i12",ah);class nc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,l,h)}emplace(t,i,o,l,h,p){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=l,this.int16[x+6]=h,this.int16[x+7]=p,t}}nc.prototype.bytesPerElement=16,de("StructArrayLayout2f1f2i16",nc);class yl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=16*t,S=4*t,C=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[S+1]=l,this.float32[S+2]=h,this.int16[C+6]=p,this.int16[C+7]=y,t}}yl.prototype.bytesPerElement=16,de("StructArrayLayout2ub2f2i16",yl);class ou extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=l,t}}ou.prototype.bytesPerElement=6,de("StructArrayLayout3ui6",ou);class rc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X){const rt=this.length;return this.resize(rt+1),this.emplace(rt,t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X)}emplace(t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X,rt){const K=24*t,tt=12*t,gt=48*t;return this.int16[K+0]=i,this.int16[K+1]=o,this.uint16[K+2]=l,this.uint16[K+3]=h,this.uint32[tt+2]=p,this.uint32[tt+3]=y,this.uint32[tt+4]=x,this.uint16[K+10]=S,this.uint16[K+11]=C,this.uint16[K+12]=I,this.float32[tt+7]=P,this.float32[tt+8]=L,this.uint8[gt+36]=O,this.uint8[gt+37]=N,this.uint8[gt+38]=G,this.uint32[tt+10]=X,this.int16[K+22]=rt,t}}rc.prototype.bytesPerElement=48,de("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rc);class lu extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X,rt,K,tt,gt,yt,Dt,Xt,jt,Qt,oe,re){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X,rt,K,tt,gt,yt,Dt,Xt,jt,Qt,oe,re)}emplace(t,i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X,rt,K,tt,gt,yt,Dt,Xt,jt,Qt,oe,re,ae){const Vt=32*t,Me=16*t;return this.int16[Vt+0]=i,this.int16[Vt+1]=o,this.int16[Vt+2]=l,this.int16[Vt+3]=h,this.int16[Vt+4]=p,this.int16[Vt+5]=y,this.int16[Vt+6]=x,this.int16[Vt+7]=S,this.uint16[Vt+8]=C,this.uint16[Vt+9]=I,this.uint16[Vt+10]=P,this.uint16[Vt+11]=L,this.uint16[Vt+12]=O,this.uint16[Vt+13]=N,this.uint16[Vt+14]=G,this.uint16[Vt+15]=X,this.uint16[Vt+16]=rt,this.uint16[Vt+17]=K,this.uint16[Vt+18]=tt,this.uint16[Vt+19]=gt,this.uint16[Vt+20]=yt,this.uint16[Vt+21]=Dt,this.uint16[Vt+22]=Xt,this.uint32[Me+12]=jt,this.float32[Me+13]=Qt,this.float32[Me+14]=oe,this.uint16[Vt+30]=re,this.uint16[Vt+31]=ae,t}}lu.prototype.bytesPerElement=64,de("StructArrayLayout8i15ui1ul2f2ui64",lu);class er extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}er.prototype.bytesPerElement=4,de("StructArrayLayout1f4",er);class m extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.uint16[6*t+0]=i,this.float32[h+1]=o,this.float32[h+2]=l,t}}m.prototype.bytesPerElement=12,de("StructArrayLayout1ui2f12",m);class e extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=4*t;return this.uint32[2*t+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=l,t}}e.prototype.bytesPerElement=8,de("StructArrayLayout1ul2ui8",e);class a extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.uint16[l+0]=i,this.uint16[l+1]=o,t}}a.prototype.bytesPerElement=4,de("StructArrayLayout2ui4",a);class u extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}u.prototype.bytesPerElement=2,de("StructArrayLayout1ui2",u);class f extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,l)}emplace(t,i,o,l,h){const p=4*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=l,this.float32[p+3]=h,t}}f.prototype.bytesPerElement=16,de("StructArrayLayout4f16",f);class g extends tn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new dt(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class v extends to{get(t){return new g(this,t)}}de("CollisionBoxArray",v);class T extends tn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class E extends rc{get(t){return new T(this,t)}}de("PlacedSymbolArray",E);class D extends tn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}D.prototype.size=64;class z extends lu{get(t){return new D(this,t)}}de("SymbolInstanceArray",z);class B extends er{getoffsetX(t){return this.float32[1*t+0]}}de("GlyphOffsetArray",B);class k extends sn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}de("SymbolLineVertexArray",k);class V extends tn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}V.prototype.size=12;class H extends m{get(t){return new V(this,t)}}de("TextAnchorOffsetArray",H);class W extends tn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class Q extends e{get(t){return new W(this,t)}}de("FeatureIndexArray",Q);class et extends bi{}class at extends bi{}class ct extends bi{}class nt extends Io{}class ht extends Ir{}class pt extends Ks{}class ot extends Qs{}class bt extends Js{}class It extends ic{}class Mt extends on{}class Ct extends zo{}class At extends ah{}class ie extends yl{}class ne extends ou{}class qt extends a{}const _e=Ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:je}=_e;class Re{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,o,l){const h=this.segments[this.segments.length-1];return t>Re.MAX_VERTEX_ARRAY_LENGTH&&Ci(`Max vertices per segment is ${Re.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Re.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!h||h.vertexLength+t>Re.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l?this.createNewSegment(i,o,l):h}createNewSegment(t,i,o){const l={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(l.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,i,o){return this.prepareSegment(0,t,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,o,l){return new Re([{vertexOffset:t,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Hi(r,t){return 256*(r=ke(Math.floor(r),0,255))+ke(Math.floor(t),0,255)}Re.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,de("SegmentVector",Re);const Fi=Ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),en=Ai([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var zi,In,Yi,pn={exports:{}},mn={exports:{}},bn={exports:{}},mr=(function(){if(Yi)return pn.exports;Yi=1;var r=(zi||(zi=1,mn.exports=function(i,o){var l,h,p,y,x,S,C,I;for(h=i.length-(l=3&i.length),p=o,x=3432918353,S=461845907,I=0;I<h;)C=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,p=27492+(65535&(y=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&i.charCodeAt(I+2))<<16;case 2:C^=(255&i.charCodeAt(I+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(I)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),mn.exports),t=(In||(In=1,bn.exports=function(i,o){for(var l,h=i.length,p=o^h,y=0;h>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),bn.exports);return pn.exports=r,pn.exports.murmur3=r,pn.exports.murmur2=t,pn.exports})(),Es=vt(mr);class Ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,o,l){this.ids.push(Po(t)),this.positions.push(i,o,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Po(t);let o=0,l=this.ids.length-1;for(;o<l;){const p=o+l>>1;this.ids[p]>=i?l=p:o=p+1}const h=[];for(;this.ids[o]===i;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(t,i){const o=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Ms(o,l,0,o.length-1),i&&i.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(t){const i=new Ua;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Po(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Es(String(r))}function Ms(r,t,i,o){for(;i<o;){const l=r[i+o>>1];let h=i-1,p=o+1;for(;;){do h++;while(r[h]<l);do p--;while(r[p]>l);if(h>=p)break;Ro(r,h,p),Ro(t,3*h,3*p),Ro(t,3*h+1,3*p+1),Ro(t,3*h+2,3*p+2)}p-i<o-p?(Ms(r,t,i,p),i=p+1):(Ms(r,t,p+1,o),o=p)}}function Ro(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}de("FeaturePositionMap",Ua);class na{constructor(t,i){this.gl=t.gl,this.location=i}}class Ga extends na{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Hr extends na{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Cs extends na{constructor(t,i){super(t,i),this.current=Qe.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const vl=new Float32Array(16);function xl(r){return[Hi(255*r.r,255*r.g),Hi(255*r.b,255*r.a)]}class ln{constructor(t,i,o){this.value=t,this.uniformNames=i.map((l=>`u_${l}`)),this.type=o}setUniform(t,i,o){t.set(o.constantOr(this.value))}getBinding(t,i,o){return this.type==="color"?new Cs(t,i):new Ga(t,i)}}class Ni{constructor(t,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,i){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(t,i,o,l){let h=null;l==="u_pattern_to"?h=this.patternTo:l==="u_pattern_from"?h=this.patternFrom:l==="u_dasharray_to"?h=this.dashTo:l==="u_dasharray_from"?h=this.dashFrom:l==="u_pixel_ratio_to"?h=this.pixelRatioTo:l==="u_pixel_ratio_from"&&(h=this.pixelRatioFrom),h!==null&&t.set(h)}getBinding(t,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Hr(t,i):new Ga(t,i)}}class wn{constructor(t,i,o,l){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(t,i,o){const l=this.paintVertexArray.length,h=this.expression.evaluate(new Si(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(l,t,h)}updatePaintArray(t,i,o,l,h){const p=this.expression.evaluate(new Si(0,h),o,l);this._setPaintValue(t,i,p)}_setPaintValue(t,i,o){if(this.type==="color"){const l=xl(o);for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ei{constructor(t,i,o,l,h,p){this.expression=t,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(t,i,o){const l=this.expression.evaluate(new Si(this.zoom,o),i,{},o.canonical,[],o.formattedSection),h=this.expression.evaluate(new Si(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(p,t,l,h)}updatePaintArray(t,i,o,l,h){const p=this.expression.evaluate(new Si(this.zoom,h),o,l),y=this.expression.evaluate(new Si(this.zoom+1,h),o,l);this._setPaintValue(t,i,p,y)}_setPaintValue(t,i,o,l){if(this.type==="color"){const h=xl(o),p=xl(l);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,l=ke(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,i,o){return new Ga(t,i)}}class eo{constructor(t,i,o,l,h,p){this.expression=t,this.type=i,this.useIntegerZoom=o,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(t,i,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,this.getPositionIds(i),o)}updatePaintArray(t,i,o,l,h){this._setPaintValues(t,i,this.getPositionIds(o),h)}_setPaintValues(t,i,o,l){const h=this.getPositions(l);if(!h||!o)return;const p=h[o.min],y=h[o.mid],x=h[o.max];if(p&&y&&x)for(let S=t;S<i;S++)this.emplace(this.zoomInPaintVertexArray,S,y,p),this.emplace(this.zoomOutPaintVertexArray,S,y,x)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class od extends eo{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Fi.members}emplace(t,i,o,l){t.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],o.pixelRatio,l.pixelRatio)}}class uu extends eo{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return en.members}emplace(t,i,o,l){t.emplace(i,0,o.y,o.height,o.width,0,l.y,l.height,l.width)}}class ld{constructor(t,i,o){this.binders={},this._buffers=[];const l=[];for(const h in t.paint._values){if(!o(h))continue;const p=t.paint.get(h);if(!(p instanceof ba&&xo(p.property.specification)))continue;const y=ff(h,t.type),x=p.value,S=p.property.specification.type,C=p.property.useIntegerZoom,I=p.property.specification["property-type"],P=I==="cross-faded"||I==="cross-faded-data-driven";if(x.kind==="constant")this.binders[h]=P?new Ni(x.value,y):new ln(x.value,y,S),l.push(`/u_${h}`);else if(x.kind==="source"||P){const L=As(h,S,"source");this.binders[h]=P?h==="line-dasharray"?new uu(x,S,C,i,L,t.id):new od(x,S,C,i,L,t.id):new wn(x,y,S,L),l.push(`/a_${h}`)}else{const L=As(h,S,"composite");this.binders[h]=new Ei(x,y,S,C,i,L),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof wn||i instanceof Ei?i.maxValue:0}populatePaintArrays(t,i,o){for(const l in this.binders){const h=this.binders[l];(h instanceof wn||h instanceof Ei||h instanceof eo)&&h.populatePaintArray(t,i,o)}}setConstantPatternPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof Ni&&l.setConstantPatternPositions(t,i)}}setConstantDashPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof Ni&&l.setConstantDashPositions(t,i)}}updatePaintArrays(t,i,o,l,h){let p=!1;for(const y in t){const x=i.getPositions(y);for(const S of x){const C=o.feature(S.index);for(const I in this.binders){const P=this.binders[I];if((P instanceof wn||P instanceof Ei||P instanceof eo)&&P.expression.isStateDependent===!0){const L=l.paint.get(I);P.expression=L.value,P.updatePaintArray(S.start,S.end,C,t[y],h),p=!0}}}}return p}defines(){const t=[];for(const i in this.binders){const o=this.binders[i];(o instanceof ln||o instanceof Ni)&&t.push(...o.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof wn||o instanceof Ei)for(let l=0;l<o.paintVertexAttributes.length;l++)t.push(o.paintVertexAttributes[l].name);else if(o instanceof eo){const l=o.getVertexAttributes();for(const h of l)t.push(h.name)}}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof ln||o instanceof Ni||o instanceof Ei)for(const l of o.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof ln||h instanceof Ni||h instanceof Ei){for(const p of h.uniformNames)if(i[p]){const y=h.getBinding(t,i[p],p);o.push({name:p,property:l,binding:y})}}}return o}setUniforms(t,i,o,l){for(const{name:h,property:p,binding:y}of i)this.binders[p].setUniform(y,l,o.get(p),h)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(t&&o instanceof eo){const l=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof wn||o instanceof Ei)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const i in this.binders){const o=this.binders[i];(o instanceof wn||o instanceof Ei||o instanceof eo)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof wn||i instanceof Ei||i instanceof eo)&&i.destroy()}}}class io{constructor(t,i,o=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new ld(l,i,o);this.needsUpload=!1,this._featureMap=new Ua,this._bufferOffset=0}populatePaintArrays(t,i,o,l){for(const h in this.programConfigurations)this.programConfigurations[h].populatePaintArrays(t,i,l);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,o,l){for(const h of o)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,i,h,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ff(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function As(r,t,i){const o={color:{source:Ks,composite:f},number:{source:er,composite:Ks}},l=(function(h){return{"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot},"line-dasharray":{source:bt,composite:bt}}[h]})(r);return l&&l[i]||o[t][i]}de("ConstantBinder",ln),de("CrossFadedConstantBinder",Ni),de("SourceExpressionBinder",wn),de("CrossFadedPatternBinder",od),de("CrossFadedDasharrayBinder",uu),de("CompositeExpressionBinder",Ei),de("ProgramConfiguration",ld,{omit:["_buffers"]}),de("ProgramConfigurationSet",io);const cu=Math.pow(2,14)-1,sh=-cu-1;function no(r){const t=De/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const l=i[o];for(let h=0;h<l.length;h++){const p=l[h],y=Math.round(p.x*t),x=Math.round(p.y*t);p.x=ke(y,sh,cu),p.y=ke(x,sh,cu),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&Ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function zr(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?no(r):[]}}const oh=-32768;function lh(r,t,i,o,l){r.emplaceBack(oh+8*t+o,oh+8*i+l)}class pf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new at,this.indexArray=new ne,this.segments=new Re,this.programConfigurations=new io(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){const l=this.layers[0],h=[];let p=null,y=!1,x=l.type==="heatmap";if(l.type==="circle"){const C=l;p=C.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||C.paint.get("circle-pitch-alignment")==="map"}const S=x?i.subdivisionGranularity.circle:1;for(const{feature:C,id:I,index:P,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,N=zr(C,O);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),N,o))continue;const G=y?p.evaluate(N,{},o):void 0,X={id:I,properties:C.properties,type:C.type,sourceLayerIndex:L,index:P,geometry:O?N.geometry:no(C),patterns:{},sortKey:G};h.push(X)}y&&h.sort(((C,I)=>C.sortKey-I.sortKey));for(const C of h){const{geometry:I,index:P,sourceLayerIndex:L}=C,O=t[P].feature;this.addFeature(C,I,P,o,S),i.featureIndex.insert(O,I,P,L,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,je),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,o,l,h=1){let p;switch(h){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${h}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const S of x){const C=S.x,I=S.y;if(C<0||C>=De||I<0||I>=De)continue;const P=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),L=P.vertexLength;for(let O=0;O<y;O++)for(let N=0;N<y;N++)lh(this.layoutVertexArray,C,I,p[N],p[O]);for(let O=0;O<y-1;O++)for(let N=0;N<y-1;N++){const G=L+O*y+N,X=L+(O+1)*y+N;this.indexArray.emplaceBack(G,X+1,G+1),this.indexArray.emplaceBack(G,X,X+1)}P.vertexLength+=y*y,P.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:l})}}function ud(r,t){for(let i=0;i<r.length;i++)if(ac(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(ac(r,t[i]))return!0;return!!gf(r,t)}function cd(r,t,i){return!!ac(r,t)||!!hd(t,r,i)}function mf(r,t){if(r.length===1)return gr(t,r[0]);for(let i=0;i<t.length;i++){const o=t[i];for(let l=0;l<o.length;l++)if(ac(r,o[l]))return!0}for(let i=0;i<r.length;i++)if(gr(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(gf(r,t[i]))return!0;return!1}function ym(r,t,i){if(r.length>1){if(gf(r,t))return!0;for(let o=0;o<t.length;o++)if(hd(t[o],r,i))return!0}for(let o=0;o<r.length;o++)if(hd(r[o],t,i))return!0;return!1}function gf(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],l=r[i+1];for(let h=0;h<t.length-1;h++)if(Eg(o,l,t[h],t[h+1]))return!0}return!1}function Eg(r,t,i,o){return Kr(r,i,o)!==Kr(t,i,o)&&Kr(r,t,i)!==Kr(r,t,o)}function hd(r,t,i){const o=i*i;if(t.length===1)return r.distSqr(t[0])<o;for(let l=1;l<t.length;l++)if(Hn(r,t[l-1],t[l])<o)return!0;return!1}function Hn(r,t,i){const o=t.distSqr(i);if(o===0)return r.distSqr(t);const l=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/o;return r.distSqr(l<0?t:l>1?i:i.sub(t)._mult(l)._add(t))}function gr(r,t){let i,o,l,h=!1;for(let p=0;p<r.length;p++){i=r[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],l=i[x],o.y>t.y!=l.y>t.y&&t.x<(l.x-o.x)*(t.y-o.y)/(l.y-o.y)+o.x&&(h=!h)}return h}function ac(r,t){let i=!1;for(let o=0,l=r.length-1;o<r.length;l=o++){const h=r[o],p=r[l];h.y>t.y!=p.y>t.y&&t.x<(p.x-h.x)*(t.y-h.y)/(p.y-h.y)+h.x&&(i=!i)}return i}function vm(r,t,i){const o=i[0],l=i[2];if(r.x<o.x&&t.x<o.x||r.x>l.x&&t.x>l.x||r.y<o.y&&t.y<o.y||r.y>l.y&&t.y>l.y)return!1;const h=Kr(r,t,i[0]);return h!==Kr(r,t,i[1])||h!==Kr(r,t,i[2])||h!==Kr(r,t,i[3])}function sc(r,t,i){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(t.id).getMaxValue(r)}function dd(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function hu(r,t,i,o,l){if(!t[0]&&!t[1])return r;const h=dt.convert(t)._mult(l);i==="viewport"&&h._rotate(-o);const p=[];for(let y=0;y<r.length;y++)p.push(r[y].sub(h));return p}function xm({queryGeometry:r,size:t},i){return cd(r,i,t)}function _f({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){return cd(r,h,t*(i.projectTileCoordinates(h.x,h.y,o,l).signedDistanceFromCamera/i.cameraToCenterDistance))}function bm({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){const p=i.projectTileCoordinates(h.x,h.y,o,l).signedDistanceFromCamera,y=t*(i.cameraToCenterDistance/p);return cd(r,pd(h,i,o,l),y)}function Mg({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){return cd(r,pd(h,i,o,l),t)}function fd({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l,pitchAlignment:h="map",pitchScale:p="map"},y){const x=h==="map"?p==="map"?xm:_f:p==="map"?bm:Mg,S={queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l};for(const C of y)for(const I of C)if(x(S,I))return!0;return!1}function pd(r,t,i,o){const l=t.projectTileCoordinates(r.x,r.y,i,o).point;return new dt((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}let rp,ap;de("CircleBucket",pf,{omit:["layers"]});var wm={get paint(){return ap=ap||new Zi({"circle-radius":new Ae(J.paint_circle["circle-radius"]),"circle-color":new Ae(J.paint_circle["circle-color"]),"circle-blur":new Ae(J.paint_circle["circle-blur"]),"circle-opacity":new Ae(J.paint_circle["circle-opacity"]),"circle-translate":new ye(J.paint_circle["circle-translate"]),"circle-translate-anchor":new ye(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ye(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ye(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ae(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ae(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ae(J.paint_circle["circle-stroke-opacity"])})},get layout(){return rp=rp||new Zi({"circle-sort-key":new Ae(J.layout_circle["circle-sort-key"])})}};class sp extends Zn{constructor(t,i){super(t,wm,i)}createBucket(t){return new pf(t)}queryRadius(t){const i=t;return sc("circle-radius",this,i)+sc("circle-stroke-width",this,i)+dd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const S=hu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-h.bearingInRadians,p),C=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),I=this.paint.get("circle-pitch-scale"),P=this.paint.get("circle-pitch-alignment");let L,O;return P==="map"?(L=S,O=C*p):(L=(function(N,G,X,rt){return N.map((K=>pd(K,G,X,rt)))})(S,h,y,x),O=C),fd({queryGeometry:L,size:O,transform:h,unwrappedTileID:y,getElevation:x,pitchAlignment:P,pitchScale:I},l)}}class yf extends pf{}let vf;de("HeatmapBucket",yf,{omit:["layers"]});var Tm={get paint(){return vf=vf||new Zi({"heatmap-radius":new Ae(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ae(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ye(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ur(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ye(J.paint_heatmap["heatmap-opacity"])})}};function md(r,{width:t,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*i*o)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*i*o}`)}else l=new Uint8Array(t*i*o);return r.width=t,r.height=i,r.data=l,r}function gd(r,{width:t,height:i},o){if(t===r.width&&i===r.height)return;const l=md({},{width:t,height:i},o);_d(r,l,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,i)},o),r.width=t,r.height=i,r.data=l.data}function _d(r,t,i,o,l,h){if(l.width===0||l.height===0)return t;if(l.width>r.width||l.height>r.height||i.x>r.width-l.width||i.y>r.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||o.x>t.width-l.width||o.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=r.data,y=t.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<l.height;x++){const S=((i.y+x)*r.width+i.x)*h,C=((o.y+x)*t.width+o.x)*h;for(let I=0;I<l.width*h;I++)y[C+I]=p[S+I]}return t}class uh{constructor(t,i){md(this,t,1,i)}resize(t){gd(this,t,1)}clone(){return new uh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,h){_d(t,i,o,l,h,1)}}class Pr{constructor(t,i){md(this,t,4,i)}resize(t){gd(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,h){_d(t,i,o,l,h,4)}setPixel(t,i,o){const l=4*(t*this.width+i);this.data[l+0]=Math.round(255*o.r/o.a),this.data[l+1]=Math.round(255*o.g/o.a),this.data[l+2]=Math.round(255*o.b/o.a),this.data[l+3]=Math.round(255*o.a)}}function op(r){const t={},i=r.resolution||256,o=r.clips?r.clips.length:1,l=r.image||new Pr({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const h=(p,y,x)=>{t[r.evaluationKey]=x;const S=r.expression.evaluate(t);l.setPixel(p/4/i,y/4,S)};if(r.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,S=0;x<i;x++,S+=4){const C=x/(i-1),{start:I,end:P}=r.clips[p];h(y,S,I*(1-C)+P*C)}else for(let p=0,y=0;p<i;p++,y+=4)h(0,y,p/(i-1));return l}de("AlphaImage",uh),de("RGBAImage",Pr);const ro="big-fb";class lp extends Zn{createBucket(t){return new yf(t)}constructor(t,i){super(t,Tm,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=op({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ro)&&this.heatmapFbos.delete(ro)}queryRadius(t){return sc("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return fd({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:h,unwrappedTileID:y,getElevation:x},l)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Sm;var Em={get paint(){return Sm=Sm||new Zi({"hillshade-illumination-direction":new ye(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ye(J.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ye(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ye(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ye(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ye(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ye(J.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ye(J.paint_hillshade["hillshade-method"])})}};class bl extends Zn{constructor(t,i){super(t,Em,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const h=Math.max(t.length,i.length,o.length,l.length);t=t.concat(Array(h-t.length).fill(t.at(-1))),i=i.concat(Array(h-i.length).fill(i.at(-1))),o=o.concat(Array(h-o.length).fill(o.at(-1))),l=l.concat(Array(h-l.length).fill(l.at(-1)));const p=i.map(Vn);return{directionRadians:t.map(Vn),altitudeRadians:p,shadowColor:l,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let xf;var Mm={get paint(){return xf=xf||new Zi({"color-relief-opacity":new ye(J["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ur(J["paint_color-relief"]["color-relief-color"])})}};class ch{constructor(t,i,o,l){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(i,l)}update(t,i,o){const{width:l,height:h}=t,p=!(this.size&&this.size[0]===l&&this.size[1]===h||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[l,h],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||za(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,l,h,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:S,y:C}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||za(t)?x.texSubImage2D(x.TEXTURE_2D,0,S,C,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,S,C,l,h,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),o!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o||t),this.filter=t),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class hh{constructor(t,i,o,l=1,h=1,p=1,y=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ci(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<x;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(x,S)]=this.data[this._idx(x-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,x)]=this.data[this._idx(S,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<x;S++)for(let C=0;C<x;C++){const I=this.get(S,C);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(t,i){const o=new Uint8Array(this.data.buffer),l=4*this._idx(t,i);return this.unpack(o[l],o[l+1],o[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,o){return t*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return un(t,this.getUnpackVector())}getPixels(){return new Pr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,h=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:l=h-1;break;case 1:h=l+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,S=-o*this.dim;for(let C=p;C<y;C++)for(let I=l;I<h;I++)this.data[this._idx(I,C)]=t.data[this._idx(I+x,C+S)]}}function un(r,t){const i=t[0],o=t[1],l=t[2],h=t[3],p=Math.min(i,o,l),y=Math.round((r+h)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/l)%256}}de("DEMData",hh);class Cg extends Zn{constructor(t,i){super(t,Mm,i)}_createColorRamp(t){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof wo&&o._styleExpression.expression instanceof tr){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Qe.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;const l={elevationStops:[],colorStops:[]},h=(i.elevationStops.length-1)/(t-1);for(let p=0;p<i.elevationStops.length-.5;p+=h)l.elevationStops.push(i.elevationStops[Math.round(p)]),l.colorStops.push(i.colorStops[Math.round(p)]);return Ci(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${i.elevationStops.length}`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const l=this._createColorRamp(i),h=new Pr({width:l.colorStops.length,height:1}),p=new Pr({width:l.colorStops.length,height:1});for(let y=0;y<l.elevationStops.length;y++){const x=un(l.elevationStops[y],o);p.setPixel(0,y,new Qe(x.r/255,x.g/255,x.b/255,1)),h.setPixel(0,y,l.colorStops[y])}return this.colorRampTextures={elevationTexture:new ch(t,p,t.gl.RGBA),colorTexture:new ch(t,h,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Ag=Ai([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cm}=Ag;function du(r,t,i){const o=i.patternDependencies;let l=!1;for(const h of t){const p=h.paint.get(`${r}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,o[y.to]=!0,o[y.from]=!0)}return l}function Lo(r,t,i,o,l){const{zoom:h}=o,p=l.patternDependencies;for(const y of t){const x=y.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let S=x.evaluate({zoom:h-1},i,{},l.availableImages),C=x.evaluate({zoom:h},i,{},l.availableImages),I=x.evaluate({zoom:h+1},i,{},l.availableImages);S=S&&S.name?S.name:S,C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,p[S]=!0,p[C]=!0,p[I]=!0,i.patterns[y.id]={min:S,mid:C,max:I}}}return i}function up(r,t,i,o,l){let h;if(l===(function(p,y,x,S){let C=0;for(let I=y,P=x-S;I<x;I+=S)C+=(p[P]-p[I])*(p[I+1]+p[P+1]),P=I;return C})(r,t,i,o)>0)for(let p=t;p<i;p+=o)h=pp(p/o|0,r[p],r[p+1],h);else for(let p=i-o;p>=t;p-=o)h=pp(p/o|0,r[p],r[p+1],h);return h&&dh(h,h.next)&&(fh(h),h=h.next),h}function fu(r,t){if(!r)return r;t||(t=r);let i,o=r;do if(i=!1,o.steiner||!dh(o,o.next)&&ni(o.prev,o,o.next)!==0)o=o.next;else{if(fh(o),o=t=o.prev,o===o.next)break;i=!0}while(i||o!==t);return t}function wl(r,t,i,o,l,h,p){if(!r)return;!p&&h&&(function(x,S,C,I){let P=x;do P.z===0&&(P.z=wf(P.x,P.y,S,C,I)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==x);P.prevZ.nextZ=null,P.prevZ=null,(function(L){let O,N=1;do{let G,X=L;L=null;let rt=null;for(O=0;X;){O++;let K=X,tt=0;for(let yt=0;yt<N&&(tt++,K=K.nextZ,K);yt++);let gt=N;for(;tt>0||gt>0&&K;)tt!==0&&(gt===0||!K||X.z<=K.z)?(G=X,X=X.nextZ,tt--):(G=K,K=K.nextZ,gt--),rt?rt.nextZ=G:L=G,G.prevZ=rt,rt=G;X=K}rt.nextZ=null,N*=2}while(O>1)})(P)})(r,o,l,h);let y=r;for(;r.prev!==r.next;){const x=r.prev,S=r.next;if(h?Am(r,o,l,h):Oo(r))t.push(x.i,r.i,S.i),fh(r),r=S.next,y=S.next;else if((r=S)===y){p?p===1?wl(r=cp(fu(r),t),t,i,o,l,h,2):p===2&&Dm(r,t,i,o,l,h):wl(fu(r),t,i,o,l,h,1);break}}}function Oo(r){const t=r.prev,i=r,o=r.next;if(ni(t,i,o)>=0)return!1;const l=t.x,h=i.x,p=o.x,y=t.y,x=i.y,S=o.y,C=Math.min(l,h,p),I=Math.min(y,x,S),P=Math.max(l,h,p),L=Math.max(y,x,S);let O=o.next;for(;O!==t;){if(O.x>=C&&O.x<=P&&O.y>=I&&O.y<=L&&oc(l,y,h,x,p,S,O.x,O.y)&&ni(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Am(r,t,i,o){const l=r.prev,h=r,p=r.next;if(ni(l,h,p)>=0)return!1;const y=l.x,x=h.x,S=p.x,C=l.y,I=h.y,P=p.y,L=Math.min(y,x,S),O=Math.min(C,I,P),N=Math.max(y,x,S),G=Math.max(C,I,P),X=wf(L,O,t,i,o),rt=wf(N,G,t,i,o);let K=r.prevZ,tt=r.nextZ;for(;K&&K.z>=X&&tt&&tt.z<=rt;){if(K.x>=L&&K.x<=N&&K.y>=O&&K.y<=G&&K!==l&&K!==p&&oc(y,C,x,I,S,P,K.x,K.y)&&ni(K.prev,K,K.next)>=0||(K=K.prevZ,tt.x>=L&&tt.x<=N&&tt.y>=O&&tt.y<=G&&tt!==l&&tt!==p&&oc(y,C,x,I,S,P,tt.x,tt.y)&&ni(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;K&&K.z>=X;){if(K.x>=L&&K.x<=N&&K.y>=O&&K.y<=G&&K!==l&&K!==p&&oc(y,C,x,I,S,P,K.x,K.y)&&ni(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;tt&&tt.z<=rt;){if(tt.x>=L&&tt.x<=N&&tt.y>=O&&tt.y<=G&&tt!==l&&tt!==p&&oc(y,C,x,I,S,P,tt.x,tt.y)&&ni(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function cp(r,t){let i=r;do{const o=i.prev,l=i.next.next;!dh(o,l)&&fp(o,i,i.next,l)&&_r(o,l)&&_r(l,o)&&(t.push(o.i,i.i,l.i),fh(i),fh(i.next),i=r=l),i=i.next}while(i!==r);return fu(i)}function Dm(r,t,i,o,l,h){let p=r;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Im(p,y)){let x=ko(p,y);return p=fu(p,p.next),x=fu(x,x.next),wl(p,t,i,o,l,h,0),void wl(x,t,i,o,l,h,0)}y=y.next}p=p.next}while(p!==r)}function hp(r,t){let i=r.x-t.x;return i===0&&(i=r.y-t.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function dp(r,t){const i=(function(l,h){let p=h;const y=l.x,x=l.y;let S,C=-1/0;if(dh(l,p))return p;do{if(dh(l,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const N=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(N<=y&&N>C&&(C=N,S=p.x<p.next.x?p:p.next,N===y))return S}p=p.next}while(p!==h);if(!S)return null;const I=S,P=S.x,L=S.y;let O=1/0;p=S;do{if(y>=p.x&&p.x>=P&&y!==p.x&&$n(x<L?y:C,x,P,L,x<L?C:y,x,p.x,p.y)){const N=Math.abs(x-p.y)/(y-p.x);_r(p,l)&&(N<O||N===O&&(p.x>S.x||p.x===S.x&&bf(S,p)))&&(S=p,O=N)}p=p.next}while(p!==I);return S})(r,t);if(!i)return t;const o=ko(i,r);return fu(o,o.next),fu(i,i.next)}function bf(r,t){return ni(r.prev,r,t.prev)<0&&ni(t.next,r,r.next)<0}function wf(r,t,i,o,l){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*l|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Tl(r){let t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function $n(r,t,i,o,l,h,p,y){return(l-p)*(t-y)>=(r-p)*(h-y)&&(r-p)*(o-y)>=(i-p)*(t-y)&&(i-p)*(h-y)>=(l-p)*(o-y)}function oc(r,t,i,o,l,h,p,y){return!(r===p&&t===y)&&$n(r,t,i,o,l,h,p,y)}function Im(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&fp(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1})(r,t)&&(_r(r,t)&&_r(t,r)&&(function(i,o){let l=i,h=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==i);return h})(r,t)&&(ni(r.prev,r,t.prev)||ni(r,t.prev,t))||dh(r,t)&&ni(r.prev,r,r.next)>0&&ni(t.prev,t,t.next)>0)}function ni(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function dh(r,t){return r.x===t.x&&r.y===t.y}function fp(r,t,i,o){const l=nn(ni(r,t,i)),h=nn(ni(r,t,o)),p=nn(ni(i,o,r)),y=nn(ni(i,o,t));return l!==h&&p!==y||!(l!==0||!yd(r,i,t))||!(h!==0||!yd(r,o,t))||!(p!==0||!yd(i,r,o))||!(y!==0||!yd(i,t,o))}function yd(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function nn(r){return r>0?1:r<0?-1:0}function _r(r,t){return ni(r.prev,r,r.next)<0?ni(r,t,r.next)>=0&&ni(r,r.prev,t)>=0:ni(r,t,r.prev)<0||ni(r,r.next,t)<0}function ko(r,t){const i=Tf(r.i,r.x,r.y),o=Tf(t.i,t.x,t.y),l=r.next,h=t.prev;return r.next=t,t.prev=r,i.next=l,l.prev=i,o.next=i,i.prev=o,h.next=o,o.prev=h,o}function pp(r,t,i,o){const l=Tf(r,t,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function fh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Tf(r,t,i){return{i:r,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ph{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class lc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}lc.noSubdivision=new lc({fill:new ph(0,0),line:new ph(0,0),tile:new ph(0,0),stencil:new ph(0,0),circle:1}),de("SubdivisionGranularityExpression",ph),de("SubdivisionGranularitySetting",lc);const cr=-32768,ra=32767;class zm{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=De/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),l=0|Math.round(i),h=this._getKey(o,l);if(this._vertexDictionary.has(h))return this._vertexDictionary.get(h);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(h,p),this._vertexBuffer.push(o,l),p}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(l,h){const p=[];for(let y=0;y<h.length;y+=3){const x=h[y],S=h[y+1],C=h[y+2],I=l[2*x],P=l[2*x+1];(l[2*S]-I)*(l[2*C+1]-P)-(l[2*S+1]-P)*(l[2*C]-I)>0?(p.push(x),p.push(C),p.push(S)):(p.push(x),p.push(S),p.push(C))}return p})(this._vertexBuffer,t);const i=[],o=t.length;for(let l=0;l<o;l+=3){const h=[t[l+0],t[l+1],t[l+2]],p=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let y=1/0,x=1/0,S=-1/0,C=-1/0;for(let N=0;N<3;N++){const G=p[2*N],X=p[2*N+1];y=Math.min(y,G),S=Math.max(S,G),x=Math.min(x,X),C=Math.max(C,X)}if(y===S||x===C)continue;const I=Math.floor(y/this._granularityCellSize),P=Math.ceil(S/this._granularityCellSize),L=Math.floor(x/this._granularityCellSize),O=Math.ceil(C/this._granularityCellSize);if(I!==P||L!==O)for(let N=L;N<O;N++){const G=this._scanlineGenerateVertexRingForCellRow(N,p,h);Sl(this._vertexBuffer,G,i)}else i.push(...h)}return i}_scanlineGenerateVertexRingForCellRow(t,i,o){const l=t*this._granularityCellSize,h=l+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],S=i[2*y+1],C=i[2*(y+1)%6],I=i[(2*(y+1)+1)%6],P=i[2*(y+2)%6],L=i[(2*(y+2)+1)%6],O=C-x,N=I-S,G=O===0,X=N===0,rt=(l-S)/N,K=(h-S)/N,tt=Math.min(rt,K),gt=Math.max(rt,K);if(!X&&(tt>=1||gt<=0)||X&&(S<l||S>h)){I>=l&&I<=h&&p.push(o[(y+1)%3]);continue}!X&&tt>0&&p.push(this._vertexToIndex(x+O*tt,S+N*tt));const yt=x+O*Math.max(tt,0),Dt=x+O*Math.min(gt,1);G||this._generateIntraEdgeVertices(p,x,S,C,I,yt,Dt),!X&&gt<1&&p.push(this._vertexToIndex(x+O*gt,S+N*gt)),(X||I>=l&&I<=h)&&p.push(o[(y+1)%3]),!X&&(I<=l||I>=h)&&this._generateInterEdgeVertices(p,x,S,C,I,P,L,Dt,l,h)}return p}_generateIntraEdgeVertices(t,i,o,l,h,p,y){const x=l-i,S=h-o,C=S===0,I=C?Math.min(i,l):Math.min(p,y),P=C?Math.max(i,l):Math.max(p,y),L=Math.floor(I/this._granularityCellSize)+1,O=Math.ceil(P/this._granularityCellSize)-1;if(C?i<l:p<y)for(let N=L;N<=O;N++){const G=N*this._granularityCellSize;t.push(this._vertexToIndex(G,o+S*(G-i)/x))}else for(let N=O;N>=L;N--){const G=N*this._granularityCellSize;t.push(this._vertexToIndex(G,o+S*(G-i)/x))}}_generateInterEdgeVertices(t,i,o,l,h,p,y,x,S,C){const I=h-o,P=p-l,L=y-h,O=(S-h)/L,N=(C-h)/L,G=Math.min(O,N),X=Math.max(O,N),rt=l+P*G;let K=Math.floor(Math.min(rt,x)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(rt,x)/this._granularityCellSize)-1,gt=x<rt;const yt=L===0;if(yt&&(y===S||y===C))return;if(yt||G>=1||X<=0){const Xt=o-y,jt=p+(i-p)*Math.min((S-y)/Xt,(C-y)/Xt);K=Math.floor(Math.min(jt,x)/this._granularityCellSize)+1,tt=Math.ceil(Math.max(jt,x)/this._granularityCellSize)-1,gt=x<jt}const Dt=I>0?C:S;if(gt)for(let Xt=K;Xt<=tt;Xt++)t.push(this._vertexToIndex(Xt*this._granularityCellSize,Dt));else for(let Xt=tt;Xt>=K;Xt--)t.push(this._vertexToIndex(Xt*this._granularityCellSize,Dt))}_generateOutline(t){const i=[];for(const o of t){const l=pu(o,this._granularity,!0),h=this._pointArrayToIndices(l),p=[];for(let y=1;y<h.length;y++)p.push(h[y-1]),p.push(h[y]);i.push(p)}return i}_handlePoles(t){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(t,i,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){const o=t[i+1];o===cr&&(t[i+1]=-32767),o===ra&&(t[i+1]=32766)}}_generatePoleQuad(t,i,o,l,h,p){l>h!=(p===cr)?(t.push(i),t.push(o),t.push(this._vertexToIndex(l,p)),t.push(o),t.push(this._vertexToIndex(h,p)),t.push(this._vertexToIndex(l,p))):(t.push(o),t.push(i),t.push(this._vertexToIndex(l,p)),t.push(this._vertexToIndex(h,p)),t.push(o),t.push(this._vertexToIndex(l,p)))}_fillPoles(t,i,o){const l=this._vertexBuffer,h=De,p=t.length;for(let y=2;y<p;y+=3){const x=t[y-2],S=t[y-1],C=t[y],I=l[2*x],P=l[2*x+1],L=l[2*S],O=l[2*S+1],N=l[2*C],G=l[2*C+1];i&&(P===0&&O===0&&this._generatePoleQuad(t,x,S,I,L,cr),O===0&&G===0&&this._generatePoleQuad(t,S,C,L,N,cr),G===0&&P===0&&this._generatePoleQuad(t,C,x,N,I,cr)),o&&(P===h&&O===h&&this._generatePoleQuad(t,x,S,I,L,ra),O===h&&G===h&&this._generatePoleQuad(t,S,C,L,N,ra),G===h&&P===h&&this._generatePoleQuad(t,C,x,N,I,ra))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:l}=(function(y){const x=[],S=[];for(const C of y)if(C.length!==0){C!==y[0]&&x.push(S.length/2);for(let I=0;I<C.length;I++)S.push(C[I].x),S.push(C[I].y)}return{flattened:S,holeIndices:x}})(t);let h;this._initializeVertices(o);try{const y=(function(S,C,I=2){const P=C&&C.length,L=P?C[0]*I:S.length;let O=up(S,0,L,I,!0);const N=[];if(!O||O.next===O.prev)return N;let G,X,rt;if(P&&(O=(function(K,tt,gt,yt){const Dt=[];for(let Xt=0,jt=tt.length;Xt<jt;Xt++){const Qt=up(K,tt[Xt]*yt,Xt<jt-1?tt[Xt+1]*yt:K.length,yt,!1);Qt===Qt.next&&(Qt.steiner=!0),Dt.push(Tl(Qt))}Dt.sort(hp);for(let Xt=0;Xt<Dt.length;Xt++)gt=dp(Dt[Xt],gt);return gt})(S,C,O,I)),S.length>80*I){G=S[0],X=S[1];let K=G,tt=X;for(let gt=I;gt<L;gt+=I){const yt=S[gt],Dt=S[gt+1];yt<G&&(G=yt),Dt<X&&(X=Dt),yt>K&&(K=yt),Dt>tt&&(tt=Dt)}rt=Math.max(K-G,tt-X),rt=rt!==0?32767/rt:0}return wl(O,N,I,G,X,rt,0),N})(o,l),x=this._convertIndices(o,y);h=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(h),{verticesFlattened:this._vertexBuffer,indicesTriangles:h,indicesLineList:p}}_convertIndices(t,i){const o=[];for(let l=0;l<i.length;l++)o.push(this._vertexToIndex(t[2*i[l]],t[2*i[l]+1]));return o}_pointArrayToIndices(t){const i=[];for(let o=0;o<t.length;o++){const l=t[o];i.push(this._vertexToIndex(l.x,l.y))}return i}}function aa(r,t,i,o=!0){return new zm(i,t).subdividePolygonInternal(r,o)}function pu(r,t,i=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],l=r[r.length-1],h=i&&(o.x!==l.x||o.y!==l.y);if(t<2)return h?[...r,r[0]]:[...r];const p=Math.floor(De/t),y=[];y.push(new dt(r[0].x,r[0].y));const x=r.length,S=h?x:x-1;for(let C=0;C<S;C++){const I=r[C],P=C<x-1?r[C+1]:r[0],L=I.x,O=I.y,N=P.x,G=P.y,X=L!==N,rt=O!==G;if(!X&&!rt)continue;const K=N-L,tt=G-O,gt=Math.abs(K),yt=Math.abs(tt);let Dt=L,Xt=O;for(;;){const Qt=K>0?(Math.floor(Dt/p)+1)*p:(Math.ceil(Dt/p)-1)*p,oe=tt>0?(Math.floor(Xt/p)+1)*p:(Math.ceil(Xt/p)-1)*p,re=Math.abs(Dt-Qt),ae=Math.abs(Xt-oe),Vt=Math.abs(Dt-N),Me=Math.abs(Xt-G),Ce=X?re/gt:Number.POSITIVE_INFINITY,Ie=rt?ae/yt:Number.POSITIVE_INFINITY;if((Vt<=re||!X)&&(Me<=ae||!rt))break;if(Ce<Ie&&X||!rt){Dt=Qt,Xt+=tt*Ce;const ve=new dt(Dt,Math.round(Xt));y[y.length-1].x===ve.x&&y[y.length-1].y===ve.y||y.push(ve)}else{Dt+=K*Ie,Xt=oe;const ve=new dt(Math.round(Dt),Xt);y[y.length-1].x===ve.x&&y[y.length-1].y===ve.y||y.push(ve)}}const jt=new dt(N,G);y[y.length-1].x===jt.x&&y[y.length-1].y===jt.y||y.push(jt)}return y}function Sl(r,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,l=r[2*t[0]];for(let x=1;x<t.length;x++){const S=r[2*t[x]];S<l&&(l=S,o=x)}const h=t.length;let p=o,y=(p+1)%h;for(;;){const x=p-1>=0?p-1:h-1,S=(y+1)%h,C=r[2*t[x]],I=r[2*t[S]],P=r[2*t[p]],L=r[2*t[p]+1],O=r[2*t[y]+1];let N=!1;if(C<I)N=!0;else if(C>I)N=!1;else{const G=O-L,X=-(r[2*t[y]]-P),rt=L<O?1:-1;((C-P)*G+(r[2*t[x]+1]-L)*X)*rt>((I-P)*G+(r[2*t[S]+1]-L)*X)*rt&&(N=!0)}if(N){const G=t[x],X=t[p],rt=t[y];G!==X&&G!==rt&&X!==rt&&i.push(rt,X,G),p--,p<0&&(p=h-1)}else{const G=t[S],X=t[p],rt=t[y];G!==X&&G!==rt&&X!==rt&&i.push(rt,X,G),y++,y>=h&&(y=0)}if(x===S)break}}function mu(r,t,i,o,l,h,p,y,x){const S=l.length/2,C=p&&y&&x;if(S<Re.MAX_VERTEX_ARRAY_LENGTH){const I=t.prepareSegment(S,i,o),P=I.vertexLength;for(let N=0;N<h.length;N+=3)o.emplaceBack(P+h[N],P+h[N+1],P+h[N+2]);let L,O;I.vertexLength+=S,I.primitiveLength+=h.length/3,C&&(O=p.prepareSegment(S,i,y),L=O.vertexLength,O.vertexLength+=S);for(let N=0;N<l.length;N+=2)r(l[N],l[N+1]);if(C)for(let N=0;N<x.length;N++){const G=x[N];for(let X=1;X<G.length;X+=2)y.emplaceBack(L+G[X-1],L+G[X]);O.primitiveLength+=G.length/2}}else(function(I,P,L,O,N,G){const X=[];for(let yt=0;yt<O.length/2;yt++)X.push(-1);const rt={count:0};let K=0,tt=I.getOrCreateLatestSegment(P,L),gt=tt.vertexLength;for(let yt=2;yt<N.length;yt+=3){const Dt=N[yt-2],Xt=N[yt-1],jt=N[yt];let Qt=X[Dt]<K,oe=X[Xt]<K,re=X[jt]<K;tt.vertexLength+((Qt?1:0)+(oe?1:0)+(re?1:0))>Re.MAX_VERTEX_ARRAY_LENGTH&&(tt=I.createNewSegment(P,L),K=rt.count,Qt=!0,oe=!0,re=!0,gt=0);const ae=qa(X,O,G,rt,Dt,Qt,tt),Vt=qa(X,O,G,rt,Xt,oe,tt),Me=qa(X,O,G,rt,jt,re,tt);L.emplaceBack(gt+ae-K,gt+Vt-K,gt+Me-K),tt.primitiveLength++}})(t,i,o,l,h,r),C&&(function(I,P,L,O,N,G){const X=[];for(let yt=0;yt<O.length/2;yt++)X.push(-1);const rt={count:0};let K=0,tt=I.getOrCreateLatestSegment(P,L),gt=tt.vertexLength;for(let yt=0;yt<N.length;yt++){const Dt=N[yt];for(let Xt=1;Xt<N[yt].length;Xt+=2){const jt=Dt[Xt-1],Qt=Dt[Xt];let oe=X[jt]<K,re=X[Qt]<K;tt.vertexLength+((oe?1:0)+(re?1:0))>Re.MAX_VERTEX_ARRAY_LENGTH&&(tt=I.createNewSegment(P,L),K=rt.count,oe=!0,re=!0,gt=0);const ae=qa(X,O,G,rt,jt,oe,tt),Vt=qa(X,O,G,rt,Qt,re,tt);L.emplaceBack(gt+ae-K,gt+Vt-K),tt.primitiveLength++}}})(p,i,y,l,x,r),t.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function qa(r,t,i,o,l,h,p){if(h){const y=o.count;return i(t[2*l],t[2*l+1]),r[l]=o.count,o.count++,p.vertexLength++,y}return r[l]}class vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ct,this.indexArray=new ne,this.indexArray2=new qt,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new Re,this.segments2=new Re,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.hasDependencies=du("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:y,id:x,index:S,sourceLayerIndex:C}of t){const I=this.layers[0]._featureFilter.needGeometry,P=zr(y,I);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),P,o))continue;const L=h?l.evaluate(P,{},o,i.availableImages):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:C,index:S,geometry:I?P.geometry:no(y),patterns:{},sortKey:L};p.push(O)}h&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:S,sourceLayerIndex:C}=y;if(this.hasDependencies){const I=Lo("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(I)}else this.addFeature(y,x,S,o,{},i.subdivisionGranularity);i.featureIndex.insert(t[S].feature,x,S,C,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,i,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,o,l,h,p){for(const y of Xl(i,500)){const x=aa(y,l,p.fill.getGranularityForZoomLevel(l.z)),S=this.layoutVertexArray;mu(((C,I)=>{S.emplaceBack(C,I)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,canonical:l})}}let Sf,Ds;de("FillBucket",vd,{omit:["layers","patternFeatures"]});var Pm={get paint(){return Ds=Ds||new Zi({"fill-antialias":new ye(J.paint_fill["fill-antialias"]),"fill-opacity":new Ae(J.paint_fill["fill-opacity"]),"fill-color":new Ae(J.paint_fill["fill-color"]),"fill-outline-color":new Ae(J.paint_fill["fill-outline-color"]),"fill-translate":new ye(J.paint_fill["fill-translate"]),"fill-translate-anchor":new ye(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new _l(J.paint_fill["fill-pattern"])})},get layout(){return Sf=Sf||new Zi({"fill-sort-key":new Ae(J.layout_fill["fill-sort-key"])})}};class mh extends Zn{constructor(t,i){super(t,Pm,i)}recalculate(t,i){super.recalculate(t,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new vd(t)}queryRadius(){return dd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:o,pixelsToTileUnits:l}){return mf(hu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,l),i)}isTileClipped(){return!0}}const xd=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bd=Ai([{name:"a_centroid",components:2,type:"Int16"}],4),{members:gh}=xd;class uc{constructor(t,i,o,l,h){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=h,t.readFields(Rm,this,i)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos,o=[];let l,h=1,p=0,y=0,x=0;for(;t.pos<i;){if(p<=0){const S=t.readVarint();h=7&S,p=S>>3}if(p--,h===1||h===2)y+=t.readSVarint(),x+=t.readSVarint(),h===1&&(l&&o.push(l),l=[]),l&&l.push(new dt(y,x));else{if(h!==7)throw new Error(`unknown command ${h}`);l&&l.push(l[0].clone())}}return l&&o.push(l),o}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let o=1,l=0,h=0,p=0,y=1/0,x=-1/0,S=1/0,C=-1/0;for(;t.pos<i;){if(l<=0){const I=t.readVarint();o=7&I,l=I>>3}if(l--,o===1||o===2)h+=t.readSVarint(),p+=t.readSVarint(),h<y&&(y=h),h>x&&(x=h),p<S&&(S=p),p>C&&(C=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,S,x,C]}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),h=this.extent*t,p=this.extent*i,y=this.loadGeometry();function x(P){return[360*(P.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(P.y+p)/l)*Math.PI))-90]}function S(P){return P.map(x)}let C;if(this.type===1){const P=[];for(const O of y)P.push(O[0]);const L=S(P);C=P.length===1?{type:"Point",coordinates:L[0]}:{type:"MultiPoint",coordinates:L}}else if(this.type===2){const P=y.map(S);C=P.length===1?{type:"LineString",coordinates:P[0]}:{type:"MultiLineString",coordinates:P}}else{if(this.type!==3)throw new Error("unknown feature type");{const P=(function(O){const N=O.length;if(N<=1)return[O];const G=[];let X,rt;for(let K=0;K<N;K++){const tt=wd(O[K]);tt!==0&&(rt===void 0&&(rt=tt<0),rt===tt<0?(X&&G.push(X),X=[O[K]]):X&&X.push(O[K]))}return X&&G.push(X),G})(y),L=[];for(const O of P)L.push(O.map(S));C=L.length===1?{type:"Polygon",coordinates:L[0]}:{type:"MultiPolygon",coordinates:L}}}const I={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Rm(r,t,i){r===1?t.id=i.readVarint():r===2?(function(o,l){const h=o.readVarint()+o.pos;for(;o.pos<h;){const p=l._keys[o.readVarint()],y=l._values[o.readVarint()];l.properties[p]=y}})(i,t):r===3?t.type=i.readVarint():r===4&&(t._geometry=i.pos)}function wd(r){let t=0;for(let i,o,l=0,h=r.length,p=h-1;l<h;p=l++)i=r[l],o=r[p],t+=(o.x-i.x)*(i.y+o.y);return t}uc.types=["Unknown","Point","LineString","Polygon"];class mp{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ef,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new uc(this._pbf,i,this.extent,this._keys,this._values)}}function Ef(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push((function(o){let l=null;const h=o.readVarint()+o.pos;for(;o.pos<h;){const p=o.readVarint()>>3;l=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(i))}class gp{constructor(t,i){this.layers=t.readFields(Dg,{},i)}}function Dg(r,t,i){if(r===3){const o=new mp(i,i.readVarint()+i.pos);o.length&&(t[o.name]=o)}}const _p=Math.pow(2,13);function gi(r,t,i,o,l,h,p,y){r.emplaceBack(t,i,2*Math.floor(o*_p)+p,l*_p*2,h*_p*2,Math.round(y))}class $i{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new nt,this.centroidVertexArray=new et,this.indexArray=new ne,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new Re,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.features=[],this.hasDependencies=du("fill-extrusion",this.layers,i);for(const{feature:l,id:h,index:p,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,S=zr(l,x);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),S,o))continue;const C={id:h,sourceLayerIndex:y,index:p,geometry:x?S.geometry:no(l),properties:l.properties,type:l.type,patterns:{}};this.hasDependencies?this.features.push(Lo("fill-extrusion",this.layers,C,{zoom:this.zoom},i)):this.addFeature(C,C.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(l,C.geometry,p,y,this.index,!0)}}addFeatures(t,i,o){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,i,o,t.subdivisionGranularity)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gh),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bd.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,o,l,h,p){for(const y of Xl(i,500)){const x={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(x,l,t,y,p);const C=this.layoutVertexArray.length-S,I=Math.floor(x.x/x.sampleCount),P=Math.floor(x.y/x.sampleCount);for(let L=0;L<C;L++)this.centroidVertexArray.emplaceBack(I,P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,canonical:l})}processPolygon(t,i,o,l,h){if(l.length<1||ji(l[0]))return;for(const I of l)I.length!==0&&hi(t,I);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=h.fill.getGranularityForZoomLevel(i.z),x=uc.types[o.type]==="Polygon";for(const I of l){if(I.length===0||ji(I))continue;const P=pu(I,y,x);this._generateSideFaces(P,p)}if(!x)return;const S=aa(l,i,y,!1),C=this.layoutVertexArray;mu(((I,P)=>{gi(C,I,P,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,i){let o=0;for(let l=1;l<t.length;l++){const h=t[l],p=t[l-1];if(pi(h,p))continue;i.segment.vertexLength+4>Re.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=h.sub(p)._perp()._unit(),x=p.dist(h);o+x>32768&&(o=0),gi(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,0,o),gi(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,1,o),o+=x,gi(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),gi(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const S=i.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function hi(r,t){for(let i=0;i<t.length;i++){const o=t[i];i===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function pi(r,t){return r.x===t.x&&(r.x<0||r.x>De)||r.y===t.y&&(r.y<0||r.y>De)}function ji(r){return r.every((t=>t.x<0))||r.every((t=>t.x>De))||r.every((t=>t.y<0))||r.every((t=>t.y>De))}let Ta;de("FillExtrusionBucket",$i,{omit:["layers","features"]});var gu={get paint(){return Ta=Ta||new Zi({"fill-extrusion-opacity":new ye(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ae(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ye(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ye(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _l(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ae(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ae(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ye(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _h extends Zn{constructor(t,i){super(t,gu,i)}createBucket(t){return new $i(t)}queryRadius(){return dd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=hu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-h.bearingInRadians,p),S=this.paint.get("fill-extrusion-height").evaluate(i,o),C=this.paint.get("fill-extrusion-base").evaluate(i,o),I=(function(L,O){const N=[];for(const G of L){const X=[G.x,G.y,0,1];cn(X,X,O),N.push(new dt(X[0]/X[3],X[1]/X[3]))}return N})(x,y),P=(function(L,O,N,G){const X=[],rt=[],K=G[8]*O,tt=G[9]*O,gt=G[10]*O,yt=G[11]*O,Dt=G[8]*N,Xt=G[9]*N,jt=G[10]*N,Qt=G[11]*N;for(const oe of L){const re=[],ae=[];for(const Vt of oe){const Me=Vt.x,Ce=Vt.y,Ie=G[0]*Me+G[4]*Ce+G[12],ve=G[1]*Me+G[5]*Ce+G[13],ti=G[2]*Me+G[6]*Ce+G[14],gn=G[3]*Me+G[7]*Ce+G[15],ir=ti+gt,$r=gn+yt,Uo=Ie+Dt,Aa=ve+Xt,Rr=ti+jt,Xr=gn+Qt,Fn=new dt((Ie+K)/$r,(ve+tt)/$r);Fn.z=ir/$r,re.push(Fn);const Lr=new dt(Uo/Xr,Aa/Xr);Lr.z=Rr/Xr,ae.push(Lr)}X.push(re),rt.push(ae)}return[X,rt]})(l,C,S,y);return(function(L,O,N){let G=1/0;mf(N,O)&&(G=Bo(N,O[0]));for(let X=0;X<O.length;X++){const rt=O[X],K=L[X];for(let tt=0;tt<rt.length-1;tt++){const gt=rt[tt],yt=[gt,rt[tt+1],K[tt+1],K[tt],gt];ud(N,yt)&&(G=Math.min(G,Bo(N,yt)))}}return G!==1/0&&G})(P[0],P[1],I)}}function cc(r,t){return r.x*t.x+r.y*t.y}function Bo(r,t){if(r.length===1){let i=0;const o=t[i++];let l;for(;!l||o.equals(l);)if(l=t[i++],!l)return 1/0;for(;i<t.length;i++){const h=t[i],p=r[0],y=l.sub(o),x=h.sub(o),S=p.sub(o),C=cc(y,y),I=cc(y,x),P=cc(x,x),L=cc(S,y),O=cc(S,x),N=C*P-I*I,G=(P*L-I*O)/N,X=(C*O-I*L)/N,rt=o.z*(1-G-X)+l.z*G+h.z*X;if(isFinite(rt))return rt}return 1/0}{let i=1/0;for(const o of t)i=Math.min(i,o.z);return i}}const On=Ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_u}=On,hc=Ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yp}=hc,Za=Math.cos(Math.PI/180*37.5),dc=Math.pow(2,14)/.5;class fc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new ht,this.layoutVertexArray2=new pt,this.indexArray=new ne,this.programConfigurations=new io(t.layers,t.zoom),this.segments=new Re,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,o){this.hasDependencies=du("line",this.layers,i)||this.hasLineDasharray(this.layers);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:y,id:x,index:S,sourceLayerIndex:C}of t){const I=this.layers[0]._featureFilter.needGeometry,P=zr(y,I);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),P,o))continue;const L=h?l.evaluate(P,{},o):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:C,index:S,geometry:I?P.geometry:no(y),patterns:{},dashes:{},sortKey:L};p.push(O)}h&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:S,sourceLayerIndex:C}=y;this.hasDependencies?(du("line",this.layers,i)?Lo("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,S,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(t[S].feature,x,S,C,this.index)}}update(t,i,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o,dashPositions:l})}addFeatures(t,i,o,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,o,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_u),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,o,l,h,p,y){const x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),C=x.get("line-cap"),I=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of i)this.addLine(L,t,S,C,I,P,l,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,dashPositions:p,canonical:l})}addLine(t,i,o,l,h,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=pu(t,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<t.length-1;K++)this.totalDistance+=t[K].dist(t[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=uc.types[i.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let I=0;for(;I<C-1&&t[I].equals(t[I+1]);)I++;if(C<(S?3:2))return;o==="bevel"&&(h=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let O,N,G,X,rt;this.e1=this.e2=-1,S&&(O=t[C-2],rt=t[I].sub(O)._unit()._perp());for(let K=I;K<C;K++){if(G=K===C-1?S?t[I+1]:void 0:t[K+1],G&&t[K].equals(G))continue;rt&&(X=rt),O&&(N=O),O=t[K],rt=G?G.sub(O)._unit()._perp():X,X=X||rt;let tt=X.add(rt);tt.x===0&&tt.y===0||tt._unit();const gt=X.x*rt.x+X.y*rt.y,yt=tt.x*rt.x+tt.y*rt.y,Dt=yt!==0?1/yt:1/0,Xt=2*Math.sqrt(2-2*yt),jt=yt<Za&&N&&G,Qt=X.x*rt.y-X.y*rt.x>0;if(jt&&K>I){const ae=O.dist(N);if(ae>2*P){const Vt=O.sub(O.sub(N)._mult(P/ae)._round());this.updateDistance(N,Vt),this.addCurrentVertex(Vt,X,0,0,L),N=Vt}}const oe=N&&G;let re=oe?o:S?"butt":l;if(oe&&re==="round"&&(Dt<p?re="miter":Dt<=2&&(re="fakeround")),re==="miter"&&Dt>h&&(re="bevel"),re==="bevel"&&(Dt>2&&(re="flipbevel"),Dt<h&&(re="miter")),N&&this.updateDistance(N,O),re==="miter")tt._mult(Dt),this.addCurrentVertex(O,tt,0,0,L);else if(re==="flipbevel"){if(Dt>100)tt=rt.mult(-1);else{const ae=Dt*X.add(rt).mag()/X.sub(rt).mag();tt._perp()._mult(ae*(Qt?-1:1))}this.addCurrentVertex(O,tt,0,0,L),this.addCurrentVertex(O,tt.mult(-1),0,0,L)}else if(re==="bevel"||re==="fakeround"){const ae=-Math.sqrt(Dt*Dt-1),Vt=Qt?ae:0,Me=Qt?0:ae;if(N&&this.addCurrentVertex(O,X,Vt,Me,L),re==="fakeround"){const Ce=Math.round(180*Xt/Math.PI/20);for(let Ie=1;Ie<Ce;Ie++){let ve=Ie/Ce;if(ve!==.5){const gn=ve-.5;ve+=ve*gn*(ve-1)*((1.0904+gt*(gt*(3.55645-1.43519*gt)-3.2452))*gn*gn+(.848013+gt*(.215638*gt-1.06021)))}const ti=rt.sub(X)._mult(ve)._add(X)._unit()._mult(Qt?-1:1);this.addHalfVertex(O,ti.x,ti.y,!1,Qt,0,L)}}G&&this.addCurrentVertex(O,rt,-Vt,-Me,L)}else if(re==="butt")this.addCurrentVertex(O,tt,0,0,L);else if(re==="square"){const ae=N?1:-1;this.addCurrentVertex(O,tt,ae,ae,L)}else re==="round"&&(N&&(this.addCurrentVertex(O,X,0,0,L),this.addCurrentVertex(O,X,1,1,L,!0)),G&&(this.addCurrentVertex(O,rt,-1,-1,L,!0),this.addCurrentVertex(O,rt,0,0,L)));if(jt&&K<C-1){const ae=O.dist(G);if(ae>2*P){const Vt=O.add(G.sub(O)._mult(P/ae)._round());this.updateDistance(O,Vt),this.addCurrentVertex(Vt,rt,0,0,L),O=Vt}}}}addCurrentVertex(t,i,o,l,h,p=!1){const y=i.y*l-i.x,x=-i.y-i.x*l;this.addHalfVertex(t,i.x+i.y*o,i.y-i.x*o,p,!1,o,h),this.addHalfVertex(t,y,x,p,!0,-l,h),this.distance>dc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,o,l,h,p))}addHalfVertex({x:t,y:i},o,l,h,p,y,x){const S=.5*(this.lineClips?this.scaledDistance*(dc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),x.primitiveLength++),p?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}hasLineDasharray(t){for(const i of t){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,i,o,l){for(const h of t){const p=h.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=h.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},S={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},C={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},I=`${x.dasharray.join(",")},${x.round}`,P=`${S.dasharray.join(",")},${S.round}`,L=`${C.dasharray.join(",")},${C.round}`;l.dashDependencies[I]=x,l.dashDependencies[P]=S,l.dashDependencies[L]=C,i.dashes[h.id]={min:I,mid:P,max:L}}}}let sa,Mf;de("LineBucket",fc,{omit:["layers","patternFeatures"]});var Td={get paint(){return Mf=Mf||new Zi({"line-opacity":new Ae(J.paint_line["line-opacity"]),"line-color":new Ae(J.paint_line["line-color"]),"line-translate":new ye(J.paint_line["line-translate"]),"line-translate-anchor":new ye(J.paint_line["line-translate-anchor"]),"line-width":new Ae(J.paint_line["line-width"]),"line-gap-width":new Ae(J.paint_line["line-gap-width"]),"line-offset":new Ae(J.paint_line["line-offset"]),"line-blur":new Ae(J.paint_line["line-blur"]),"line-dasharray":new _l(J.paint_line["line-dasharray"]),"line-pattern":new _l(J.paint_line["line-pattern"]),"line-gradient":new ur(J.paint_line["line-gradient"])})},get layout(){return sa=sa||new Zi({"line-cap":new ye(J.layout_line["line-cap"]),"line-join":new Ae(J.layout_line["line-join"]),"line-miter-limit":new ye(J.layout_line["line-miter-limit"]),"line-round-limit":new ye(J.layout_line["line-round-limit"]),"line-sort-key":new Ae(J.layout_line["line-sort-key"])})}};class Lm extends Ae{possiblyEvaluate(t,i){return i=new Si(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,o,l){return i=Mi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,o,l)}}let pc;class Cf extends Zn{constructor(t,i){super(t,Td,i),this.gradientVersion=0,pc||(pc=new Lm(Td.paint.properties["line-width"].specification),pc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=pc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new fc(t)}queryRadius(t){const i=t,o=El(sc("line-width",this,i),sc("line-gap-width",this,i)),l=sc("line-offset",this,i);return o/2+Math.abs(l)+dd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p}){const y=hu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-h.bearingInRadians,p),x=p/2*El(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),S=this.paint.get("line-offset").evaluate(i,o);return S&&(l=(function(C,I){const P=[];for(let L=0;L<C.length;L++){const O=C[L],N=[];for(let G=0;G<O.length;G++){const X=O[G-1],rt=O[G],K=O[G+1],tt=G===0?new dt(0,0):rt.sub(X)._unit()._perp(),gt=G===O.length-1?new dt(0,0):K.sub(rt)._unit()._perp(),yt=tt._add(gt)._unit(),Dt=yt.x*gt.x+yt.y*gt.y;Dt!==0&&yt._mult(1/Dt),N.push(yt._mult(I)._add(rt))}P.push(N)}return P})(l,S*p)),(function(C,I,P){for(let L=0;L<I.length;L++){const O=I[L];if(C.length>=3){for(let N=0;N<O.length;N++)if(ac(C,O[N]))return!0}if(ym(C,O,P))return!0}return!1})(y,l,x)}isTileClipped(){return!0}}function El(r,t){return t>0?t+2*r:r}const hr=Ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yu=Ai([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yh=Ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fo=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vp=Ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xp(r,t,i){return r.sections.forEach((o=>{o.text=(function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),Ss.applyArabicShaping&&(l=Ss.applyArabicShaping(l)),l})(o.text,t,i)})),r}Ai([{name:"triangle",components:3,type:"Uint16"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ai([{type:"Float32",name:"offsetX"}]),Ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ai([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Xn=24;const Ml={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},bp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ha={40:!0};function wp(r,t,i,o,l,h){if("fontStack"in t){const p=i[t.fontStack],y=p&&p[r];return y?y.metrics.advance*t.scale+l:0}{const p=o[t.imageName];return p?p.displaySize[0]*t.scale*Xn/h+l:0}}function oa(r,t,i,o){const l=Math.pow(r-t,2);return o?r<t?l/2:2*l:l+Math.abs(i)*i}function Om(r,t,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Tp(r,t,i,o,l,h){let p=null,y=oa(t,i,l,h);for(const x of o){const S=oa(t-x.x,i,l,h)+x.badness;S<=y&&(p=x,y=S)}return{index:r,x:t,priorBreak:p,badness:y}}function km(r){return r?km(r.priorBreak).concat(r.index):[]}class $a{constructor(t="",i=[],o=[]){this.text=t,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(t,i){const o=new $a;for(let l=0;l<t.sections.length;l++){const h=t.sections[l];h.image?o.addImageSection(h):o.addTextSection(h,i)}return o}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let i="",o={premature:!0,value:void 0};const l=t[Symbol.iterator]();let h=l.next();const p=t[Symbol.iterator]();p.next();let y=p.next();for(;!h.done;)i+=!y.done&&au(y.value.codePointAt(0))&&!Ml[y.value]||!o.premature&&au(o.value.codePointAt(0))&&!Ml[o.value]||!Ml[h.value]?h.value:Ml[h.value],o={value:h.value,premature:!1},h=l.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const t=this.text.match(/^\s*/),i=t?t[0].length:0,o=this.text.match(/\S\s*$/),l=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-l),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-l)}substring(t,i){const o=[...this.text].slice(t,i).join(""),l=this.sectionIndex.slice(t,i);return new $a(o,this.sections,l)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,i)=>Math.max(t,this.sections[i].scale)),0)}getMaxImageSize(t){let i=0,o=0;for(let l=0;l<this.length();l++){const h=this.getSection(l);if("imageName"in h){const p=t[h.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(t,i){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>o)))}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Ci("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):Ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,i,o,l,h){const p=[],y=this.determineAverageLineWidth(t,i,o,l,h),x=this.hasZeroWidthSpaces();let S=0,C=0;const I=this.text[Symbol.iterator]();let P=I.next();const L=this.text[Symbol.iterator]();L.next();let O=L.next();const N=this.text[Symbol.iterator]();N.next(),N.next();let G=N.next();for(;!P.done;){const X=this.getSection(C),rt=P.value.codePointAt(0);if(ad(rt)||(S+=wp(rt,X,o,l,t,h)),!O.done){const K=fl(rt),tt=O.value.codePointAt(0);(bp[rt]||K||"imageName"in X||!G.done&&Ha[tt])&&p.push(Tp(C+1,S,y,p,Om(rt,tt,K&&x),!1))}C++,P=I.next(),O=L.next(),G=N.next()}return km(Tp(this.length(),S,y,p,0,!0))}determineAverageLineWidth(t,i,o,l,h){let p=0,y=0;for(const x of this.text){const S=this.getSection(y);p+=wp(x.codePointAt(0),S,o,l,t,h),y++}return p/Math.max(1,Math.ceil(p/i))}}const vh=4294967296,Af=1/vh,mc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Df{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,o=this.length){for(;this.pos<o;){const l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,t(h,i,this),this.pos===p&&this.skip(l)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const i=this.buf;let o,l;return l=i[this.pos++],o=127&l,l<128?o:(l=i[this.pos++],o|=(127&l)<<7,l<128?o:(l=i[this.pos++],o|=(127&l)<<14,l<128?o:(l=i[this.pos++],o|=(127&l)<<21,l<128?o:(l=i[this.pos],o|=(15&l)<<28,(function(h,p,y){const x=y.buf;let S,C;if(C=x[y.pos++],S=(112&C)>>4,C<128||(C=x[y.pos++],S|=(127&C)<<3,C<128)||(C=x[y.pos++],S|=(127&C)<<10,C<128)||(C=x[y.pos++],S|=(127&C)<<17,C<128)||(C=x[y.pos++],S|=(127&C)<<24,C<128)||(C=x[y.pos++],S|=(1&C)<<31,C<128))return gc(h,S,p);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&mc?mc.decode(this.buf.subarray(i,t)):(function(o,l,h){let p="",y=l;for(;y<h;){const x=o[y];let S,C,I,P=null,L=x>239?4:x>223?3:x>191?2:1;if(y+L>h)break;L===1?x<128&&(P=x):L===2?(S=o[y+1],(192&S)==128&&(P=(31&x)<<6|63&S,P<=127&&(P=null))):L===3?(S=o[y+1],C=o[y+2],(192&S)==128&&(192&C)==128&&(P=(15&x)<<12|(63&S)<<6|63&C,(P<=2047||P>=55296&&P<=57343)&&(P=null))):L===4&&(S=o[y+1],C=o[y+2],I=o[y+3],(192&S)==128&&(192&C)==128&&(192&I)==128&&(P=(15&x)<<18|(63&S)<<12|(63&C)<<6|63&I,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,L=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),y+=L}return p})(this.buf,i,t)}readBytes(){const t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Af),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Af),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(i,o){let l,h;if(i>=0?(l=i%4294967296|0,h=i/4294967296|0):(l=~(-i%4294967296),h=~(-i/4294967296),4294967295^l?l=l+1|0:(l=0,h=h+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(l,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(h,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const i=this.pos;this.pos=(function(l,h,p){for(let y,x,S=0;S<h.length;S++){if(y=h.charCodeAt(S),y>55295&&y<57344){if(!x){y>56319||S+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):x=y;continue}if(y<56320){l[p++]=239,l[p++]=191,l[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(l[p++]=239,l[p++]=191,l[p++]=189,x=null);y<128?l[p++]=y:(y<2048?l[p++]=y>>6|192:(y<65536?l[p++]=y>>12|224:(l[p++]=y>>18|240,l[p++]=y>>12&63|128),l[p++]=y>>6&63|128),l[p++]=63&y|128)}return p})(this.buf,t,this.pos);const o=this.pos-i;o>=128&&Sp(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const i=t.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,i){this.pos++;const o=this.pos;t(i,this);const l=this.pos-o;l>=128&&Sp(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l}writeMessage(t,i,o){this.writeTag(t,2),this.writeRawMessage(i,o)}writePackedVarint(t,i){i.length&&this.writeMessage(t,Bm,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,If,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,zg,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,Ep,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,Ig,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,Pg,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,Fm,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,Nm,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,xh,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function gc(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Sp(r,t,i){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(let l=i.pos-1;l>=r;l--)i.buf[l+o]=i.buf[l]}function Bm(r,t){for(let i=0;i<r.length;i++)t.writeVarint(r[i])}function If(r,t){for(let i=0;i<r.length;i++)t.writeSVarint(r[i])}function Ep(r,t){for(let i=0;i<r.length;i++)t.writeFloat(r[i])}function Ig(r,t){for(let i=0;i<r.length;i++)t.writeDouble(r[i])}function zg(r,t){for(let i=0;i<r.length;i++)t.writeBoolean(r[i])}function Pg(r,t){for(let i=0;i<r.length;i++)t.writeFixed32(r[i])}function Fm(r,t){for(let i=0;i<r.length;i++)t.writeSFixed32(r[i])}function Nm(r,t){for(let i=0;i<r.length;i++)t.writeFixed64(r[i])}function xh(r,t){for(let i=0;i<r.length;i++)t.writeSFixed64(r[i])}function zf(r,t,i){r===1&&i.readMessage(jm,t)}function jm(r,t,i){if(r===3){const{id:o,bitmap:l,width:h,height:p,left:y,top:x,advance:S}=i.readMessage(Vm,{});t.push({id:o,bitmap:new uh({width:h+6,height:p+6},l),metrics:{width:h,height:p,left:y,top:x,advance:S}})}}function Vm(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}function Mp(r){let t=0,i=0;for(const p of r)t+=p.w*p.h,i=Math.max(i,p.w);r.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let l=0,h=0;for(const p of r)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const S=o.pop();S&&y<o.length&&(o[y]=S)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h,fill:t/(l*h)||0}}class Pf{constructor(t,{pixelRatio:i,version:o,stretchX:l,stretchY:h,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=l,this.stretchY=h,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Cp{constructor(t,i){const o={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(t,o,h),this.addImages(i,l,h);const{w:p,h:y}=Mp(h),x=new Pr({width:p||1,height:y||1});for(const S in t){const C=t[S],I=o[S].paddedRect;Pr.copy(C.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},C.data)}for(const S in i){const C=i[S],I=l[S].paddedRect,P=I.x+1,L=I.y+1,O=C.data.width,N=C.data.height;Pr.copy(C.data,x,{x:0,y:0},{x:P,y:L},C.data),Pr.copy(C.data,x,{x:0,y:N-1},{x:P,y:L-1},{width:O,height:1}),Pr.copy(C.data,x,{x:0,y:0},{x:P,y:L+N},{width:O,height:1}),Pr.copy(C.data,x,{x:O-1,y:0},{x:P-1,y:L},{width:1,height:N}),Pr.copy(C.data,x,{x:0,y:0},{x:P+O,y:L},{width:1,height:N})}this.image=x,this.iconPositions=o,this.patternPositions=l}addImages(t,i,o){for(const l in t){const h=t[l],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};o.push(p),i[l]=new Pf(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),i)}patchUpdatedImage(t,i,o){if(!t||!i||t.version===i.version)return;t.version=i.version;const[l,h]=t.tl;o.update(i.data,void 0,{x:l,y:h})}}var Cl;function _c(r,t,i,o,l,h,p,y,x,S,C,I,P,L,O){const N=$a.fromFeature(r,l);let G;I===R.ay.vertical&&N.verticalizePunctuation();let X=N.determineLineBreaks(S,h,t,o,L);const{processBidirectionalText:rt,processStyledBidirectionalText:K}=Ss;if(rt&&N.sections.length===1){G=[],X=X.map((Dt=>N.toCodeUnitIndex(Dt)));const yt=rt(N.toString(),X);for(const Dt of yt){const Xt=[...Dt].map((()=>0));G.push(new $a(Dt,N.sections,Xt))}}else if(K){G=[],X=X.map((jt=>N.toCodeUnitIndex(jt)));let yt=0;const Dt=[];for(const jt of N.text)Dt.push(...Array(jt.length).fill(N.sectionIndex[yt])),yt++;const Xt=K(N.text,Dt,X);for(const jt of Xt){const Qt=[];let oe="";for(const re of jt[0])Qt.push(jt[1][oe.length]),oe+=re;G.push(new $a(jt[0],N.sections,Qt))}}else G=(function(yt,Dt){const Xt=[];let jt=0;for(const Qt of Dt)Xt.push(yt.substring(jt,Qt)),jt=Qt;return jt<yt.length()&&Xt.push(yt.substring(jt,yt.length())),Xt})(N,X);const tt=[],gt={positionedLines:tt,text:N.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:I,iconsInText:!1,verticalizable:!1};return(function(yt,Dt,Xt,jt,Qt,oe,re,ae,Vt,Me,Ce,Ie){let ve=0,ti=0,gn=0,ir=0;const $r=ae==="right"?1:ae==="left"?0:.5,Uo=Xn/Ie;let Aa=0;for(const Fn of Qt){Fn.trim();const Lr=Fn.getMaxScale(),ua={positionedGlyphs:[],lineOffset:0};yt.positionedLines[Aa]=ua;const ca=ua.positionedGlyphs;let Wa=0;if(!Fn.length()){ti+=oe,++Aa;continue}const Yr=Um(jt,Fn,Uo);let Ka=0;for(const xr of Fn.text){const Tn=Fn.getSection(Ka),nr=xr.codePointAt(0),zn=Ap(Vt,Ce,nr),br={glyph:nr,imageName:null,x:ve,y:ti+-17,vertical:zn,scale:1,fontStack:"",sectionIndex:Fn.getSectionIndex(Ka),metrics:null,rect:null};let Dc;if("fontStack"in Tn){if(Dc=Rg(Tn,nr,zn,Yr,Dt,Xt),!Dc)continue;br.fontStack=Tn.fontStack}else{if(yt.iconsInText=!0,Tn.scale*=Uo,Dc=Gm(Tn,zn,Lr,Yr,jt),!Dc)continue;Wa=Math.max(Wa,Dc.imageOffset),br.imageName=Tn.imageName}const{rect:Pl,metrics:lm,baselineOffset:Rh}=Dc;br.y+=Rh,br.scale=Tn.scale,br.metrics=lm,br.rect=Pl,ca.push(br),zn?(yt.verticalizable=!0,ve+=("imageName"in Tn?lm.advance:Xn)*Tn.scale+Me):ve+=lm.advance*Tn.scale+Me,Ka++}ca.length!==0&&(gn=Math.max(ve-Me,gn),Lg(ca,0,ca.length-1,$r)),ve=0,ua.lineOffset=Math.max(Wa,(Lr-1)*Xn);const Go=oe*Lr+Wa;ti+=Go,ir=Math.max(Go,ir),++Aa}const{horizontalAlign:Rr,verticalAlign:Xr}=Rf(re);(function(Fn,Lr,ua,ca,Wa,Yr,Ka,Go,xr){const Tn=(Lr-ua)*Wa;let nr=0;nr=Yr!==Ka?-Go*ca- -17:-ca*xr*Ka+.5*Ka;for(const zn of Fn)for(const br of zn.positionedGlyphs)br.x+=Tn,br.y+=nr})(yt.positionedLines,$r,Rr,Xr,gn,ir,oe,ti,Qt.length),yt.top+=-Xr*ti,yt.bottom=yt.top+ti,yt.left+=-Rr*gn,yt.right=yt.left+gn})(gt,t,i,o,G,p,y,x,I,S,P,O),!(function(yt){for(const Dt of yt)if(Dt.positionedGlyphs.length!==0)return!1;return!0})(tt)&&gt}function Rf(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Um(r,t,i){const o=t.getMaxScale()*Xn,{maxImageWidth:l,maxImageHeight:h}=t.getMaxImageSize(r),p=Math.max(o,h*i);return{verticalLineContentWidth:Math.max(o,l*i),horizontalLineContentHeight:p}}function Vi(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function Ap(r,t,i){return!(r===R.ay.horizontal||!t&&!va(i)||t&&(ad(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Rg(r,t,i,o,l,h){const p=h[r.fontStack],y=(function(S,C,I,P){if(S&&S.rect)return S;const L=C[I.fontStack],O=L&&L[P];return O?{rect:null,metrics:O.metrics}:null})(p&&p[t],l,r,t);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-r.scale*Xn;else{const S=Vi(r.verticalAlign);x=(o.horizontalLineContentHeight-r.scale*Xn)*S}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function Gm(r,t,i,o,l){const h=l[r.imageName];if(!h)return null;const p=h.paddedRect,y=h.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let S;if(t)S=o.verticalLineContentWidth-y[1]*r.scale;else{const C=Vi(r.verticalAlign);S=(o.horizontalLineContentHeight-y[1]*r.scale)*C}return{rect:p,metrics:x,baselineOffset:S,imageOffset:(t?y[0]:y[1])*r.scale-Xn*i}}function Lg(r,t,i,o){if(o===0)return;const l=r[i],h=(r[i].x+l.metrics.advance*l.scale)*o;for(let p=t;p<=i;p++)r[p].x-=h}function Og(r,t,i){const{horizontalAlign:o,verticalAlign:l}=Rf(i),h=t[0]-r.displaySize[0]*o,p=t[1]-r.displaySize[1]*l;return{image:r,top:p,bottom:p+r.displaySize[1],left:h,right:h+r.displaySize[0]}}function qm(r){var t,i;let o=r.left,l=r.top,h=r.right-o,p=r.bottom-l;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",S=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&h/p<S||y==="proportional"){const C=Math.ceil(p*S);o*=C/h,h=C}}else if(y==="proportional"&&x==="stretchOnly"&&S!==0&&h/p>S){const C=Math.ceil(h/S);l*=C/p,p=C}return{x1:o,y1:l,x2:o+h,y2:l+p}}function Sd(r,t,i,o,l,h){const p=r.image;let y;if(p.content){const G=p.content,X=p.pixelRatio||1;y=[G[0]/X,G[1]/X,p.displaySize[0]-G[2]/X,p.displaySize[1]-G[3]/X]}const x=t.left*h,S=t.right*h;let C,I,P,L;i==="width"||i==="both"?(L=l[0]+x-o[3],I=l[0]+S+o[1]):(L=l[0]+(x+S-p.displaySize[0])/2,I=L+p.displaySize[0]);const O=t.top*h,N=t.bottom*h;return i==="height"||i==="both"?(C=l[1]+O-o[0],P=l[1]+N+o[2]):(C=l[1]+(O+N-p.displaySize[1])/2,P=C+p.displaySize[1]),{image:p,top:C,right:I,bottom:P,left:L,collisionPadding:y}}de("ImagePosition",Pf),de("ImageAtlas",Cp),R.ay=void 0,(Cl=R.ay||(R.ay={}))[Cl.none=0]="none",Cl[Cl.horizontal=1]="horizontal",Cl[Cl.vertical=2]="vertical",Cl[Cl.horizontalOnly=3]="horizontalOnly";const Sa=128,No=32640;function Ed(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Si(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let h=0;for(;h<o.length&&o[h]<=r;)h++;h=Math.max(0,h-1);let p=h;for(;p<o.length&&o[p]<r+1;)p++;p=Math.min(o.length-1,p);const y=o[h],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Si(y)),maxSize:i.evaluate(new Si(x)),interpolationType:l}}}function Md(r,t,i){let o="never";const l=r.get(t);return l?o=l:r.get(i)&&(o="always"),o}const vu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xa(r,t,i,o,l,h,p,y,x,S,C,I,P){const L=y?Math.min(No,Math.round(y[0])):0,O=y?Math.min(No,Math.round(y[1])):0;r.emplaceBack(t,i,Math.round(32*o),Math.round(32*l),h,p,(L<<1)+(x?1:0),O,16*S,16*C,256*I,256*P)}function yc(r,t,i){r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i)}function kg(r){for(const t of r.sections)if(Ys(t.text))return!0;return!1}class Lf{constructor(t){this.layoutVertexArray=new It,this.indexArray=new ne,this.programConfigurations=t,this.segments=new Re,this.dynamicLayoutVertexArray=new Mt,this.opacityVertexArray=new Ct,this.hasVisibleVertices=!1,this.placedSymbolArray=new E}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hr.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,yu.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,vu,!0),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}de("SymbolBuffers",Lf);class Of{constructor(t,i,o){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Re,this.collisionVertexArray=new ie}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,yh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}de("CollisionBuffers",Of);class vc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ed(this.zoom,i["text-size"]),this.iconSizeData=Ed(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=Md(o,"text-overlap","text-allow-overlap")!=="never"||Md(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>R.ay[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Lf(new io(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Lf(new io(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new B,this.lineVertexArray=new k,this.symbolInstances=new z,this.textAnchorOffsets=new H}calculateGlyphDependencies(t,i,o,l,h){for(const p of t)if(i[p.codePointAt(0)]=!0,(o||l)&&h){const y=Ml[p];y&&(i[y.codePointAt(0)]=!0)}}populate(t,i,o){const l=this.layers[0],h=l.layout,p=h.get("text-font"),y=h.get("text-field"),x=h.get("icon-image"),S=(y.value.kind!=="constant"||y.value.value instanceof vn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),C=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,I=h.get("symbol-sort-key");if(this.features=[],!S&&!C)return;const P=i.iconDependencies,L=i.glyphDependencies,O=i.availableImages,N=new Si(this.zoom);for(const{feature:G,id:X,index:rt,sourceLayerIndex:K}of t){const tt=l._featureFilter.needGeometry,gt=zr(G,tt);if(!l._featureFilter.filter(N,gt,o))continue;let yt,Dt;if(tt||(gt.geometry=no(G)),S){const jt=l.getValueAndResolveTokens("text-field",gt,o,O),Qt=vn.factory(jt),oe=this.hasRTLText=this.hasRTLText||kg(Qt);(!oe||Ss.getRTLTextPluginStatus()==="unavailable"||oe&&Ss.isParsed())&&(yt=xp(Qt,l,gt))}if(C){const jt=l.getValueAndResolveTokens("icon-image",gt,o,O);Dt=jt instanceof xn?jt:xn.fromString(jt)}if(!yt&&!Dt)continue;const Xt=this.sortFeaturesByKey?I.evaluate(gt,{},o):void 0;if(this.features.push({id:X,text:yt,icon:Dt,index:rt,sourceLayerIndex:K,geometry:gt.geometry,properties:G.properties,type:uc.types[G.type],sortKey:Xt}),Dt&&(P[Dt.name]=!0),yt){const jt=p.evaluate(gt,{},o).join(","),Qt=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(R.ay.vertical)>=0;for(const oe of yt.sections)if(oe.image)P[oe.image.name]=!0;else{const re=nu(yt.toString()),ae=oe.fontStack||jt,Vt=L[ae]=L[ae]||{};this.calculateGlyphDependencies(oe.text,Vt,Qt,this.allowVerticalPlacement,re)}}}h.get("symbol-placement")==="line"&&(this.features=(function(G){const X={},rt={},K=[];let tt=0;function gt(jt){K.push(G[jt]),tt++}function yt(jt,Qt,oe){const re=rt[jt];return delete rt[jt],rt[Qt]=re,K[re].geometry[0].pop(),K[re].geometry[0]=K[re].geometry[0].concat(oe[0]),re}function Dt(jt,Qt,oe){const re=X[Qt];return delete X[Qt],X[jt]=re,K[re].geometry[0].shift(),K[re].geometry[0]=oe[0].concat(K[re].geometry[0]),re}function Xt(jt,Qt,oe){const re=oe?Qt[0][Qt[0].length-1]:Qt[0][0];return`${jt}:${re.x}:${re.y}`}for(let jt=0;jt<G.length;jt++){const Qt=G[jt],oe=Qt.geometry,re=Qt.text?Qt.text.toString():null;if(!re){gt(jt);continue}const ae=Xt(re,oe),Vt=Xt(re,oe,!0);if(ae in rt&&Vt in X&&rt[ae]!==X[Vt]){const Me=Dt(ae,Vt,oe),Ce=yt(ae,Vt,K[Me].geometry);delete X[ae],delete rt[Vt],rt[Xt(re,K[Ce].geometry,!0)]=Ce,K[Me].geometry=null}else ae in rt?yt(ae,Vt,oe):Vt in X?Dt(ae,Vt,oe):(gt(jt),X[ae]=tt-1,rt[Vt]=tt-1)}return K.filter((jt=>jt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((G,X)=>G.sortKey-X.sortKey))}update(t,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const o=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(i[t.segment+1]),h=t.dist(i[t.segment]);const p={};for(let y=t.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:l},y<i.length-1&&(l+=i[y+1].dist(i[y]));for(let y=t.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:h},y>0&&(h+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,i,o,l,h,p,y,x,S,C,I,P){const L=t.indexArray,O=t.layoutVertexArray,N=t.segments.prepareSegment(4*i.length,O,L,this.canOverlap?p.sortKey:void 0),G=this.glyphOffsetArray.length,X=N.vertexLength,rt=this.allowVerticalPlacement&&y===R.ay.vertical?Math.PI/2:0,K=p.text&&p.text.sections;for(let tt=0;tt<i.length;tt++){const{tl:gt,tr:yt,bl:Dt,br:Xt,tex:jt,pixelOffsetTL:Qt,pixelOffsetBR:oe,minFontScaleX:re,minFontScaleY:ae,glyphOffset:Vt,isSDF:Me,sectionIndex:Ce}=i[tt],Ie=N.vertexLength,ve=Vt[1];Xa(O,x.x,x.y,gt.x,ve+gt.y,jt.x,jt.y,o,Me,Qt.x,Qt.y,re,ae),Xa(O,x.x,x.y,yt.x,ve+yt.y,jt.x+jt.w,jt.y,o,Me,oe.x,Qt.y,re,ae),Xa(O,x.x,x.y,Dt.x,ve+Dt.y,jt.x,jt.y+jt.h,o,Me,Qt.x,oe.y,re,ae),Xa(O,x.x,x.y,Xt.x,ve+Xt.y,jt.x+jt.w,jt.y+jt.h,o,Me,oe.x,oe.y,re,ae),yc(t.dynamicLayoutVertexArray,x,rt),L.emplaceBack(Ie,Ie+2,Ie+1),L.emplaceBack(Ie+1,Ie+2,Ie+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),tt!==i.length-1&&Ce===i[tt+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,p,p.index,{imagePositions:{},canonical:P,formattedSection:K&&K[Ce]})}t.placedSymbolArray.emplaceBack(x.x,x.y,G,this.glyphOffsetArray.length-G,X,S,C,x.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],y,0,!1,0,I)}_addCollisionDebugVertex(t,i,o,l,h,p){return i.emplaceBack(0,0),t.emplaceBack(o.x,o.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,i,o,l,h,p,y){const x=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),S=x.vertexLength,C=h.layoutVertexArray,I=h.collisionVertexArray,P=y.anchorX,L=y.anchorY;this._addCollisionDebugVertex(C,I,p,P,L,new dt(t,i)),this._addCollisionDebugVertex(C,I,p,P,L,new dt(o,i)),this._addCollisionDebugVertex(C,I,p,P,L,new dt(o,l)),this._addCollisionDebugVertex(C,I,p,P,L,new dt(t,l)),x.vertexLength+=4;const O=h.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,o,l){for(let h=t;h<i;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Of(At,Fo.members,qt),this.iconCollisionBox=new Of(At,Fo.members,qt);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,o,l,h,p,y,x,S){const C={};for(let I=i;I<o;I++){const P=t.get(I);C.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,anchorPointX:P.anchorPointX,anchorPointY:P.anchorPointY},C.textFeatureIndex=P.featureIndex;break}for(let I=l;I<h;I++){const P=t.get(I);C.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,anchorPointX:P.anchorPointX,anchorPointY:P.anchorPointY},C.verticalTextFeatureIndex=P.featureIndex;break}for(let I=p;I<y;I++){const P=t.get(I);C.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,anchorPointX:P.anchorPointX,anchorPointY:P.anchorPointY},C.iconFeatureIndex=P.featureIndex;break}for(let I=x;I<S;I++){const P=t.get(I);C.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,anchorPointX:P.anchorPointX,anchorPointY:P.anchorPointY},C.verticalIconFeatureIndex=P.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const o=t.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<l;h+=4)t.indexArray.emplaceBack(h,h+2,h+1),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),o=Math.cos(t),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);l.push(0|Math.round(i*x.anchorX+o*x.anchorY)),h.push(x.featureIndex)}return p.sort(((y,x)=>l[y]-l[x]||h[x]-h[y])),p}addToSortKeyRanges(t,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dp,Zm;de("SymbolBucket",vc,{omit:["layers","collisionBoxArray","features","compareText"]}),vc.MAX_GLYPHS=65535,vc.addDynamicAttributes=yc;var Cd={get paint(){return Zm=Zm||new Zi({"icon-opacity":new Ae(J.paint_symbol["icon-opacity"]),"icon-color":new Ae(J.paint_symbol["icon-color"]),"icon-halo-color":new Ae(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ae(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ae(J.paint_symbol["icon-halo-blur"]),"icon-translate":new ye(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new ye(J.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ae(J.paint_symbol["text-opacity"]),"text-color":new Ae(J.paint_symbol["text-color"],{runtimeType:fr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ae(J.paint_symbol["text-halo-color"]),"text-halo-width":new Ae(J.paint_symbol["text-halo-width"]),"text-halo-blur":new Ae(J.paint_symbol["text-halo-blur"]),"text-translate":new ye(J.paint_symbol["text-translate"]),"text-translate-anchor":new ye(J.paint_symbol["text-translate-anchor"])})},get layout(){return Dp=Dp||new Zi({"symbol-placement":new ye(J.layout_symbol["symbol-placement"]),"symbol-spacing":new ye(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ye(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ae(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ye(J.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ye(J.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ye(J.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ye(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new ye(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ye(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ae(J.layout_symbol["icon-size"]),"icon-text-fit":new ye(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ye(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ae(J.layout_symbol["icon-image"]),"icon-rotate":new Ae(J.layout_symbol["icon-rotate"]),"icon-padding":new Ae(J.layout_symbol["icon-padding"]),"icon-keep-upright":new ye(J.layout_symbol["icon-keep-upright"]),"icon-offset":new Ae(J.layout_symbol["icon-offset"]),"icon-anchor":new Ae(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ye(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ye(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ye(J.layout_symbol["text-rotation-alignment"]),"text-field":new Ae(J.layout_symbol["text-field"]),"text-font":new Ae(J.layout_symbol["text-font"]),"text-size":new Ae(J.layout_symbol["text-size"]),"text-max-width":new Ae(J.layout_symbol["text-max-width"]),"text-line-height":new ye(J.layout_symbol["text-line-height"]),"text-letter-spacing":new Ae(J.layout_symbol["text-letter-spacing"]),"text-justify":new Ae(J.layout_symbol["text-justify"]),"text-radial-offset":new Ae(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ye(J.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ae(J.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ae(J.layout_symbol["text-anchor"]),"text-max-angle":new ye(J.layout_symbol["text-max-angle"]),"text-writing-mode":new ye(J.layout_symbol["text-writing-mode"]),"text-rotate":new Ae(J.layout_symbol["text-rotate"]),"text-padding":new ye(J.layout_symbol["text-padding"]),"text-keep-upright":new ye(J.layout_symbol["text-keep-upright"]),"text-transform":new Ae(J.layout_symbol["text-transform"]),"text-offset":new Ae(J.layout_symbol["text-offset"]),"text-allow-overlap":new ye(J.layout_symbol["text-allow-overlap"]),"text-overlap":new ye(J.layout_symbol["text-overlap"]),"text-ignore-placement":new ye(J.layout_symbol["text-ignore-placement"]),"text-optional":new ye(J.layout_symbol["text-optional"])})}};class Ip{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:fi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}de("FormatSectionOverride",Ip,{omit:["defaultValue"]});class Ad extends Zn{constructor(t,i){super(t,Cd,i)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const h of o)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,o,l){const h=this.layout.get(t).evaluate(i,{},o,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||$u(p.value)||!h?h:(function(y,x){return x.replace(/{([^{}]+)}/g,((S,C)=>y&&C in y?String(y[C]):""))})(i.properties,h)}createBucket(t){return new vc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Cd.paint.overridableProperties){if(!Ad.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),o=new Ip(i),l=new Ql(o,i.property.specification);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new wo("source",l):new Ar("composite",l,i.value.zoomStops),this.paint._values[t]=new ba(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Ad.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const o=t.get("text-field"),l=Cd.paint.properties[i];let h=!1;const p=y=>{for(const x of y)if(l.overrides&&l.overrides.hasOverride(x))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof vn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=S=>{h||(S instanceof Bs&&Bi(S.value)===fo?p(S.value.sections):S instanceof Qo?p(S.sections):S.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return h}}let Hm;var zp={get paint(){return Hm=Hm||new Zi({"background-color":new ye(J.paint_background["background-color"]),"background-pattern":new nh(J.paint_background["background-pattern"]),"background-opacity":new ye(J.paint_background["background-opacity"])})}};class Pp extends Zn{constructor(t,i){super(t,zp,i)}}class Bg extends Zn{constructor(t,i){super(t,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Fg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Dd={once:!0},Rp=63710088e-1;class Al{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Al(Ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,o=this.lat*i,l=t.lat*i,h=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((t.lng-this.lng)*i);return Rp*Math.acos(Math.min(h,1))}static convert(t){if(t instanceof Al)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Al(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Al(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const oi=2*Math.PI*Rp;function kf(r){return oi*Math.cos(r*Math.PI/180)}function Id(r){return(180+r)/360}function Bf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Lp(r,t){return r/kf(t)}function Ff(r){return 360*r-180}function xu(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function zd(r,t){return r*kf(xu(t))}class Pd{constructor(t,i,o=0){this.x=+t,this.y=+i,this.z=+o}static fromLngLat(t,i=0){const o=Al.convert(t);return new Pd(Id(o.lng),Bf(o.lat),Lp(i,o.lat))}toLngLat(){return new Al(Ff(this.x),xu(this.y))}toAltitude(){return zd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oi*(t=xu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Op(r,t,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class kp{constructor(t,i,o){if(!(function(l,h,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||h<0||h>=Math.pow(2,l))})(t,i,o))throw new Error(`x=${i}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=o,this.key=xc(0,t,t,i,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,o){const l=(p=this.y,y=this.z,x=Op(256*(h=this.x),256*(p=Math.pow(2,y)-p-1),y),S=Op(256*(h+1),256*(p+1),y),x[0]+","+x[1]+","+S[0]+","+S[1]);var h,p,y,x,S;const C=(function(I,P,L){let O,N="";for(let G=I;G>0;G--)O=1<<G-1,N+=(P&O?1:0)+(L&O?2:0);return N})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new dt((t.x*i-this.x)*De,(t.y*i-this.y)*De)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $m{constructor(t,i){this.wrap=t,this.canonical=i,this.key=xc(t,i.z,i.z,i.x,i.y)}}class Ea{constructor(t,i,o,l,h){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=i,this.canonical=new kp(o,+l,+h),this.key=xc(i,t,o,l,h)}clone(){return new Ea(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new Ea(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ea(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?xc(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):xc(this.wrap*+i,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-t.canonical.z;return!(i<0)&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new Ea(i,this.wrap,i,o,l),new Ea(i,this.wrap,i,o+1,l),new Ea(i,this.wrap,i,o,l+1),new Ea(i,this.wrap,i,o+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ea(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $m(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Pd(t.x-this.wrap,t.y))}}function xc(r,t,i,o,l){(r*=2)<0&&(r=-1*r-1);const h=1<<i;return(h*h*r+h*l+o).toString(36)+i.toString(36)+t.toString(36)}function Di(r,t){return t?r.properties[t]:r.id}function Bp(r,t){const i={id:r.id};if(t.removeAllProperties&&(delete r.removeProperties,delete r.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(const o of t.removeProperties){const l=r.addOrUpdateProperties.findIndex((h=>h.key===o));l>-1&&r.addOrUpdateProperties.splice(l,1)}return(r.removeAllProperties||t.removeAllProperties)&&(i.removeAllProperties=!0),(r.removeProperties||t.removeProperties)&&(i.removeProperties=[...r.removeProperties||[],...t.removeProperties||[]]),(r.addOrUpdateProperties||t.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...r.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(r.newGeometry||t.newGeometry)&&(i.newGeometry=t.newGeometry||r.newGeometry),i}function yr(r){var t,i;if(!r)return{};const o={};return o.removeAll=r.removeAll,o.remove=new Set(r.remove||[]),o.add=new Map((t=r.add)===null||t===void 0?void 0:t.map((l=>[l.id,l]))),o.update=new Map((i=r.update)===null||i===void 0?void 0:i.map((l=>[l.id,l]))),o}de("CanonicalTileID",kp),de("OverscaledTileID",Ea,{omit:["terrainRttPosMatrix32f"]});class Xm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const o=t[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Fp{constructor(t,i,o,l,h){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=o,t._y=l,this.properties=t.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class bh{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,i,o){this._name=t,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class wh extends bh{}class Rd extends wh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Th extends wh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Np extends bh{delta;constructor(t,i,o,l){super(t,i,l),this.delta=o}}class Nf extends Np{constructor(t,i,o,l){super(t,Int32Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class Ld extends bh{constructor(t,i,o){super(t,Int32Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}class jp{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,i,o,l,h=4096){this._name=t,this._geometryVector=i,this._idVector=o,this._propertyVectors=l,this._extent=h}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){const t=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const l=t?.next().value,h={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(h[y]=x)}i++,yield{id:o,geometry:l,properties:h}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const t=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const h={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,S=y.getValue(o);S!==null&&(p[x]=S)}t.push({id:l,geometry:h,properties:p})}return t}containsMaxSaveIntegerValues(t){return t instanceof Rd||t instanceof Ld&&t instanceof Nf||t instanceof Th}}class Ng{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var dr,Je,jo,ao,bc,Yn,Wn,Kn,jf,Ya;(function(r){r.PRESENT="PRESENT",r.DATA="DATA",r.OFFSET="OFFSET",r.LENGTH="LENGTH"})(dr||(dr={}));class Vp{_dictionaryType;_offsetType;_lengthType;constructor(t,i,o){this._dictionaryType=t,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function kn(r,t,i){const o=new Int32Array(i);let l=0,h=t.get();for(let p=0;p<o.length;p++){let y=r[h++],x=127&y;y<128||(y=r[h++],x|=(127&y)<<7,y<128||(y=r[h++],x|=(127&y)<<14,y<128||(y=r[h++],x|=(127&y)<<21,y<128||(y=r[h++],x|=(15&y)<<28)))),o[l++]=x}return t.set(h),o}function Sh(r,t,i){const o=new BigInt64Array(i);for(let l=0;l<o.length;l++)o[l]=Wm(r,t);return o}function Up(r,t){let i,o;return o=r[t.get()],t.increment(),i=127&o,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<7,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<14,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<21,o<128?i:(o=r[t.get()],i|=(15&o)<<28,(function(l,h,p){let y,x;if(x=h[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=h[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=h[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(l>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,r,t)))))}function Ym(r,t,i,o){throw new Error("FastPFor is not implemented yet.")}function vr(r){return r>>>1^-(1&r)}function bu(r){return r>>1n^-(1n&r)}function Wm(r,t){let i=0n,o=0,l=t.get();for(;l<r.length;){const h=r[l++];if(i|=BigInt(127&h)<<BigInt(o),!(128&h))break;if(o+=7,o>=64)throw new Error("Varint too long")}return t.set(l),i}function Gp(r,t,i){const o=new Int32Array(i);let l=0;for(let h=0;h<t;h++){const p=r[h];o.fill(r[h+t],l,l+p),l+=p}return o}function qp(r,t,i){const o=new BigInt64Array(i);let l=0;for(let h=0;h<t;h++){const p=Number(r[h]);o.fill(r[h+t],l,l+p),l+=p}return o}function Eh(r,t,i){const o=new Float64Array(i);let l=0;for(let h=0;h<t;h++){const p=r[h];o.fill(r[h+t],l,l+p),l+=p}return o}function Ma(r){const t=r.length/4*4;let i=1;if(t>=4)for(let o=r[0];i<t-4;i+=4)o=r[i]+=o,o=r[i+1]+=o,o=r[i+2]+=o,o=r[i+3]+=o;for(;i!=r.length;)r[i]+=r[i-1],++i}function Zp(r){r[0]=r[0]>>>1^-(1&r[0]),r[1]=r[1]>>>1^-(1&r[1]);const t=r.length/4*4;let i=2;if(t>=4)for(;i<t-4;i+=4){const o=r[i],l=r[i+1],h=r[i+2],p=r[i+3];r[i]=(o>>>1^-(1&o))+r[i-2],r[i+1]=(l>>>1^-(1&l))+r[i-1],r[i+2]=(h>>>1^-(1&h))+r[i],r[i+3]=(p>>>1^-(1&p))+r[i+1]}for(;i!=r.length;i+=2)r[i]=(r[i]>>>1^-(1&r[i]))+r[i-2],r[i+1]=(r[i+1]>>>1^-(1&r[i+1]))+r[i-1]}function so(r,t,i){return Math.min(i,Math.max(t,r))}(function(r){r.NONE="NONE",r.DELTA="DELTA",r.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",r.RLE="RLE",r.MORTON="MORTON",r.PDE="PDE"})(Je||(Je={})),(function(r){r.NONE="NONE",r.FAST_PFOR="FAST_PFOR",r.VARINT="VARINT",r.ALP="ALP"})(jo||(jo={})),(function(r){r.NONE="NONE",r.SINGLE="SINGLE",r.SHARED="SHARED",r.VERTEX="VERTEX",r.MORTON="MORTON",r.FSST="FSST"})(ao||(ao={})),(function(r){r.VERTEX="VERTEX",r.INDEX="INDEX",r.STRING="STRING",r.KEY="KEY"})(bc||(bc={})),(function(r){r.VAR_BINARY="VAR_BINARY",r.GEOMETRIES="GEOMETRIES",r.PARTS="PARTS",r.RINGS="RINGS",r.TRIANGLES="TRIANGLES",r.SYMBOL="SYMBOL",r.DICTIONARY="DICTIONARY"})(Yn||(Yn={}));class la{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,i,o,l,h,p,y){this._physicalStreamType=t,this._logicalStreamType=i,this._logicalLevelTechnique1=o,this._logicalLevelTechnique2=l,this._physicalLevelTechnique=h,this._numValues=p,this._byteLength=y}static decode(t,i){const o=t[i.get()],l=Object.values(dr)[o>>4];let h=null;switch(l){case dr.DATA:h=new Vp(Object.values(ao)[15&o]);break;case dr.OFFSET:h=new Vp(null,Object.values(bc)[15&o]);break;case dr.LENGTH:h=new Vp(null,null,Object.values(Yn)[15&o])}i.increment();const p=t[i.get()],y=Object.values(Je)[p>>5],x=Object.values(Je)[p>>2&7],S=Object.values(jo)[3&p];i.increment();const C=kn(t,i,2);return new la(l,h,y,x,S,C[0],C[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class Vf extends la{num_bits;coordinate_shift;constructor(t,i,o,l,h,p,y,x,S){super(t,i,o,l,h,p,y),this.num_bits=x,this.coordinate_shift=S}static decode(t,i){const o=la.decode(t,i),l=kn(t,i,2);return new Vf(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=kn(i,o,2);return new Vf(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class Od extends la{_runs;_numRleValues;constructor(t,i,o,l,h,p,y,x,S){super(t,i,o,l,h,p,y),this._runs=x,this._numRleValues=S}static decode(t,i){const o=la.decode(t,i),l=kn(t,i,2);return new Od(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=kn(i,o,2);return new Od(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class Bn{static decode(t,i){const o=la.decode(t,i);return o.logicalLevelTechnique1===Je.MORTON?Vf.decodePartial(o,t,i):Je.RLE!==o.logicalLevelTechnique1&&Je.RLE!==o.logicalLevelTechnique2||jo.NONE===o.physicalLevelTechnique?o:Od.decodePartial(o,t,i)}}(function(r){r[r.FLAT=0]="FLAT",r[r.CONST=1]="CONST",r[r.SEQUENCE=2]="SEQUENCE",r[r.DICTIONARY=3]="DICTIONARY",r[r.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Wn||(Wn={}));class Is{values;_size;constructor(t,i){this.values=t,this._size=i}get(t){const i=Math.floor(t/8);return(this.values[i]>>t%8&1)==1}set(t,i){const o=Math.floor(t/8);this.values[o]=this.values[o]|(i?1:0)<<t%8}getInt(t){const i=Math.floor(t/8);return this.values[i]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class Ue{constructor(){}static decodeIntStream(t,i,o,l,h){const p=Ue.decodePhysicalLevelTechnique(t,i,o);return this.decodeIntBuffer(p,o,l,h)}static decodeLengthStreamToOffsetBuffer(t,i,o){const l=Ue.decodePhysicalLevelTechnique(t,i,o);return this.decodeLengthToOffsetBuffer(l,o)}static decodePhysicalLevelTechnique(t,i,o){const l=o.physicalLevelTechnique;if(l===jo.FAST_PFOR)return Ym();if(l===jo.VARINT)return kn(t,i,o.numValues);if(l===jo.NONE){const h=i.get();i.add(o.byteLength);const p=t.subarray(h,i.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,i,o,l){const h=Ue.decodePhysicalLevelTechnique(t,i,o);if(h.length===1){const p=h[0];return l?vr(p):p}return l?(function(p){return vr(p[1])})(h):(function(p){return p[1]})(h)}static decodeSequenceIntStream(t,i,o){return(function(l){if(l.length==2){const h=vr(l[1]);return[h,h]}return[vr(l[2]),vr(l[3])]})(Ue.decodePhysicalLevelTechnique(t,i,o))}static decodeSequenceLongStream(t,i,o){return(function(l){if(l.length==2){const h=bu(l[1]);return[h,h]}return[bu(l[2]),bu(l[3])]})(Sh(t,i,o.numValues))}static decodeLongStream(t,i,o,l){const h=Sh(t,i,o.numValues);return this.decodeLongBuffer(h,o,l)}static decodeLongFloat64Stream(t,i,o,l){const h=(function(p,y,x){const S=new Float64Array(y);for(let C=0;C<y;C++)S[C]=Up(p,x);return S})(t,o.numValues,i);return this.decodeFloat64Buffer(h,o,l)}static decodeConstLongStream(t,i,o,l){const h=Sh(t,i,o.numValues);if(h.length===1){const p=h[0];return l?bu(p):p}return l?(function(p){return bu(p[1])})(h):(function(p){return p[1]})(h)}static decodeIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case Je.DELTA:return i.logicalLevelTechnique2===Je.RLE?(function(h,p,y){const x=new Int32Array(y);let S=0,C=0;for(let I=0;I<p;I++){const P=h[I],L=vr(h[I+p]);for(let O=0;O<P;O++)C+=L,x[S++]=C}return x})(t,i.runs,i.numRleValues):((function(h){h[0]=h[0]>>>1^-(1&h[0]);const p=h.length/4*4;let y=1;if(p>=4)for(;y<p-4;y+=4){const x=h[y],S=h[y+1],C=h[y+2],I=h[y+3];h[y]=(x>>>1^-(1&x))+h[y-1],h[y+1]=(S>>>1^-(1&S))+h[y],h[y+2]=(C>>>1^-(1&C))+h[y+1],h[y+3]=(I>>>1^-(1&I))+h[y+2]}for(;y!=h.length;++y)h[y]=(h[y]>>>1^-(1&h[y]))+h[y-1]})(t),t);case Je.RLE:return(function(h,p,y){return y?(function(x,S,C){const I=new Int32Array(C);let P=0;for(let L=0;L<S;L++){const O=x[L];let N=x[L+S];N=N>>>1^-(1&N),I.fill(N,P,P+O),P+=O}return I})(h,p.runs,p.numRleValues):Gp(h,p.runs,p.numRleValues)})(t,i,o);case Je.MORTON:return Ma(t),t;case Je.COMPONENTWISE_DELTA:return l?((function(h,p,y,x){let S=h[0]>>>1^-(1&h[0]),C=h[1]>>>1^-(1&h[1]);h[0]=so(Math.round(S*p),y,x),h[1]=so(Math.round(C*p),y,x);const I=h.length/16;let P=2;if(I>=4)for(;P<I-4;P+=4){const L=h[P],O=h[P+1],N=(L>>>1^-(1&L))+S,G=(O>>>1^-(1&O))+C;h[P]=so(Math.round(N*p),y,x),h[P+1]=so(Math.round(G*p),y,x);const X=h[P+2],rt=h[P+3];S=(X>>>1^-(1&X))+N,C=(rt>>>1^-(1&rt))+G,h[P+2]=so(Math.round(S*p),y,x),h[P+3]=so(Math.round(C*p),y,x)}for(;P!=h.length;P+=2)S+=h[P]>>>1^-(1&h[P]),C+=h[P+1]>>>1^-(1&h[P+1]),h[P]=so(Math.round(S*p),y,x),h[P+1]=so(Math.round(C*p),y,x)})(t,l.scale,l.min,l.max),t):(Zp(t),t);case Je.NONE:return o&&(function(h){for(let p=0;p<h.length;p++){const y=h[p];h[p]=y>>>1^-(1&y)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,i,o){switch(i.logicalLevelTechnique1){case Je.DELTA:return i.logicalLevelTechnique2===Je.RLE?(function(l,h,p){const y=new BigInt64Array(p);let x=0,S=0n;for(let C=0;C<h;C++){const I=Number(l[C]),P=bu(l[C+h]);for(let L=0;L<I;L++)S+=P,y[x++]=S}return y})(t,i.runs,i.numRleValues):((function(l){l[0]=l[0]>>1n^-(1n&l[0]);const h=l.length/4*4;let p=1;if(h>=4)for(;p<h-4;p+=4){const y=l[p],x=l[p+1],S=l[p+2],C=l[p+3];l[p]=(y>>1n^-(1n&y))+l[p-1],l[p+1]=(x>>1n^-(1n&x))+l[p],l[p+2]=(S>>1n^-(1n&S))+l[p+1],l[p+3]=(C>>1n^-(1n&C))+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]>>1n^-(1n&l[p]))+l[p-1]})(t),t);case Je.RLE:return(function(l,h,p){return p?(function(y,x,S){const C=new BigInt64Array(S);let I=0;for(let P=0;P<x;P++){const L=Number(y[P]);let O=y[P+x];O=O>>1n^-(1n&O),C.fill(O,I,I+L),I+=L}return C})(l,h.runs,h.numRleValues):qp(l,h.runs,h.numRleValues)})(t,i,o);case Je.NONE:return o&&(function(l){for(let h=0;h<l.length;h++){const p=l[h];l[h]=p>>1n^-(1n&p)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,i,o){switch(i.logicalLevelTechnique1){case Je.DELTA:return i.logicalLevelTechnique2===Je.RLE&&(t=Eh(t,i.runs,i.numRleValues)),(function(l){l[0]=l[0]%2==1?(l[0]+1)/-2:l[0]/2;const h=l.length/4*4;let p=1;if(h>=4)for(;p<h-4;p+=4){const y=l[p],x=l[p+1],S=l[p+2],C=l[p+3];l[p]=(y%2==1?(y+1)/-2:y/2)+l[p-1],l[p+1]=(x%2==1?(x+1)/-2:x/2)+l[p],l[p+2]=(S%2==1?(S+1)/-2:S/2)+l[p+1],l[p+3]=(C%2==1?(C+1)/-2:C/2)+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]%2==1?(l[p]+1)/-2:l[p]/2)+l[p-1]})(t),t;case Je.RLE:return(function(l,h,p){return p?(function(y,x,S){const C=new Float64Array(S);let I=0;for(let P=0;P<x;P++){const L=y[P];let O=y[P+x];O=O%2==1?(O+1)/-2:O/2,C.fill(O,I,I+L),I+=L}return C})(l,h.runs,h.numRleValues):Eh(l,h.runs,h.numRleValues)})(t,i,o);case Je.NONE:return o&&(function(l){for(let h=0;h<l.length;h++){const p=l[h];l[h]=p%2==1?(p+1)/-2:p/2}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,i){if(i.logicalLevelTechnique1===Je.DELTA&&i.logicalLevelTechnique2===Je.NONE)return(function(o){const l=new Int32Array(o.length+1);l[0]=0,l[1]=vr(o[0]);let h=l[1],p=2;for(;p!=l.length;++p){const y=o[p-1];h+=y>>>1^-(1&y),l[p]=l[p-1]+h}return l})(t);if(i.logicalLevelTechnique1===Je.RLE&&i.logicalLevelTechnique2===Je.NONE)return(function(o,l,h){const p=new Int32Array(h+1);p[0]=0;let y=1,x=p[0];for(let S=0;S<l;S++){const C=o[S],I=o[S+l];for(let P=y;P<y+C;P++)p[P]=I+x,x=p[P];y+=C}return p})(t,i.runs,i.numRleValues);if(i.logicalLevelTechnique1===Je.NONE&&i.logicalLevelTechnique2===Je.NONE){(function(l){let h=0;for(let p=0;p<l.length;p++)l[p]+=h,h=l[p]})(t);const o=new Int32Array(i.numValues+1);return o[0]=0,o.set(t,1),o}if(i.logicalLevelTechnique1===Je.DELTA&&i.logicalLevelTechnique2===Je.RLE){const o=(function(l,h,p){const y=new Int32Array(p+1);y[0]=0;let x=1,S=y[0];for(let C=0;C<h;C++){const I=l[C];let P=l[C+h];P=P>>>1^-(1&P);for(let L=x;L<x+I;L++)y[L]=P+S,S=y[L];x+=I}return y})(t,i.runs,i.numRleValues);return Ma(o),o}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,i,o,l,h){const p=o.physicalLevelTechnique===jo.FAST_PFOR?Ym():kn(t,i,o.numValues);return this.decodeNullableIntBuffer(p,o,l,h)}static decodeNullableLongStream(t,i,o,l,h){const p=Sh(t,i,o.numValues);return this.decodeNullableLongBuffer(p,o,l,h)}static decodeNullableIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case Je.DELTA:return i.logicalLevelTechnique2===Je.RLE&&(t=Gp(t,i.runs,i.numRleValues)),(function(h,p){const y=new Int32Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?p[0]>>>1^-(1&p[0]):0,x=1):y[0]=0;let S=1;for(;S!=y.length;++S)y[S]=h.get(S)?y[S-1]+(p[x]>>>1^-(1&p[x++])):y[S-1];return y})(l,t);case Je.RLE:return(function(h,p,y,x){const S=p;return y?(function(C,I,P){const L=new Int32Array(C.size());let O=0;for(let N=0;N<P;N++){const G=I[N];let X=I[N+P];X=X>>>1^-(1&X);for(let rt=O;rt<O+G;rt++)C.get(rt)?L[rt]=X:(L[rt]=0,O++);O+=G}return L})(x,h,S.runs):(function(C,I,P){const L=new Int32Array(C.size());let O=0;for(let N=0;N<P;N++){const G=I[N],X=I[N+P];for(let rt=O;rt<O+G;rt++)C.get(rt)?L[rt]=X:(L[rt]=0,O++);O+=G}return L})(x,h,S.runs)})(t,i,o,l);case Je.MORTON:return Ma(t),t;case Je.COMPONENTWISE_DELTA:return Zp(t),t;case Je.NONE:return t=o?(function(h,p){const y=new Int32Array(h.size());let x=0,S=0;for(;S!=y.length;++S)if(h.get(S)){const C=p[x++];y[S]=C>>>1^-(1&C)}else y[S]=0;return y})(l,t):(function(h,p){const y=new Int32Array(h.size());let x=0,S=0;for(;S!=y.length;++S)y[S]=h.get(S)?p[x++]:0;return y})(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case Je.DELTA:return i.logicalLevelTechnique2===Je.RLE&&(t=qp(t,i.runs,i.numRleValues)),(function(h,p){const y=new BigInt64Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?p[0]>>1n^-(1n&p[0]):0n,x=1):y[0]=0n;let S=1;for(;S!=y.length;++S)y[S]=h.get(S)?y[S-1]+(p[x]>>1n^-(1n&p[x++])):y[S-1];return y})(l,t);case Je.RLE:return(function(h,p,y,x){const S=p;return y?(function(C,I,P){const L=new BigInt64Array(C.size());let O=0;for(let N=0;N<P;N++){const G=Number(I[N]);let X=I[N+P];X=X>>1n^-(1n&X);for(let rt=O;rt<O+G;rt++)C.get(rt)?L[rt]=X:(L[rt]=0n,O++);O+=G}return L})(x,h,S.runs):(function(C,I,P){const L=new BigInt64Array(C.size());let O=0;for(let N=0;N<P;N++){const G=Number(I[N]),X=I[N+P];for(let rt=O;rt<O+G;rt++)C.get(rt)?L[rt]=X:(L[rt]=0n,O++);O+=G}return L})(x,h,S.runs)})(t,i,o,l);case Je.NONE:return t=o?(function(h,p){const y=new BigInt64Array(h.size());let x=0,S=0;for(;S!=y.length;++S)if(h.get(S)){const C=p[x++];y[S]=C>>1n^-(1n&C)}else y[S]=0n;return y})(l,t):(function(h,p){const y=new BigInt64Array(h.size());let x=0,S=0;for(;S!=y.length;++S)y[S]=h.get(S)?p[x++]:0n;return y})(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,i,o,l){const h=t.logicalLevelTechnique1;if(h===Je.RLE)return t.runs===1?Wn.CONST:Wn.FLAT;const p=i instanceof Is?i.size():i;if(h===Je.DELTA&&t.logicalLevelTechnique2===Je.RLE){const y=t.runs,x=2;if(t.numRleValues!==p)return Wn.FLAT;if(y===1)return Wn.SEQUENCE;if(y===2){const S=l.get();let C;if(t.physicalLevelTechnique===jo.VARINT)C=kn(o,l,4);else{const I=l.get();C=new Int32Array(o.buffer,o.byteOffset+I,4)}if(l.set(S),C[2]===x&&C[3]===x)return Wn.SEQUENCE}}return t.numValues===1?Wn.CONST:Wn.FLAT}}class Km extends wh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Qm extends Np{constructor(t,i,o,l){super(t,BigInt64Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class Mh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,i,o){this._geometryOffsets=t,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class jg{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,i){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=i+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=i}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Ch extends jg{encode(t){this.validateCoordinates(t);const i=t.x+this._coordinateShift,o=t.y+this._coordinateShift;let l=0;for(let h=0;h<this._numBits;h++)l|=(i&1<<h)<<h|(o&1<<h)<<h+1;return l}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let i=0;for(let o=0;o<this._numBits;o++)i|=(t&1<<2*o)>>o;return i}static decode(t,i,o){return{x:Ch.decodeMorton(t,i)-o,y:Ch.decodeMorton(t>>1,i)-o}}static decodeMorton(t,i){let o=0;for(let l=0;l<i;l++)o|=(t&1<<2*l)>>l;return o}}(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON",r[r.MULTIPOINT=3]="MULTIPOINT",r[r.MULTILINESTRING=4]="MULTILINESTRING",r[r.MULTIPOLYGON=5]="MULTIPOLYGON"})(Kn||(Kn={})),(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON"})(jf||(jf={})),(function(r){r[r.MORTON=0]="MORTON",r[r.VEC_2=1]="VEC_2",r[r.VEC_3=2]="VEC_3"})(Ya||(Ya={}));class Vg{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((i=>[i]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,i){return[t,...i]}createMultiPolygon(t){return t.flat()}}function Hp(r){const t=new Array(r.numGeometries);let i=1,o=1,l=1,h=0;const p=new Vg;let y=0,x=0;const S=r.mortonSettings,C=r.topologyVector,I=C.geometryOffsets,P=C.partOffsets,L=C.ringOffsets,O=r.vertexOffsets,N=r.containsPolygonGeometry(),G=r.vertexBuffer;for(let X=0;X<r.numGeometries;X++){const rt=r.geometryType(X);if(rt===Kn.POINT){if(O&&O.length!==0)if(r.vertexBufferType===Ya.VEC_2){const K=2*O[x++],tt=new dt(G[K],G[K+1]);t[h++]=p.createPoint(tt)}else{const K=O[x++],tt=Ch.decode(G[K],S.numBits,S.coordinateShift),gt=new dt(tt.x,tt.y);t[h++]=p.createPoint(gt)}else{const K=new dt(G[y++],G[y++]);t[h++]=p.createPoint(K)}I&&l++,P&&i++,L&&o++}else if(rt===Kn.MULTIPOINT){const K=I[l]-I[l-1];l++;const tt=new Array(K);if(O&&O.length!==0){for(let gt=0;gt<K;gt++){const yt=2*O[x++];tt[gt]=new dt(G[yt],G[yt+1])}t[h++]=p.createMultiPoint(tt)}else{for(let gt=0;gt<K;gt++){const yt=G[y++],Dt=G[y++];tt[gt]=new dt(yt,Dt)}t[h++]=p.createMultiPoint(tt)}}else if(rt===Kn.LINESTRING){let K,tt=0;N?(tt=L[o]-L[o-1],o++):tt=P[i]-P[i-1],i++,O&&O.length!==0?(K=r.vertexBufferType===Ya.VEC_2?Tu(G,O,x,tt,!1):wc(G,O,x,tt,!1,S),x+=tt):(K=$p(G,y,tt,!1),y+=2*tt),t[h++]=p.createLineString(K),I&&l++}else if(rt===Kn.POLYGON){const K=P[i]-P[i-1];i++;const tt=new Array(K-1);let gt=L[o]-L[o-1];if(o++,O&&O.length!==0){const yt=r.vertexBufferType===Ya.VEC_2?wu(G,O,x,gt):kd(G,O,x,gt,0,S);x+=gt;for(let Dt=0;Dt<tt.length;Dt++)gt=L[o]-L[o-1],o++,tt[Dt]=r.vertexBufferType===Ya.VEC_2?wu(G,O,x,gt):kd(G,O,x,gt,0,S),x+=gt;t[h++]=p.createPolygon(yt,tt)}else{const yt=Dl(G,y,gt);y+=2*gt;for(let Dt=0;Dt<tt.length;Dt++)gt=L[o]-L[o-1],o++,tt[Dt]=Dl(G,y,gt),y+=2*gt;t[h++]=p.createPolygon(yt,tt)}I&&l++}else if(rt===Kn.MULTILINESTRING){const K=I[l]-I[l-1];l++;const tt=new Array(K);if(O&&O.length!==0){for(let gt=0;gt<K;gt++){let yt=0;N?(yt=L[o]-L[o-1],o++):yt=P[i]-P[i-1],i++;const Dt=r.vertexBufferType===Ya.VEC_2?Tu(G,O,x,yt,!1):wc(G,O,x,yt,!1,S);tt[gt]=Dt,x+=yt}t[h++]=p.createMultiLineString(tt)}else{for(let gt=0;gt<K;gt++){let yt=0;N?(yt=L[o]-L[o-1],o++):yt=P[i]-P[i-1],i++,tt[gt]=$p(G,y,yt,!1),y+=2*yt}t[h++]=p.createMultiLineString(tt)}}else{if(rt!==Kn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const K=I[l]-I[l-1];l++;const tt=new Array(K);let gt=0;if(O&&O.length!==0){for(let yt=0;yt<K;yt++){const Dt=P[i]-P[i-1];i++;const Xt=new Array(Dt-1);gt=L[o]-L[o-1],o++;const jt=r.vertexBufferType===Ya.VEC_2?wu(G,O,x,gt):kd(G,O,x,gt,0,S);x+=gt;for(let Qt=0;Qt<Xt.length;Qt++)gt=L[o]-L[o-1],o++,Xt[Qt]=r.vertexBufferType===Ya.VEC_2?wu(G,O,x,gt):kd(G,O,x,gt,0,S),x+=gt;tt[yt]=p.createPolygon(jt,Xt)}t[h++]=p.createMultiPolygon(tt)}else{for(let yt=0;yt<K;yt++){const Dt=P[i]-P[i-1];i++;const Xt=new Array(Dt-1);gt=L[o]-L[o-1],o++;const jt=Dl(G,y,gt);y+=2*gt;for(let Qt=0;Qt<Xt.length;Qt++){const oe=L[o]-L[o-1];o++,Xt[Qt]=Dl(G,y,oe),y+=2*oe}tt[yt]=p.createPolygon(jt,Xt)}t[h++]=p.createMultiPolygon(tt)}}}}return t}function Dl(r,t,i){return $p(r,t,i,!0)}function wu(r,t,i,o){return Tu(r,t,i,o,!0)}function kd(r,t,i,o,l,h){return wc(r,t,i,o,!0,h)}function $p(r,t,i,o){const l=new Array(o?i+1:i);for(let h=0;h<2*i;h+=2)l[h/2]=new dt(r[t+h],r[t+h+1]);return o&&(l[l.length-1]=l[0]),l}function Tu(r,t,i,o,l){const h=new Array(l?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*t[i+p/2];h[p/2]=new dt(r[y],r[y+1])}return l&&(h[h.length-1]=h[0]),h}function wc(r,t,i,o,l,h){const p=new Array(l?o+1:o);for(let y=0;y<o;y++){const x=Ch.decode(r[t[i+y]],h.numBits,h.coordinateShift);p[y]=new dt(x.x,x.y)}return l&&(p[p.length-1]=p[0]),p}class Xp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,i,o,l,h){this._vertexBufferType=t,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=l,this._mortonSettings=h}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const t=Hp(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:t[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(t){const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){const o=Ch.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Hp(this)}get mortonSettings(){return this._mortonSettings}}class Su extends Xp{_numGeometries;_geometryType;constructor(t,i,o,l,h,p,y){super(o,l,h,p,y),this._numGeometries=t,this._geometryType=i}static createMortonEncoded(t,i,o,l,h,p){return new Su(t,i,Ya.MORTON,o,l,h,p)}static create(t,i,o,l,h){return new Su(t,i,Ya.VEC_2,o,l,h)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Kn.POLYGON||this._geometryType===Kn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Tc extends Xp{_geometryTypes;constructor(t,i,o,l,h,p){super(t,o,l,h,p),this._geometryTypes=i}static createMortonEncoded(t,i,o,l,h){return new Tc(Ya.MORTON,t,i,o,l,h)}static create(t,i,o,l){return new Tc(Ya.VEC_2,t,i,o,l)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===Kn.POLYGON||this.geometryType(t)===Kn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Uf{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,i,o,l){this._triangleOffsets=t,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=l}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const t=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,l=i.ringOffsets,h=i.geometryOffsets;let p=0,y=1,x=1,S=1;for(let C=0;C<this.numGeometries;C++)switch(this.geometryType(C)){case Kn.POLYGON:{const I=o[y]-o[y-1];y++;const P=[];for(let L=0;L<I;L++){const O=l[x]-l[x-1];x++;const N=[];for(let G=0;G<O;G++){const X=this._vertexBuffer[p++],rt=this._vertexBuffer[p++];N.push(new dt(X,rt))}N.length>0&&N.push(N[0]),P.push(N)}t[C]=P,h&&S++}break;case Kn.MULTIPOLYGON:{const I=h[S]-h[S-1];S++;const P=[];for(let L=0;L<I;L++){const O=o[y]-o[y-1];y++;for(let N=0;N<O;N++){const G=l[x]-l[x-1];x++;const X=[];for(let rt=0;rt<G;rt++){const K=this._vertexBuffer[p++],tt=this._vertexBuffer[p++];X.push(new dt(K,tt))}X.length>0&&X.push(X[0]),P.push(X)}}t[C]=P}}return t}[Symbol.iterator](){return null}}class Sc extends Uf{_numGeometries;_geometryType;constructor(t,i,o,l,h,p){super(o,l,h,p),this._numGeometries=t,this._geometryType=i}static create(t,i,o,l,h,p){return new Sc(t,i,o,l,h,p)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class Bd extends Uf{_geometryTypes;constructor(t,i,o,l,h){super(i,o,l,h),this._geometryTypes=t}static create(t,i,o,l,h){return new Bd(t,i,o,l,h)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Jm(r,t,i,o,l){const h=Bn.decode(r,i);let p=null,y=null,x=null,S=null,C=null,I=null,P=null,L=null;if(Ue.getVectorType(h,o,r,i)===Wn.CONST){const N=Ue.decodeConstIntStream(r,i,h,!1);for(let G=0;G<t-1;G++){const X=Bn.decode(r,i);switch(X.physicalStreamType){case dr.LENGTH:switch(X.logicalStreamType.lengthType){case Yn.GEOMETRIES:p=Ue.decodeLengthStreamToOffsetBuffer(r,i,X);break;case Yn.PARTS:y=Ue.decodeLengthStreamToOffsetBuffer(r,i,X);break;case Yn.RINGS:x=Ue.decodeLengthStreamToOffsetBuffer(r,i,X);break;case Yn.TRIANGLES:P=Ue.decodeLengthStreamToOffsetBuffer(r,i,X)}break;case dr.OFFSET:switch(X.logicalStreamType.offsetType){case bc.VERTEX:S=Ue.decodeIntStream(r,i,X,!1);break;case bc.INDEX:L=Ue.decodeIntStream(r,i,X,!1)}break;case dr.DATA:if(ao.VERTEX===X.logicalStreamType.dictionaryType)C=Ue.decodeIntStream(r,i,X,!0,l);else{const rt=X;I={numBits:rt.numBits(),coordinateShift:rt.coordinateShift()},C=Ue.decodeIntStream(r,i,X,!1,l)}}}if(L!==null){if(p!=null||y!=null){const G=new Mh(p,y,x);return Sc.create(o,N,P,L,C,G)}return Sc.create(o,N,P,L,C)}return I===null?Su.create(o,N,new Mh(p,y,x),S,C):Su.createMortonEncoded(o,N,new Mh(p,y,x),S,C,I)}const O=Ue.decodeIntStream(r,i,h,!1);for(let N=0;N<t-1;N++){const G=Bn.decode(r,i);switch(G.physicalStreamType){case dr.LENGTH:switch(G.logicalStreamType.lengthType){case Yn.GEOMETRIES:p=Ue.decodeIntStream(r,i,G,!1);break;case Yn.PARTS:y=Ue.decodeIntStream(r,i,G,!1);break;case Yn.RINGS:x=Ue.decodeIntStream(r,i,G,!1);break;case Yn.TRIANGLES:P=Ue.decodeLengthStreamToOffsetBuffer(r,i,G)}break;case dr.OFFSET:switch(G.logicalStreamType.offsetType){case bc.VERTEX:S=Ue.decodeIntStream(r,i,G,!1);break;case bc.INDEX:L=Ue.decodeIntStream(r,i,G,!1)}break;case dr.DATA:if(ao.VERTEX===G.logicalStreamType.dictionaryType)C=Ue.decodeIntStream(r,i,G,!0,l);else{const X=G;I={numBits:X.numBits(),coordinateShift:X.coordinateShift()},C=Ue.decodeIntStream(r,i,G,!1,l)}}}return L!==null&&y===null?Bd.create(O,P,L,C):(p!==null?(p=Yp(O,p,2),y!==null&&x!==null?(y=Wp(O,p,y,!1),x=(function(N,G,X,rt){const K=new Int32Array(X[X.length-1]+1);let tt=0;K[0]=tt;let gt=1,yt=1,Dt=0;for(let Xt=0;Xt<N.length;Xt++){const jt=N[Xt],Qt=G[Xt+1]-G[Xt];if(jt!==0&&jt!==3)for(let oe=0;oe<Qt;oe++){const re=X[gt]-X[gt-1];gt++;for(let ae=0;ae<re;ae++)tt=K[yt++]=tt+rt[Dt++]}else for(let oe=0;oe<Qt;oe++)K[yt++]=++tt,gt++}return K})(O,p,y,x)):y!==null&&(y=(function(N,G,X){const rt=new Int32Array(G[G.length-1]+1);let K=0;rt[0]=K;let tt=1,gt=0;for(let yt=0;yt<N.length;yt++){const Dt=N[yt],Xt=G[yt+1]-G[yt];if(Dt===4||Dt===1)for(let jt=0;jt<Xt;jt++)K=rt[tt++]=K+X[gt++];else for(let jt=0;jt<Xt;jt++)rt[tt++]=++K}return rt})(O,p,y))):y!==null&&x!==null?(y=Yp(O,y,1),x=Wp(O,y,x,!0)):y!==null&&(y=Yp(O,y,0)),L!==null?Bd.create(O,P,L,C,new Mh(p,y,x)):I===null?Tc.create(O,new Mh(p,y,x),S,C):Tc.createMortonEncoded(O,new Mh(p,y,x),S,C,I))}function Yp(r,t,i){const o=new Int32Array(r.length+1);let l=0;o[0]=l;let h=0;for(let p=0;p<r.length;p++)l=o[p+1]=l+(r[p]>i?t[h++]:1);return o}function Wp(r,t,i,o){const l=new Int32Array(t[t.length-1]+1);let h=0;l[0]=h;let p=1,y=0;for(let x=0;x<r.length;x++){const S=r[x],C=t[x+1]-t[x];if(S===5||S===2||o&&(S===4||S===1))for(let I=0;I<C;I++)h=l[p++]=h+i[y++];else for(let I=0;I<C;I++)l[p++]=++h}return l}class Ug extends bh{dataVector;constructor(t,i,o){super(t,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(t){return this.dataVector.get(t)}}class Kp extends wh{getValueFromBuffer(t){return this.dataBuffer[t]}}class tg extends bh{constructor(t,i,o){super(t,BigInt64Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}function Gf(r,t,i){for(let o=0;o<r;o++){const l=Bn.decode(t,i);i.add(l.byteLength)}}function Eu(r,t,i){return Fd(r,Math.ceil(t/8),i)}function Fd(r,t,i){const o=new Uint8Array(t);let l=0;for(;l<t;){const h=r[i.increment()];if(h<=127){const p=h+3,y=r[i.increment()],x=l+p;o.fill(y,l,x),l=x}else{const p=256-h;for(let y=0;y<p;y++)o[l++]=r[i.increment()]}}return o}const Gg=new TextDecoder;function Ec(r,t,i){return i-t>=12?Gg.decode(r.subarray(t,i)):(function(o,l,h){let p="",y=l;for(;y<h;){const x=o[y];let S,C,I,P=null,L=x>239?4:x>223?3:x>191?2:1;if(y+L>h)break;L===1?x<128&&(P=x):L===2?(S=o[y+1],(192&S)==128&&(P=(31&x)<<6|63&S,P<=127&&(P=null))):L===3?(S=o[y+1],C=o[y+2],(192&S)==128&&(192&C)==128&&(P=(15&x)<<12|(63&S)<<6|63&C,(P<=2047||P>=55296&&P<=57343)&&(P=null))):L===4&&(S=o[y+1],C=o[y+2],I=o[y+3],(192&S)==128&&(192&C)==128&&(192&I)==128&&(P=(15&x)<<18|(63&S)<<12|(63&C)<<6|63&I,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,L=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),y+=L}return p})(r,t,i)}class Qp extends bh{offsetBuffer;constructor(t,i,o,l){super(t,o,l),this.offsetBuffer=i}}class Jp extends Qp{textEncoder;constructor(t,i,o,l){super(t,i,o,l??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return Ec(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class Mc extends Qp{indexBuffer;textEncoder;constructor(t,i,o,l,h){super(t,o,l,h??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(t){const i=this.indexBuffer[t];return Ec(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class tm extends Qp{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,i,o,l,h,p,y){super(t,o,l,y),this.indexBuffer=i,this.symbolOffsetBuffer=h,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,l,h){const p=[],y=new Array(l.length).fill(0);for(let x=1;x<l.length;x++)y[x]=y[x-1]+l[x-1];for(let x=0;x<h.length;x++)if(h[x]===255)p.push(h[++x]);else{const S=l[h[x]],C=y[h[x]];for(let I=0;I<S;I++)p.push(o[C+I])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[t];return Ec(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(t){const i=new Uint32Array(t.length-1);let o=t[0];for(let l=1;l<t.length;l++){const h=t[l];i[l-1]=h-o,o=h}return i}}class Ah{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,i,o,l,h){let p=null,y=null,x=null,S=null,C=null,I=null,P=null,L=null;for(let O=0;O<l;O++){const N=Bn.decode(i,o);if(N.byteLength!==0)switch(N.physicalStreamType){case dr.PRESENT:{const G=Eu(i,N.numValues,o);I=new Is(G,N.numValues);break}case dr.OFFSET:y=h!=null||I!=null?Ue.decodeNullableIntStream(i,o,N,!1,h??I):Ue.decodeIntStream(i,o,N,!1);break;case dr.LENGTH:{const G=Ue.decodeLengthStreamToOffsetBuffer(i,o,N);Yn.DICTIONARY===N.logicalStreamType.lengthType?p=G:Yn.SYMBOL===N.logicalStreamType.lengthType?S=G:P=G;break}case dr.DATA:{const G=i.subarray(o.get(),o.get()+N.byteLength);o.add(N.byteLength);const X=N.logicalStreamType.dictionaryType;ao.FSST===X?C=G:ao.SINGLE===X||ao.SHARED===X?x=G:ao.NONE===X&&(L=G);break}}}return this.decodeFsstDictionaryVector(t,C,y,p,x,S,h??I)??this.decodeDictionaryVector(t,x,y,p,h??I)??this.decodePlainStringVector(t,P,L,y,h??I)}static decodeFsstDictionaryVector(t,i,o,l,h,p,y){return i?new tm(t,o,l,h,p,i,y):null}static decodeDictionaryVector(t,i,o,l,h){return i?h?new Mc(t,o,l,i,h):new Mc(t,o,l,i):null}static decodePlainStringVector(t,i,o,l,h){if(!i||!o)return null;if(l)return h?new Mc(t,l,i,o,h):new Mc(t,l,i,o);if(h&&h.size()!==i.length-1){const p=new Int32Array(h.size());let y=0;for(let x=0;x<h.size();x++)p[x]=h.get(x)?y++:0;return new Mc(t,p,i,o,h)}return h?new Jp(t,i,o,h):new Jp(t,i,o)}static decodeSharedDictionary(t,i,o,l,h){let p=null,y=null,x=null,S=null,C=!1;for(;!C;){const O=Bn.decode(t,i);switch(O.physicalStreamType){case dr.LENGTH:Yn.DICTIONARY===O.logicalStreamType.lengthType?p=Ue.decodeLengthStreamToOffsetBuffer(t,i,O):x=Ue.decodeLengthStreamToOffsetBuffer(t,i,O);break;case dr.DATA:ao.SINGLE===O.logicalStreamType.dictionaryType||ao.SHARED===O.logicalStreamType.dictionaryType?(y=t.subarray(i.get(),i.get()+O.byteLength),C=!0):S=t.subarray(i.get(),i.get()+O.byteLength),i.add(O.byteLength)}}const I=o.complexType.children,P=[];let L=0;for(const O of I){const N=kn(t,i,1)[0];if(N==0)continue;const G=`${o.name}${O.name===Ah.ROOT_COLUMN_NAME?"":Ah.NESTED_COLUMN_SEPARATOR+O.name}`;if(h&&!h.has(G)){Gf(N,t,i);continue}if(N!==2||O.type!=="scalarField"||O.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const X=Bn.decode(t,i),rt=Eu(t,X.numValues,i),K=Bn.decode(t,i),tt=(K instanceof Od?K.numRleValues:K.numValues)!==l?Ue.decodeNullableIntStream(t,i,K,!1,new Is(rt,X.numValues)):Ue.decodeIntStream(t,i,K,!1);P[L++]=S?new tm(G,tt,p,y,x,S,new Is(rt,X.numValues)):new Mc(G,tt,p,y,new Is(rt,X.numValues))}return P}}function em(r,t,i,o,l,h){return i.type==="scalarType"?(function(p,y,x,S,C,I){let P=null,L=0;if(p===0)return null;if(I.nullable){const N=Bn.decode(y,x);L=N.numValues;const G=x.get(),X=Eu(y,L,x);x.set(G+N.byteLength),P=new Is(X,N.numValues)}const O=P??S;switch(C.physicalType){case 4:case 3:return(function(N,G,X,rt,K){const tt=Bn.decode(N,G),gt=Ue.getVectorType(tt,K,N,G),yt=rt.physicalType===3;if(gt===Wn.FLAT){const Dt=Dh(K)?Ue.decodeNullableIntStream(N,G,tt,yt,K):Ue.decodeIntStream(N,G,tt,yt);return new Rd(X.name,Dt,K)}if(gt===Wn.SEQUENCE){const Dt=Ue.decodeSequenceIntStream(N,G,tt);return new Nf(X.name,Dt[0],Dt[1],tt.numRleValues)}{const Dt=Ue.decodeConstIntStream(N,G,tt,yt);return new Ld(X.name,Dt,K)}})(y,x,I,C,O);case 9:return Ah.decode(I.name,y,x,I.nullable?p-1:p,P);case 0:return(function(N,G,X,rt,K){const tt=Bn.decode(N,G),gt=tt.numValues,yt=G.get(),Dt=Dh(K)?(function(jt,Qt,oe,re){const ae=Fd(jt,Math.ceil(Qt/8),oe),Vt=new Is(ae,Qt),Me=re.size(),Ce=new Is(new Uint8Array(Me),Me);let Ie=0;for(let ve=0;ve<re.size();ve++){const ti=!!re.get(ve)&&Vt.get(Ie++);Ce.set(ve,ti)}return Ce.getBuffer()})(N,gt,G,K):Eu(N,gt,G);G.set(yt+tt.byteLength);const Xt=new Is(Dt,gt);return new Ug(X.name,Xt,K)})(y,x,I,0,O);case 6:case 5:return(function(N,G,X,rt,K){const tt=Bn.decode(N,G),gt=Ue.getVectorType(tt,rt,N,G),yt=K.physicalType===5;if(gt===Wn.FLAT){const Dt=Dh(rt)?Ue.decodeNullableLongStream(N,G,tt,yt,rt):Ue.decodeLongStream(N,G,tt,yt);return new Km(X.name,Dt,rt)}if(gt===Wn.SEQUENCE){const Dt=Ue.decodeSequenceLongStream(N,G,tt);return new Qm(X.name,Dt[0],Dt[1],tt.numRleValues)}{const Dt=Ue.decodeConstLongStream(N,G,tt,yt);return new tg(X.name,Dt,rt)}})(y,x,I,O,C);case 7:return(function(N,G,X,rt){const K=Bn.decode(N,G),tt=Dh(rt)?(function(gt,yt,Dt,Xt){const jt=yt.get(),Qt=jt+Xt*Float32Array.BYTES_PER_ELEMENT,oe=new Uint8Array(gt.subarray(jt,Qt)).buffer,re=new Float32Array(oe);yt.set(Qt);const ae=Dt.size(),Vt=new Float32Array(ae);let Me=0;for(let Ce=0;Ce<ae;Ce++)Vt[Ce]=Dt.get(Ce)?re[Me++]:0;return Vt})(N,G,rt,K.numValues):(function(gt,yt,Dt){const Xt=yt.get(),jt=Xt+Dt*Float32Array.BYTES_PER_ELEMENT,Qt=new Uint8Array(gt.subarray(Xt,jt)).buffer,oe=new Float32Array(Qt);return yt.set(jt),oe})(N,G,K.numValues);return new Kp(X.name,tt,rt)})(y,x,I,O);case 8:return(function(N,G,X,rt){const K=Bn.decode(N,G),tt=Dh(rt)?(function(gt,yt,Dt,Xt){const jt=yt.get(),Qt=jt+Xt*Float64Array.BYTES_PER_ELEMENT,oe=new Uint8Array(gt.subarray(jt,Qt)).buffer,re=new Float64Array(oe);yt.set(Qt);const ae=Dt.size(),Vt=new Float64Array(ae);let Me=0;for(let Ce=0;Ce<ae;Ce++)Vt[Ce]=Dt.get(Ce)?re[Me++]:0;return Vt})(N,G,rt,K.numValues):(function(gt,yt,Dt){const Xt=yt.get(),jt=Xt+Dt*Float64Array.BYTES_PER_ELEMENT,Qt=new Uint8Array(gt.subarray(Xt,jt)).buffer,oe=new Float64Array(Qt);return yt.set(jt),oe})(N,G,K.numValues);return new Th(X.name,tt,rt)})(y,x,I,O);default:throw new Error(`The specified data type for the field is currently not supported: ${C}`)}})(o,r,t,l,i.scalarType,i):o!=1?null:Ah.decodeSharedDictionary(r,t,i,l,h)}function Dh(r){return r instanceof Is}class Nd{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{const i={};i.nullable=!!(1&t),i.columnScope=0;const o={};return o.physicalType=t>1?6:4,o.type="physicalType",i.scalarType=o,i.type="scalarType",i}case 4:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:0};return i.type="complexType",i.complexType=o,i}case 30:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:1};return i.type="complexType",i.complexType=o,i}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){const i=t.scalarType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(i.type==="logicalType")return!1}else if(t.type==="complexType"){const i=t.complexType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let i=null;switch(t){case 10:case 11:i=0;break;case 12:case 13:i=1;break;case 14:case 15:i=2;break;case 16:case 17:i=3;break;case 18:case 19:i=4;break;case 20:case 21:i=5;break;case 22:case 23:i=6;break;case 24:case 25:i=7;break;case 26:case 27:i=8;break;case 28:case 29:i=9;break;default:return null}const o={};o.nullable=!!(1&t),o.columnScope=0;const l={type:"physicalType"};return l.physicalType=i,o.type="scalarType",o.scalarType=l,o}}const qf=new TextDecoder;function eg(r,t){const i=kn(r,t,1)[0];if(i===0)return"";const o=t.get(),l=r.subarray(o,o+i);return t.add(i),qf.decode(l)}function ig(r,t){const i=kn(r,t,1)[0]>>>0,o=!!(4&i),l=!!(2&i),h=kn(r,t,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),l){const y={};if(o?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),8&i){const x=kn(r,t,1)[0]>>>0;y.children=new Array(x);for(let S=0;S<x;S++)y.children[S]=ig(r,t)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),p.type="scalarField",p.scalarField=y}return p}function im(r,t){const i=kn(r,t,1)[0]>>>0,o=Nd.decodeColumnType(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if(Nd.columnTypeHasName(i)?o.name=eg(r,t):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),Nd.columnTypeHasChildren(i)){const l=kn(r,t,1)[0]>>>0,h=o.complexType;h.children=new Array(l);for(let p=0;p<l;p++)h.children[p]=ig(r,t)}return o}function nm(r,t){const i={featureTables:[]},o={};o.name=eg(r,t);const l=kn(r,t,1)[0]>>>0,h=kn(r,t,1)[0]>>>0;o.columns=new Array(h);for(let p=0;p<h;p++)o.columns[p]=im(r,t);return i.featureTables.push(o),[i,l]}function Zf(r,t,i,o,l,h,p=!1){const y=t.scalarType.physicalType,x=Ue.getVectorType(l,h,r,i);if(y===4)switch(x){case Wn.FLAT:{const S=Ue.decodeIntStream(r,i,l,!1);return new Rd(o,S,h)}case Wn.SEQUENCE:{const S=Ue.decodeSequenceIntStream(r,i,l);return new Nf(o,S[0],S[1],l.numRleValues)}case Wn.CONST:{const S=Ue.decodeConstIntStream(r,i,l,!1);return new Ld(o,S,h)}}else switch(x){case Wn.FLAT:{if(p){const C=Ue.decodeLongFloat64Stream(r,i,l,!1);return new Th(o,C,h)}const S=Ue.decodeLongStream(r,i,l,!1);return new Km(o,S,h)}case Wn.SEQUENCE:{const S=Ue.decodeSequenceLongStream(r,i,l);return new Qm(o,S[0],S[1],l.numRleValues)}case Wn.CONST:{const S=Ue.decodeConstLongStream(r,i,l,!1);return new tg(o,S,h)}}throw new Error("Vector type not supported for id column.")}class rm{constructor(t,i){var o;switch(this._featureData=t,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Kn.POINT:case Kn.MULTIPOINT:this.type=1;break;case Kn.LINESTRING:case Kn.MULTILINESTRING:this.type=2;break;case Kn.POLYGON:case Kn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}projectPoint(t,i,o,l){return[360*(t.x+i)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+o)/l)*Math.PI))-90]}projectLine(t,i,o,l){return t.map((h=>this.projectPoint(h,i,o,l)))}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),h=this.extent*t,p=this.extent*i,y=this.loadGeometry();let x;switch(this.type){case 1:{const C=[];for(const P of y)C.push(P[0]);const I=this.projectLine(C,h,p,l);x=C.length===1?{type:"Point",coordinates:I[0]}:{type:"MultiPoint",coordinates:I};break}case 2:{const C=y.map((I=>this.projectLine(I,h,p,l)));x=C.length===1?{type:"LineString",coordinates:C[0]}:{type:"MultiLineString",coordinates:C};break}case 3:{const C=Xl(y),I=[];for(const P of C)I.push(P.map((L=>this.projectLine(L,h,p,l))));x=I.length===1?{type:"Polygon",coordinates:I[0]}:{type:"MultiPolygon",coordinates:I};break}default:throw new Error(`unknown feature type: ${this.type}`)}const S={type:"Feature",geometry:x,properties:this.properties};return this.id!=null&&(S.id=this.id),S}loadGeometry(){const t=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const l of i)o.push(new dt(l.x,l.y));t.push(o)}return t}bbox(){return[0,0,0,0]}}class ng{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new rm(this.features[t],this.extent)}}class Hf{constructor(t){this.layers={};const i=(function(o,l,h=!0){const p=new Ng(0),y=[];for(;p.get()<o.length;){const x=kn(o,p,1)[0]>>>0,S=p.get()+x;if(S>o.length)throw new Error(`Block overruns tile: ${S} > ${o.length}`);if(kn(o,p,1)[0]>>>0!=1){p.set(S);continue}const C=nm(o,p),I=C[1],P=C[0].featureTables[0];let L=null,O=null;const N=[];let G=0;for(const rt of P.columns){const K=rt.name;if(K==="id"){let tt=null;if(rt.nullable){const yt=Bn.decode(o,p),Dt=p.get(),Xt=Eu(o,yt.numValues,p);p.set(Dt+yt.byteLength),tt=new Is(Xt,yt.numValues)}const gt=Bn.decode(o,p);G=gt.getDecompressedCount(),L=Zf(o,rt,p,K,gt,tt??G,h)}else if(K==="geometry"){const tt=kn(o,p,1)[0];if(G===0){const gt=p.get();G=Bn.decode(o,p).getDecompressedCount(),p.set(gt)}O=Jm(o,tt,p,G,l)}else{const tt=Nd.hasStreamCount(rt)?kn(o,p,1)[0]:1;if(tt===0&&rt.type==="scalarType")continue;const gt=em(o,p,rt,tt,G,void 0);gt&&(Array.isArray(gt)?N.push(...gt):N.push(gt))}}const X=new jp(P.name,O,L,N,I);y.push(X),p.set(S)}return y})(new Uint8Array(t));this.layers=i.reduce(((o,l)=>Object.assign(Object.assign({},o),{[l.name]:new ng(l)})),{})}}class Ca{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const i=new Ca;return i.extend(t(new dt(this.minX,this.minY))),i.extend(t(new dt(this.maxX,this.minY))),i.extend(t(new dt(this.minX,this.maxY))),i.extend(t(new dt(this.maxX,this.maxY))),i}static fromPoints(t){const i=new Ca;for(const o of t)i.extend(o);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}const Vo="_geojsonTileLayer";class Il{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new dl(De,16,0),this.grid3D=new dl(De,16,0),this.featureIndexArray=new Q,this.promoteId=i}insert(t,i,o,l,h,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,h);const x=p?this.grid3D:this.grid;for(let S=0;S<i.length;S++){const C=i[S],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<C.length;P++){const L=C[P];I[0]=Math.min(I[0],L.x),I[1]=Math.min(I[1],L.y),I[2]=Math.max(I[2],L.x),I[3]=Math.max(I[3],L.y)}I[0]<De&&I[1]<De&&I[2]>=0&&I[3]>=0&&x.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new gp(new Df(this.rawTileData)).layers:new Hf(this.rawTileData).layers,this.sourceLayerCoder=new Xm(this.vtLayers?Object.keys(this.vtLayers).sort():[Vo])),this.vtLayers}query(t,i,o,l){this.loadVTLayers();const h=t.params,p=De/t.tileSize/t.scale,y=Gr(h.filter,h.globalState),x=t.queryGeometry,S=t.queryPadding*p,C=Ca.fromPoints(x),I=this.grid.query(C.minX-S,C.minY-S,C.maxX+S,C.maxY+S),P=Ca.fromPoints(t.cameraQueryGeometry).expandBy(S),L=this.grid3D.query(P.minX,P.minY,P.maxX,P.maxY,((G,X,rt,K)=>(function(tt,gt,yt,Dt,Xt){for(const Qt of tt)if(gt<=Qt.x&&yt<=Qt.y&&Dt>=Qt.x&&Xt>=Qt.y)return!0;const jt=[new dt(gt,yt),new dt(gt,Xt),new dt(Dt,Xt),new dt(Dt,yt)];if(tt.length>2){for(const Qt of jt)if(ac(tt,Qt))return!0}for(let Qt=0;Qt<tt.length-1;Qt++)if(vm(tt[Qt],tt[Qt+1],jt))return!0;return!1})(t.cameraQueryGeometry,G-S,X-S,rt+S,K+S)));for(const G of L)I.push(G);I.sort(jd);const O={};let N;for(let G=0;G<I.length;G++){const X=I[G];if(X===N)continue;N=X;const rt=this.featureIndexArray.get(X);let K=null;this.loadMatchingFeature(O,rt.bucketIndex,rt.sourceLayerIndex,rt.featureIndex,y,h.layers,h.availableImages,i,o,l,((tt,gt,yt)=>(K||(K=no(tt)),gt.queryIntersectsFeature({queryGeometry:x,feature:tt,featureState:yt,geometry:K,zoom:this.z,transform:t.transform,pixelsToTileUnits:p,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return O}loadMatchingFeature(t,i,o,l,h,p,y,x,S,C,I){const P=this.bucketLayerIDs[i];if(p&&!P.some((G=>p.has(G))))return;const L=this.sourceLayerCoder.decode(o),O=this.vtLayers[L].feature(l);if(h.needGeometry){const G=zr(O,!0);if(!h.filter(new Si(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!h.filter(new Si(this.tileID.overscaledZ),O))return;const N=this.getId(O,L);for(let G=0;G<P.length;G++){const X=P[G];if(p&&!p.has(X))continue;const rt=x[X];if(!rt)continue;let K={};N&&C&&(K=C.getState(rt.sourceLayer||Vo,N));const tt=Mi({},S[X]);tt.paint=Ih(tt.paint,rt.paint,O,K,y),tt.layout=Ih(tt.layout,rt.layout,O,K,y);const gt=!I||I(O,rt,K);if(!gt)continue;const yt=new Fp(O,this.z,this.x,this.y,N);yt.layer=tt;let Dt=t[X];Dt===void 0&&(Dt=t[X]=[]),Dt.push({featureIndex:l,feature:yt,intersectionZ:gt})}}lookupSymbolFeatures(t,i,o,l,h,p,y,x){const S={};this.loadVTLayers();const C=Gr(h.filterSpec,h.globalState);for(const I of t)this.loadMatchingFeature(S,o,l,I,C,p,y,x,i);return S}hasLayer(t){for(const i of this.bucketLayerIDs)for(const o of i)if(t===o)return!0;return!1}getId(t,i){var o;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function Ih(r,t,i,o,l){return fa(r,((h,p)=>{const y=t instanceof wa?t.get(p):null;return y&&y.evaluate?y.evaluate(i,o,l):y}))}function jd(r,t){return t-r}function zl(r,t,i,o,l){const h=[];for(let p=0;p<r.length;p++){const y=r[p];let x;for(let S=0;S<y.length-1;S++){let C=y[S],I=y[S+1];C.x<t&&I.x<t||(C.x<t?C=new dt(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x<t&&(I=new dt(t,C.y+(t-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y<i&&I.y<i||(C.y<i?C=new dt(C.x+(i-C.y)/(I.y-C.y)*(I.x-C.x),i)._round():I.y<i&&(I=new dt(C.x+(i-C.y)/(I.y-C.y)*(I.x-C.x),i)._round()),C.x>=o&&I.x>=o||(C.x>=o?C=new dt(o,C.y+(o-C.x)/(I.x-C.x)*(I.y-C.y))._round():I.x>=o&&(I=new dt(o,C.y+(o-C.x)/(I.x-C.x)*(I.y-C.y))._round()),C.y>=l&&I.y>=l||(C.y>=l?C=new dt(C.x+(l-C.y)/(I.y-C.y)*(I.x-C.x),l)._round():I.y>=l&&(I=new dt(C.x+(l-C.y)/(I.y-C.y)*(I.x-C.x),l)._round()),x&&C.equals(x[x.length-1])||(x=[C],h.push(x)),x.push(I)))))}}return h}function rg(r,t,i,o,l){switch(t){case 1:return(function(h,p,y,x){const S=[];for(const C of h)for(const I of C){const P=x===0?I.x:I.y;P>=p&&P<=y&&S.push([I])}return S})(r,i,o,l);case 2:return zh(r,i,o,l,!1);case 3:return zh(r,i,o,l,!0)}return[]}function ag(r,t,i,o,l){const h=o===0?qg:sg;let p=[];const y=[];for(let C=0;C<r.length-1;C++){const I=r[C],P=r[C+1],L=o===0?I.x:I.y,O=o===0?P.x:P.y;let N=!1;L<t?O>t&&p.push(h(I,P,t)):L>i?O<i&&p.push(h(I,P,i)):p.push(I),O<t&&L>=t&&(p.push(h(I,P,t)),N=!0),O>i&&L<=i&&(p.push(h(I,P,i)),N=!0),!l&&N&&(y.push(p),p=[])}const x=r.length-1,S=o===0?r[x].x:r[x].y;return S>=t&&S<=i&&p.push(r[x]),l&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new dt(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function zh(r,t,i,o,l){const h=[];for(const p of r){const y=ag(p,t,i,o,l);y.length>0&&h.push(...y)}return h}function qg(r,t,i){return new dt(i,r.y+(i-r.x)/(t.x-r.x)*(t.y-r.y))}function sg(r,t,i){return new dt(r.x+(i-r.y)/(t.y-r.y)*(t.x-r.x),i)}de("FeatureIndex",Il,{omit:["rawTileData","sourceLayerCoder"]});class oo extends dt{constructor(t,i,o,l){super(t,i),this.angle=o,l!==void 0&&(this.segment=l)}clone(){return new oo(this.x,this.y,this.angle,this.segment)}}function am(r,t,i,o,l){if(t.segment===void 0||i===0)return!0;let h=t,p=t.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=r[p].dist(h),h=r[p]}y+=r[p].dist(r[p+1]),p++;const x=[];let S=0;for(;y<i/2;){const C=r[p],I=r[p+1];if(!I)return!1;let P=r[p-1].angleTo(C)-C.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:P}),S+=P;y-x[0].distance>o;)S-=x.shift().angleDelta;if(S>l)return!1;p++,y+=C.dist(I)}return!0}function og(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function Vd(r,t,i){return r?.6*t*i:0}function Ud(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function lg(r,t,i,o,l,h){const p=Vd(i,l,h),y=Ud(i,o)*h;let x=0;const S=og(r)/2;for(let C=0;C<r.length-1;C++){const I=r[C],P=r[C+1],L=I.dist(P);if(x+L>S){const O=(S-x)/L,N=Oa.number(I.x,P.x,O),G=Oa.number(I.y,P.y,O),X=new oo(N,G,P.angleTo(I),C);return X._round(),!p||am(r,X,y,p,t)?X:void 0}x+=L}}function Ph(r,t,i,o,l,h,p,y,x){const S=Vd(o,h,p),C=Ud(o,l),I=C*p,P=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-I<t/4&&(t=I+t/4),sm(r,P?t/2*y%t:(C/2+2*h)*p*y%t,t,S,i,I,P,!1,x)}function sm(r,t,i,o,l,h,p,y,x){const S=h/2,C=og(r);let I=0,P=t-i,L=[];for(let O=0;O<r.length-1;O++){const N=r[O],G=r[O+1],X=N.dist(G),rt=G.angleTo(N);for(;P+i<I+X;){P+=i;const K=(P-I)/X,tt=Oa.number(N.x,G.x,K),gt=Oa.number(N.y,G.y,K);if(tt>=0&&tt<x&&gt>=0&&gt<x&&P-S>=0&&P+S<=C){const yt=new oo(tt,gt,rt,O);yt._round(),o&&!am(r,yt,h,o,l)||L.push(yt)}}I+=X}return y||L.length||p||(L=sm(r,I/2,i,o,l,h,p,!0,x)),L}function $f(r,t,i,o){const l=[],h=r.image,p=h.pixelRatio,y=h.paddedRect.w-2,x=h.paddedRect.h-2;let S={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const C=h.stretchX||[[0,y]],I=h.stretchY||[[0,x]],P=(Vt,Me)=>Vt+Me[1]-Me[0],L=C.reduce(P,0),O=I.reduce(P,0),N=y-L,G=x-O;let X=0,rt=L,K=0,tt=O,gt=0,yt=N,Dt=0,Xt=G;if(h.content&&o){const Vt=h.content,Me=Vt[2]-Vt[0],Ce=Vt[3]-Vt[1];(h.textFitWidth||h.textFitHeight)&&(S=qm(r)),X=Cc(C,0,Vt[0]),K=Cc(I,0,Vt[1]),rt=Cc(C,Vt[0],Vt[2]),tt=Cc(I,Vt[1],Vt[3]),gt=Vt[0]-X,Dt=Vt[1]-K,yt=Me-rt,Xt=Ce-tt}const jt=S.x1,Qt=S.y1,oe=S.x2-jt,re=S.y2-Qt,ae=(Vt,Me,Ce,Ie)=>{const ve=Xf(Vt.stretch-X,rt,oe,jt),ti=Ac(Vt.fixed-gt,yt,Vt.stretch,L),gn=Xf(Me.stretch-K,tt,re,Qt),ir=Ac(Me.fixed-Dt,Xt,Me.stretch,O),$r=Xf(Ce.stretch-X,rt,oe,jt),Uo=Ac(Ce.fixed-gt,yt,Ce.stretch,L),Aa=Xf(Ie.stretch-K,tt,re,Qt),Rr=Ac(Ie.fixed-Dt,Xt,Ie.stretch,O),Xr=new dt(ve,gn),Fn=new dt($r,gn),Lr=new dt($r,Aa),ua=new dt(ve,Aa),ca=new dt(ti/p,ir/p),Wa=new dt(Uo/p,Rr/p),Yr=t*Math.PI/180;if(Yr){const xr=Math.sin(Yr),Tn=Math.cos(Yr),nr=[Tn,-xr,xr,Tn];Xr._matMult(nr),Fn._matMult(nr),ua._matMult(nr),Lr._matMult(nr)}const Ka=Vt.stretch+Vt.fixed,Go=Me.stretch+Me.fixed;return{tl:Xr,tr:Fn,bl:ua,br:Lr,tex:{x:h.paddedRect.x+1+Ka,y:h.paddedRect.y+1+Go,w:Ce.stretch+Ce.fixed-Ka,h:Ie.stretch+Ie.fixed-Go},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ca,pixelOffsetBR:Wa,minFontScaleX:yt/p/oe,minFontScaleY:Xt/p/re,isSDF:i}};if(o&&(h.stretchX||h.stretchY)){const Vt=om(C,N,L),Me=om(I,G,O);for(let Ce=0;Ce<Vt.length-1;Ce++){const Ie=Vt[Ce],ve=Vt[Ce+1];for(let ti=0;ti<Me.length-1;ti++)l.push(ae(Ie,Me[ti],ve,Me[ti+1]))}}else l.push(ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return l}function Cc(r,t,i){let o=0;for(const l of r)o+=Math.max(t,Math.min(i,l[1]))-Math.max(t,Math.min(i,l[0]));return o}function om(r,t,i){const o=[{fixed:-1,stretch:0}];for(const[l,h]of r){const p=o[o.length-1];o.push({fixed:l-p.stretch,stretch:p.stretch}),o.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return o.push({fixed:t+1,stretch:i}),o}function Xf(r,t,i,o){return r/t*i+o}function Ac(r,t,i,o){return r-t*i/o}de("Anchor",oo);class n{constructor(t,i,o,l,h,p,y,x,S,C){var I;if(this.boxStartIndex=t.length,S){let P=p.top,L=p.bottom;const O=p.collisionPadding;O&&(P-=O[1],L+=O[3]);let N=L-P;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const P=!((I=p.image)===null||I===void 0)&&I.content&&(p.image.textFitWidth||p.image.textFitHeight)?qm(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};P.y1=P.y1*y-x[0],P.y2=P.y2*y+x[2],P.x1=P.x1*y-x[3],P.x2=P.x2*y+x[1];const L=p.collisionPadding;if(L&&(P.x1-=L[0]*y,P.y1-=L[1]*y,P.x2+=L[2]*y,P.y2+=L[3]*y),C){const O=new dt(P.x1,P.y1),N=new dt(P.x2,P.y1),G=new dt(P.x1,P.y2),X=new dt(P.x2,P.y2),rt=C*Math.PI/180;O._rotate(rt),N._rotate(rt),G._rotate(rt),X._rotate(rt),P.x1=Math.min(O.x,N.x,G.x,X.x),P.x2=Math.max(O.x,N.x,G.x,X.x),P.y1=Math.min(O.y,N.y,G.y,X.y),P.y2=Math.max(O.y,N.y,G.y,X.y)}t.emplaceBack(i.x,i.y,P.x1,P.y1,P.x2,P.y2,o,l,h)}this.boxEndIndex=t.length}}class s{constructor(t=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:o}=this,l=i[t];for(;t>0;){const h=t-1>>1,p=i[h];if(o(l,p)>=0)break;i[t]=p,t=h}i[t]=l}_down(t){const{data:i,compare:o}=this,l=this.length>>1,h=i[t];for(;t<l;){let p=1+(t<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],h)>=0)break;i[t]=i[p],t=p}i[t]=h}}function c(r,t=1,i=!1){const o=Ca.fromPoints(r[0]),l=Math.min(o.width(),o.height());let h=l/2;const p=new s([],_),{minX:y,minY:x,maxX:S,maxY:C}=o;if(l===0)return new dt(y,x);for(let L=y;L<S;L+=l)for(let O=x;O<C;O+=l)p.push(new w(L+h,O+h,h,r));let I=(function(L){let O=0,N=0,G=0;const X=L[0];for(let rt=0,K=X.length,tt=K-1;rt<K;tt=rt++){const gt=X[rt],yt=X[tt],Dt=gt.x*yt.y-yt.x*gt.y;N+=(gt.x+yt.x)*Dt,G+=(gt.y+yt.y)*Dt,O+=3*Dt}return new w(N/O,G/O,0,L)})(r),P=p.length;for(;p.length;){const L=p.pop();(L.d>I.d||!I.d)&&(I=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,P)),L.max-I.d<=t||(h=L.h/2,p.push(new w(L.p.x-h,L.p.y-h,h,r)),p.push(new w(L.p.x+h,L.p.y-h,h,r)),p.push(new w(L.p.x-h,L.p.y+h,h,r)),p.push(new w(L.p.x+h,L.p.y+h,h,r)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function _(r,t){return t.max-r.max}function w(r,t,i,o){this.p=new dt(r,t),this.h=i,this.d=(function(l,h){let p=!1,y=1/0;for(let x=0;x<h.length;x++){const S=h[x];for(let C=0,I=S.length,P=I-1;C<I;P=C++){const L=S[C],O=S[P];L.y>l.y!=O.y>l.y&&l.x<(O.x-L.x)*(l.y-L.y)/(O.y-L.y)+L.x&&(p=!p),y=Math.min(y,Hn(l,L,O))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var M;R.aO=void 0,(M=R.aO||(R.aO={}))[M.center=1]="center",M[M.left=2]="left",M[M.right=3]="right",M[M.top=4]="top",M[M.bottom=5]="bottom",M[M["top-left"]=6]="top-left",M[M["top-right"]=7]="top-right",M[M["bottom-left"]=8]="bottom-left",M[M["bottom-right"]=9]="bottom-right";const F=Number.POSITIVE_INFINITY;function Y(r,t){return t[1]!==F?(function(i,o,l){let h=0,p=0;switch(o=Math.abs(o),l=Math.abs(l),i){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(i){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,p]})(r,t[0],t[1]):(function(i,o){let l=0,h=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-o;break;case"top":h=o-7}switch(i){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=o;break;case"right":l=-o}return[l,h]})(r,t[0])}function mt(r,t,i){var o;const l=r.layout,h=(o=l.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},i);if(h){const y=h.values,x=[];for(let S=0;S<y.length;S+=2){const C=x[S]=y[S],I=y[S+1].map((P=>P*Xn));C.startsWith("top")?I[1]-=7:C.startsWith("bottom")&&(I[1]+=7),x[S+1]=I}return new Un(x)}const p=l.get("text-variable-anchor");if(p){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},i)*Xn,F]:l.get("text-offset").evaluate(t,{},i).map((S=>S*Xn));const x=[];for(const S of p)x.push(S,Y(S,y));return new Un(x)}return null}function Rt(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zt(r,t,i,o,l,h,p,y,x,S,C,I){let P=h.textMaxSize.evaluate(t,{});P===void 0&&(P=p);const L=r.layers[0].layout,O=L.get("icon-offset").evaluate(t,{},C),N=kt(i.horizontal),G=p/24,X=r.tilePixelRatio*G,rt=r.tilePixelRatio*P/24,K=r.tilePixelRatio*y,tt=r.tilePixelRatio*L.get("symbol-spacing"),gt=L.get("text-padding")*r.tilePixelRatio,yt=(function(Ce,Ie,ve,ti=1){const gn=Ce.get("icon-padding").evaluate(Ie,{},ve),ir=gn&&gn.values;return[ir[0]*ti,ir[1]*ti,ir[2]*ti,ir[3]*ti]})(L,t,C,r.tilePixelRatio),Dt=L.get("text-max-angle")/180*Math.PI,Xt=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",jt=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Qt=L.get("symbol-placement"),oe=tt/2,re=L.get("icon-text-fit");let ae;o&&re!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(ae=Sd(o,i.vertical,re,L.get("icon-text-fit-padding"),O,G)),N&&(o=Sd(o,N,re,L.get("icon-text-fit-padding"),O,G)));const Vt=C?I.line.getGranularityForZoomLevel(C.z):1,Me=(Ce,Ie)=>{Ie.x<0||Ie.x>=De||Ie.y<0||Ie.y>=De||(function(ve,ti,gn,ir,$r,Uo,Aa,Rr,Xr,Fn,Lr,ua,ca,Wa,Yr,Ka,Go,xr,Tn,nr,zn,br,Dc,Pl,lm){const Rh=ve.addToLineVertexArray(ti,gn);let Gd,Yf,Wf,Kf,v_=0,x_=0,b_=0,w_=0,Zg=-1,Hg=-1;const Ic={};let T_=Es("");if(ve.allowVerticalPlacement&&ir.vertical){const ha=Rr.layout.get("text-rotate").evaluate(zn,{},Pl)+90;Wf=new n(Xr,ti,Fn,Lr,ua,ir.vertical,ca,Wa,Yr,ha),Aa&&(Kf=new n(Xr,ti,Fn,Lr,ua,Aa,Go,xr,Yr,ha))}if($r){const ha=Rr.layout.get("icon-rotate").evaluate(zn,{}),lo=Rr.layout.get("icon-text-fit")!=="none",qd=$f($r,ha,Dc,lo),Ll=Aa?$f(Aa,ha,Dc,lo):void 0;Yf=new n(Xr,ti,Fn,Lr,ua,$r,Go,xr,!1,ha),v_=4*qd.length;const Zd=ve.iconSizeData;let Cu=null;Zd.kind==="source"?(Cu=[Sa*Rr.layout.get("icon-size").evaluate(zn,{})],Cu[0]>No&&Ci(`${ve.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Zd.kind==="composite"&&(Cu=[Sa*br.compositeIconSizes[0].evaluate(zn,{},Pl),Sa*br.compositeIconSizes[1].evaluate(zn,{},Pl)],(Cu[0]>No||Cu[1]>No)&&Ci(`${ve.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ve.addSymbols(ve.icon,qd,Cu,nr,Tn,zn,R.ay.none,ti,Rh.lineStartIndex,Rh.lineLength,-1,Pl),Zg=ve.icon.placedSymbolArray.length-1,Ll&&(x_=4*Ll.length,ve.addSymbols(ve.icon,Ll,Cu,nr,Tn,zn,R.ay.vertical,ti,Rh.lineStartIndex,Rh.lineLength,-1,Pl),Hg=ve.icon.placedSymbolArray.length-1)}const S_=Object.keys(ir.horizontal);for(const ha of S_){const lo=ir.horizontal[ha];if(!Gd){T_=Es(lo.text);const Ll=Rr.layout.get("text-rotate").evaluate(zn,{},Pl);Gd=new n(Xr,ti,Fn,Lr,ua,lo,ca,Wa,Yr,Ll)}const qd=lo.positionedLines.length===1;if(b_+=Jt(ve,ti,lo,Uo,Rr,Yr,zn,Ka,Rh,ir.vertical?R.ay.horizontal:R.ay.horizontalOnly,qd?S_:[ha],Ic,Zg,br,Pl),qd)break}ir.vertical&&(w_+=Jt(ve,ti,ir.vertical,Uo,Rr,Yr,zn,Ka,Rh,R.ay.vertical,["vertical"],Ic,Hg,br,Pl));const zy=Gd?Gd.boxStartIndex:ve.collisionBoxArray.length,Py=Gd?Gd.boxEndIndex:ve.collisionBoxArray.length,Ry=Wf?Wf.boxStartIndex:ve.collisionBoxArray.length,Ly=Wf?Wf.boxEndIndex:ve.collisionBoxArray.length,Oy=Yf?Yf.boxStartIndex:ve.collisionBoxArray.length,ky=Yf?Yf.boxEndIndex:ve.collisionBoxArray.length,By=Kf?Kf.boxStartIndex:ve.collisionBoxArray.length,Fy=Kf?Kf.boxEndIndex:ve.collisionBoxArray.length;let Rl=-1;const ug=(ha,lo)=>ha&&ha.circleDiameter?Math.max(ha.circleDiameter,lo):lo;Rl=ug(Gd,Rl),Rl=ug(Wf,Rl),Rl=ug(Yf,Rl),Rl=ug(Kf,Rl);const E_=Rl>-1?1:0;E_&&(Rl*=lm/Xn),ve.glyphOffsetArray.length>=vc.MAX_GLYPHS&&Ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zn.sortKey!==void 0&&ve.addToSortKeyRanges(ve.symbolInstances.length,zn.sortKey);const Ny=mt(Rr,zn,Pl),[jy,Vy]=(function(ha,lo){const qd=ha.length,Ll=lo?.values;if(Ll?.length>0)for(let Zd=0;Zd<Ll.length;Zd+=2){const Cu=Ll[Zd+1];ha.emplaceBack(R.aO[Ll[Zd]],Cu[0],Cu[1])}return[qd,ha.length]})(ve.textAnchorOffsets,Ny);ve.symbolInstances.emplaceBack(ti.x,ti.y,Ic.right>=0?Ic.right:-1,Ic.center>=0?Ic.center:-1,Ic.left>=0?Ic.left:-1,Ic.vertical||-1,Zg,Hg,T_,zy,Py,Ry,Ly,Oy,ky,By,Fy,Fn,b_,w_,v_,x_,E_,0,ca,Rl,jy,Vy)})(r,Ie,Ce,i,o,l,ae,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,X,[gt,gt,gt,gt],Xt,x,K,yt,jt,O,t,h,S,C,p)};if(Qt==="line")for(const Ce of zl(t.geometry,0,0,De,De)){const Ie=pu(Ce,Vt),ve=Ph(Ie,tt,Dt,i.vertical||N,o,24,rt,r.overscaling,De);for(const ti of ve)N&&Nt(r,N.text,oe,ti)||Me(Ie,ti)}else if(Qt==="line-center"){for(const Ce of t.geometry)if(Ce.length>1){const Ie=pu(Ce,Vt),ve=lg(Ie,Dt,i.vertical||N,o,24,rt);ve&&Me(Ie,ve)}}else if(t.type==="Polygon")for(const Ce of Xl(t.geometry,0)){const Ie=c(Ce,16);Me(pu(Ce[0],Vt,!0),new oo(Ie.x,Ie.y,0))}else if(t.type==="LineString")for(const Ce of t.geometry){const Ie=pu(Ce,Vt);Me(Ie,new oo(Ie[0].x,Ie[0].y,0))}else if(t.type==="Point")for(const Ce of t.geometry)for(const Ie of Ce)Me([Ie],new oo(Ie.x,Ie.y,0))}function Jt(r,t,i,o,l,h,p,y,x,S,C,I,P,L,O){const N=(function(rt,K,tt,gt,yt,Dt,Xt,jt){const Qt=gt.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,oe=[];for(const re of K.positionedLines)for(const ae of re.positionedGlyphs){if(!ae.rect)continue;const Vt=ae.rect||{};let Me=4,Ce=!0,Ie=1,ve=0;const ti=(yt||jt)&&ae.vertical,gn=ae.metrics.advance*ae.scale/2;if(jt&&K.verticalizable&&(ve=re.lineOffset/2-(ae.imageName?-(Xn-ae.metrics.width*ae.scale)/2:(ae.scale-1)*Xn)),ae.imageName){const xr=Xt[ae.imageName];Ce=xr.sdf,Ie=xr.pixelRatio,Me=1/Ie}const ir=yt?[ae.x+gn,ae.y]:[0,0];let $r=yt?[0,0]:[ae.x+gn+tt[0],ae.y+tt[1]-ve],Uo=[0,0];ti&&(Uo=$r,$r=[0,0]);const Aa=ae.metrics.isDoubleResolution?2:1,Rr=(ae.metrics.left-Me)*ae.scale-gn+$r[0],Xr=(-ae.metrics.top-Me)*ae.scale+$r[1],Fn=Rr+Vt.w/Aa*ae.scale/Ie,Lr=Xr+Vt.h/Aa*ae.scale/Ie,ua=new dt(Rr,Xr),ca=new dt(Fn,Xr),Wa=new dt(Rr,Lr),Yr=new dt(Fn,Lr);if(ti){const xr=new dt(-gn,gn- -17),Tn=-Math.PI/2,nr=12-gn,zn=new dt(22-nr,-(ae.imageName?nr:0)),br=new dt(...Uo);ua._rotateAround(Tn,xr)._add(zn)._add(br),ca._rotateAround(Tn,xr)._add(zn)._add(br),Wa._rotateAround(Tn,xr)._add(zn)._add(br),Yr._rotateAround(Tn,xr)._add(zn)._add(br)}if(Qt){const xr=Math.sin(Qt),Tn=Math.cos(Qt),nr=[Tn,-xr,xr,Tn];ua._matMult(nr),ca._matMult(nr),Wa._matMult(nr),Yr._matMult(nr)}const Ka=new dt(0,0),Go=new dt(0,0);oe.push({tl:ua,tr:ca,bl:Wa,br:Yr,tex:Vt,writingMode:K.writingMode,glyphOffset:ir,sectionIndex:ae.sectionIndex,isSDF:Ce,pixelOffsetTL:Ka,pixelOffsetBR:Go,minFontScaleX:0,minFontScaleY:0})}return oe})(0,i,y,l,h,p,o,r.allowVerticalPlacement),G=r.textSizeData;let X=null;G.kind==="source"?(X=[Sa*l.layout.get("text-size").evaluate(p,{})],X[0]>No&&Ci(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):G.kind==="composite"&&(X=[Sa*L.compositeTextSizes[0].evaluate(p,{},O),Sa*L.compositeTextSizes[1].evaluate(p,{},O)],(X[0]>No||X[1]>No)&&Ci(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,N,X,y,h,p,S,t,x.lineStartIndex,x.lineLength,P,O);for(const rt of C)I[rt]=r.text.placedSymbolArray.length-1;return 4*N.length}function kt(r){for(const t in r)return r[t];return null}function Nt(r,t,i,o){const l=r.compareText;if(t in l){const h=l[t];for(let p=h.length-1;p>=0;p--)if(o.dist(h[p])<i)return!0}else l[t]=[];return l[t].push(o),!1}const we=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fe{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=we[15&o];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Fe(y,p,h,t)}constructor(t,i=64,o=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=we.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=i,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ui(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,x=[0,h.length-1,0],S=[];for(;x.length;){const C=x.pop()||0,I=x.pop()||0,P=x.pop()||0;if(I-P<=y){for(let G=P;G<=I;G++){const X=p[2*G],rt=p[2*G+1];X>=t&&X<=o&&rt>=i&&rt<=l&&S.push(h[G])}continue}const L=P+I>>1,O=p[2*L],N=p[2*L+1];O>=t&&O<=o&&N>=i&&N<=l&&S.push(h[L]),(C===0?t<=O:i<=N)&&(x.push(P),x.push(L-1),x.push(1-C)),(C===0?o>=O:l>=N)&&(x.push(L+1),x.push(I),x.push(1-C))}return S}within(t,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],x=[],S=o*o;for(;y.length;){const C=y.pop()||0,I=y.pop()||0,P=y.pop()||0;if(I-P<=p){for(let G=P;G<=I;G++)Yt(h[2*G],h[2*G+1],t,i)<=S&&x.push(l[G]);continue}const L=P+I>>1,O=h[2*L],N=h[2*L+1];Yt(O,N,t,i)<=S&&x.push(l[L]),(C===0?t-o<=O:i-o<=N)&&(y.push(P),y.push(L-1),y.push(1-C)),(C===0?t+o>=O:i+o>=N)&&(y.push(L+1),y.push(I),y.push(1-C))}return x}}function Ui(r,t,i,o,l,h){if(l-o<=i)return;const p=o+l>>1;Et(r,t,p,o,l,h),Ui(r,t,i,o,p-1,1-h),Ui(r,t,i,p+1,l,1-h)}function Et(r,t,i,o,l,h){for(;l>o;){if(l-o>600){const S=l-o+1,C=i-o+1,I=Math.log(S),P=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*P*(S-P)/S)*(C-S/2<0?-1:1);Et(r,t,i,Math.max(o,Math.floor(i-C*P/S+L)),Math.min(l,Math.floor(i+(S-C)*P/S+L)),h)}const p=t[2*i+h];let y=o,x=l;for(wt(r,t,o,i),t[2*l+h]>p&&wt(r,t,o,l);y<x;){for(wt(r,t,y,x),y++,x--;t[2*y+h]<p;)y++;for(;t[2*x+h]>p;)x--}t[2*o+h]===p?wt(r,t,o,x):(x++,wt(r,t,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function wt(r,t,i,o){zt(r,i,o),zt(t,2*i,2*o),zt(t,2*i+1,2*o+1)}function zt(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}function Yt(r,t,i,o){const l=r-i,h=t-o;return l*l+h*h}var ze;R.cG=void 0,(ze=R.cG||(R.cG={})).create="create",ze.load="load",ze.fullLoad="fullLoad";let _i=null,Ee=[];const Xe=1e3/60,li="loadTime",wi="fullLoadTime",Mu={mark(r){performance.mark(r)},frame(r){const t=r;_i!=null&&Ee.push(t-_i),_i=t},clearMetrics(){_i=null,Ee=[],performance.clearMeasures(li),performance.clearMeasures(wi);for(const r in R.cG)performance.clearMarks(R.cG[r])},getPerformanceMetrics(){performance.measure(li,R.cG.create,R.cG.load),performance.measure(wi,R.cG.create,R.cG.fullLoad);const r=performance.getEntriesByName(li)[0].duration,t=performance.getEntriesByName(wi)[0].duration,i=Ee.length,o=1/(Ee.reduce(((h,p)=>h+p),0)/i/1e3),l=Ee.filter((h=>h>Xe)).reduce(((h,p)=>h+(p-Xe)/Xe),0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:l/(i+l)*100,totalFrames:i}}};R.$=fe,R.A=le,R.B=ws,R.C=ya,R.D=ye,R.E=St,R.F=function([r,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(i),y:r*Math.sin(t)*Math.sin(i),z:r*Math.cos(i)}},R.G=Oa,R.H=Si,R.I=Pf,R.J=cf,R.K=function(r){if(an==null){const t=r.navigator?r.navigator.userAgent:null;an=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return an},R.L=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Fg((()=>this.process())),this.subscription=ho(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=pa(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}unregisterMessageHandler(r){delete this.messageHandlers[r]}sendAsync(r,t){return new Promise(((i,o)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),h=t?ho(t.signal,"abort",(()=>{h?.unsubscribe(),delete this.resolveRejects[l];const x={id:l,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),Dd):null;this.resolveRejects[l]={resolve:x=>{h?.unsubscribe(),i(x)},reject:x=>{h?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},r),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Co(r.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(r){const t=r.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(pa(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,(function*(){if(t.type==="<response>"){const l=this.resolveRejects[r];return delete this.resolveRejects[r],l?void(t.error?l.reject(Ts(t.error)):l.resolve(Ts(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Ts(t.data),o=new AbortController;this.abortControllers[r]=o;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,i,o);this.completeTask(r,null,l)}catch(l){this.completeTask(r,l)}}))}completeTask(r,t,i){const o=[];delete this.abortControllers[r];const l={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Co(t):null,data:Co(i,o)};this.target.postMessage(l,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},R.M=Ho,R.N=function(){var r=new le(16);return le!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},R.O=function(r,t,i){var o,l,h,p,y,x,S,C,I,P,L,O,N=i[0],G=i[1],X=i[2];return t===r?(r[12]=t[0]*N+t[4]*G+t[8]*X+t[12],r[13]=t[1]*N+t[5]*G+t[9]*X+t[13],r[14]=t[2]*N+t[6]*G+t[10]*X+t[14],r[15]=t[3]*N+t[7]*G+t[11]*X+t[15]):(l=t[1],h=t[2],p=t[3],y=t[4],x=t[5],S=t[6],C=t[7],I=t[8],P=t[9],L=t[10],O=t[11],r[0]=o=t[0],r[1]=l,r[2]=h,r[3]=p,r[4]=y,r[5]=x,r[6]=S,r[7]=C,r[8]=I,r[9]=P,r[10]=L,r[11]=O,r[12]=o*N+y*G+I*X+t[12],r[13]=l*N+x*G+P*X+t[13],r[14]=h*N+S*G+L*X+t[14],r[15]=p*N+C*G+O*X+t[15]),r},R.P=dt,R.Q=function(r,t,i){var o=i[0],l=i[1],h=i[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*l,r[5]=t[5]*l,r[6]=t[6]*l,r[7]=t[7]*l,r[8]=t[8]*h,r[9]=t[9]*h,r[10]=t[10]*h,r[11]=t[11]*h,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},R.R=Pr,R.S=function(r,t,i){var o=t[0],l=t[1],h=t[2],p=t[3],y=t[4],x=t[5],S=t[6],C=t[7],I=t[8],P=t[9],L=t[10],O=t[11],N=t[12],G=t[13],X=t[14],rt=t[15],K=i[0],tt=i[1],gt=i[2],yt=i[3];return r[0]=K*o+tt*y+gt*I+yt*N,r[1]=K*l+tt*x+gt*P+yt*G,r[2]=K*h+tt*S+gt*L+yt*X,r[3]=K*p+tt*C+gt*O+yt*rt,r[4]=(K=i[4])*o+(tt=i[5])*y+(gt=i[6])*I+(yt=i[7])*N,r[5]=K*l+tt*x+gt*P+yt*G,r[6]=K*h+tt*S+gt*L+yt*X,r[7]=K*p+tt*C+gt*O+yt*rt,r[8]=(K=i[8])*o+(tt=i[9])*y+(gt=i[10])*I+(yt=i[11])*N,r[9]=K*l+tt*x+gt*P+yt*G,r[10]=K*h+tt*S+gt*L+yt*X,r[11]=K*p+tt*C+gt*O+yt*rt,r[12]=(K=i[12])*o+(tt=i[13])*y+(gt=i[14])*I+(yt=i[15])*N,r[13]=K*l+tt*x+gt*P+yt*G,r[14]=K*h+tt*S+gt*L+yt*X,r[15]=K*p+tt*C+gt*O+yt*rt,r},R.T=ch,R.U=function(r,t){const i={};for(let o=0;o<t.length;o++){const l=t[o];l in r&&(i[l]=r[l])}return i},R.V=Al,R.W=Ke,R.X=Bf,R.Y=Id,R.Z=_t,R._=d,R.a=Rs,R.a$=ii,R.a0=co,R.a1=Ea,R.a2=Ff,R.a3=xu,R.a4=De,R.a5=function(r,t,i){if(!r)return t||{};if(!t)return r||{};const o=yr(r),l=yr(t);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,S]of y.update){const C=p.update.get(x);C&&(y.update.set(x,Bp(C,S)),p.update.delete(x))}})(o,l);const h={};if((o.removeAll||l.removeAll)&&(h.removeAll=!0),h.remove=new Set([...o.remove,...l.remove]),h.add=new Map([...o.add,...l.add]),h.update=new Map([...o.update,...l.update]),h.remove.size&&h.add.size)for(const p of h.add.keys())h.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(h)},R.a6=function(r,t){if(r==null)return!0;if(r.type==="Feature")return Di(r,t)!=null;if(r.type==="FeatureCollection"){const i=new Set;for(const o of r.features){const l=Di(o,t);if(l==null||i.has(l))return!1;i.add(l)}return!0}return!1},R.a7=function(r,t){const i=new Map;if(r!=null)if(r.type==="Feature")i.set(Di(r,t),r);else for(const o of r.features)i.set(Di(o,t),o);return i},R.a8=function(r,t,i){var o,l;if(t.removeAll)r.clear();else if(t.remove)for(const h of t.remove)r.delete(h);if(t.add)for(const h of t.add){const p=Di(h,i);p!=null&&r.set(p,h)}if(t.update)for(const h of t.update){let p=r.get(h.id);if(!p)continue;const y=!!h.newGeometry,x=h.removeAllProperties||((o=h.removeProperties)===null||o===void 0?void 0:o.length)>0||((l=h.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0;if((y||x)&&(p=Object.assign({},p),r.set(h.id,p),y&&(p.geometry=h.newGeometry),x)){if(p.properties=h.removeAllProperties?{}:Object.assign({},p.properties||{}),h.removeProperties)for(const S of h.removeProperties)delete p.properties[S];if(h.addOrUpdateProperties)for(const{key:S,value:C}of h.addOrUpdateProperties)p.properties[S]=C}}},R.a9=Vo,R.aA=function(r,t){var i=t[0],o=t[1],l=t[2],h=t[3],p=t[4],y=t[5],x=t[6],S=t[7],C=t[8],I=t[9],P=t[10],L=t[11],O=t[12],N=t[13],G=t[14],X=t[15],rt=i*y-o*p,K=i*x-l*p,tt=i*S-h*p,gt=o*x-l*y,yt=o*S-h*y,Dt=l*S-h*x,Xt=C*N-I*O,jt=C*G-P*O,Qt=C*X-L*O,oe=I*G-P*N,re=I*X-L*N,ae=P*X-L*G,Vt=rt*ae-K*re+tt*oe+gt*Qt-yt*jt+Dt*Xt;return Vt?(r[0]=(y*ae-x*re+S*oe)*(Vt=1/Vt),r[1]=(l*re-o*ae-h*oe)*Vt,r[2]=(N*Dt-G*yt+X*gt)*Vt,r[3]=(P*yt-I*Dt-L*gt)*Vt,r[4]=(x*Qt-p*ae-S*jt)*Vt,r[5]=(i*ae-l*Qt+h*jt)*Vt,r[6]=(G*tt-O*Dt-X*K)*Vt,r[7]=(C*Dt-P*tt+L*K)*Vt,r[8]=(p*re-y*Qt+S*Xt)*Vt,r[9]=(o*Qt-i*re-h*Xt)*Vt,r[10]=(O*yt-N*tt+X*rt)*Vt,r[11]=(I*tt-C*yt-L*rt)*Vt,r[12]=(y*jt-p*oe-x*Xt)*Vt,r[13]=(i*oe-o*jt+l*Xt)*Vt,r[14]=(N*K-O*gt-G*rt)*Vt,r[15]=(C*gt-I*K+P*rt)*Vt,r):null},R.aB=ce,R.aC=function(r){var t=r[0],i=r[1];return Math.sqrt(t*t+i*i)},R.aD=function(r){return r[0]=0,r[1]=0,r},R.aE=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r},R.aF=yc,R.aG=cn,R.aH=function(r,t,i,o){const l=t.y-r.y,h=t.x-r.x,p=o.y-i.y,y=o.x-i.x,x=p*h-y*l;if(x===0)return null;const S=(y*(r.y-i.y)-p*(r.x-i.x))/x;return new dt(r.x+S*h,r.y+S*l)},R.aI=zl,R.aJ=ud,R.aK=function(r){let t=1/0,i=1/0,o=-1/0,l=-1/0;for(const h of r)t=Math.min(t,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),l=Math.max(l,h.y);return[t,i,o,l]},R.aL=Xn,R.aM=vi,R.aN=function(r,t,i,o,l=!1){if(!i[0]&&!i[1])return[0,0];const h=l?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(h){const p=Math.sin(h),y=Math.cos(h);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[l?i[0]:vi(t,i[0],r.zoom),l?i[1]:vi(t,i[1],r.zoom)]},R.aP=Md,R.aQ=Rt,R.aR=Rf,R.aS=Fe,R.aT=Ai,R.aU=lc,R.aV=et,R.aW=Re,R.aX=ne,R.aY=kr,R.aZ=zd,R.a_=Pi,R.aa=Pd,R.ab=Ca,R.ac=25,R.ad=kp,R.ae=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const o of r){const l=window.document.createElement("source");j(o)||(t.crossOrigin="Anonymous"),l.src=o,t.appendChild(l)}}))},R.af=te,R.ag=function(){return Xi++},R.ah=v,R.ai=vc,R.aj=Gr,R.ak=zr,R.al=Fp,R.am=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,l,h)=>{const p=l||h;return t[o]=!p||p.toLowerCase(),""})),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},R.an=ke,R.ao=85.051129,R.ap=Vn,R.aq=function(r){return Math.pow(2,r)},R.ar=ue,R.as=Lp,R.at=function(r){return Math.log(r)/Math.LN2},R.au=function(r){var t=r[0],i=r[1];return t*t+i*i},R.av=class{constructor(r,t){this.max=r,this.onRemove=t,this.reset()}reset(){for(const r in this.data)for(const t of this.data[r])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(r,t,i){const o=r.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const l={value:t,timeout:void 0};if(i!==void 0&&(l.timeout=setTimeout((()=>{this.remove(r,l)}),i)),this.data[o].push(l),this.order.push(o),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const t=this.data[r].shift();return t.timeout&&clearTimeout(t.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),t.value}getByKey(r){const t=this.data[r];return t?t[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,t){if(!this.has(r))return this;const i=r.wrapped().key,o=t===void 0?0:this.data[i].indexOf(t),l=this.data[i][o];return this.data[i].splice(o,1),l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(r){const t=[];for(const i in this.data)for(const o of this.data[i])r(o.value)||t.push(o);for(const i of t)this.remove(i.value.tileID,i)}},R.aw=function(r){if(!r.length)return new Set;const t=Math.max(...r.map((x=>x.canonical.z)));let i=1/0,o=-1/0,l=1/0,h=-1/0;const p=[];for(const x of r){const{x:S,y:C,z:I}=x.canonical,P=Math.pow(2,t-I),L=S*P,O=C*P;p.push({id:x,x:L,y:O}),L<i&&(i=L),L>o&&(o=L),O<l&&(l=O),O>h&&(h=O)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==l&&x.y!==h||y.add(x.id);return y},R.ax=function(r,t){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=r,y=l?ke(tr.interpolationFactor(l,t,h,p),0,1):0;r.kind==="camera"?o=Oa.number(r.minSize,r.maxSize,y):i=y}return{uSizeT:i,uSize:o}},R.az=function(r,{uSize:t,uSizeT:i},{lowerSize:o,upperSize:l}){return r.kind==="source"?o/Sa:r.kind==="composite"?Oa.number(o/Sa,l/Sa,i):t},R.b=za,R.b$=class extends na{constructor(r,t){super(r,t),this.current=vl}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},R.b0=function(r){var t=new le(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},R.b1=function(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r},R.b2=function(r,t){var i=t[0],o=t[1],l=t[2],h=i*i+o*o+l*l;return h>0&&(h=1/Math.sqrt(h)),r[0]=t[0]*h,r[1]=t[1]*h,r[2]=t[2]*h,r},R.b3=Wi,R.b4=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},R.b5=function(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r[3]=t[3]*i[3],r},R.b6=be,R.b7=function(r,t,i){const o=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return o===0?null:(-(r[0]*i[0]+r[1]*i[1]+r[2]*i[2])-i[3])/o},R.b8=jn,R.b9=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r},R.bA=Ut,R.bB=function(r,t,i){var o=i[0],l=i[1],h=i[2],p=i[3],y=t[0],x=t[1],S=t[2],C=l*S-h*x,I=h*y-o*S,P=o*x-l*y;return r[0]=y+p*(C+=C)+l*(P+=P)-h*(I+=I),r[1]=x+p*I+h*C-o*P,r[2]=S+p*P+o*I-l*C,r},R.bC=function(r,t,i){const o=(l=[r[0],r[1],r[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((C=l[8])*(p=l[4])-(y=l[5])*(S=l[7]))+l[1]*(-C*(h=l[3])+y*(x=l[6]))+l[2]*(S*h-p*x);var l,h,p,y,x,S,C;if(o===0)return null;const I=Wi([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),P=Wi([],[i[0],i[1],i[2]],[r[0],r[1],r[2]]),L=Wi([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),O=Pi([],I,-r[3]);return ii(O,O,Pi([],P,-t[3])),ii(O,O,Pi([],L,-i[3])),Pi(O,O,1/o),O},R.bD=Rp,R.bE=function(){return new Float64Array(4)},R.bF=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[0]*Math.cos(o)-l[1]*Math.sin(o),h[1]=l[0]*Math.sin(o)+l[1]*Math.cos(o),h[2]=l[2],r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},R.bG=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[0],h[1]=l[1]*Math.cos(o)-l[2]*Math.sin(o),h[2]=l[1]*Math.sin(o)+l[2]*Math.cos(o),r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},R.bH=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[2]*Math.sin(o)+l[0]*Math.cos(o),h[1]=l[1],h[2]=l[2]*Math.cos(o)-l[0]*Math.sin(o),r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},R.bI=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[0],p=t[1],y=t[2],x=t[3],S=t[8],C=t[9],I=t[10],P=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=h*l-S*o,r[1]=p*l-C*o,r[2]=y*l-I*o,r[3]=x*l-P*o,r[8]=h*o+S*l,r[9]=p*o+C*l,r[10]=y*o+I*l,r[11]=x*o+P*l,r},R.bJ=function(r,t){const i=Tt(r,360),o=Tt(t,360),l=o-i,h=o>i?l-360:l+360;return Math.abs(l)<Math.abs(h)?l:h},R.bK=function(r){return r[0]=0,r[1]=0,r[2]=0,r},R.bL=function(r,t,i,o){const l=Math.sqrt(r*r+t*t),h=Math.sqrt(i*i+o*o);r/=l,t/=l,i/=h,o/=h;const p=Math.acos(r*i+t*o);return-t*i+r*o>0?p:-p},R.bM=function(r,t){const i=Tt(r,2*Math.PI),o=Tt(t,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},R.bN=function(){const r={},t=J.$version;for(const i in J.$root){const o=J.$root[i];if(o.required){let l=null;l=i==="version"?t:o.type==="array"?[]:{},l!=null&&(r[i]=l)}}return r},R.bO=Ki,R.bP=th,R.bQ=function r(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],i[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const o in t)if(!r(t[o],i[o]))return!1;return!0}return t===i},R.bR=function(r){r=r.slice();const t=Object.create(null);for(let i=0;i<r.length;i++)t[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=Pt(r[i],t[r[i].ref]));return r},R.bS=function(r,t){if(r.type==="custom")return new Bg(r,t);switch(r.type){case"background":return new Pp(r,t);case"circle":return new sp(r,t);case"color-relief":return new Cg(r,t);case"fill":return new mh(r,t);case"fill-extrusion":return new _h(r,t);case"heatmap":return new lp(r,t);case"hillshade":return new bl(r,t);case"line":return new Cf(r,t);case"raster":return new Do(r,t);case"symbol":return new Ad(r,t)}},R.bT=r=>r.type==="raster",R.bU=Or,R.bV=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Ot(r.version,t.version))return[{command:"setStyle",args:[t]}];Ot(r.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Ot(r.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),Ot(r.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Ot(r.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Ot(r.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Ot(r.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Ot(r.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),Ot(r.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Ot(r.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Ot(r.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Ot(r.light,t.light)||i.push({command:"setLight",args:[t.light]}),Ot(r.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Ot(r.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Ot(r.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const o={},l=[];(function(p,y,x,S){let C;for(C in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,C)&&(Object.prototype.hasOwnProperty.call(y,C)||Te(C,x,S));for(C in y)Object.prototype.hasOwnProperty.call(y,C)&&(Object.prototype.hasOwnProperty.call(p,C)?Ot(p[C],y[C])||(p[C].type==="geojson"&&y[C].type==="geojson"&&hn(p,y,C)?Ft(x,{command:"setGeoJSONSourceData",args:[C,y[C].data]}):Be(C,y,x,S)):pe(C,y,x))})(r.sources,t.sources,l,o);const h=[];r.layers&&r.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):h.push(p)})),i=i.concat(l),(function(p,y,x){y=y||[];const S=(p=p||[]).map(di),C=y.map(di),I=p.reduce(Ri,{}),P=y.reduce(Ri,{}),L=S.slice(),O=Object.create(null);let N,G,X,rt,K;for(let tt=0,gt=0;tt<S.length;tt++)N=S[tt],Object.prototype.hasOwnProperty.call(P,N)?gt++:(Ft(x,{command:"removeLayer",args:[N]}),L.splice(L.indexOf(N,gt),1));for(let tt=0,gt=0;tt<C.length;tt++)N=C[C.length-1-tt],L[L.length-1-tt]!==N&&(Object.prototype.hasOwnProperty.call(I,N)?(Ft(x,{command:"removeLayer",args:[N]}),L.splice(L.lastIndexOf(N,L.length-gt),1)):gt++,rt=L[L.length-tt],Ft(x,{command:"addLayer",args:[P[N],rt]}),L.splice(L.length-tt,0,N),O[N]=!0);for(let tt=0;tt<C.length;tt++)if(N=C[tt],G=I[N],X=P[N],!O[N]&&!Ot(G,X))if(Ot(G.source,X.source)&&Ot(G["source-layer"],X["source-layer"])&&Ot(G.type,X.type)){for(K in He(G.layout,X.layout,x,N,null,"setLayoutProperty"),He(G.paint,X.paint,x,N,null,"setPaintProperty"),Ot(G.filter,X.filter)||Ft(x,{command:"setFilter",args:[N,X.filter]}),Ot(G.minzoom,X.minzoom)&&Ot(G.maxzoom,X.maxzoom)||Ft(x,{command:"setLayerZoomRange",args:[N,X.minzoom,X.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?He(G[K],X[K],x,N,K.slice(6),"setPaintProperty"):Ot(G[K],X[K])||Ft(x,{command:"setLayerProperty",args:[N,K,X[K]]}));for(K in X)Object.prototype.hasOwnProperty.call(X,K)&&!Object.prototype.hasOwnProperty.call(G,K)&&K!=="layout"&&K!=="paint"&&K!=="filter"&&K!=="metadata"&&K!=="minzoom"&&K!=="maxzoom"&&(K.indexOf("paint.")===0?He(G[K],X[K],x,N,K.slice(6),"setPaintProperty"):Ot(G[K],X[K])||Ft(x,{command:"setLayerProperty",args:[N,K,X[K]]}))}else Ft(x,{command:"removeLayer",args:[N]}),rt=L[L.lastIndexOf(N)+1],Ft(x,{command:"addLayer",args:[X,rt]})})(h,t.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[t]}]}return i},R.bW=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},R.bX=fa,R.bY=es,R.bZ=class extends na{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},R.b_=Cs,R.ba=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},R.bb=$m,R.bc=xc,R.bd=function(r,t,i,o,l){var h=1/Math.tan(t/2);if(r[0]=h/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,l!=null&&l!==1/0){var p=1/(o-l);r[10]=(l+o)*p,r[14]=2*l*o*p}else r[10]=-1,r[14]=-2*o;return r},R.be=function(r){var t=new le(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},R.bf=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[0],p=t[1],y=t[2],x=t[3],S=t[4],C=t[5],I=t[6],P=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=h*l+S*o,r[1]=p*l+C*o,r[2]=y*l+I*o,r[3]=x*l+P*o,r[4]=S*l-h*o,r[5]=C*l-p*o,r[6]=I*l-y*o,r[7]=P*l-x*o,r},R.bg=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[4],p=t[5],y=t[6],x=t[7],S=t[8],C=t[9],I=t[10],P=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=h*l+S*o,r[5]=p*l+C*o,r[6]=y*l+I*o,r[7]=x*l+P*o,r[8]=S*l-h*o,r[9]=C*l-p*o,r[10]=I*l-y*o,r[11]=P*l-x*o,r},R.bh=function(){const r=new Float32Array(16);return ue(r),r},R.bi=function(){const r=new Float64Array(16);return ue(r),r},R.bj=function(){return new Float64Array(16)},R.bk=function(r,t,i){const o=new Float64Array(4);return Ut(o,r,t-90,i),o},R.bl=function(r,t,i,o){var l,h,p,y,x,S=t[0],C=t[1],I=t[2],P=t[3],L=i[0],O=i[1],N=i[2],G=i[3];return(h=S*L+C*O+I*N+P*G)<0&&(h=-h,L=-L,O=-O,N=-N,G=-G),1-h>me?(l=Math.acos(h),p=Math.sin(l),y=Math.sin((1-o)*l)/p,x=Math.sin(o*l)/p):(y=1-o,x=o),r[0]=y*S+x*L,r[1]=y*C+x*O,r[2]=y*I+x*N,r[3]=y*P+x*G,r},R.bm=function(r){const t=new Float64Array(9);var i,o,l,h,p,y,x,S,C,I,P,L,O,N,G,X,rt,K;I=(l=(o=r)[0])*(x=l+l),P=(h=o[1])*x,O=(p=o[2])*x,N=p*(S=h+h),X=(y=o[3])*x,rt=y*S,K=y*(C=p+p),(i=t)[0]=1-(L=h*S)-(G=p*C),i[3]=P-K,i[6]=O+rt,i[1]=P+K,i[4]=1-I-G,i[7]=N-X,i[2]=O-rt,i[5]=N+X,i[8]=1-I-L;const tt=kr(-Math.asin(ke(t[2],-1,1)));let gt,yt;return Math.hypot(t[5],t[8])<.001?(gt=0,yt=-kr(Math.atan2(t[3],t[4]))):(gt=kr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),yt=kr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:gt,pitch:tt+90,bearing:yt}},R.bn=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},R.bo=Qe,R.bp=Ga,R.bq=cr,R.br=ra,R.bs=ph,R.bt=Kt,R.bu=ge,R.bv=Jn,R.bw=function(r,t,i,o,l){return Kt(o,l,ke((r-t)/(i-t),0,1))},R.bx=Tt,R.by=function(){return new Float64Array(3)},R.bz=function(r,t,i,o){return r[0]=t[0]+i[0]*o,r[1]=t[1]+i[1]*o,r[2]=t[2]+i[2]*o,r},R.c=Vl,R.c$=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},R.c0=Hr,R.c1=class extends na{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},R.c2=class extends na{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},R.c3=mi,R.c4=function(r,t){var i=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=i,r[2]=0,r[3]=-i,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},R.c5=function(r,t,i){var o=t[0],l=t[1],h=t[2];return r[0]=o*i[0]+l*i[3]+h*i[6],r[1]=o*i[1]+l*i[4]+h*i[7],r[2]=o*i[2]+l*i[5]+h*i[8],r},R.c6=function(r,t,i,o,l,h,p){var y=1/(t-i),x=1/(o-l),S=1/(h-p);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*S,r[11]=0,r[12]=(t+i)*y,r[13]=(l+o)*x,r[14]=(p+h)*S,r[15]=1,r},R.c7=class extends na{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let i=0;i<r.length;i++)t[4*i]=r[i].r,t[4*i+1]=r[i].g,t[4*i+2]=r[i].b,t[4*i+3]=r[i].a;this.gl.uniform4fv(this.location,t)}}},R.c8=class extends na{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},R.c9=class extends nc{},R.cA=function(r){return Nl[r]||jl[r]},R.cB=function(r,t,i){var o=t[0],l=t[1];return r[0]=i[0]*o+i[4]*l+i[12],r[1]=i[1]*o+i[5]*l+i[13],r},R.cC=function(r,t){const{x:i,y:o}=Pd.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||i<0||i>=1)},R.cD=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},R.cE=class extends sn{},R.cF=Mu,R.cH=function(r){return r.message===rs},R.cI=Tr,R.cJ=function(r,t){Rs.REGISTERED_PROTOCOLS[r]=t},R.cK=function(r){delete Rs.REGISTERED_PROTOCOLS[r]},R.cL=function(r,t){const i={};for(let l=0;l<r.length;l++){const h=t&&t[r[l].id]||si(r[l]);t&&(t[r[l].id]=h);let p=i[h];p||(p=i[h]=[]),p.push(r[l])}const o=[];for(const l in i)o.push(i[l]);return o},R.cM=de,R.cN=Xm,R.cO=Il,R.cP=Cp,R.cQ=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=De/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],i=t.layout,o=t._unevaluatedLayout._values,l={layoutIconSize:o["icon-size"].possiblyEvaluate(new Si(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Si(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Si(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=r.bucket.textSizeData;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Si(S),r.canonical),o["text-size"].possiblyEvaluate(new Si(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=r.bucket.iconSizeData;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Si(S),r.canonical),o["icon-size"].possiblyEvaluate(new Si(C),r.canonical)]}const h=i.get("text-line-height")*Xn,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const S of r.bucket.features){const C=i.get("text-font").evaluate(S,{},r.canonical).join(","),I=x.evaluate(S,{},r.canonical),P=l.layoutTextSize.evaluate(S,{},r.canonical),L=l.layoutIconSize.evaluate(S,{},r.canonical),O={horizontal:{},vertical:void 0},N=S.text;let G,X=[0,0];if(N){const tt=N.toString(),gt=i.get("text-letter-spacing").evaluate(S,{},r.canonical)*Xn,yt=$s(tt)?gt:0,Dt=i.get("text-anchor").evaluate(S,{},r.canonical),Xt=mt(t,S,r.canonical);if(!Xt){const re=i.get("text-radial-offset").evaluate(S,{},r.canonical);X=re?Y(Dt,[re*Xn,F]):i.get("text-offset").evaluate(S,{},r.canonical).map((ae=>ae*Xn))}let jt=p?"center":i.get("text-justify").evaluate(S,{},r.canonical);const Qt=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(S,{},r.canonical)*Xn:1/0,oe=()=>{r.bucket.allowVerticalPlacement&&nu(tt)&&(O.vertical=_c(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,Qt,h,Dt,"left",yt,X,R.ay.vertical,!0,P,I))};if(!p&&Xt){const re=new Set;if(jt==="auto")for(let Vt=0;Vt<Xt.values.length;Vt+=2)re.add(Rt(Xt.values[Vt]));else re.add(jt);let ae=!1;for(const Vt of re)if(!O.horizontal[Vt])if(ae)O.horizontal[Vt]=O.horizontal[0];else{const Me=_c(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,Qt,h,"center",Vt,yt,X,R.ay.horizontal,!1,P,I);Me&&(O.horizontal[Vt]=Me,ae=Me.positionedLines.length===1)}oe()}else{jt==="auto"&&(jt=Rt(Dt));const re=_c(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,Qt,h,Dt,jt,yt,X,R.ay.horizontal,!1,P,I);re&&(O.horizontal[jt]=re),oe(),nu(tt)&&p&&y&&(O.vertical=_c(N,r.glyphMap,r.glyphPositions,r.imagePositions,C,Qt,h,Dt,jt,yt,X,R.ay.vertical,!1,P,I))}}let rt=!1;if(S.icon&&S.icon.name){const tt=r.imageMap[S.icon.name];tt&&(G=Og(r.imagePositions[S.icon.name],i.get("icon-offset").evaluate(S,{},r.canonical),i.get("icon-anchor").evaluate(S,{},r.canonical)),rt=!!tt.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=rt:r.bucket.sdfIcons!==rt&&Ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const K=kt(O.horizontal)||O.vertical;r.bucket.iconsInText=!!K&&K.iconsInText,(K||G)&&Zt(r.bucket,S,O,G,r.imageMap,l,P,L,X,rt,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},R.cR=vd,R.cS=$i,R.cT=fc,R.cU=mp,R.cV=Df,R.cW=uc,R.cX=function(r,t,i,o,l,h){let p=rg(r,t,i,l,0);return p=rg(p,t,o,h,1),p},R.cY=class{constructor(r){this.maxEntries=r,this.map=new Map}get(r){const t=this.map.get(r);return t!==void 0&&(this.map.delete(r),this.map.set(r,t)),t}set(r,t){if(this.map.has(r))this.map.delete(r);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(r,t)}clear(){this.map.clear()}},R.cZ=gp,R.c_=Hf,R.ca=vp,R.cb=class extends ou{},R.cc=ro,R.cd=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},R.ce=op,R.cf=function(r,t,i){var o=t[0],l=t[1],h=t[2],p=i[3]*o+i[7]*l+i[11]*h+i[15];return r[0]=(i[0]*o+i[4]*l+i[8]*h+i[12])/(p=p||1),r[1]=(i[1]*o+i[5]*l+i[9]*h+i[13])/p,r[2]=(i[2]*o+i[6]*l+i[10]*h+i[14])/p,r},R.cg=class extends su{},R.ch=class extends u{},R.ci=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},R.cj=function(r,t){var i=r[0],o=r[1],l=r[2],h=r[3],p=r[4],y=r[5],x=r[6],S=r[7],C=r[8],I=r[9],P=r[10],L=r[11],O=r[12],N=r[13],G=r[14],X=r[15],rt=t[0],K=t[1],tt=t[2],gt=t[3],yt=t[4],Dt=t[5],Xt=t[6],jt=t[7],Qt=t[8],oe=t[9],re=t[10],ae=t[11],Vt=t[12],Me=t[13],Ce=t[14],Ie=t[15];return Math.abs(i-rt)<=me*Math.max(1,Math.abs(i),Math.abs(rt))&&Math.abs(o-K)<=me*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(l-tt)<=me*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(h-gt)<=me*Math.max(1,Math.abs(h),Math.abs(gt))&&Math.abs(p-yt)<=me*Math.max(1,Math.abs(p),Math.abs(yt))&&Math.abs(y-Dt)<=me*Math.max(1,Math.abs(y),Math.abs(Dt))&&Math.abs(x-Xt)<=me*Math.max(1,Math.abs(x),Math.abs(Xt))&&Math.abs(S-jt)<=me*Math.max(1,Math.abs(S),Math.abs(jt))&&Math.abs(C-Qt)<=me*Math.max(1,Math.abs(C),Math.abs(Qt))&&Math.abs(I-oe)<=me*Math.max(1,Math.abs(I),Math.abs(oe))&&Math.abs(P-re)<=me*Math.max(1,Math.abs(P),Math.abs(re))&&Math.abs(L-ae)<=me*Math.max(1,Math.abs(L),Math.abs(ae))&&Math.abs(O-Vt)<=me*Math.max(1,Math.abs(O),Math.abs(Vt))&&Math.abs(N-Me)<=me*Math.max(1,Math.abs(N),Math.abs(Me))&&Math.abs(G-Ce)<=me*Math.max(1,Math.abs(G),Math.abs(Ce))&&Math.abs(X-Ie)<=me*Math.max(1,Math.abs(X),Math.abs(Ie))},R.ck=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},R.cl=r=>r.type==="symbol",R.cm=r=>r.type==="circle",R.cn=r=>r.type==="heatmap",R.co=r=>r.type==="line",R.cp=r=>r.type==="fill",R.cq=r=>r.type==="fill-extrusion",R.cr=r=>r.type==="hillshade",R.cs=r=>r.type==="color-relief",R.ct=r=>r.type==="background",R.cu=r=>r.type==="custom",R.cv=xe,R.cw=function(r,t,i){const o=Oe(t.x-i.x,t.y-i.y),l=Oe(r.x-i.x,r.y-i.y);var h,p;return kr(Math.atan2(o[0]*l[1]-o[1]*l[0],(h=o)[0]*(p=l)[0]+h[1]*p[1]))},R.cx=Ne,R.cy=function(r,t){return jl[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},R.cz=function(r,t){return Nl[t]&&"touches"in r},R.d=j,R.d0=function(r,t,i,o,l){return d(this,void 0,void 0,(function*(){if(fe())try{return yield co(r,t,i,o,l)}catch{}return(function(h,p,y,x,S){const C=h.width,I=h.height;is&&ns||(is=new OffscreenCanvas(C,I),ns=is.getContext("2d",{willReadFrequently:!0})),is.width=C,is.height=I,ns.drawImage(h,0,0,C,I);const P=ns.getImageData(p,y,x,S);return ns.clearRect(0,0,C,I),P.data})(r,t,i,o,l)}))},R.d1=hh,R.d2=vt,R.d3=Jl,R.d4=Ss,R.e=Mi,R.f=r=>d(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),R.g=Ul,R.h=r=>new Promise(((t,i)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ma}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(l):ma})),R.i=pa,R.j=(r,t)=>ft(Mi(r,{type:"json"}),t),R.k=ut,R.l=st,R.m=ft,R.n=(r,t)=>ft(Mi(r,{type:"arrayBuffer"}),t),R.o=function(r){return new Df(r).readFields(zf,[])},R.p=Mp,R.q=function(r){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))},R.r=uh,R.s=ho,R.t=Zi,R.u=J,R.v=bs,R.w=Ci,R.x=ih,R.y=np,R.z=xa})),it("worker",["./shared"],(function(R){class d{constructor(j,q){this.keyCache={},j&&this.replace(j,q)}replace(j,q){this._layerConfigs={},this._layers={},this.update(j,[],q)}update(j,q,$){for(const ut of j){this._layerConfigs[ut.id]=ut;const St=this._layers[ut.id]=R.bS(ut,$);St._featureFilter=R.aj(St.filter,$),this.keyCache[ut.id]&&delete this.keyCache[ut.id]}for(const ut of q)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const st=R.cL(Object.values(this._layerConfigs),this.keyCache);for(const ut of st){const St=ut.map((pe=>this._layers[pe.id])),J=St[0];if(J.visibility==="none")continue;const xt=J.source||"";let Pt=this.familiesBySource[xt];Pt||(Pt=this.familiesBySource[xt]={});const Ot=J.sourceLayer||R.a9;let Ft=Pt[Ot];Ft||(Ft=Pt[Ot]=[]),Ft.push(St)}}}class dt{constructor(j){const q={},$=[];for(const J in j){const xt=j[J],Pt=q[J]={};for(const Ot in xt){const Ft=xt[+Ot];if(!Ft||Ft.bitmap.width===0||Ft.bitmap.height===0)continue;const pe={x:0,y:0,w:Ft.bitmap.width+2,h:Ft.bitmap.height+2};$.push(pe),Pt[Ot]={rect:pe,metrics:Ft.metrics}}}const{w:st,h:ut}=R.p($),St=new R.r({width:st||1,height:ut||1});for(const J in j){const xt=j[J];for(const Pt in xt){const Ot=xt[+Pt];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const Ft=q[J][Pt].rect;R.r.copy(Ot.bitmap,St,{x:0,y:0},{x:Ft.x+1,y:Ft.y+1},Ot.bitmap)}}this.image=St,this.positions=q}}R.cM("GlyphAtlas",dt);class vt{constructor(j){this.tileID=new R.a1(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,q,$,st,ut){return R._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new R.ah;const St=new R.cN(Object.keys(j.layers).sort()),J=new R.cO(this.tileID,this.promoteId);J.bucketLayerIDs=[];const xt={},Pt={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:$,subdivisionGranularity:ut},Ot=q.familiesBySource[this.source];for(const he in Ot){const Se=j.layers[he];if(!Se)continue;Se.version===1&&R.w(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fr=St.encode(he),$o=[];for(let Qn=0;Qn<Se.length;Qn++){const Pe=Se.feature(Qn),Qr=J.getId(Pe,he);$o.push({feature:Pe,id:Qr,index:Qn,sourceLayerIndex:fr})}for(const Qn of Ot[he]){const Pe=Qn[0];Pe.source!==this.source&&R.w(`layer.source = ${Pe.source} does not equal this.source = ${this.source}`),Pe.isHidden(this.zoom,!0)||(Wt(Qn,this.zoom,$),(xt[Pe.id]=Pe.createBucket({index:J.bucketLayerIDs.length,layers:Qn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fr,sourceID:this.source})).populate($o,Pt,this.tileID.canonical),J.bucketLayerIDs.push(Qn.map((Qr=>Qr.id))))}}const Ft=R.bX(Pt.glyphDependencies,(he=>Object.keys(he).map(Number)));this.inFlightDependencies.forEach((he=>he?.abort())),this.inFlightDependencies=[];let pe=Promise.resolve({});if(Object.keys(Ft).length){const he=new AbortController;this.inFlightDependencies.push(he),pe=st.sendAsync({type:"GG",data:{stacks:Ft,source:this.source,tileID:this.tileID,type:"glyphs"}},he)}const Te=Object.keys(Pt.iconDependencies);let Be=Promise.resolve({});if(Te.length){const he=new AbortController;this.inFlightDependencies.push(he),Be=st.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},he)}const hn=Object.keys(Pt.patternDependencies);let He=Promise.resolve({});if(hn.length){const he=new AbortController;this.inFlightDependencies.push(he),He=st.sendAsync({type:"GI",data:{icons:hn,source:this.source,tileID:this.tileID,type:"patterns"}},he)}const di=Pt.dashDependencies;let Ri=Promise.resolve({});if(Object.keys(di).length){const he=new AbortController;this.inFlightDependencies.push(he),Ri=st.sendAsync({type:"GDA",data:{dashes:di}},he)}const[te,Li,Oi,En]=yield Promise.all([pe,Be,He,Ri]),fi=new dt(te),$t=new R.cP(Li,Oi);for(const he in xt){const Se=xt[he];Se instanceof R.ai?(Wt(Se.layers,this.zoom,$),R.cQ({bucket:Se,glyphMap:te,glyphPositions:fi.positions,imageMap:Li,imagePositions:$t.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Pt.subdivisionGranularity})):Se.hasDependencies&&(Se instanceof R.cR||Se instanceof R.cS||Se instanceof R.cT)&&(Wt(Se.layers,this.zoom,$),Se.addFeatures(Pt,this.tileID.canonical,$t.patternPositions,En))}return this.status="done",{buckets:Object.values(xt).filter((he=>!he.isEmpty())),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fi.image,imageAtlas:$t,dashPositions:En,glyphMap:this.returnDependencies?te:null,iconMap:this.returnDependencies?Li:null,glyphPositions:this.returnDependencies?fi.positions:null}}))}}function Wt(ft,j,q){const $=new R.H(j);for(const st of ft)st.recalculate($,q)}class ee extends R.cW{constructor(j,q){super(new R.cV,0,q,[],[]),this.feature=j,this.type=j.type,this.properties=j.tags?j.tags:{},"id"in j&&(typeof j.id=="string"?this.id=parseInt(j.id,10):typeof j.id!="number"||isNaN(j.id)||(this.id=j.id))}loadGeometry(){const j=[],q=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const $ of q){const st=[];for(const ut of $)st.push(new R.P(ut[0],ut[1]));j.push(st)}return j}}class Bt extends R.cU{constructor(j,q){super(new R.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=q?q.version:1,this.extent=q?q.extent:4096,this.length=j.length,this.features=j}feature(j){return new ee(this.features[j],this.extent)}}function Gt(ft,j){j.writeVarintField(15,ft.version||1),j.writeStringField(1,ft.name||""),j.writeVarintField(5,ft.extent||4096);const q={keys:[],values:[],keycache:{},valuecache:{}};for(let ut=0;ut<ft.length;ut++)q.feature=ft.feature(ut),j.writeMessage(2,se,q);const $=q.keys;for(const ut of $)j.writeStringField(3,ut);const st=q.values;for(const ut of st)j.writeMessage(4,le,ut)}function se(ft,j){if(!ft.feature)return;const q=ft.feature;q.id!==void 0&&j.writeVarintField(1,q.id),j.writeMessage(2,Lt,ft),j.writeVarintField(3,q.type),j.writeMessage(4,me,q)}function Lt(ft,j){for(const q in ft.feature?.properties){let $=ft.feature.properties[q],st=ft.keycache[q];if($===null)continue;st===void 0&&(ft.keys.push(q),st=ft.keys.length-1,ft.keycache[q]=st),j.writeVarint(st),typeof $!="string"&&typeof $!="boolean"&&typeof $!="number"&&($=JSON.stringify($));const ut=typeof $+":"+$;let St=ft.valuecache[ut];St===void 0&&(ft.values.push($),St=ft.values.length-1,ft.valuecache[ut]=St),j.writeVarint(St)}}function _t(ft,j){return(j<<3)+(7&ft)}function fe(ft){return ft<<1^ft>>31}function me(ft,j){const q=ft.loadGeometry(),$=ft.type;let st=0,ut=0;for(const St of q){let J=1;$===1&&(J=St.length),j.writeVarint(_t(1,J));const xt=$===3?St.length-1:St.length;for(let Pt=0;Pt<xt;Pt++){Pt===1&&$!==1&&j.writeVarint(_t(2,xt-1));const Ot=St[Pt].x-st,Ft=St[Pt].y-ut;j.writeVarint(fe(Ot)),j.writeVarint(fe(Ft)),st+=Ot,ut+=Ft}ft.type===3&&j.writeVarint(_t(7,1))}}function le(ft,j){const q=typeof ft;q==="string"?j.writeStringField(1,ft):q==="boolean"?j.writeBooleanField(7,ft):q==="number"&&(ft%1!=0?j.writeDoubleField(3,ft):ft<0?j.writeSVarintField(6,ft):j.writeVarintField(5,ft))}class mi extends R.cW{constructor(j,q,$,st,ut){super(new R.cV,0,ut,[],[]),this.type=j,this.properties=$||{},this.extent=ut,this.pointsArray=q,this.id=st}loadGeometry(){return this.pointsArray.map((j=>j.map((q=>new R.P(q.x,q.y)))))}}class ue extends R.cU{constructor(j,q,$){super(new R.cV),this.version=2,this._myFeatures=j,this.name=q,this.length=j.length,this.extent=$}feature(j){return this._myFeatures[j]}}class Ye{constructor(){this.layers={}}addLayer(j){this.layers[j.name]=j}}function be(ft){let j=(function(q){const $=new R.cV;return(function(st,ut){for(const St in st.layers)ut.writeMessage(3,Gt,st.layers[St])})(q,$),$.finish()})(ft);return j.byteOffset===0&&j.byteLength===j.buffer.byteLength||(j=new Uint8Array(j)),{vectorTile:ft,rawData:j.buffer}}function We(ft,j,q){const{extent:$}=ft,st=Math.pow(2,q.z-j.z),ut=(q.x-j.x*st)*$,St=(q.y-j.y*st)*$,J=[];for(let xt=0;xt<ft.length;xt++){const Pt=ft.feature(xt);let Ot=Pt.loadGeometry();for(const pe of Ot)for(const Te of pe)Te.x=Te.x*st-ut,Te.y=Te.y*st-St;const Ft=128;Ot=R.cX(Ot,Pt.type,-Ft,-Ft,$+Ft,$+Ft),Ot.length!==0&&J.push(new mi(Pt.type,Ot,Pt.properties,Pt.id,$))}return new ue(J,ft.name,$)}class ii{constructor(j,q,$){this.actor=j,this.layerIndex=q,this.availableImages=$,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new R.cY(1e3)}loadVectorTile(j,q){return R._(this,void 0,void 0,(function*(){const $=yield R.n(j.request,q);try{return{vectorTile:j.encoding!=="mlt"?new R.cZ(new R.cV($.data)):new R.c_($.data),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(st){const ut=new Uint8Array($.data);let St=`Unable to parse the tile at ${j.request.url}, `;throw St+=ut[0]===31&&ut[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${st.message}`,new Error(St)}}))}loadTile(j){return R._(this,void 0,void 0,(function*(){const{uid:q,overzoomParameters:$}=j;$&&(j.request=$.overzoomRequest);const st=!!(j&&j.request&&j.request.collectResourceTiming)&&new R.c$(j.request),ut=new vt(j);this.loading[q]=ut;const St=new AbortController;ut.abort=St;try{const J=yield this.loadVectorTile(j,St);if(delete this.loading[q],!J)return null;if($){const pe=this._getOverzoomTile(j,J.vectorTile);J.rawData=pe.rawData,J.vectorTile=pe.vectorTile}const xt=J.rawData,Pt={};J.expires&&(Pt.expires=J.expires),J.cacheControl&&(Pt.cacheControl=J.cacheControl);const Ot={};if(st){const pe=st.finish();pe&&(Ot.resourceTiming=JSON.parse(JSON.stringify(pe)))}ut.vectorTile=J.vectorTile;const Ft=ut.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[q]=ut,this.fetching[q]={rawTileData:xt,cacheControl:Pt,resourceTiming:Ot};try{const pe=yield Ft;return R.e({rawTileData:xt.slice(0),encoding:j.encoding},pe,Pt,Ot)}finally{delete this.fetching[q]}}catch(J){throw delete this.loading[q],ut.status="done",this.loaded[q]=ut,J}}))}_getOverzoomTile(j,q){const{tileID:$,source:st,overzoomParameters:ut}=j,{maxZoomTileID:St}=ut,J=`${St.key}_${$.key}`,xt=this.overzoomedTileResultCache.get(J);if(xt)return xt;const Pt=new Ye,Ot=this.layerIndex.familiesBySource[st];for(const pe in Ot){const Te=q.layers[pe];if(!Te)continue;const Be=We(Te,St,$.canonical);Be.length>0&&Pt.addLayer(Be)}const Ft=be(Pt);return this.overzoomedTileResultCache.set(J,Ft),Ft}reloadTile(j){return R._(this,void 0,void 0,(function*(){const q=j.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[q];if($.showCollisionBoxes=j.showCollisionBoxes,$.status==="parsing"){const st=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let ut;if(this.fetching[q]){const{rawTileData:St,cacheControl:J,resourceTiming:xt}=this.fetching[q];delete this.fetching[q],ut=R.e({rawTileData:St.slice(0),encoding:j.encoding},st,J,xt)}else ut=st;return ut}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)}))}abortTile(j){return R._(this,void 0,void 0,(function*(){const q=this.loading,$=j.uid;q&&q[$]&&q[$].abort&&(q[$].abort.abort(),delete q[$])}))}removeTile(j){return R._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class Pi{constructor(){this.loaded={}}loadTile(j){return R._(this,void 0,void 0,(function*(){const{uid:q,encoding:$,rawImageData:st,redFactor:ut,greenFactor:St,blueFactor:J,baseShift:xt}=j,Pt=st.width+2,Ot=st.height+2,Ft=R.b(st)?new R.R({width:Pt,height:Ot},yield R.d0(st,-1,-1,Pt,Ot)):st,pe=new R.d1(q,Ft,$,ut,St,J,xt);return this.loaded=this.loaded||{},this.loaded[q]=pe,pe}))}removeTile(j){const q=this.loaded,$=j.uid;q&&q[$]&&delete q[$]}}var Wi,yi,jn=(function(){if(yi)return Wi;function ft(q,$){if(q.length!==0){j(q[0],$);for(var st=1;st<q.length;st++)j(q[st],!$)}}function j(q,$){for(var st=0,ut=0,St=0,J=q.length,xt=J-1;St<J;xt=St++){var Pt=(q[St][0]-q[xt][0])*(q[xt][1]+q[St][1]),Ot=st+Pt;ut+=Math.abs(st)>=Math.abs(Pt)?st-Ot+Pt:Pt-Ot+st,st=Ot}st+ut>=0!=!!$&&q.reverse()}return yi=1,Wi=function q($,st){var ut,St=$&&$.type;if(St==="FeatureCollection")for(ut=0;ut<$.features.length;ut++)q($.features[ut],st);else if(St==="GeometryCollection")for(ut=0;ut<$.geometries.length;ut++)q($.geometries[ut],st);else if(St==="Feature")q($.geometry,st);else if(St==="Polygon")ft($.coordinates,st);else if(St==="MultiPolygon")for(ut=0;ut<$.coordinates.length;ut++)ft($.coordinates[ut],st);return $}})(),cn=R.d2(jn);const wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ft=>ft},Ut=Math.fround||(ce=new Float32Array(1),ft=>(ce[0]=+ft,ce[0]));var ce;class Oe{constructor(j){this.options=Object.assign(Object.create(wr),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:q,minZoom:$,maxZoom:st}=this.options;q&&console.time("total time");const ut=`prepare ${j.length} points`;q&&console.time(ut),this.points=j;const St=[];for(let xt=0;xt<j.length;xt++){const Pt=j[xt];if(!Pt.geometry)continue;const[Ot,Ft]=Pt.geometry.coordinates,pe=Ut(Tt(Ot)),Te=Ut(Kt(Ft));St.push(pe,Te,1/0,xt,-1,1),this.options.reduce&&St.push(0)}let J=this.trees[st+1]=this._createTree(St);q&&console.timeEnd(ut);for(let xt=st;xt>=$;xt--){const Pt=+Date.now();J=this.trees[xt]=this._createTree(this._cluster(J,xt)),q&&console.log("z%d: %d clusters in %dms",xt,J.numItems,+Date.now()-Pt)}return q&&console.timeEnd("total time"),this}getClusters(j,q){let $=((j[0]+180)%360+360)%360-180;const st=Math.max(-90,Math.min(90,j[1]));let ut=j[2]===180?180:((j[2]+180)%360+360)%360-180;const St=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)$=-180,ut=180;else if($>ut){const Ft=this.getClusters([$,st,180,St],q),pe=this.getClusters([-180,st,ut,St],q);return Ft.concat(pe)}const J=this.trees[this._limitZoom(q)],xt=J.range(Tt($),Kt(St),Tt(ut),Kt(st)),Pt=J.data,Ot=[];for(const Ft of xt){const pe=this.stride*Ft;Ot.push(Pt[pe+5]>1?De(Pt,pe,this.clusterProps):this.points[Pt[pe+3]])}return Ot}getChildren(j){const q=this._getOriginId(j),$=this._getOriginZoom(j),st="No cluster with the specified id.",ut=this.trees[$];if(!ut)throw new Error(st);const St=ut.data;if(q*this.stride>=St.length)throw new Error(st);const J=this.options.radius/(this.options.extent*Math.pow(2,$-1)),xt=ut.within(St[q*this.stride],St[q*this.stride+1],J),Pt=[];for(const Ot of xt){const Ft=Ot*this.stride;St[Ft+4]===j&&Pt.push(St[Ft+5]>1?De(St,Ft,this.clusterProps):this.points[St[Ft+3]])}if(Pt.length===0)throw new Error(st);return Pt}getLeaves(j,q,$){const st=[];return this._appendLeaves(st,j,q=q||10,$=$||0,0),st}getTile(j,q,$){const st=this.trees[this._limitZoom(j)],ut=Math.pow(2,j),{extent:St,radius:J}=this.options,xt=J/St,Pt=($-xt)/ut,Ot=($+1+xt)/ut,Ft={features:[]};return this._addTileFeatures(st.range((q-xt)/ut,Pt,(q+1+xt)/ut,Ot),st.data,q,$,ut,Ft),q===0&&this._addTileFeatures(st.range(1-xt/ut,Pt,1,Ot),st.data,ut,$,ut,Ft),q===ut-1&&this._addTileFeatures(st.range(0,Pt,xt/ut,Ot),st.data,-1,$,ut,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(j){let q=this._getOriginZoom(j)-1;for(;q<=this.options.maxZoom;){const $=this.getChildren(j);if(q++,$.length!==1)break;j=$[0].properties.cluster_id}return q}_appendLeaves(j,q,$,st,ut){const St=this.getChildren(q);for(const J of St){const xt=J.properties;if(xt&&xt.cluster?ut+xt.point_count<=st?ut+=xt.point_count:ut=this._appendLeaves(j,xt.cluster_id,$,st,ut):ut<st?ut++:j.push(J),j.length===$)break}return ut}_createTree(j){const q=new R.aS(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<j.length;$+=this.stride)q.add(j[$],j[$+1]);return q.finish(),q.data=j,q}_addTileFeatures(j,q,$,st,ut,St){for(const J of j){const xt=J*this.stride,Pt=q[xt+5]>1;let Ot,Ft,pe;if(Pt)Ot=vi(q,xt,this.clusterProps),Ft=q[xt],pe=q[xt+1];else{const hn=this.points[q[xt+3]];Ot=hn.properties;const[He,di]=hn.geometry.coordinates;Ft=Tt(He),pe=Kt(di)}const Te={type:1,geometry:[[Math.round(this.options.extent*(Ft*ut-$)),Math.round(this.options.extent*(pe*ut-st))]],tags:Ot};let Be;Be=Pt||this.options.generateId?q[xt+3]:this.points[q[xt+3]].id,Be!==void 0&&(Te.id=Be),St.features.push(Te)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,q){const{radius:$,extent:st,reduce:ut,minPoints:St}=this.options,J=$/(st*Math.pow(2,q)),xt=j.data,Pt=[],Ot=this.stride;for(let Ft=0;Ft<xt.length;Ft+=Ot){if(xt[Ft+2]<=q)continue;xt[Ft+2]=q;const pe=xt[Ft],Te=xt[Ft+1],Be=j.within(xt[Ft],xt[Ft+1],J),hn=xt[Ft+5];let He=hn;for(const di of Be){const Ri=di*Ot;xt[Ri+2]>q&&(He+=xt[Ri+5])}if(He>hn&&He>=St){let di,Ri=pe*hn,te=Te*hn,Li=-1;const Oi=(Ft/Ot<<5)+(q+1)+this.points.length;for(const En of Be){const fi=En*Ot;if(xt[fi+2]<=q)continue;xt[fi+2]=q;const $t=xt[fi+5];Ri+=xt[fi]*$t,te+=xt[fi+1]*$t,xt[fi+4]=Oi,ut&&(di||(di=this._map(xt,Ft,!0),Li=this.clusterProps.length,this.clusterProps.push(di)),ut(di,this._map(xt,fi)))}xt[Ft+4]=Oi,Pt.push(Ri/He,te/He,1/0,Oi,-1,He),ut&&Pt.push(Li)}else{for(let di=0;di<Ot;di++)Pt.push(xt[Ft+di]);if(He>1)for(const di of Be){const Ri=di*Ot;if(!(xt[Ri+2]<=q)){xt[Ri+2]=q;for(let te=0;te<Ot;te++)Pt.push(xt[Ri+te])}}}}return Pt}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,q,$){if(j[q+5]>1){const St=this.clusterProps[j[q+6]];return $?Object.assign({},St):St}const st=this.points[j[q+3]].properties,ut=this.options.map(st);return $&&ut===st?Object.assign({},ut):ut}}function De(ft,j,q){return{type:"Feature",id:ft[j+3],properties:vi(ft,j,q),geometry:{type:"Point",coordinates:[($=ft[j],360*($-.5)),ge(ft[j+1])]}};var $}function vi(ft,j,q){const $=ft[j+5],st=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,ut=ft[j+6],St=ut===-1?{}:Object.assign({},q[ut]);return Object.assign(St,{cluster:!0,cluster_id:ft[j+3],point_count:$,point_count_abbreviated:st})}function Tt(ft){return ft/360+.5}function Kt(ft){const j=Math.sin(ft*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function ge(ft){const j=(180-360*ft)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function xe(ft,j,q,$){let st=$;const ut=j+(q-j>>1);let St,J=q-j;const xt=ft[j],Pt=ft[j+1],Ot=ft[q],Ft=ft[q+1];for(let pe=j+3;pe<q;pe+=3){const Te=Ne(ft[pe],ft[pe+1],xt,Pt,Ot,Ft);if(Te>st)St=pe,st=Te;else if(Te===st){const Be=Math.abs(pe-ut);Be<J&&(St=pe,J=Be)}}st>$&&(St-j>3&&xe(ft,j,St,$),ft[St+2]=st,q-St>3&&xe(ft,St,q,$))}function Ne(ft,j,q,$,st,ut){let St=st-q,J=ut-$;if(St!==0||J!==0){const xt=((ft-q)*St+(j-$)*J)/(St*St+J*J);xt>1?(q=st,$=ut):xt>0&&(q+=St*xt,$+=J*xt)}return St=ft-q,J=j-$,St*St+J*J}function ke(ft,j,q,$){const st={id:ft??null,type:j,geometry:q,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ke(st,q);else if(j==="Polygon")Ke(st,q[0]);else if(j==="MultiLineString")for(const ut of q)Ke(st,ut);else if(j==="MultiPolygon")for(const ut of q)Ke(st,ut[0]);return st}function Ke(ft,j){for(let q=0;q<j.length;q+=3)ft.minX=Math.min(ft.minX,j[q]),ft.minY=Math.min(ft.minY,j[q+1]),ft.maxX=Math.max(ft.maxX,j[q]),ft.maxY=Math.max(ft.maxY,j[q+1])}function Mi(ft,j,q,$){if(!j.geometry)return;const st=j.geometry.coordinates;if(st&&st.length===0)return;const ut=j.geometry.type,St=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let J=[],xt=j.id;if(q.promoteId?xt=j.properties[q.promoteId]:q.generateId&&(xt=$||0),ut==="Point")Xi(st,J);else if(ut==="MultiPoint")for(const Pt of st)Xi(Pt,J);else if(ut==="LineString")fa(st,J,St,!1);else if(ut==="MultiLineString"){if(q.lineMetrics){for(const Pt of st)J=[],fa(Pt,J,St,!1),ft.push(ke(xt,"LineString",J,j.properties));return}es(st,J,St,!1)}else if(ut==="Polygon")es(st,J,St,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(const Pt of j.geometry.geometries)Mi(ft,{id:xt,geometry:Pt,properties:j.properties},q,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Pt of st){const Ot=[];es(Pt,Ot,St,!0),J.push(Ot)}}ft.push(ke(xt,ut,J,j.properties))}function Xi(ft,j){j.push(Or(ft[0]),Fl(ft[1]),0)}function fa(ft,j,q,$){let st,ut,St=0;for(let xt=0;xt<ft.length;xt++){const Pt=Or(ft[xt][0]),Ot=Fl(ft[xt][1]);j.push(Pt,Ot,0),xt>0&&(St+=$?(st*Ot-Pt*ut)/2:Math.sqrt(Math.pow(Pt-st,2)+Math.pow(Ot-ut,2))),st=Pt,ut=Ot}const J=j.length-3;j[2]=1,xe(j,0,J,q),j[J+2]=1,j.size=Math.abs(St),j.start=0,j.end=j.size}function es(ft,j,q,$){for(let st=0;st<ft.length;st++){const ut=[];fa(ft[st],ut,q,$),j.push(ut)}}function Or(ft){return ft/360+.5}function Fl(ft){const j=Math.sin(ft*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Ci(ft,j,q,$,st,ut,St,J){if($/=j,ut>=(q/=j)&&St<$)return ft;if(St<q||ut>=$)return null;const xt=[];for(const Pt of ft){const Ot=Pt.geometry;let Ft=Pt.type;const pe=st===0?Pt.minX:Pt.minY,Te=st===0?Pt.maxX:Pt.maxY;if(pe>=q&&Te<$){xt.push(Pt);continue}if(Te<q||pe>=$)continue;let Be=[];if(Ft==="Point"||Ft==="MultiPoint")Kr(Ot,Be,q,$,st);else if(Ft==="LineString")pa(Ot,Be,q,$,st,!1,J.lineMetrics);else if(Ft==="MultiLineString")za(Ot,Be,q,$,st,!1);else if(Ft==="Polygon")za(Ot,Be,q,$,st,!0);else if(Ft==="MultiPolygon")for(const hn of Ot){const He=[];za(hn,He,q,$,st,!0),He.length&&Be.push(He)}if(Be.length){if(J.lineMetrics&&Ft==="LineString"){for(const hn of Be)xt.push(ke(Pt.id,Ft,hn,Pt.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(Be.length===1?(Ft="LineString",Be=Be[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=Be.length===3?"Point":"MultiPoint"),xt.push(ke(Pt.id,Ft,Be,Pt.tags))}}return xt.length?xt:null}function Kr(ft,j,q,$,st){for(let ut=0;ut<ft.length;ut+=3){const St=ft[ut+st];St>=q&&St<=$&&ma(j,ft[ut],ft[ut+1],ft[ut+2])}}function pa(ft,j,q,$,st,ut,St){let J=an(ft);const xt=st===0?co:is;let Pt,Ot,Ft=ft.start;for(let He=0;He<ft.length-3;He+=3){const di=ft[He],Ri=ft[He+1],te=ft[He+2],Li=ft[He+3],Oi=ft[He+4],En=st===0?di:Ri,fi=st===0?Li:Oi;let $t=!1;St&&(Pt=Math.sqrt(Math.pow(di-Li,2)+Math.pow(Ri-Oi,2))),En<q?fi>q&&(Ot=xt(J,di,Ri,Li,Oi,q),St&&(J.start=Ft+Pt*Ot)):En>$?fi<$&&(Ot=xt(J,di,Ri,Li,Oi,$),St&&(J.start=Ft+Pt*Ot)):ma(J,di,Ri,te),fi<q&&En>=q&&(Ot=xt(J,di,Ri,Li,Oi,q),$t=!0),fi>$&&En<=$&&(Ot=xt(J,di,Ri,Li,Oi,$),$t=!0),!ut&&$t&&(St&&(J.end=Ft+Pt*Ot),j.push(J),J=an(ft)),St&&(Ft+=Pt)}let pe=ft.length-3;const Te=ft[pe],Be=ft[pe+1],hn=st===0?Te:Be;hn>=q&&hn<=$&&ma(J,Te,Be,ft[pe+2]),pe=J.length-3,ut&&pe>=3&&(J[pe]!==J[0]||J[pe+1]!==J[1])&&ma(J,J[0],J[1],J[2]),J.length&&j.push(J)}function an(ft){const j=[];return j.size=ft.size,j.start=ft.start,j.end=ft.end,j}function za(ft,j,q,$,st,ut){for(const St of ft)pa(St,j,q,$,st,ut,!1)}function ma(ft,j,q,$){ft.push(j,q,$)}function co(ft,j,q,$,st,ut){const St=(ut-j)/($-j);return ma(ft,ut,q+(st-q)*St,1),St}function is(ft,j,q,$,st,ut){const St=(ut-q)/(st-q);return ma(ft,j+($-j)*St,ut,1),St}function ns(ft,j){const q=[];for(let $=0;$<ft.length;$++){const st=ft[$],ut=st.type;let St;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")St=ho(st.geometry,j);else if(ut==="MultiLineString"||ut==="Polygon"){St=[];for(const J of st.geometry)St.push(ho(J,j))}else if(ut==="MultiPolygon"){St=[];for(const J of st.geometry){const xt=[];for(const Pt of J)xt.push(ho(Pt,j));St.push(xt)}}q.push(ke(st.id,ut,St,st.tags))}return q}function ho(ft,j){const q=[];q.size=ft.size,ft.start!==void 0&&(q.start=ft.start,q.end=ft.end);for(let $=0;$<ft.length;$+=3)q.push(ft[$]+j,ft[$+1],ft[$+2]);return q}function Vn(ft,j){if(ft.transformed)return ft;const q=1<<ft.z,$=ft.x,st=ft.y;for(const ut of ft.features){const St=ut.geometry,J=ut.type;if(ut.geometry=[],J===1)for(let xt=0;xt<St.length;xt+=2)ut.geometry.push(kr(St[xt],St[xt+1],j,q,$,st));else for(let xt=0;xt<St.length;xt++){const Pt=[];for(let Ot=0;Ot<St[xt].length;Ot+=2)Pt.push(kr(St[xt][Ot],St[xt][Ot+1],j,q,$,st));ut.geometry.push(Pt)}}return ft.transformed=!0,ft}function kr(ft,j,q,$,st,ut){return[Math.round(q*(ft*$-st)),Math.round(q*(j*$-ut))]}function Nl(ft,j,q,$,st){const ut=j===st.maxZoom?0:st.tolerance/((1<<j)*st.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:ft.length,source:null,x:q,y:$,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const J of ft)jl(St,J,ut,st);return St}function jl(ft,j,q,$){const st=j.geometry,ut=j.type,St=[];if(ft.minX=Math.min(ft.minX,j.minX),ft.minY=Math.min(ft.minY,j.minY),ft.maxX=Math.max(ft.maxX,j.maxX),ft.maxY=Math.max(ft.maxY,j.maxY),ut==="Point"||ut==="MultiPoint")for(let J=0;J<st.length;J+=3)St.push(st[J],st[J+1]),ft.numPoints++,ft.numSimplified++;else if(ut==="LineString")rs(St,st,ft,q,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(let J=0;J<st.length;J++)rs(St,st[J],ft,q,ut==="Polygon",J===0);else if(ut==="MultiPolygon")for(let J=0;J<st.length;J++){const xt=st[J];for(let Pt=0;Pt<xt.length;Pt++)rs(St,xt[Pt],ft,q,!0,Pt===0)}if(St.length){let J=j.tags||null;if(ut==="LineString"&&$.lineMetrics){J={};for(const Pt in j.tags)J[Pt]=j.tags[Pt];J.mapbox_clip_start=st.start/st.size,J.mapbox_clip_end=st.end/st.size}const xt={geometry:St,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:J};j.id!==null&&(xt.id=j.id),ft.features.push(xt)}}function rs(ft,j,q,$,st,ut){const St=$*$;if($>0&&j.size<(st?St:$))return void(q.numPoints+=j.length/3);const J=[];for(let xt=0;xt<j.length;xt+=3)($===0||j[xt+2]>St)&&(q.numSimplified++,J.push(j[xt],j[xt+1])),q.numPoints++;st&&(function(xt,Pt){let Ot=0;for(let Ft=0,pe=xt.length,Te=pe-2;Ft<pe;Te=Ft,Ft+=2)Ot+=(xt[Ft]-xt[Te])*(xt[Ft+1]+xt[Te+1]);if(Ot>0===Pt)for(let Ft=0,pe=xt.length;Ft<pe/2;Ft+=2){const Te=xt[Ft],Be=xt[Ft+1];xt[Ft]=xt[pe-2-Ft],xt[Ft+1]=xt[pe-1-Ft],xt[pe-2-Ft]=Te,xt[pe-1-Ft]=Be}})(J,ut),ft.push(J)}const Vl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Rs{constructor(j,q){const $=(q=this.options=(function(ut,St){for(const J in St)ut[J]=St[J];return ut})(Object.create(Vl),q)).debug;if($&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let st=(function(ut,St){const J=[];if(ut.type==="FeatureCollection")for(let xt=0;xt<ut.features.length;xt++)Mi(J,ut.features[xt],St,xt);else Mi(J,ut.type==="Feature"?ut:{geometry:ut},St);return J})(j,q);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),st=(function(ut,St){const J=St.buffer/St.extent;let xt=ut;const Pt=Ci(ut,1,-1-J,J,0,-1,2,St),Ot=Ci(ut,1,1-J,2+J,0,-1,2,St);return(Pt||Ot)&&(xt=Ci(ut,1,-J,1+J,0,-1,2,St)||[],Pt&&(xt=ns(Pt,1).concat(xt)),Ot&&(xt=xt.concat(ns(Ot,-1)))),xt})(st,q),st.length&&this.splitTile(st,0,0,0),$&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,q,$,st,ut,St,J){const xt=[j,q,$,st],Pt=this.options,Ot=Pt.debug;for(;xt.length;){st=xt.pop(),$=xt.pop(),q=xt.pop(),j=xt.pop();const Ft=1<<q,pe=Ul(q,$,st);let Te=this.tiles[pe];if(!Te&&(Ot>1&&console.time("creation"),Te=this.tiles[pe]=Nl(j,q,$,st,Pt),this.tileCoords.push({z:q,x:$,y:st}),Ot)){Ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,$,st,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));const $t=`z${q}`;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(Te.source=j,ut==null){if(q===Pt.indexMaxZoom||Te.numPoints<=Pt.indexMaxPoints)continue}else{if(q===Pt.maxZoom||q===ut)continue;if(ut!=null){const $t=ut-q;if($!==St>>$t||st!==J>>$t)continue}}if(Te.source=null,j.length===0)continue;Ot>1&&console.time("clipping");const Be=.5*Pt.buffer/Pt.extent,hn=.5-Be,He=.5+Be,di=1+Be;let Ri=null,te=null,Li=null,Oi=null,En=Ci(j,Ft,$-Be,$+He,0,Te.minX,Te.maxX,Pt),fi=Ci(j,Ft,$+hn,$+di,0,Te.minX,Te.maxX,Pt);j=null,En&&(Ri=Ci(En,Ft,st-Be,st+He,1,Te.minY,Te.maxY,Pt),te=Ci(En,Ft,st+hn,st+di,1,Te.minY,Te.maxY,Pt),En=null),fi&&(Li=Ci(fi,Ft,st-Be,st+He,1,Te.minY,Te.maxY,Pt),Oi=Ci(fi,Ft,st+hn,st+di,1,Te.minY,Te.maxY,Pt),fi=null),Ot>1&&console.timeEnd("clipping"),xt.push(Ri||[],q+1,2*$,2*st),xt.push(te||[],q+1,2*$,2*st+1),xt.push(Li||[],q+1,2*$+1,2*st),xt.push(Oi||[],q+1,2*$+1,2*st+1)}}getTile(j,q,$){j=+j,q=+q,$=+$;const st=this.options,{extent:ut,debug:St}=st;if(j<0||j>24)return null;const J=1<<j,xt=Ul(j,q=q+J&J-1,$);if(this.tiles[xt])return Vn(this.tiles[xt],ut);St>1&&console.log("drilling down to z%d-%d-%d",j,q,$);let Pt,Ot=j,Ft=q,pe=$;for(;!Pt&&Ot>0;)Ot--,Ft>>=1,pe>>=1,Pt=this.tiles[Ul(Ot,Ft,pe)];return Pt&&Pt.source?(St>1&&(console.log("found parent tile z%d-%d-%d",Ot,Ft,pe),console.time("drilling down")),this.splitTile(Pt.source,Ot,Ft,pe,j,q,$),St>1&&console.timeEnd("drilling down"),this.tiles[xt]?Vn(this.tiles[xt],ut):null):null}}function Ul(ft,j,q){return 32*((1<<ft)*q+j)+ft}class Ho extends ii{constructor(j,q,$,st=Tr){super(j,q,$),this._dataUpdateable=new Map,this._createGeoJSONIndex=st}loadVectorTile(j,q){return R._(this,void 0,void 0,(function*(){const $=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const st=this._geoJSONIndex.getTile($.z,$.x,$.y);return st?be(new Bt(st.features,{version:2,extent:R.a4})):null}))}loadData(j){return R._(this,void 0,void 0,(function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const $=this._startPerformance(j);this._pendingRequest=new AbortController;try{(!this._pendingData||j.request||j.data||j.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest));const st=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(st,j),this.loaded={};const ut=j.dataDiff&&R.a6(st)?{applyDiff:!0}:{data:st};return this._finishPerformance($,j,ut),ut}catch(st){if(delete this._pendingRequest,R.cH(st))return{abandoned:!0};throw st}}))}_startPerformance(j){var q;if(!((q=j?.request)===null||q===void 0)&&q.collectResourceTiming)return new R.c$(j.request)}_finishPerformance(j,q,$){if(!j)return;const st=j.finish();st&&($.resourceTiming={},$.resourceTiming[q.source]=JSON.parse(JSON.stringify(st)))}getData(){return R._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const q=this.loaded;return q&&q[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,q){return R._(this,void 0,void 0,(function*(){let $;if(j.request?$=yield this.loadGeoJSONFromUrl(j.request,j.promoteId,q):j.data?$=this._loadGeoJSONFromObject(j.data,j.promoteId):j.dataDiff&&($=this._loadGeoJSONFromDiff(j.dataDiff,j.promoteId,j.source)),delete this._pendingRequest,typeof $!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);return cn($,!0),j.filter&&($=this._filterGeoJSON($,j.filter)),$}))}loadGeoJSONFromUrl(j,q,$){return R._(this,void 0,void 0,(function*(){const st=yield R.j(j,$);return this._dataUpdateable=R.a6(st.data,q)?R.a7(st.data,q):void 0,st.data}))}_loadGeoJSONFromObject(j,q){return this._dataUpdateable=R.a6(j,q)?R.a7(j,q):void 0,j}_loadGeoJSONFromDiff(j,q,$){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${$}`);R.a8(this._dataUpdateable,j,q);const st=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(st)}_filterGeoJSON(j,q){const $=R.d3(q,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($.result==="error")throw new Error($.value.map((ut=>`${ut.key}: ${ut.message}`)).join(", "));const st=j.features.filter((ut=>$.value.evaluate({zoom:0},ut)));return this._toFeatureCollection(st)}_toFeatureCollection(j){return{type:"FeatureCollection",features:j}}removeSource(j){return R._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}function Tr(ft,j){return j.cluster?new Oe((function({superclusterOptions:q,clusterProperties:$}){if(!$||!q)return q;const st={},ut={},St={accumulated:null,zoom:0},J={properties:null},xt=Object.keys($);for(const Pt of xt){const[Ot,Ft]=$[Pt],pe=R.d3(Ft),Te=R.d3(typeof Ot=="string"?[Ot,["accumulated"],["get",Pt]]:Ot);st[Pt]=pe.value,ut[Pt]=Te.value}return q.map=Pt=>{J.properties=Pt;const Ot={};for(const Ft of xt)Ot[Ft]=st[Ft].evaluate(St,J);return Ot},q.reduce=(Pt,Ot)=>{J.properties=Ot;for(const Ft of xt)St.accumulated=Pt[Ft],Pt[Ft]=ut[Ft].evaluate(St,J)},q})(j)).load(ft.features):(function(q,$){return new Rs(q,$)})(ft,j.geojsonVtOptions)}class Ki{constructor(j){this.self=j,this.actor=new R.L(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(q,$)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=$},this.self.addProtocol=R.cJ,this.self.removeProtocol=R.cK,this.self.registerRTLTextPlugin=q=>{R.d4.setMethods(q)},this.actor.registerMessageHandler("LDT",((q,$)=>this._getDEMWorkerSource(q,$.source).loadTile($))),this.actor.registerMessageHandler("RDT",((q,$)=>R._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(q,$.source).removeTile($)})))),this.actor.registerMessageHandler("GCEZ",((q,$)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(q,$.type,$.source).getClusterExpansionZoom($)})))),this.actor.registerMessageHandler("GCC",((q,$)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(q,$.type,$.source).getClusterChildren($)})))),this.actor.registerMessageHandler("GCL",((q,$)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(q,$.type,$.source).getClusterLeaves($)})))),this.actor.registerMessageHandler("LD",((q,$)=>this._getWorkerSource(q,$.type,$.source).loadData($))),this.actor.registerMessageHandler("GD",((q,$)=>this._getWorkerSource(q,$.type,$.source).getData())),this.actor.registerMessageHandler("LT",((q,$)=>this._getWorkerSource(q,$.type,$.source).loadTile($))),this.actor.registerMessageHandler("RT",((q,$)=>this._getWorkerSource(q,$.type,$.source).reloadTile($))),this.actor.registerMessageHandler("AT",((q,$)=>this._getWorkerSource(q,$.type,$.source).abortTile($))),this.actor.registerMessageHandler("RMT",((q,$)=>this._getWorkerSource(q,$.type,$.source).removeTile($))),this.actor.registerMessageHandler("RS",((q,$)=>R._(this,void 0,void 0,(function*(){if(!this.workerSources[q]||!this.workerSources[q][$.type]||!this.workerSources[q][$.type][$.source])return;const st=this.workerSources[q][$.type][$.source];delete this.workerSources[q][$.type][$.source],st.removeSource!==void 0&&st.removeSource($)})))),this.actor.registerMessageHandler("RM",(q=>R._(this,void 0,void 0,(function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],this.globalStates.delete(q)})))),this.actor.registerMessageHandler("SR",((q,$)=>R._(this,void 0,void 0,(function*(){this.referrer=$})))),this.actor.registerMessageHandler("SRPS",((q,$)=>this._syncRTLPluginState(q,$))),this.actor.registerMessageHandler("IS",((q,$)=>R._(this,void 0,void 0,(function*(){this.self.importScripts($)})))),this.actor.registerMessageHandler("SI",((q,$)=>this._setImages(q,$))),this.actor.registerMessageHandler("UL",((q,$)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(q).update($.layers,$.removedIds,this._getGlobalState(q))})))),this.actor.registerMessageHandler("UGS",((q,$)=>R._(this,void 0,void 0,(function*(){const st=this._getGlobalState(q);for(const ut in $)st[ut]=$[ut]})))),this.actor.registerMessageHandler("SL",((q,$)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(q).replace($,this._getGlobalState(q))}))))}_getGlobalState(j){let q=this.globalStates.get(j);return q||(q={},this.globalStates.set(j,q)),q}_setImages(j,q){return R._(this,void 0,void 0,(function*(){this.availableImages[j]=q;for(const $ in this.workerSources[j]){const st=this.workerSources[j][$];for(const ut in st)st[ut].availableImages=q}}))}_syncRTLPluginState(j,q){return R._(this,void 0,void 0,(function*(){return yield R.d4.syncState(q,this.self.importScripts)}))}_getAvailableImages(j){let q=this.availableImages[j];return q||(q=[]),q}_getLayerIndex(j){let q=this.layerIndexes[j];return q||(q=this.layerIndexes[j]=new d),q}_getWorkerSource(j,q,$){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][q]||(this.workerSources[j][q]={}),!this.workerSources[j][q][$]){const st={sendAsync:(ut,St)=>(ut.targetMapId=j,this.actor.sendAsync(ut,St))};switch(q){case"vector":this.workerSources[j][q][$]=new ii(st,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][q][$]=new Ho(st,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][q][$]=new this.externalWorkerSourceTypes[q](st,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][q][$]}_getDEMWorkerSource(j,q){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][q]||(this.demWorkerSources[j][q]=new Pi),this.demWorkerSources[j][q]}}return R.i(self)&&(self.worker=new Ki(self)),Ki})),it("index",["exports","./shared"],(function(R,d){var dt="5.13.0";function vt(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let Wt,ee,Bt;const Gt={frame(m,e,a){const u=requestAnimationFrame((g=>{f(),e(g)})),{unsubscribe:f}=d.s(m.signal,"abort",(()=>{f(),cancelAnimationFrame(u),a(d.c())}),!1)},frameAsync(m){return new Promise(((e,a)=>{this.frame(m,e,a)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(Wt||(Wt=document.createElement("a")),Wt.href=m,Wt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Bt!==void 0?Bt:!!matchMedia&&(ee==null&&(ee=matchMedia("(prefers-reduced-motion: reduce)")),ee.matches)},set prefersReducedMotion(m){Bt=m}},se=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Lt(){return se.getCurrentTime()}class _t{static testProp(e){if(!_t.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in _t.docStyle)return e[a];return e[0]}static create(e,a,u){const f=window.document.createElement(e);return a!==void 0&&(f.className=a),u&&u.appendChild(f),f}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){_t.docStyle&&_t.selectProp&&(_t.userSelect=_t.docStyle[_t.selectProp],_t.docStyle[_t.selectProp]="none")}static enableDrag(){_t.docStyle&&_t.selectProp&&(_t.docStyle[_t.selectProp]=_t.userSelect)}static setTransform(e,a){e.style[_t.transformProp]=a}static addEventListener(e,a,u,f={}){e.addEventListener(a,u,"passive"in f?f:f.capture)}static removeEventListener(e,a,u,f={}){e.removeEventListener(a,u,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",_t.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_t.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",_t.suppressClickInternal,!0)}),0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,u){const f=a.boundingClientRect;return new d.P((u.clientX-f.left)/a.x-e.clientLeft,(u.clientY-f.top)/a.y-e.clientTop)}static mousePos(e,a){const u=_t.getScale(e);return _t.getPoint(e,u,a)}static touchPos(e,a){const u=[],f=_t.getScale(e);for(let g=0;g<a.length;g++)u.push(_t.getPoint(e,f,a[g]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=a.querySelectorAll("script");for(const f of u)f.remove();return _t.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){const u=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const a=e.children;for(const u of a)_t.removeAttributes(u),_t.clean(u)}static removeAttributes(e){for(const{name:a,value:u}of e.attributes)_t.isPossiblyDangerous(a,u)&&e.removeAttribute(a)}}_t.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_t.selectProp=_t.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_t.transformProp=_t.testProp(["transform","WebkitTransform"]);const fe={supported:!1,testSupport:function(m){!mi&&le&&(ue?Ye(m):me=m)}};let me,le,mi=!1,ue=!1;function Ye(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,le),m.isContextLost())return;fe.supported=!0}catch{}m.deleteTexture(e),mi=!0}var be;typeof document<"u"&&(le=document.createElement("img"),le.onload=()=>{me&&Ye(me),me=null,ue=!0},le.onerror=()=>{mi=!0,me=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,a,u,f;m.resetRequestQueue=()=>{e=[],a=0,u=0,f={}},m.addThrottleControl=E=>{const D=u++;return f[D]=E,D},m.removeThrottleControl=E=>{delete f[E],v()},m.getImage=(E,D,z=!0)=>new Promise(((B,k)=>{fe.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),d.e(E,{type:"image"}),e.push({abortController:D,requestParameters:E,supportImageRefresh:z,state:"queued",onError:V=>{k(V)},onSuccess:V=>{B(V)}}),v()}));const g=E=>d._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:D,supportImageRefresh:z,onError:B,onSuccess:k,abortController:V}=E,H=z===!1&&!d.i(self)&&!d.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce(((et,at)=>et&&at==="accept"),!0));a++;const W=H?T(D,V):d.m(D,V);try{const et=yield W;delete E.abortController,E.state="completed",et.data instanceof HTMLImageElement||d.b(et.data)?k(et):et.data&&k({data:yield(Q=et.data,typeof createImageBitmap=="function"?d.f(Q):d.h(Q)),cacheControl:et.cacheControl,expires:et.expires})}catch(et){delete E.abortController,B(et)}finally{a--,v()}var Q})),v=()=>{const E=(()=>{for(const D of Object.keys(f))if(f[D]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=a;D<E&&e.length>0;D++){const z=e.shift();z.abortController.signal.aborted?D--:g(z)}},T=(E,D)=>new Promise(((z,B)=>{const k=new Image,V=E.url,H=E.credentials;H&&H==="include"?k.crossOrigin="use-credentials":(H&&H==="same-origin"||!d.d(V))&&(k.crossOrigin="anonymous"),D.signal.addEventListener("abort",(()=>{k.src="",B(d.c())})),k.fetchPriority="high",k.onload=()=>{k.onerror=k.onload=null,z({data:k})},k.onerror=()=>{k.onerror=k.onload=null,D.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},k.src=V}))})(be||(be={})),be.resetRequestQueue();class We{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ii(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:u,url:f}of m){const g=`${u}${f}`;a.indexOf(g)===-1&&(a.push(g),e.push({id:u,url:f}))}}return e}function Pi(m,e,a){try{const u=new URL(m);return u.pathname+=`${e}${a}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Wi(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class yi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let u=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,a){if(!e)return!0;let u=0;for(const f of e){if(f[0]<u||f[1]<f[0]||a<f[1])return!1;u=f[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const u=a.spriteData,f=u&&u.width||a.data.width,g=u&&u.height||a.data.height;return!(e[0]<0||f<e[0]||e[1]<0||g<e[1]||e[2]<0||f<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,u=!0){const f=this.getImage(e);if(u&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,u)=>{let f=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){const a={};for(const u of e){let f=this.getImage(u);f||(this.fire(new d.l("styleimagemissing",{id:u})),f=this.getImage(u)),f?a[u]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],u=this.getImage(e);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const f={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new d.I(f,u);this.patterns[e]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:a,h:u}=d.p(e),f=this.atlasImage;f.resize({width:a||1,height:u||1});for(const g in this.patterns){const{bin:v}=this.patterns[g],T=v.x+1,E=v.y+1,D=this.getImage(g).data,z=D.width,B=D.height;d.R.copy(D,f,{x:0,y:0},{x:T,y:E},{width:z,height:B}),d.R.copy(D,f,{x:0,y:B-1},{x:T,y:E-1},{width:z,height:1}),d.R.copy(D,f,{x:0,y:0},{x:T,y:E+B},{width:z,height:1}),d.R.copy(D,f,{x:z-1,y:0},{x:T-1,y:E},{width:1,height:B}),d.R.copy(D,f,{x:0,y:0},{x:T+z,y:E},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||d.w(`Image with ID: "${a}" was not found`),Wi(u)&&this.updateImage(a,u)}}cloneImages(){const e={};for(const a in this.images){const u=this.images[a];e[a]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return e}}const jn=1e20;function cn(m,e,a,u,f,g,v,T,E){for(let D=e;D<e+u;D++)wr(m,a*g+D,g,f,v,T,E);for(let D=a;D<a+f;D++)wr(m,D*g+e,1,u,v,T,E)}function wr(m,e,a,u,f,g,v){g[0]=0,v[0]=-jn,v[1]=jn,f[0]=m[e];for(let T=1,E=0,D=0;T<u;T++){f[T]=m[e+T*a];const z=T*T;do{const B=g[E];D=(f[T]-f[B]+z-B*B)/(T-B)/2}while(D<=v[E]&&--E>-1);E++,g[E]=T,v[E]=D,v[E+1]=jn}for(let T=0,E=0;T<u;T++){for(;v[E+1]<T;)E++;const D=g[E],z=T-D;m[e+T*a]=f[D]+z*z}}const Ut=d.v.layout_symbol["text-font"].default.join(",");class ce{constructor(e,a,u){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=u}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,(function*(){const a=[];for(const g in e)for(const v of e[g])a.push(this._getAndCacheGlyphsPromise(g,v));const u=yield Promise.all(a),f={};for(const{stack:g,id:v,glyph:T}of u)f[g]||(f[g]={}),f[g][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return f}))}_getAndCacheGlyphsPromise(e,a){return d._(this,void 0,void 0,(function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let f=u.glyphs[a];return f!==void 0?{stack:e,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=u.glyphs[a]=this._drawGlyph(u,e,a),{stack:e,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(e,a)}))}_downloadAndCacheRangePromise(e,a){return d._(this,void 0,void 0,(function*(){const u=this.entries[e],f=Math.floor(a/256);if(u.ranges[f])return{stack:e,id:a,glyph:null};if(!u.requests[f]){const g=ce.loadGlyphRange(e,f,this.url,this.requestManager);u.requests[f]=g}try{const g=yield u.requests[f];for(const v in g)u.glyphs[+v]=g[+v];return u.ranges[f]=!0,{stack:e,id:a,glyph:g[a]||null}}catch(g){const v=u.glyphs[a]=this._drawGlyph(u,e,a);return this._warnOnMissingGlyphRange(v,f,a,g),{stack:e,id:a,glyph:v}}}))}_warnOnMissingGlyphRange(e,a,u,f){const g=256*a,v=g+255,T=u.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${a}, ${g}-${v}. Rendering codepoint U+${T} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&d.q(e)}_drawGlyph(e,a,u){const f=a===Ut&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),g=f?"ideographTinySDF":"tinySDF";e[g]||(e[g]=this._createTinySDF(f?this.localIdeographFontFamily:a));const v=e[g].draw(String.fromCodePoint(u));return{id:u,bitmap:new d.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const a=e?e.split(","):[];a.push("sans-serif");const u=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[f,g]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(e)&&(u=`${g}`);return u}destroy(){for(const e in this.entries){const a=this.entries[e];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}ce.loadGlyphRange=function(m,e,a,u){return d._(this,void 0,void 0,(function*(){const f=256*e,g=f+255,v=u.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${f}-${g}`),"Glyphs"),T=yield d.n(v,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${f}-${g}`);const E={};for(const D of d.o(T.data))E[D.id]=D;return E}))},ce.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:a=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:v="normal",lang:T=null}={}){this.buffer=e,this.cutoff=u,this.radius=a,this.lang=T;const E=this.size=m+4*e,D=this._createCanvas(E),z=this.ctx=D.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${g} ${m}px ${f}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(m),v=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),E=Math.min(this.size-this.buffer,v+Math.ceil(u)),D=T+2*this.buffer,z=E+2*this.buffer,B=Math.max(D*z,0),k=new Uint8ClampedArray(B),V={data:k,width:D,height:z,glyphWidth:T,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(T===0||E===0)return V;const{ctx:H,buffer:W,gridInner:Q,gridOuter:et}=this;this.lang&&(H.lang=this.lang),H.clearRect(W,W,T,E),H.fillText(m,W,W+v);const at=H.getImageData(W,W,T,E);et.fill(jn,0,B),Q.fill(0,0,B);for(let ct=0;ct<E;ct++)for(let nt=0;nt<T;nt++){const ht=at.data[4*(ct*T+nt)+3]/255;if(ht===0)continue;const pt=(ct+W)*D+nt+W;if(ht===1)et[pt]=0,Q[pt]=jn;else{const ot=.5-ht;et[pt]=ot>0?ot*ot:0,Q[pt]=ot<0?ot*ot:0}}cn(et,0,0,D,z,D,this.f,this.v,this.z),cn(Q,W,W,T,E,D,this.f,this.v,this.z);for(let ct=0;ct<B;ct++){const nt=Math.sqrt(et[ct])-Math.sqrt(Q[ct]);k[ct]=Math.round(255-255*(nt/this.radius+this.cutoff))}return V}};class Oe{constructor(){this.specification=d.u.light.position}possiblyEvaluate(e,a){return d.F(e.expression.evaluate(a))}interpolate(e,a,u){return{x:d.G.number(e.x,a.x,u),y:d.G.number(e.y,a.y,u),z:d.G.number(e.z,a.z,u)}}}let De;class vi extends d.E{constructor(e){super(),De=De||new d.t({anchor:new d.D(d.u.light.anchor),position:new Oe,color:new d.D(d.u.light.color),intensity:new d.D(d.u.light.intensity)}),this._transitionable=new d.x(De,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(d.y,e,a))for(const u in e){const f=e[u];u.endsWith(d.z)?this._transitionable.setTransition(u.slice(0,-d.z.length),f):this._transitionable.setValue(u,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u){return(!u||u.validate!==!1)&&d.B(this,e.call(d.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u}))}}const Tt=new d.t({"sky-color":new d.D(d.u.sky["sky-color"]),"horizon-color":new d.D(d.u.sky["horizon-color"]),"fog-color":new d.D(d.u.sky["fog-color"]),"fog-ground-blend":new d.D(d.u.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.u.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.u.sky["atmosphere-blend"])});class Kt extends d.E{constructor(e){super(),this._transitionable=new d.x(Tt,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0))}setSky(e,a={}){if(!this._validate(d.J,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const f=e[u];u.endsWith(d.z)?this._transitionable.setTransition(u.slice(0,-d.z.length),f):this._transitionable.setValue(u,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u={}){return u?.validate!==!1&&d.B(this,e.call(d.C,d.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ge{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const u=e.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,a)),this.dashEntry[u]}getDashRanges(e,a,u){const f=[];let g=e.length%2==1?-e[e.length-1]*u:0,v=e[0]*u,T=!0;f.push({left:g,right:v,isDash:T,zeroLength:e[0]===0});let E=e[0];for(let D=1;D<e.length;D++){T=!T;const z=e[D];g=E*u,E+=z,v=E*u,f.push({left:g,right:v,isDash:T,zeroLength:z===0})}return f}addRoundDash(e,a,u){const f=a/2;for(let g=-u;g<=u;g++){const v=this.width*(this.nextRow+u+g);let T=0,E=e[T];for(let D=0;D<this.width;D++){D/E.right>1&&(E=e[++T]);const z=Math.abs(D-E.left),B=Math.abs(D-E.right),k=Math.min(z,B);let V;const H=g/u*(f+1);if(E.isDash){const W=f-Math.abs(H);V=Math.sqrt(k*k+W*W)}else V=f-Math.sqrt(k*k+H*H);this.data[v+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const E=e[T],D=e[T+1];E.zeroLength?e.splice(T,1):D&&D.isDash===E.isDash&&(D.left=E.left,e.splice(T,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let g=0,v=e[g];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++g]);const E=Math.abs(T-v.left),D=Math.abs(T-v.right),z=Math.min(E,D);this.data[f+T]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(e,a){const u=a?7:0,f=2*u+1;if(this.nextRow+f>this.height)return d.w("LineAtlas out of space"),null;let g=0;for(let T=0;T<e.length;T++)g+=e[T];if(g!==0){const T=this.width/g,E=this.getDashRanges(e,this.width,T);a?this.addRoundDash(E,T,u):this.addRegularDash(E)}const v={y:this.nextRow+u,height:2*u,width:g};return this.nextRow+=f,this.dirty=!0,v}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const xe="maplibre_preloaded_worker_pool";class Ne{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ne.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[xe]}numActive(){return Object.keys(this.active).length}}const ke=Math.floor(Gt.hardwareConcurrency/2);let Ke,Mi;function Xi(){return Ke||(Ke=new Ne),Ke}Ne.workerCount=d.K(globalThis)?Math.max(Math.min(ke,3),1):1;class fa{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let f=0;f<u.length;f++){const g=new d.L(u[f],a);g.name=`Worker ${f}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const u=[];for(const f of this.actors)u.push(f.sendAsync({type:e,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const u of this.actors)u.registerMessageHandler(e,a)}unregisterMessageHandler(e){for(const a of this.actors)a.unregisterMessageHandler(e)}}function es(){return Mi||(Mi=new fa(Xi(),d.M),Mi.registerMessageHandler("GR",((m,e,a)=>d.m(e,a)))),Mi}function Or(m,e){const a=d.N();return d.O(a,a,[1,1,0]),d.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.S(a,a,m.calculatePosMatrix(e.toUnwrapped())):a}function Fl(m,e,a,u,f,g,v){var T;const E=(function(k,V,H){if(k)for(const W of k){const Q=V[W];if(Q&&Q.source===H&&Q.type==="fill-extrusion")return!0}else for(const W in V){const Q=V[W];if(Q.source===H&&Q.type==="fill-extrusion")return!0}return!1})((T=f?.layers)!==null&&T!==void 0?T:null,e,m.id),D=g.maxPitchScaleFactor(),z=m.tilesIn(u,D,E);z.sort(Ci);const B=[];for(const k of z)B.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(e,a,m.getState(),k.queryGeometry,k.cameraQueryGeometry,k.scale,f,g,D,Or(g,k.tileID),v?(V,H)=>v(k.tileID,V,H):void 0)});return(function(k,V){for(const H in k)for(const W of k[H])Kr(W,V);return k})((function(k){const V={},H={};for(const W of k){const Q=W.queryResults,et=W.wrappedTileID,at=H[et]=H[et]||{};for(const ct in Q){const nt=Q[ct],ht=at[ct]=at[ct]||{},pt=V[ct]=V[ct]||[];for(const ot of nt)ht[ot.featureIndex]||(ht[ot.featureIndex]=!0,pt.push(ot))}}return V})(B),m)}function Ci(m,e){const a=m.tileID,u=e.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function Kr(m,e){const a=m.feature,u=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=u}function pa(m,e,a){return d._(this,void 0,void 0,(function*(){let u=m;if(m.url?u=(yield d.j(e.transformRequest(m.url,"Source"),a)).data:yield Gt.frameAsync(a),!u)return null;const f=d.U(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(f.vectorLayerIds=u.vector_layers.map((g=>g.id))),f}))}class an{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.V?new d.V(e.lng,e.lat):d.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.V?new d.V(e.lng,e.lat):d.V.convert(e),this}extend(e){const a=this._sw,u=this._ne;let f,g;if(e instanceof d.V)f=e,g=e;else{if(!(e instanceof an))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(an.convert(e)):this.extend(d.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.V.convert(e)):this;if(f=e._sw,g=e._ne,!f||!g)return this}return a||u?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new d.V(f.lng,f.lat),this._ne=new d.V(g.lng,g.lat)),this}getCenter(){return new d.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.V(this.getWest(),this.getNorth())}getSouthEast(){return new d.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:u}=d.V.convert(e);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}intersects(e){if((e=an.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const a=d.W(this.getWest(),-180,180),u=d.W(this.getEast(),-180,180),f=d.W(e.getWest(),-180,180),g=d.W(e.getEast(),-180,180),v=a>u,T=f>g;return!(!v||!T)||(v?g>=a||f<=u:T?u>=f||a<=g:!(f>u||g<a))}static convert(e){return e instanceof an?e:e&&new an(e)}static fromLngLat(e,a=0){const u=360*a/40075017,f=u/Math.cos(Math.PI/180*e.lat);return new an(new d.V(e.lng-f,e.lat-u),new d.V(e.lng+f,e.lat+u))}adjustAntiMeridian(){const e=new d.V(this._sw.lng,this._sw.lat),a=new d.V(this._ne.lng,this._ne.lat);return new an(e,e.lng>a.lng?new d.V(a.lng+360,a.lat):a)}}class za{constructor(e,a,u){this.bounds=an.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),u=Math.floor(d.Y(this.bounds.getWest())*a),f=Math.floor(d.X(this.bounds.getNorth())*a),g=Math.ceil(d.Y(this.bounds.getEast())*a),v=Math.ceil(d.X(this.bounds.getSouth())*a);return e.x>=u&&e.x<g&&e.y>=f&&e.y<v}}class ma extends d.E{constructor(e,a,u,f){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield pa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new za(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};u.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,v)=>{e.reloadPromise={resolve:g,reject:v}}))}else e.actor=this.dispatcher.getActor(),f="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:f,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=e.tileID.scaledTo(this.maxzoom).canonical,u=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class co extends d.E{constructor(e,a,u,f){super(),this.id=e,this.dispatcher=u,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.U(a,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield pa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(d.e(this,a),a.bounds&&(this.tileBounds=new za(a.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield be.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const f=this.map.painter.context,g=f.gl,v=u.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new d.T(f,v,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class is extends co{constructor(e,a,u,f){super(e,a,u,f),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const f=yield be.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){const g=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const v=d.b(g)&&d.Z()?g:yield this.readImageNow(g),T={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}}))}readImageNow(e){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.$()){const a=e.width+2,u=e.height+2;try{return new d.R({width:a,height:u},yield d.a0(e,-1,-1,a,u))}catch{}}return Gt.getImageData(e,1)}))}_getNeighboringTiles(e){const a=e.canonical,u=Math.pow(2,a.z),f=(a.x-1+u)%u,g=a.x===0?e.wrap-1:e.wrap,v=(a.x+1+u)%u,T=a.x+1===u?e.wrap+1:e.wrap,E={};return E[new d.a1(e.overscaledZ,g,a.z,f,a.y).key]={backfilled:!1},E[new d.a1(e.overscaledZ,T,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(E[new d.a1(e.overscaledZ,g,a.z,f,a.y-1).key]={backfilled:!1},E[new d.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},E[new d.a1(e.overscaledZ,T,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<u&&(E[new d.a1(e.overscaledZ,g,a.z,f,a.y+1).key]={backfilled:!1},E[new d.a1(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},E[new d.a1(e.overscaledZ,T,a.z,v,a.y+1).key]={backfilled:!1}),E}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function ns(m){return m.type==="GeometryCollection"?m.geometries.map((e=>e.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function ho(m){const e=new an;let a;switch(m.type){case"FeatureCollection":a=m.features.map((u=>ns(u.geometry))).flat(1/0);break;case"Feature":a=ns(m.geometry);break;default:a=ns(m)}if(a.length==0)return e;for(let u=0;u<a.length-1;u+=2)e.extend([a[u],a[u+1]]);return e}class Vn extends d.E{constructor(e,a,u,f){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=u.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:d.a4,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.a4,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(d.a4/this.tileSize)}_getClusterMaxZoom(e){const a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,a){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const u=this._updateWorkerData();return a?u:this}updateData(e,a){this._pendingWorkerUpdate.diff=d.a5(this._pendingWorkerUpdate.diff,e);const u=this._updateWorkerData();return a?u:this}getData(){return d._(this,void 0,void 0,(function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return d._(this,void 0,void 0,(function*(){return ho(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:u}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:a}=this._pendingWorkerUpdate,u=d.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(Gt.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=e,this._pendingWorkerUpdate.data=void 0):a&&(u.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));f.applyDiff?this._applyDiff(a):this._data={geojson:f.data};let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&d.e(v,{resourceTiming:g}),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(e){const a=typeof this.promoteId=="string"?this.promoteId:void 0;this._data.url||this._data.updateable||!d.a6(this._data.geojson,a)||(this._data={updateable:d.a7(this._data.geojson,a)}),e&&this._data.updateable?d.a8(this._data.updateable,e,a):d.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(e){if(this._options.cluster||!e||e.removeAll)return;const{add:a=[],update:u=[],remove:f=[]}=e||{},g=new Set([...u.map((v=>v.id)),...f]);for(const v of g.values())if(typeof v!="number"&&this.promoteId==null)return void d.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${v}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...u.map((v=>v.newGeometry)),...a.map((v=>v.geometry))].filter(Boolean).map((v=>ho(v))),prevIds:g}}shouldReloadTile(e,{nextBounds:a,prevIds:u}){if(!e.latestFeatureIndex)return e.state!=="unloaded";const f=e.latestFeatureIndex.loadVTLayers();for(let E=0;E<e.latestFeatureIndex.featureIndexArray.length;E++){const D=e.latestFeatureIndex.featureIndexArray.get(E),z=f[d.a9].feature(D.featureIndex),B=e.latestFeatureIndex.getId(z,d.a9);if(u.has(B))return!0}const{buffer:g,extent:v}=this.workerOptions.geojsonVtOptions,T=(function({x:E,y:D,z},B=0){const k=d.a2((E-B)/Math.pow(2,z)),V=d.a3((D+1+B)/Math.pow(2,z)),H=d.a2((E+1+B)/Math.pow(2,z)),W=d.a3((D-B)/Math.pow(2,z));return new an([k,V],[H,W])})(e.tileID.canonical,g/v);for(const E of a)if(T.intersects(E))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return d._(this,void 0,void 0,(function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(e){return d._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return d._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class kr extends d.E{constructor(e,a,u,f){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(e){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield be.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new d.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(d.aa.fromLngLat);var u;return this.tileID=(function(f){const g=d.ab.fromPoints(f),v=g.width(),T=g.height(),E=Math.max(v,T),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),z=Math.pow(2,D);return new d.ad(D,Math.floor((g.minX+g.maxX)/2*z),Math.floor((g.minY+g.maxY)/2*z))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new d.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:a,minY:u,maxX:f,maxY:g}=d.ab.fromPoints(e),v={};for(let T=0;T<=d.ac;T++){const E=Math.pow(2,T),D=Math.floor(a*E),z=Math.floor(u*E),B=Math.floor(f*E),k=Math.floor(g*E);v[T]={minTileX:D,minTileY:z,maxTileX:B,maxTileY:k}}return v}}class Nl extends kr{constructor(e,a,u,f){super(e,a,u,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.ae(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new d.k(new d.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class jl extends kr{constructor(e,a,u,f){super(e,a,u,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((v=>typeof v!="number"))))||this.fire(new d.k(new d.af(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.af(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.k(new d.af(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.af(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.af(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(a,this.canvas,u.RGBA,{premultiply:!0});let f=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,f=!0)}f&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const rs={},Vl=m=>{switch(m){case"geojson":return Vn;case"image":return kr;case"raster":return co;case"raster-dem":return is;case"vector":return ma;case"video":return Nl;case"canvas":return jl}return rs[m]},Rs="RTLPluginLoaded";class Ul extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=es()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,(function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Gt.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(Rs))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ho=null;function Tr(){return Ho||(Ho=new Ul),Ho}var Ki,ft;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Ki||(Ki={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(ft||(ft={}));class j{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=d.ag(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:u,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=u,this.fadeEndTime=f}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Lt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(f,g){const v={};if(!g)return v;for(const T of f){const E=T.layerIds.map((D=>g.getLayer(D))).filter(Boolean);if(E.length!==0){T.layers=E,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map((D=>E.filter((z=>z.id===D))[0])));for(const D of E)v[D.id]=T}}return v})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof d.ai){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof d.ai&&g.hasRTLText){this.hasRTLText=!0,Tr().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new d.ah}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,u,f,g,v,T,E,D,z,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:E,params:T,queryPadding:this.queryPadding*D,getElevation:B},e,a,u):{}}querySourceFeatures(e,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",v=f[d.a9]||f[g];if(!v)return;const T=d.aj(a?.filter,a?.globalState),{z:E,x:D,y:z}=this.tileID.canonical,B={z:E,x:D,y:z};for(let k=0;k<v.length;k++){const V=v.feature(k);if(T.needGeometry){const Q=d.ak(V,!0);if(!T.filter(new d.H(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!T.filter(new d.H(this.tileID.overscaledZ),V))continue;const H=u.getId(V,g),W=new d.al(V,E,D,z,H);W.tile=B,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const u=d.am(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const g=this.expirationTime-a;g?this.expirationTime=u+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const g=this.buckets[f],v=g.layers[0].sourceLayer||d.a9,T=u[v],E=e[v];if(!T||!E||Object.keys(E).length===0)continue;g.update(E,T,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const D=a&&a.style&&a.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Lt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Lt()+e}setDependencies(e,a){const u={};for(const f of a)u[f]=!0;this.dependencies[e]=u}hasDependency(e,a){for(const u of e){const f=this.dependencies[u];if(f){for(const g of a)if(f[g])return!0}}return!1}}class q{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,u){const f=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},d.e(this.stateChanges[e][f],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==f&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const g in this.state[e][f])u[g]||(this.deletedStates[e][f][g]=null)}else for(const g in u)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][g]===null&&delete this.deletedStates[e][f][g]}removeFeatureState(e,a,u){if(this.deletedStates[e]===null)return;const f=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&a!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][u]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(u in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][u]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,a){const u=String(a),f=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][a];if(g===null)return{};for(const v in g)delete f[v]}return f}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),d.e(this.state[f][v],this.stateChanges[f][v]),g[v]=this.state[f][v];u[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const v in this.state[f])g[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else for(const T of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][T];g[v]=this.state[f][v]}u[f]=u[f]||{},d.e(u[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const f in e)e[f].setFeatureState(u,a)}}const $=89.25;function st(m,e){const a=d.an(e.lat,-d.ao,d.ao);return new d.P(d.Y(e.lng)*m,d.X(a)*m)}function ut(m,e){return new d.aa(e.x/m,e.y/m).toLngLat()}function St(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.ap(90-m.pitch)),Math.tan(d.ap($-m.pitch)))}function J(m,e){const a=m.canonical,u=e/d.aq(a.z),f=a.x+Math.pow(2,a.z)*m.wrap,g=d.ar(new Float64Array(16));return d.O(g,g,[f*u,a.y*u,0]),d.Q(g,g,[u/d.a4,u/d.a4,1]),g}function xt(m,e,a,u,f){const g=d.aa.fromLngLat(m,e),v=f*d.as(1,m.lat),T=v*Math.cos(d.ap(a)),E=Math.sqrt(v*v-T*T),D=E*Math.sin(d.ap(-u)),z=E*Math.cos(d.ap(-u));return new d.aa(g.x+D,g.y+z,g.z+T)}function Pt(m,e,a){const u=e.intersectsFrustum(m);if(!a||u===0)return u;const f=e.intersectsPlane(a);return f===0?0:u===2&&f===2?2:1}function Ot(m,e,a){let u=0;const f=(a-e)/10;for(let g=0;g<10;g++)u+=f*Math.pow(Math.cos(e+(g+.5)/10*(a-e)),m);return u}function Ft(m,e){return function(a,u,f,g,v){const T=2*((m-1)/d.at(Math.cos(d.ap($-v))/Math.cos(d.ap($)))-1),E=Math.acos(f/g),D=2*Ot(T-1,0,d.ap(v/2)),z=Math.min(d.ap($),E+d.ap(v/2)),B=Ot(T-1,Math.min(z,E-d.ap(v/2)),z),k=Math.atan(u/f),V=Math.hypot(u,f);let H=a;return H+=d.at(g/V/Math.max(.5,Math.cos(d.ap(v/2)))),H+=T*d.at(Math.cos(k))/2,H-=d.at(Math.max(1,B/D/e))/2,H}}const pe=Ft(9.314,3);function Te(m,e){const a=(e.roundZoom?Math.round:Math.floor)(m.zoom+d.at(m.tileSize/e.tileSize));return Math.max(0,a)}function Be(m,e){const a=m.getCameraFrustum(),u=m.getClippingPlane(),f=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=d.aa.fromLngLat(m.center,m.elevation);f.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),T=v.allowVariableZoom(m,e),E=Te(m,e),D=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,B=Math.min(Math.max(0,E),z),k=Math.pow(2,B),V=[k*f.x,k*f.y,0],H=[k*g.x,k*g.y,0],W=Math.hypot(g.x-f.x,g.y-f.y),Q=Math.abs(g.z-f.z),et=Math.hypot(W,Q),at=ht=>({zoom:0,x:0,y:0,wrap:ht,fullyVisible:!1}),ct=[],nt=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let ht=1;ht<=3;ht++)ct.push(at(-ht)),ct.push(at(ht));for(ct.push(at(0));ct.length>0;){const ht=ct.pop(),pt=ht.x,ot=ht.y;let bt=ht.fullyVisible;const It={x:pt,y:ot,z:ht.zoom},Mt=v.getTileBoundingVolume(It,ht.wrap,m.elevation,e);if(!bt){const ne=Pt(a,Mt,u);if(ne===0)continue;bt=ne===2}const Ct=v.distanceToTile2d(f.x,f.y,It,Mt);let At=E;T&&(At=(e.calculateTileZoom||pe)(m.zoom+d.at(m.tileSize/e.tileSize),Ct,Q,et,m.fov)),At=(e.roundZoom?Math.round:Math.floor)(At),At=Math.max(0,At);const ie=Math.min(At,z);if(ht.wrap=v.getWrap(g,It,ht.wrap),ht.zoom>=ie){if(ht.zoom<D)continue;const ne=B-ht.zoom,qt=V[0]-.5-(pt<<ne),_e=V[1]-.5-(ot<<ne),je=e.reparseOverscaled?Math.max(ht.zoom,At):ht.zoom;nt.push({tileID:new d.a1(ht.zoom===z?je:ht.zoom,ht.wrap,ht.zoom,pt,ot),distanceSq:d.au([H[0]-.5-pt,H[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(qt*qt+_e*_e)})}else for(let ne=0;ne<4;ne++)ct.push({zoom:ht.zoom+1,x:(pt<<1)+ne%2,y:(ot<<1)+(ne>>1),wrap:ht.wrap,fullyVisible:bt})}return nt.sort(((ht,pt)=>ht.distanceSq-pt.distanceSq)).map((ht=>ht.tileID))}const hn=d.ab.fromPoints([new d.P(0,0),new d.P(d.a4,d.a4)]);class He extends d.E{constructor(e,a,u){super(),this.id=e,this.dispatcher=u,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,g,v,T)=>{const E=new(Vl(g.type))(f,g,v,T);if(E.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${E.id}`);return E})(e,a,u,this),this._tiles={},this._cache=new d.av(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new q,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,u){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,u)}catch(f){e.state="errored",f.status!==404?this._source.fire(new d.k(f,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(di).map((e=>e.key))}getRenderableIds(e){const a=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&a.push(this._tiles[u]);return e?a.sort(((u,f)=>{const g=u.tileID,v=f.tileID,T=new d.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),E=new d.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-v.overscaledZ||E.y-T.y||E.x-T.x})).map((u=>u.tileID.key)):a.map((u=>u.tileID)).sort(di).map((u=>u.key))}hasRenderableParent(e){const a=e.overscaledZ-1;if(a>=this._source.minzoom){const u=this.getLoadedTile(e.scaledTo(a));if(u)return this._isIdRenderable(u.tileID.key)}return!1}_isIdRenderable(e,a=!1){var u;return(u=this._tiles[e])===null||u===void 0?void 0:u.isRenderable(a)}reload(e,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)a&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[u],a)||(e?this._reloadTile(u,"expired"):this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading"))}}_reloadTile(e,a){return d._(this,void 0,void 0,(function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,e,a))}))}_tileLoaded(e,a,u){e.timeAdded=Lt(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const g=a[f];if(e.neighboringTiles&&e.neighboringTiles[g]){const v=this.getTileByID(g);u(e,v),u(v,e)}}function u(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-f.tileID.canonical.x;const T=g.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=g.tileID.key;v===0&&T===0||Math.abs(T)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,v,T),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){const u=this._getLoadedDescendents(a),f=new Set;for(const g of a){const v=u[g.key];if(!v?.length){f.add(g);continue}const T=g.overscaledZ+He.maxOverzooming,E=v.filter((B=>B.tileID.overscaledZ<=T));if(!E.length){f.add(g);continue}const D=Math.min(...E.map((B=>B.tileID.overscaledZ))),z=E.filter((B=>B.tileID.overscaledZ===D)).map((B=>B.tileID));for(const B of z)e[B.key]=B;this._areDescendentsComplete(z,D,g.overscaledZ)||f.add(g)}return f}_getLoadedDescendents(e){var a;const u={};for(const f in this._tiles){const g=this._tiles[f];if(g.hasData())for(const v of e)g.tileID.isChildOf(v)&&(u[a=v.key]||(u[a]=[])).push(g)}return u}_areDescendentsComplete(e,a,u){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-u)===e.length}getLoadedTile(e){const a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const u={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new d.a1(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(u=Be(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((E=>this._source.hasTile(E))))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const f=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=Te(e,this._source),v=this._updateRetainedTiles(u,g),T=Ri(this._source.type);T&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(u,v),T?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(e){for(const a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(const a in this._tiles){const u=this._tiles[a];e[a]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(a):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){const a=[];for(const u of e)if(u.canonical.z>this._source.minzoom){const f=u.scaledTo(u.canonical.z-1);a.push(f);const g=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));a.push(g)}return e.concat(a)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var u;const f=new Set;for(const D of e)this._addTile(D).hasData()||f.add(D);const g=e.reduce(((D,z)=>(D[z.key]=z,D)),{}),v=this._retainLoadedChildren(g,f),T={},E=Math.max(a-He.maxUnderzooming,this._source.minzoom);for(const D of v){let z=this._tiles[D.key],B=z?.wasRequested();for(let k=D.overscaledZ-1;k>=E;--k){const V=D.scaledTo(k);if(T[V.key])break;if(T[V.key]=!0,z=this.getTile(V),!z&&B&&(z=this._addTile(V)),z){const H=z.hasData();if((H||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||B)&&(g[V.key]=V),B=z.wasRequested(),H)break}}}return g}_updateFadingTiles(e,a){const u=Lt(),f=d.aw(e);for(const g of e){const v=this._tiles[g.key];v.fadingDirection!==ft.Departing&&v.fadeOpacity!==0||v.resetFadeLogic(),this._updateFadingAncestor(v,a,u)||this._updateFadingDescendents(v,a,u)||this._updateFadingEdge(v,f,u)||v.resetFadeLogic()}}_updateFadingAncestor(e,a,u){if(!e.hasData())return!1;const{tileID:f,fadingRole:g,fadingDirection:v,fadingParentID:T}=e;if(g===Ki.Base&&v===ft.Incoming&&T)return a[T.key]=T,!0;const E=Math.max(f.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let D=f.overscaledZ-1;D>=E;D--){const z=f.scaledTo(D),B=this.getLoadedTile(z);if(B)return e.setCrossFadeLogic({fadingRole:Ki.Base,fadingDirection:ft.Incoming,fadingParentID:B.tileID,fadeEndTime:u+this._rasterFadeDuration}),B.setCrossFadeLogic({fadingRole:Ki.Parent,fadingDirection:ft.Departing,fadeEndTime:u+this._rasterFadeDuration}),a[z.key]=z,!0}return!1}_updateFadingDescendents(e,a,u){if(!e.hasData())return!1;const f=e.tileID.children(this._source.maxzoom);let g=this._updateFadingChildren(e,f,a,u);if(g)return!0;for(const v of f){const T=v.children(this._source.maxzoom);this._updateFadingChildren(e,T,a,u)&&(g=!0)}return g}_updateFadingChildren(e,a,u,f){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let g=!1;for(const v of a){const T=this.getLoadedTile(v);if(!T)continue;const{fadingRole:E,fadingDirection:D,fadingParentID:z}=T;E===Ki.Base&&D===ft.Departing&&z||(T.setCrossFadeLogic({fadingRole:Ki.Base,fadingDirection:ft.Departing,fadingParentID:e.tileID,fadeEndTime:f+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Ki.Parent,fadingDirection:ft.Incoming,fadeEndTime:f+this._rasterFadeDuration})),u[v.key]=v,g=!0}return g}_updateFadingEdge(e,a,u){const f=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(f)&&(e.setSelfFadeLogic(u+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));const u=a;return a||(a=new j(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,u||this._source.fire(new d.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);const u=a.getExpiryTimeout();u&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),u))}_clearTileReloadTimer(e){const a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((u=>u.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,u){const f=[],g=this.transform;if(!g)return f;const v=g.getCoveringTilesDetailsProvider().allowWorldCopies(),T=u?g.getCameraQueryGeometry(e):e,E=V=>g.screenPointToMercatorCoordinate(V,this.terrain),D=this.transformBbox(e,E,!v),z=this.transformBbox(T,E,!v),B=this.getIds(),k=d.ab.fromPoints(z);for(let V=0;V<B.length;V++){const H=this._tiles[B[V]];if(H.holdingForSymbolFade())continue;const W=v?[H.tileID]:[H.tileID.unwrapTo(-1),H.tileID.unwrapTo(0)],Q=Math.pow(2,g.zoom-H.tileID.overscaledZ),et=a*H.queryPadding*d.a4/H.tileSize/Q;for(const at of W){const ct=k.map((nt=>at.getTilePoint(new d.aa(nt.x,nt.y))));if(ct.expandBy(et),ct.intersects(hn)){const nt=D.map((pt=>at.getTilePoint(pt))),ht=z.map((pt=>at.getTilePoint(pt)));f.push({tile:H,tileID:v?at:at.unwrapTo(0),queryGeometry:nt,cameraQueryGeometry:ht,scale:Q})}}}return f}transformBbox(e,a,u){let f=e.map(a);if(u){const g=d.ab.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const v=g.map(a);d.ab.fromPoints(f).covers(v)||(f=f.map((T=>T.x>.5?new d.aa(T.x-1,T.y,T.z):T)))}return f}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map((u=>this._tiles[u].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ri(this._source.type)&&this._rasterFadeDuration>0){const e=Lt();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,u){this._state.updateState(e=e||d.a9,a,u)}removeFeatureState(e,a,u){this._state.removeFeatureState(e=e||d.a9,a,u)}getFeatureState(e,a){return this._state.getState(e=e||d.a9,a)}setDependencies(e,a,u){const f=this._tiles[e];f&&f.setDependencies(a,u)}reloadTilesForDependencies(e,a){for(const u in this._tiles)this._tiles[u].hasDependency(e,a)&&this._reloadTile(u,"reloading");this._cache.filter((u=>!u.hasDependency(e,a)))}}function di(m,e){const a=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-a||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Ri(m){return m==="raster"||m==="image"||m==="video"}He.maxUnderzooming=10,He.maxOverzooming=3;class te{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.an(e,0,1);let a=1,u=this._distances[a];const f=e*this.paddedLength+this.padding;for(;u<f&&a<this._distances.length;)u=this._distances[++a];const g=a-1,v=this._distances[g],T=u-v,E=T>0?(f-v)/T:0;return this.points[g].mult(1-E).add(this.points[a].mult(E))}}function Li(m,e){let a=!0;return m==="always"||m!=="never"&&e!=="never"||(a=!1),a}class Oi{constructor(e,a,u){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(a/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,u,f,g){this._forEachCell(a,u,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(e,a,u,f){this._forEachCell(a-f,u-f,a+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(u),this.circles.push(f)}_insertBoxCell(e,a,u,f,g,v){this.boxCells[g].push(v)}_insertCircleCell(e,a,u,f,g,v){this.circleCells[g].push(v)}_query(e,a,u,f,g,v,T){if(u<0||e>this.width||f<0||a>this.height)return[];const E=[];if(e<=0&&a<=0&&this.width<=u&&this.height<=f){if(g)return[{key:null,x1:e,y1:a,x2:u,y2:f}];for(let D=0;D<this.boxKeys.length;D++)E.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const z=this.circles[3*D],B=this.circles[3*D+1],k=this.circles[3*D+2];E.push({key:this.circleKeys[D],x1:z-k,y1:B-k,x2:z+k,y2:B+k})}}else this._forEachCell(e,a,u,f,this._queryCell,E,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},T);return E}query(e,a,u,f){return this._query(e,a,u,f,!1,null)}hitTest(e,a,u,f,g,v){return this._query(e,a,u,f,!0,g,v).length>0}hitTestCircle(e,a,u,f,g){const v=e-u,T=e+u,E=a-u,D=a+u;if(T<0||v>this.width||D<0||E>this.height)return!1;const z=[];return this._forEachCell(v,E,T,D,this._queryCellCircle,z,{hitTest:!0,overlapMode:f,circle:{x:e,y:a,radius:u},seenUids:{box:{},circle:{}}},g),z.length>0}_queryCell(e,a,u,f,g,v,T,E){const{seenUids:D,hitTest:z,overlapMode:B}=T,k=this.boxCells[g];if(k!==null){const H=this.bboxes;for(const W of k)if(!D.box[W]){D.box[W]=!0;const Q=4*W,et=this.boxKeys[W];if(e<=H[Q+2]&&a<=H[Q+3]&&u>=H[Q+0]&&f>=H[Q+1]&&(!E||E(et))&&(!z||!Li(B,et.overlapMode))&&(v.push({key:et,x1:H[Q],y1:H[Q+1],x2:H[Q+2],y2:H[Q+3]}),z))return!0}}const V=this.circleCells[g];if(V!==null){const H=this.circles;for(const W of V)if(!D.circle[W]){D.circle[W]=!0;const Q=3*W,et=this.circleKeys[W];if(this._circleAndRectCollide(H[Q],H[Q+1],H[Q+2],e,a,u,f)&&(!E||E(et))&&(!z||!Li(B,et.overlapMode))){const at=H[Q],ct=H[Q+1],nt=H[Q+2];if(v.push({key:et,x1:at-nt,y1:ct-nt,x2:at+nt,y2:ct+nt}),z)return!0}}}return!1}_queryCellCircle(e,a,u,f,g,v,T,E){const{circle:D,seenUids:z,overlapMode:B}=T,k=this.boxCells[g];if(k!==null){const H=this.bboxes;for(const W of k)if(!z.box[W]){z.box[W]=!0;const Q=4*W,et=this.boxKeys[W];if(this._circleAndRectCollide(D.x,D.y,D.radius,H[Q+0],H[Q+1],H[Q+2],H[Q+3])&&(!E||E(et))&&!Li(B,et.overlapMode))return v.push(!0),!0}}const V=this.circleCells[g];if(V!==null){const H=this.circles;for(const W of V)if(!z.circle[W]){z.circle[W]=!0;const Q=3*W,et=this.circleKeys[W];if(this._circlesCollide(H[Q],H[Q+1],H[Q+2],D.x,D.y,D.radius)&&(!E||E(et))&&!Li(B,et.overlapMode))return v.push(!0),!0}}}_forEachCell(e,a,u,f,g,v,T,E){const D=this._convertToXCellCoord(e),z=this._convertToYCellCoord(a),B=this._convertToXCellCoord(u),k=this._convertToYCellCoord(f);for(let V=D;V<=B;V++)for(let H=z;H<=k;H++)if(g.call(this,e,a,u,f,this.xCellCount*H+V,v,T,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,u,f,g,v){const T=f-e,E=g-a,D=u+v;return D*D>T*T+E*E}_circleAndRectCollide(e,a,u,f,g,v,T){const E=(v-f)/2,D=Math.abs(e-(f+E));if(D>E+u)return!1;const z=(T-g)/2,B=Math.abs(a-(g+z));if(B>z+u)return!1;if(D<=E||B<=z)return!0;const k=D-E,V=B-z;return k*k+V*V<=u*u}}function En(m,e,a){const u=d.N();if(!m){const{vecSouth:B,vecEast:k}=$t(e),V=vt();V[0]=k[0],V[1]=k[1],V[2]=B[0],V[3]=B[1],f=V,(z=(v=(g=V)[0])*(D=g[3])-(E=g[2])*(T=g[1]))&&(f[0]=D*(z=1/z),f[1]=-T*z,f[2]=-E*z,f[3]=v*z),u[0]=V[0],u[1]=V[1],u[4]=V[2],u[5]=V[3]}var f,g,v,T,E,D,z;return d.Q(u,u,[1/a,1/a,1]),u}function fi(m,e,a,u){if(m){const f=d.N();if(!e){const{vecSouth:g,vecEast:v}=$t(a);f[0]=v[0],f[1]=v[1],f[4]=g[0],f[5]=g[1]}return d.Q(f,f,[u,u,1]),f}return a.pixelsToClipSpaceMatrix}function $t(m){const e=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),u=Math.cos(m.pitchInRadians),f=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),v=d.aB();v[0]=-f*u*a-g*e,v[1]=-g*u*a+f*e;const T=d.aC(v);T<1e-9?d.aD(v):d.aE(v,v,1/T);const E=d.aB();E[0]=f*u*e-g*a,E[1]=g*u*e+f*a;const D=d.aC(E);return D<1e-9?d.aD(E):d.aE(E,E,1/D),{vecEast:E,vecSouth:v}}function he(m,e,a,u){let f;u?(f=[m,e,u(m,e),1],d.aG(f,f,a)):(f=[m,e,0,1],Iu(f,f,a));const g=f[3];return{point:new d.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Se(m,e){return .5+m/e*.5}function fr(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function $o(m,e,a,u,f,g,v,T,E,D,z,B,k){const V=a?m.textSizeData:m.iconSizeData,H=d.ax(V,e.transform.zoom),W=[256/e.width*2+1,256/e.height*2+1],Q=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();const et=m.lineVertexArray,at=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,ct=e.transform.width/e.transform.height;let nt=!1;for(let ht=0;ht<at.length;ht++){const pt=at.get(ht);if(pt.hidden||pt.writingMode===d.ay.vertical&&!nt){Sr(pt.numGlyphs,Q);continue}nt=!1;const ot=new d.P(pt.anchorX,pt.anchorY),bt={getElevation:k,pitchedLabelPlaneMatrix:u,lineVertexArray:et,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ot,unwrappedTileID:E,width:D,height:z,translation:B},It=La(pt.anchorX,pt.anchorY,bt);if(!fr(It.point,W)){Sr(pt.numGlyphs,Q);continue}const Mt=Se(e.transform.cameraToCenterDistance,It.signedDistanceFromCamera),Ct=d.az(V,H,pt),At=g?Ct*e.transform.getPitchedTextCorrection(pt.anchorX,pt.anchorY,E)/Mt:Ct*Mt,ie=Qr({projectionContext:bt,pitchedLabelPlaneMatrixInverse:f,symbol:pt,fontSize:At,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ct,rotateToLine:T});nt=ie.useVertical,(ie.notEnoughRoom||nt||ie.needsFlipping&&Qr({projectionContext:bt,pitchedLabelPlaneMatrixInverse:f,symbol:pt,fontSize:At,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ct,rotateToLine:T}).notEnoughRoom)&&Sr(pt.numGlyphs,Q)}a?m.text.dynamicLayoutVertexBuffer.updateData(Q):m.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Qn(m,e,a,u,f,g,v,T){const E=g.glyphStartIndex+g.numGlyphs,D=g.lineStartIndex,z=g.lineStartIndex+g.lineLength,B=e.getoffsetX(g.glyphStartIndex),k=e.getoffsetX(E-1),V=ki(m*B,a,u,f,g.segment,D,z,T,v);if(!V)return null;const H=ki(m*k,a,u,f,g.segment,D,z,T,v);return H?T.projectionCache.anyProjectionOccluded?null:{first:V,last:H}:null}function Pe(m,e,a,u){return m===d.ay.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*u?{useVertical:!0}:(m===d.ay.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function Qr(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:u,fontSize:f,flip:g,keepUpright:v,glyphOffsetArray:T,dynamicLayoutVertexArray:E,aspectRatio:D,rotateToLine:z}=m,B=f/24,k=u.lineOffsetX*B,V=u.lineOffsetY*B;let H;if(u.numGlyphs>1){const W=u.glyphStartIndex+u.numGlyphs,Q=u.lineStartIndex,et=u.lineStartIndex+u.lineLength,at=Qn(B,T,k,V,g,u,z,e);if(!at)return{notEnoughRoom:!0};const ct=Ra(at.first.point.x,at.first.point.y,e,a),nt=Ra(at.last.point.x,at.last.point.y,e,a);if(v&&!g){const ht=Pe(u.writingMode,ct,nt,D);if(ht)return ht}H=[at.first];for(let ht=u.glyphStartIndex+1;ht<W-1;ht++){const pt=ki(B*T.getoffsetX(ht),k,V,g,u.segment,Q,et,e,z);if(!pt)return{notEnoughRoom:!0};H.push(pt)}H.push(at.last)}else{if(v&&!g){const Q=pr(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,et=u.lineStartIndex+u.segment+1,at=new d.P(e.lineVertexArray.getx(et),e.lineVertexArray.gety(et)),ct=pr(at.x,at.y,e),nt=ct.signedDistanceFromCamera>0?ct.point:fo(e.tileAnchorPoint,at,Q,1,e),ht=Ra(Q.x,Q.y,e,a),pt=Ra(nt.x,nt.y,e,a),ot=Pe(u.writingMode,ht,pt,D);if(ot)return ot}const W=ki(B*T.getoffsetX(u.glyphStartIndex),k,V,g,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,z);if(!W||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[W]}for(const W of H)d.aF(E,W.point,W.angle);return{}}function fo(m,e,a,u,f){const g=m.add(m.sub(e)._unit()),v=pr(g.x,g.y,f).point,T=a.sub(v);return a.add(T._mult(u/T.mag()))}function Pa(m,e,a){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const f=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=pr(f.x,f.y,e);if(g.signedDistanceFromCamera>0)return u.projections[m]=g.point,u.anyProjectionOccluded=u.anyProjectionOccluded||g.isOccluded,g.point;const v=m-a.direction;return fo(a.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function pr(m,e,a){const u=m+a.translation[0],f=e+a.translation[1];let g;return a.pitchWithMap?(g=he(u,f,a.pitchedLabelPlaneMatrix,a.getElevation),g.isOccluded=!1):(g=a.transform.projectTileCoordinates(u,f,a.unwrappedTileID,a.getElevation),g.point.x=(.5*g.point.x+.5)*a.width,g.point.y=(.5*-g.point.y+.5)*a.height),g}function Ra(m,e,a,u){if(a.pitchWithMap){const f=[m,e,0,1];return d.aG(f,f,u),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-e/a.height*2}}function La(m,e,a){return a.transform.projectTileCoordinates(m,e,a.unwrappedTileID,a.getElevation)}function dn(m,e,a){return m._unit()._perp()._mult(e*a)}function Br(m,e,a,u,f,g,v,T,E){if(T.projectionCache.offsets[m])return T.projectionCache.offsets[m];const D=a.add(e);if(m+E.direction<u||m+E.direction>=f)return T.projectionCache.offsets[m]=D,D;const z=Pa(m+E.direction,T,E),B=dn(z.sub(a),v,E.direction),k=a.add(B),V=z.add(B);return T.projectionCache.offsets[m]=d.aH(g,D,k,V)||D,T.projectionCache.offsets[m]}function ki(m,e,a,u,f,g,v,T,E){const D=u?m-e:m+e;let z=D>0?1:-1,B=0;u&&(z*=-1,B=Math.PI),z<0&&(B+=Math.PI);let k,V=z>0?g+f:g+f+1;T.projectionCache.cachedAnchorPoint?k=T.projectionCache.cachedAnchorPoint:(k=pr(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=k);let H,W,Q=k,et=k,at=0,ct=0;const nt=Math.abs(D),ht=[];let pt;for(;at+ct<=nt;){if(V+=z,V<g||V>=v)return null;at+=ct,et=Q,W=H;const It={absOffsetX:nt,direction:z,distanceFromAnchor:at,previousVertex:et};if(Q=Pa(V,T,It),a===0)ht.push(et),pt=Q.sub(et);else{let Mt;const Ct=Q.sub(et);Mt=Ct.mag()===0?dn(Pa(V+z,T,It).sub(Q),a,z):dn(Ct,a,z),W||(W=et.add(Mt)),H=Br(V,Mt,Q,g,v,W,a,T,It),ht.push(W),pt=H.sub(W)}ct=pt.mag()}const ot=pt._mult((nt-at)/ct)._add(W||et),bt=B+Math.atan2(Q.y-et.y,Q.x-et.x);return ht.push(ot),{point:ot,angle:E?bt:0,path:ht}}const Xo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Sr(m,e){for(let a=0;a<m;a++){const u=e.length;e.resize(u+4),e.float32.set(Xo,3*u)}}function Iu(m,e,a){const u=e[0],f=e[1];return m[0]=a[0]*u+a[4]*f+a[12],m[1]=a[1]*u+a[5]*f+a[13],m[3]=a[3]*u+a[7]*f+a[15],m}const Qi=100;class Ls{constructor(e,a=new Oi(e.width+200,e.height+200,25),u=new Oi(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Qi,this.screenBottomBoundary=e.height+Qi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,u,f,g,v,T,E,D,z,B,k){const V=this.projectAndGetPerspectiveRatio(e.anchorPointX+E[0],e.anchorPointY+E[1],g,z,k),H=u*V.perspectiveRatio;let W;if(v||T)W=this._projectCollisionBox(e,H,f,g,v,T,E,V,z,B,k);else{const pt=V.x+(B?B.x*H:0),ot=V.y+(B?B.y*H:0);W={allPointsOccluded:!1,box:[pt+e.x1*H,ot+e.y1*H,pt+e.x2*H,ot+e.y2*H]}}const[Q,et,at,ct]=W.box,nt=v?W.allPointsOccluded:V.isOccluded;let ht=nt;return ht||(ht=V.perspectiveRatio<this.perspectiveRatioCutoff),ht||(ht=!this.isInsideGrid(Q,et,at,ct)),ht||a!=="always"&&this.grid.hitTest(Q,et,at,ct,a,D)?{box:[Q,et,at,ct],placeable:!1,offscreen:!1,occluded:nt}:{box:[Q,et,at,ct],placeable:!0,offscreen:this.isOffscreen(Q,et,at,ct),occluded:nt}}placeCollisionCircles(e,a,u,f,g,v,T,E,D,z,B,k,V,H){const W=[],Q=new d.P(a.anchorX,a.anchorY),et=this.getPerspectiveRatio(Q.x,Q.y,v,H),at=(D?g*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/et:g*et)/d.aL,ct={getElevation:H,pitchedLabelPlaneMatrix:T,lineVertexArray:u,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:V},nt=Qn(at,f,a.lineOffsetX*at,a.lineOffsetY*at,!1,a,!1,ct);let ht=!1,pt=!1,ot=!0;if(nt){const bt=.5*B*et+k,It=new d.P(-100,-100),Mt=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new te,At=nt.first,ie=nt.last;let ne=[];for(let je=At.path.length-1;je>=1;je--)ne.push(At.path[je]);for(let je=1;je<ie.path.length;je++)ne.push(ie.path[je]);const qt=2.5*bt;if(D){const je=this.projectPathToScreenSpace(ne,ct);ne=je.some((Re=>Re.signedDistanceFromCamera<=0))?[]:je.map((Re=>Re.point))}let _e=[];if(ne.length>0){const je=ne[0].clone(),Re=ne[0].clone();for(let Hi=1;Hi<ne.length;Hi++)je.x=Math.min(je.x,ne[Hi].x),je.y=Math.min(je.y,ne[Hi].y),Re.x=Math.max(Re.x,ne[Hi].x),Re.y=Math.max(Re.y,ne[Hi].y);_e=je.x>=It.x&&Re.x<=Mt.x&&je.y>=It.y&&Re.y<=Mt.y?[ne]:Re.x<It.x||je.x>Mt.x||Re.y<It.y||je.y>Mt.y?[]:d.aI([ne],It.x,It.y,Mt.x,Mt.y)}for(const je of _e){Ct.reset(je,.25*bt);let Re=0;Re=Ct.length<=.5*bt?1:Math.ceil(Ct.paddedLength/qt)+1;for(let Hi=0;Hi<Re;Hi++){const Fi=Hi/Math.max(Re-1,1),en=Ct.lerp(Fi),zi=en.x+Qi,In=en.y+Qi;W.push(zi,In,bt,0);const Yi=zi-bt,pn=In-bt,mn=zi+bt,bn=In+bt;if(ot=ot&&this.isOffscreen(Yi,pn,mn,bn),pt=pt||this.isInsideGrid(Yi,pn,mn,bn),e!=="always"&&this.grid.hitTestCircle(zi,In,bt,e,z)&&(ht=!0,!E))return{circles:[],offscreen:!1,collisionDetected:ht}}}}return{circles:!E&&ht||!pt||et<this.perspectiveRatioCutoff?[]:W,offscreen:ot,collisionDetected:ht}}projectPathToScreenSpace(e,a){const u=(function(f,g){const v=d.N();return d.aA(v,g.pitchedLabelPlaneMatrix),f.map((T=>{const E=he(T.x,T.y,v,g.getElevation),D=g.transform.projectTileCoordinates(E.point.x,E.point.y,g.unwrappedTileID,g.getElevation);return D.point.x=(.5*D.point.x+.5)*g.width,D.point.y=(.5*-D.point.y+.5)*g.height,D}))})(e,a);return(function(f){let g=0,v=0,T=0,E=0;for(let D=0;D<f.length;D++)f[D].isOccluded?(T=D+1,E=0):(E++,E>v&&(v=E,g=T));return f.slice(g,g+v)})(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],u=new d.ab;for(const B of e){const k=new d.P(B.x+Qi,B.y+Qi);u.extend(k),a.push(k)}const{minX:f,minY:g,maxX:v,maxY:T}=u,E=this.grid.query(f,g,v,T).concat(this.ignoredGrid.query(f,g,v,T)),D={},z={};for(const B of E){const k=B.key;if(D[k.bucketInstanceId]===void 0&&(D[k.bucketInstanceId]={}),D[k.bucketInstanceId][k.featureIndex])continue;const V=[new d.P(B.x1,B.y1),new d.P(B.x2,B.y1),new d.P(B.x2,B.y2),new d.P(B.x1,B.y2)];d.aJ(a,V)&&(D[k.bucketInstanceId][k.featureIndex]=!0,z[k.bucketInstanceId]===void 0&&(z[k.bucketInstanceId]=[]),z[k.bucketInstanceId].push(k.featureIndex))}return z}insertCollisionBox(e,a,u,f,g,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,u,f,g,v){const T=u?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:a};for(let D=0;D<e.length;D+=4)T.insertCircle(E,e[D],e[D+1],e[D+2])}projectAndGetPerspectiveRatio(e,a,u,f,g){if(g){let v;f?(v=[e,a,f(e,a),1],d.aG(v,v,g)):(v=[e,a,0,1],Iu(v,v,g));const T=v[3];return{x:(v[0]/T+1)/2*this.transform.width+Qi,y:(-v[1]/T+1)/2*this.transform.height+Qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const v=this.transform.projectTileCoordinates(e,a,u,f);return{x:(v.point.x+1)/2*this.transform.width+Qi,y:(1-v.point.y)/2*this.transform.height+Qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,u,f){const g=this.transform.projectTileCoordinates(e,a,u,f);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,a,u,f){return u<Qi||e>=this.screenRightBoundary||f<Qi||a>this.screenBottomBoundary}isInsideGrid(e,a,u,f){return u>=0&&e<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=d.ar([]);return d.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,u,f,g,v,T,E,D,z,B){let k=1,V=0,H=0,W=1;const Q=e.anchorPointX+T[0],et=e.anchorPointY+T[1];if(v&&!g){const ne=this.projectAndGetPerspectiveRatio(Q+1,et,f,D,B),qt=ne.x-E.x,_e=Math.atan((ne.y-E.y)/qt)+(qt<0?Math.PI:0),je=Math.sin(_e),Re=Math.cos(_e);k=Re,V=je,H=-je,W=Re}else if(!v&&g){const ne=$t(this.transform);k=ne.vecEast[0],V=ne.vecEast[1],H=ne.vecSouth[0],W=ne.vecSouth[1]}let at=E.x,ct=E.y,nt=a;g&&(at=Q,ct=et,nt=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),nt*=this.transform.getPitchedTextCorrection(Q,et,f),z||(nt*=d.an(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(at+=k*z.x*nt+H*z.y*nt,ct+=V*z.x*nt+W*z.y*nt);const ht=e.x1*nt,pt=e.x2*nt,ot=(ht+pt)/2,bt=e.y1*nt,It=e.y2*nt,Mt=(bt+It)/2,Ct=[{offsetX:ht,offsetY:bt},{offsetX:ot,offsetY:bt},{offsetX:pt,offsetY:bt},{offsetX:pt,offsetY:Mt},{offsetX:pt,offsetY:It},{offsetX:ot,offsetY:It},{offsetX:ht,offsetY:It},{offsetX:ht,offsetY:Mt}];let At=[];for(const{offsetX:ne,offsetY:qt}of Ct)At.push(new d.P(at+k*ne+H*qt,ct+V*ne+W*qt));let ie=!1;if(g){const ne=At.map((qt=>this.projectAndGetPerspectiveRatio(qt.x,qt.y,f,D,B)));ie=ne.some((qt=>!qt.isOccluded)),At=ne.map((qt=>new d.P(qt.x,qt.y)))}else ie=!0;return{box:d.aK(At),allPointsOccluded:!ie}}}class kh{constructor(e,a,u,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):f&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Os{constructor(e,a,u,f,g){this.text=new kh(e?e.text:null,a,u,g),this.icon=new kh(e?e.icon:null,a,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gl{constructor(e,a,u){this.text=e,this.icon=a,this.skipFade=u}}class Fr{constructor(e,a,u,f,g){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=g}}class Jr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[e]}}function Bh(m,e,a,u,f){const{horizontalAlign:g,verticalAlign:v}=d.aR(m);return new d.P(-(g-.5)*e+u[0]*f,-(v-.5)*a+u[1]*f)}class tp{constructor(e,a,u,f,g){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new Ls(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Jr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(u,f)=>a.getElevation(e,u,f):null}getBucketParts(e,a,u,f){const g=u.getBucket(a),v=u.latestFeatureIndex;if(!g||!v||a.id!==g.layerIds[0])return;const T=u.collisionBoxArray,E=g.layers[0].layout,D=g.layers[0].paint,z=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/d.a4,k=u.tileID.toUnwrapped(),V=E.get("text-rotation-alignment")==="map",H=d.aM(u,1,this.transform.zoom),W=d.aN(this.collisionIndex.transform,u,D.get("text-translate"),D.get("text-translate-anchor")),Q=d.aN(this.collisionIndex.transform,u,D.get("icon-translate"),D.get("icon-translate-anchor")),et=En(V,this.transform,H);this.retainedQueryData[g.bucketInstanceId]=new Fr(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,u.tileID);const at={bucket:g,layout:E,translationText:W,translationIcon:Q,unwrappedTileID:k,pitchedLabelPlaneMatrix:et,scale:z,textPixelRatio:B,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.ax(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(const ct of g.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:ht,symbolInstanceEnd:pt}=ct;e.push({sortKey:nt,symbolInstanceStart:ht,symbolInstanceEnd:pt,parameters:at})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:at})}attemptAnchorPlacement(e,a,u,f,g,v,T,E,D,z,B,k,V,H,W,Q,et,at,ct,nt){const ht=d.aO[e.textAnchor],pt=[e.textOffset0,e.textOffset1],ot=Bh(ht,u,f,pt,g),bt=this.collisionIndex.placeCollisionBox(a,k,E,D,z,T,v,Q,B.predicate,ct,ot,nt);if((!at||this.collisionIndex.placeCollisionBox(at,k,E,D,z,T,v,et,B.predicate,ct,ot,nt).placeable)&&bt.placeable){let It;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(It=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:pt,width:u,height:f,anchor:ht,textBoxScale:g,prevAnchor:It},this.markUsedJustification(H,ht,V,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,V),this.placedOrientations[V.crossTileID]=W),{shift:ot,placedGlyphBoxes:bt}}}placeLayerBucketPart(e,a,u){const{bucket:f,layout:g,translationText:v,translationIcon:T,unwrappedTileID:E,pitchedLabelPlaneMatrix:D,textPixelRatio:z,holdingForFade:B,collisionBoxArray:k,partiallyEvaluatedTextSize:V,collisionGroup:H}=e.parameters,W=g.get("text-optional"),Q=g.get("icon-optional"),et=d.aP(g,"text-overlap","text-allow-overlap"),at=et==="always",ct=d.aP(g,"icon-overlap","icon-allow-overlap"),nt=ct==="always",ht=g.get("text-rotation-alignment")==="map",pt=g.get("text-pitch-alignment")==="map",ot=g.get("icon-text-fit")!=="none",bt=g.get("symbol-z-order")==="viewport-y",It=at&&(nt||!f.hasIconData()||Q),Mt=nt&&(at||!f.hasTextData()||W);!f.collisionArrays&&k&&f.deserializeCollisionBoxes(k);const Ct=this.retainedQueryData[f.bucketInstanceId].tileID,At=this._getTerrainElevationFunc(Ct),ie=this.transform.getFastPathSimpleProjectionMatrix(Ct),ne=(qt,_e,je)=>{var Re,Hi;if(a[qt.crossTileID])return;if(B)return void(this.placements[qt.crossTileID]=new Gl(!1,!1,!1));let Fi=!1,en=!1,zi=!0,In=null,Yi={box:null,placeable:!1,offscreen:null,occluded:!1},pn={placeable:!1},mn=null,bn=null,mr=null,Es=0,Ua=0,Po=0;_e.textFeatureIndex?Es=_e.textFeatureIndex:qt.useRuntimeCollisionCircles&&(Es=qt.featureIndex),_e.verticalTextFeatureIndex&&(Ua=_e.verticalTextFeatureIndex);const Ms=_e.textBox;if(Ms){const Hr=ln=>{let Ni=d.ay.horizontal;if(f.allowVerticalPlacement&&!ln&&this.prevPlacement){const wn=this.prevPlacement.placedOrientations[qt.crossTileID];wn&&(this.placedOrientations[qt.crossTileID]=wn,Ni=wn,this.markUsedOrientation(f,Ni,qt))}return Ni},Cs=(ln,Ni)=>{if(f.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&_e.verticalTextBox){for(const wn of f.writingModes)if(wn===d.ay.vertical?(Yi=Ni(),pn=Yi):Yi=ln(),Yi&&Yi.placeable)break}else Yi=ln()},vl=qt.textAnchorOffsetStartIndex,xl=qt.textAnchorOffsetEndIndex;if(xl===vl){const ln=(Ni,wn)=>{const Ei=this.collisionIndex.placeCollisionBox(Ni,et,z,Ct,E,pt,ht,v,H.predicate,At,void 0,ie);return Ei&&Ei.placeable&&(this.markUsedOrientation(f,wn,qt),this.placedOrientations[qt.crossTileID]=wn),Ei};Cs((()=>ln(Ms,d.ay.horizontal)),(()=>{const Ni=_e.verticalTextBox;return f.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&Ni?ln(Ni,d.ay.vertical):{box:null,offscreen:null}})),Hr(Yi&&Yi.placeable)}else{let ln=d.aO[(Hi=(Re=this.prevPlacement)===null||Re===void 0?void 0:Re.variableOffsets[qt.crossTileID])===null||Hi===void 0?void 0:Hi.anchor];const Ni=(Ei,eo,od)=>{const uu=Ei.x2-Ei.x1,ld=Ei.y2-Ei.y1,io=qt.textBoxScale,ff=ot&&ct==="never"?eo:null;let As=null,cu=et==="never"?1:2,sh="never";ln&&cu++;for(let no=0;no<cu;no++){for(let zr=vl;zr<xl;zr++){const oh=f.textAnchorOffsets.get(zr);if(ln&&oh.textAnchor!==ln)continue;const lh=this.attemptAnchorPlacement(oh,Ei,uu,ld,io,ht,pt,z,Ct,E,H,sh,qt,f,od,v,T,ff,At);if(lh&&(As=lh.placedGlyphBoxes,As&&As.placeable))return Fi=!0,In=lh.shift,As}ln?ln=null:sh=et}return u&&!As&&(As={box:this.collisionIndex.placeCollisionBox(Ms,"always",z,Ct,E,pt,ht,v,H.predicate,At,void 0,ie).box,offscreen:!1,placeable:!1,occluded:!1}),As};Cs((()=>Ni(Ms,_e.iconBox,d.ay.horizontal)),(()=>{const Ei=_e.verticalTextBox;return f.allowVerticalPlacement&&(!Yi||!Yi.placeable)&&qt.numVerticalGlyphVertices>0&&Ei?Ni(Ei,_e.verticalIconBox,d.ay.vertical):{box:null,occluded:!0,offscreen:null}})),Yi&&(Fi=Yi.placeable,zi=Yi.offscreen);const wn=Hr(Yi&&Yi.placeable);if(!Fi&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[qt.crossTileID];Ei&&(this.variableOffsets[qt.crossTileID]=Ei,this.markUsedJustification(f,Ei.anchor,qt,wn))}}}if(mn=Yi,Fi=mn&&mn.placeable,zi=mn&&mn.offscreen,qt.useRuntimeCollisionCircles&&qt.centerJustifiedTextSymbolIndex>=0){const Hr=f.text.placedSymbolArray.get(qt.centerJustifiedTextSymbolIndex),Cs=d.az(f.textSizeData,V,Hr),vl=g.get("text-padding");bn=this.collisionIndex.placeCollisionCircles(et,Hr,f.lineVertexArray,f.glyphOffsetArray,Cs,E,D,u,pt,H.predicate,qt.collisionCircleDiameter,vl,v,At),bn.circles.length&&bn.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),Fi=at||bn.circles.length>0&&!bn.collisionDetected,zi=zi&&bn.offscreen}if(_e.iconFeatureIndex&&(Po=_e.iconFeatureIndex),_e.iconBox){const Hr=Cs=>this.collisionIndex.placeCollisionBox(Cs,ct,z,Ct,E,pt,ht,T,H.predicate,At,ot&&In?In:void 0,ie);pn&&pn.placeable&&_e.verticalIconBox?(mr=Hr(_e.verticalIconBox),en=mr.placeable):(mr=Hr(_e.iconBox),en=mr.placeable),zi=zi&&mr.offscreen}const Ro=W||qt.numHorizontalGlyphVertices===0&&qt.numVerticalGlyphVertices===0,na=Q||qt.numIconVertices===0;Ro||na?na?Ro||(en=en&&Fi):Fi=en&&Fi:en=Fi=en&&Fi;const Ga=en&&mr.placeable;if(Fi&&mn.placeable&&this.collisionIndex.insertCollisionBox(mn.box,et,g.get("text-ignore-placement"),f.bucketInstanceId,pn&&pn.placeable&&Ua?Ua:Es,H.ID),Ga&&this.collisionIndex.insertCollisionBox(mr.box,ct,g.get("icon-ignore-placement"),f.bucketInstanceId,Po,H.ID),bn&&Fi&&this.collisionIndex.insertCollisionCircles(bn.circles,et,g.get("text-ignore-placement"),f.bucketInstanceId,Es,H.ID),u&&this.storeCollisionData(f.bucketInstanceId,je,_e,mn,mr,bn),qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qt.crossTileID]=new Gl((Fi||It)&&!mn?.occluded,(en||Mt)&&!mr?.occluded,zi||f.justReloaded),a[qt.crossTileID]=!0};if(bt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let _e=qt.length-1;_e>=0;--_e){const je=qt[_e];ne(f.symbolInstances.get(je),f.collisionArrays[je],je)}}else for(let qt=e.symbolInstanceStart;qt<e.symbolInstanceEnd;qt++)ne(f.symbolInstances.get(qt),f.collisionArrays[qt],qt);f.justReloaded=!1}storeCollisionData(e,a,u,f,g,v){if(u.textBox||u.iconBox){let T,E;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(a)?E=T.get(a):(E={text:null,icon:null},T.set(a,E)),u.textBox&&(E.text=f.box),u.iconBox&&(E.icon=g.box)}if(v){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=[]);for(let E=0;E<v.circles.length;E+=4)T.push(v.circles[E+0]-Qi),T.push(v.circles[E+1]-Qi),T.push(v.circles[E+2]),T.push(v.collisionDetected?1:0)}}markUsedJustification(e,a,u,f){let g;g=f===d.ay.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.aQ(a)];const v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const T of v)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=g>=0&&T!==g?0:u.crossTileID)}markUsedOrientation(e,a,u){const f=a===d.ay.horizontal||a===d.ay.horizontalOnly?a:0,g=a===d.ay.vertical?a:0,v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const T of v)e.text.placedSymbolArray.get(T).placedOrientation=f;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(e):1,g=a?a.opacities:{},v=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const E in this.placements){const D=this.placements[E],z=g[E];z?(this.opacities[E]=new Os(z,f,D.text,D.icon),u=u||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[E]=new Os(null,f,D.text,D.icon,D.skipFade),u=u||D.text||D.icon)}for(const E in g){const D=g[E];if(!this.opacities[E]){const z=new Os(D,f,!1,!1);z.isHidden()||(this.opacities[E]=z,u=u||D.text.placed||D.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in T)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=T[E]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const u={};for(const f of a){const g=f.getBucket(e);g&&f.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,f.tileID,u,f.collisionBoxArray)}}updateBucketOpacities(e,a,u,f){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],v=g.layout,T=new Os(null,0,!1,!1,!0),E=v.get("text-allow-overlap"),D=v.get("icon-allow-overlap"),z=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=v.get("text-rotation-alignment")==="map",k=v.get("text-pitch-alignment")==="map",V=v.get("icon-text-fit")!=="none",H=new Os(null,0,E&&(D||!e.hasIconData()||v.get("icon-optional")),D&&(E||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&f&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(f);const W=(et,at,ct)=>{for(let nt=0;nt<at/4;nt++)et.opacityVertexArray.emplaceBack(ct);et.hasVisibleVertices=et.hasVisibleVertices||ct!==as},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let et=0;et<e.symbolInstances.length;et++){const at=e.symbolInstances.get(et),{numHorizontalGlyphVertices:ct,numVerticalGlyphVertices:nt,crossTileID:ht}=at;let pt=this.opacities[ht];u[ht]?pt=T:pt||(pt=H,this.opacities[ht]=pt),u[ht]=!0;const ot=at.numIconVertices>0,bt=this.placedOrientations[at.crossTileID],It=bt===d.ay.vertical,Mt=bt===d.ay.horizontal||bt===d.ay.horizontalOnly;if(ct>0||nt>0){const At=Yo(pt.text);W(e.text,ct,It?as:At),W(e.text,nt,Mt?as:At);const ie=pt.text.isHidden();[at.rightJustifiedTextSymbolIndex,at.centerJustifiedTextSymbolIndex,at.leftJustifiedTextSymbolIndex].forEach((_e=>{_e>=0&&(e.text.placedSymbolArray.get(_e).hidden=ie||It?1:0)})),at.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(at.verticalPlacedTextSymbolIndex).hidden=ie||Mt?1:0);const ne=this.variableOffsets[at.crossTileID];ne&&this.markUsedJustification(e,ne.anchor,at,bt);const qt=this.placedOrientations[at.crossTileID];qt&&(this.markUsedJustification(e,"left",at,qt),this.markUsedOrientation(e,qt,at))}if(ot){const At=Yo(pt.icon),ie=!(V&&at.verticalPlacedIconSymbolIndex&&It);at.placedIconSymbolIndex>=0&&(W(e.icon,at.numIconVertices,ie?At:as),e.icon.placedSymbolArray.get(at.placedIconSymbolIndex).hidden=pt.icon.isHidden()),at.verticalPlacedIconSymbolIndex>=0&&(W(e.icon,at.numVerticalIconVertices,ie?as:At),e.icon.placedSymbolArray.get(at.verticalPlacedIconSymbolIndex).hidden=pt.icon.isHidden())}const Ct=Q&&Q.has(et)?Q.get(et):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const At=e.collisionArrays[et];if(At){let ie=new d.P(0,0);if(At.textBox||At.verticalTextBox){let ne=!0;if(z){const qt=this.variableOffsets[ht];qt?(ie=Bh(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textBoxScale),B&&ie._rotate(k?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ne=!1}if(At.textBox||At.verticalTextBox){let qt;At.textBox&&(qt=It),At.verticalTextBox&&(qt=Mt),Pc(e.textCollisionBox.collisionVertexArray,pt.text.placed,!ne||qt,Ct.text,ie.x,ie.y)}}if(At.iconBox||At.verticalIconBox){const ne=!!(!Mt&&At.verticalIconBox);let qt;At.iconBox&&(qt=ne),At.verticalIconBox&&(qt=!ne),Pc(e.iconCollisionBox.collisionVertexArray,pt.icon.placed,qt,Ct.icon,V?ie.x:0,V?ie.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Pc(m,e,a,u,f,g){u&&u.length!==0||(u=[0,0,0,0]);const v=u[0]-Qi,T=u[1]-Qi,E=u[2]-Qi,D=u[3]-Qi;m.emplaceBack(e?1:0,a?1:0,f||0,g||0,v,T),m.emplaceBack(e?1:0,a?1:0,f||0,g||0,E,T),m.emplaceBack(e?1:0,a?1:0,f||0,g||0,E,D),m.emplaceBack(e?1:0,a?1:0,f||0,g||0,v,D)}const Fh=Math.pow(2,25),zu=Math.pow(2,24),Nh=Math.pow(2,17),Nr=Math.pow(2,16),Rc=Math.pow(2,9),Lc=Math.pow(2,8),Pu=Math.pow(2,1);function Yo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,a=Math.floor(127*m.opacity);return a*Fh+e*zu+a*Nh+e*Nr+a*Rc+e*Lc+a*Pu+e}const as=0;class Ru{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,u,f,g){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(v,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((T,E)=>T.sortKey-E.sortKey)));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Wo{constructor(e,a,u,f,g,v,T,E){this.placement=new tp(e,a,v,T,E),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,a,u){const f=Lt(),g=()=>!this._forceFullPlacement&&Lt()-f>2;for(;this._currentPlacementIndex>=0;){const v=a[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=T)&&(!v.maxzoom||v.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Ru(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ss=512/d.a4/2;class jh{constructor(e,a,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const f=new Map;for(let g=0;g<a.length;g++){const v=a.get(g),T=v.key,E=f.get(T);E?E.push(v):f.set(T,[v])}for(const[g,v]of f){const T={positions:v.map((E=>({x:Math.floor(E.anchorX*ss),y:Math.floor(E.anchorY*ss)}))),crossTileIDs:v.map((E=>E.crossTileID))};if(T.positions.length>128){const E=new d.aS(T.positions.length,16,Uint16Array);for(const{x:D,y:z}of T.positions)E.add(D,z);E.finish(),delete T.positions,T.index=E}this._symbolsByKey[g]=T}}getScaledCoordinates(e,a){const{x:u,y:f,z:g}=this.tileID.canonical,{x:v,y:T,z:E}=a.canonical,D=ss/Math.pow(2,E-g),z=(T*d.a4+e.anchorY)*D,B=f*d.a4*ss;return{x:Math.floor((v*d.a4+e.anchorX)*D-u*d.a4*ss),y:Math.floor(z-B)}}findMatches(e,a,u){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<e.length;g++){const v=e.get(g);if(v.crossTileID)continue;const T=this._symbolsByKey[v.key];if(!T)continue;const E=this.getScaledCoordinates(v,a);if(T.index){const D=T.index.range(E.x-f,E.y-f,E.x+f,E.y+f).sort();for(const z of D){const B=T.crossTileIDs[z];if(!u[B]){u[B]=!0,v.crossTileID=B;break}}}else if(T.positions)for(let D=0;D<T.positions.length;D++){const z=T.positions[D],B=T.crossTileIDs[D];if(Math.abs(z.x-E.x)<=f&&Math.abs(z.y-E.y)<=f&&!u[B]){u[B]=!0,v.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class $d{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class os{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const u in this.indexes){const f=this.indexes[u],g={};for(const v in f){const T=f[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),g[T.tileID.key]=T}this.indexes[u]=g}this.lng=e}addBucket(e,a,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const f=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>e.overscaledZ)for(const T in v){const E=v[T];E.tileID.isChildOf(e)&&E.findMatches(a.symbolInstances,e,f)}else{const T=v[e.scaledTo(Number(g)).key];T&&T.findMatches(a.symbolInstances,e,f)}}for(let g=0;g<a.symbolInstances.length;g++){const v=a.symbolInstances.get(g);v.crossTileID||(v.crossTileID=u.generate(),f[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new jh(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const u of a.getCrossTileIDsLists())for(const f of u)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let a=!1;for(const u in this.indexes){const f=this.indexes[u];for(const g in f)e[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[g]),delete f[g],a=!0)}return a}}class Ko{constructor(){this.layerIndexes={},this.crossTileIDs=new $d,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,u){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new os);let g=!1;const v={};f.handleWrapJump(u);for(const T of a){const E=T.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(T.tileID,E,this.crossTileIDs)&&(g=!0),v[E.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(e){const a={};e.forEach((u=>{a[u]=!0}));for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}var Qe="void main() {fragColor=vec4(1.0);}";const Er={prelude:Ge(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ge("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ge("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ge(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ge(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ge(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ge(Qe,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ge(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ge(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ge("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ge("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ge(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ge("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ge(Qe,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ge(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ge(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ge(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ge(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ge(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ge(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ge(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ge(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ge(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ge(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ge(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ge(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Ge(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Ge(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ge(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ge(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ge(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ge("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ge("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ge("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ge("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ge(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ge("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ge(m,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(f):f,T={};return{fragmentSource:m=m.replace(a,((E,D,z,B,k)=>(T[k]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
in ${z} ${B} ${k};
#else
uniform ${z} ${B} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${z} ${B} ${k} = u_${k};
#endif
`))),vertexSource:e=e.replace(a,((E,D,z,B,k)=>{const V=B==="float"?"vec2":"vec4",H=k.match(/color/)?"color":V;return T[k]?D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${z} ${V} a_${k};
out ${z} ${B} ${k};
#else
uniform ${z} ${B} u_${k};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${z} ${B} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${H}(a_${k}, u_${k}_t);
#else
    ${z} ${B} ${k} = u_${k};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${z} ${V} a_${k};
#else
uniform ${z} ${B} u_${k};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${z} ${B} ${k} = a_${k};
#else
    ${z} ${B} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${z} ${B} ${k} = unpack_mix_${H}(a_${k}, u_${k}_t);
#else
    ${z} ${B} ${k} = u_${k};
#endif
`})),staticAttributes:u,staticUniforms:v}}class ls{constructor(e,a,u){this.vertexBuffer=e,this.indexBuffer=a,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var vn=d.aT([{name:"a_pos",type:"Int16",components:2}]);const Mn="#define PROJECTION_MERCATOR",Cn="mercator";class Pn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Cn}get shaderDefine(){return Mn}get shaderPreludeCode(){return Er.projectionMercator}get vertexShaderPreludeCode(){return Er.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,u,f,g){if(this._cachedMesh)return this._cachedMesh;const v=new d.aV;v.emplaceBack(0,0),v.emplaceBack(d.a4,0),v.emplaceBack(0,d.a4),v.emplaceBack(d.a4,d.a4);const T=e.createVertexBuffer(v,vn.members),E=d.aW.simpleSegment(0,0,4,2),D=new d.aX;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3);const z=e.createIndexBuffer(D);return this._cachedMesh=new ls(T,z,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ii{constructor(e=0,a=0,u=0,f=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=u,this.right=f}interpolate(e,a,u){return a.top!=null&&e.top!=null&&(this.top=d.G.number(e.top,a.top,u)),a.bottom!=null&&e.bottom!=null&&(this.bottom=d.G.number(e.bottom,a.bottom,u)),a.left!=null&&e.left!=null&&(this.left=d.G.number(e.left,a.left,u)),a.right!=null&&e.right!=null&&(this.right=d.G.number(e.right,a.right,u)),this}getCenter(e,a){const u=d.an((this.left+e-this.right)/2,0,e),f=d.an((this.top+a-this.bottom)/2,0,a);return new d.P(u,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ii(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Lu(m,e){if(!m.renderWorldCopies||m.lngRange)return;const a=e.lng-m.center.lng;e.lng+=a>180?-360:a<-180?360:0}function Un(m){return Math.max(0,Math.floor(m))}class xn{constructor(e,a){var u;this.applyConstrain=(f,g)=>this._constrainOverride!==null?this._constrainOverride(f,g):this._callbacks.defaultConstrain(f,g),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(u=a?.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Un(this._zoom),this._scale=d.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ii,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,u){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Un(this._zoom),this._scale=d.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ii(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const a=d.W(e,-180,180)*Math.PI/180;var u,f,g,v,T,E,D,z,B;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=vt(),u=this._rotationMatrix,g=-this._bearingInRadians,v=(f=this._rotationMatrix)[0],T=f[1],E=f[2],D=f[3],z=Math.sin(g),B=Math.cos(g),u[0]=v*B+E*z,u[1]=T*B+D*z,u[2]=v*-z+E*B,u[3]=T*-z+D*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const a=d.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aY(this._fovInRadians)}setFov(e){e=d.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const a=this.applyConstrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=d.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,u){this._unmodified=!1,this._edgeInsets.interpolate(e,a,u),this.constrainInternal(),this._calcMatrices()}resize(e,a,u=!0){this._width=e,this._height=a,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new an([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.ao,d.ao])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{const{minX:u,minY:f,maxX:g,maxY:v}=d.ab.fromPoints(a).extend(e);return[new d.P(u,f),new d.P(g,f),new d.P(g,v),new d.P(u,v),new d.P(u,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.ar(new Float64Array(16));d.Q(e,e,[this._width/2,-this._height/2,1]),d.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.ar(new Float64Array(16)),d.Q(e,e,[1,-1,1]),d.O(e,e,[-1,-1,0]),d.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,u,f){const g=u!==void 0?u:this.bearing,v=f=f!==void 0?f:this.pitch,T=d.aa.fromLngLat(e,a),E=-Math.cos(d.ap(v)),D=Math.sin(d.ap(v)),z=D*Math.sin(d.ap(g)),B=-D*Math.cos(d.ap(g));let k=this.elevation;const V=a-k;let H;E*V>=0||Math.abs(E)<.1?(H=1e4,k=a+H*E):H=-V/E;let W,Q,et=d.aZ(1,T.y),at=0;do{if(at+=1,at>10)break;Q=H/et,W=new d.aa(T.x+z*Q,T.y+B*Q),et=1/W.meterInMercatorCoordinateUnits()}while(Math.abs(H-Q*et)>1e-12);return{center:W.toLngLat(),elevation:k,zoom:d.at(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const a=d.as(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/a,f=d.aa.fromLngLat(this.center,this.elevation),g=xt(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const v=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),d.aZ(g.z,f.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.as(1,this.center.lat)*this.worldSize;return xt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/d.a4,1/a/d.a4]}}class Jn{constructor(e,a){this.min=e,this.max=a,this.center=d.a_([],d.a$([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],u=d.b0(this.min),f=d.b0(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],f[g]=a[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Jn(u,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let u=0;u<e.planes.length;u++){const f=this.intersectsPlane(e.planes[u]);if(f===0)return 0;f===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],u=e[3];for(let f=0;f<3;f++)e[f]>0?(a+=e[f]*this.min[f],u+=e[f]*this.max[f]):(u+=e[f]*this.min[f],a+=e[f]*this.max[f]);return a>=0?2:u<0?0:1}}class ql{distanceToTile2d(e,a,u,f){const g=f.distanceX([e,a]),v=f.distanceY([e,a]);return Math.hypot(g,v)}getWrap(e,a,u){return u}getTileBoundingVolume(e,a,u,f){var g,v;let T=0,E=0;if(f?.terrain){const z=new d.a1(e.z,a,e.z,e.x,e.y),B=f.terrain.getMinMaxElevation(z);T=(g=B.minElevation)!==null&&g!==void 0?g:Math.min(0,u),E=(v=B.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}const D=1<<e.z;return new Jn([a+e.x/D,e.y/D,T],[a+(e.x+1)/D,(e.y+1)/D,E])}allowVariableZoom(e,a){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,f=d.an(78.5-u/2,0,60);return!!a.terrain||e.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mr{constructor(e,a,u){this.points=e,this.planes=a,this.aabb=u}static fromInvProjectionMatrix(e,a=1,u=0,f,g){const v=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,u),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>(function(V,H,W,Q){const et=d.aG([],V,H),at=1/et[3]/W*Q;return d.b5(et,et,[at,at,1/et[3],at])})(k,e,a,T)));f&&(function(k,V,H,W){const Q=W?4:0,et=W?0:4;let at=0;const ct=[],nt=[];for(let ot=0;ot<4;ot++){const bt=d.b1([],k[ot+et],k[ot+Q]),It=d.b6(bt);d.a_(bt,bt,1/It),ct.push(It),nt.push(bt)}for(let ot=0;ot<4;ot++){const bt=d.b7(k[ot+Q],nt[ot],H);at=bt!==null&&bt>=0?Math.max(at,bt):Math.max(at,ct[ot])}const ht=(function(ot,bt){const It=d.b1([],ot[bt[0]],ot[bt[1]]),Mt=d.b1([],ot[bt[2]],ot[bt[1]]),Ct=[0,0,0,0];return d.b2(Ct,d.b3([],It,Mt)),Ct[3]=-d.b4(Ct,ot[bt[0]]),Ct})(k,V),pt=(function(ot,bt){const It=d.b8(ot),Mt=d.b9([],ot,1/It),Ct=d.b1([],bt,d.a_([],Mt,d.b4(bt,Mt))),At=d.b8(Ct);if(At>0){const ie=Math.sqrt(1-Mt[3]*Mt[3]),ne=d.a_([],Mt,-Mt[3]),qt=d.a$([],ne,d.a_([],Ct,ie/At));return d.ba(bt,qt)}return null})(H,ht);if(pt!==null){const ot=pt/d.b4(nt[0],ht);at=Math.min(at,ot)}for(let ot=0;ot<4;ot++){const bt=Math.min(at,ct[ot]);k[ot+et]=[k[ot+Q][0]+nt[ot][0]*bt,k[ot+Q][1]+nt[ot][1]*bt,k[ot+Q][2]+nt[ot][2]*bt,1]}})(E,v[0],f,g);const D=v.map((k=>{const V=d.b1([],E[k[0]],E[k[1]]),H=d.b1([],E[k[2]],E[k[1]]),W=d.b2([],d.b3([],V,H)),Q=-d.b4(W,E[k[1]]);return W.concat(Q)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const k of E)for(let V=0;V<3;V++)z[V]=Math.min(z[V],k[V]),B[V]=Math.max(B[V],k[V]);return new Mr(E,D,new Jn(z,B))}}class Bi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,u=!0){this._helper.resize(e,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,u)=>{u=d.an(+u,this.minZoom,this.maxZoom);const f={center:new d.V(a.lng,a.lat),zoom:u};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const nt=179.9999999999;g=[-nt,nt]}const v=this.tileSize*d.aq(f.zoom);let T=0,E=v,D=0,z=v,B=0,k=0;const{x:V,y:H}=this.size;if(this._helper._latRange){const nt=this._helper._latRange;T=d.X(nt[1])*v,E=d.X(nt[0])*v,E-T<H&&(B=H/(E-T))}g&&(D=d.W(d.Y(g[0])*v,0,v),z=d.W(d.Y(g[1])*v,0,v),z<D&&(z+=v),z-D<V&&(k=V/(z-D)));const{x:W,y:Q}=st(v,a);let et,at;const ct=Math.max(k||0,B||0);if(ct){const nt=new d.P(k?(z+D)/2:W,B?(E+T)/2:Q);return f.center=ut(v,nt).wrap(),f.zoom+=d.at(ct),f}if(this._helper._latRange){const nt=H/2;Q-nt<T&&(at=T+nt),Q+nt>E&&(at=E-nt)}if(g){const nt=(D+z)/2;let ht=W;this._helper._renderWorldCopies&&(ht=d.W(W,nt-v/2,nt+v/2));const pt=V/2;ht-pt<D&&(et=D+pt),ht+pt>z&&(et=z-pt)}if(et!==void 0||at!==void 0){const nt=new d.P(et??W,at??Q);f.center=ut(v,nt).wrap()}return f},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new xn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._coveringTilesDetailsProvider=new ql}clone(){const e=new Bi;return e.apply(this),e}apply(e,a,u){this._helper.apply(e,a,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const a=[new d.bb(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new d.P(0,0)),f=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),T=Math.floor(Math.min(u.x,f.x,g.x,v.x)),E=Math.floor(Math.max(u.x,f.x,g.x,v.x)),D=1;for(let z=T-D;z<=E+D;z++)z!==0&&a.push(new d.bb(z,e))}return a}getCameraFrustum(){return Mr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const a=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,a){const u=d.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,u),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),v=d.aa.fromLngLat(e),T=new d.aa(v.x-(f.x-g.x),v.y-(f.y-g.y));this.setCenter(T?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(d.aa.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.aa.fromLngLat(e))}screenPointToLocation(e,a){var u;return(u=this.screenPointToMercatorCoordinate(e,a))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){const u=a.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){const u=a||0,f=[e.x,e.y,0,1],g=[e.x,e.y,1,1];d.aG(f,f,this._pixelMatrixInverse),d.aG(g,g,this._pixelMatrixInverse);const v=f[3],T=g[3],E=f[1]/v,D=g[1]/T,z=f[2]/v,B=g[2]/T,k=z===B?0:(u-z)/(B-z);return new d.aa(d.G.number(f[0]/v,g[0]/T,k)/this.worldSize,d.G.number(E,D,k)/this.worldSize,u)}coordinatePoint(e,a=0,u=this._pixelMatrix){const f=[e.x*this.worldSize,e.y*this.worldSize,a,1];return d.aG(f,f,u),new d.P(f[0]/f[3],f[1]/f[3])}getBounds(){const e=Math.max(0,this._helper._height/2-St(this));return new an().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-St(this)}calculatePosMatrix(e,a=!1,u){var f;const g=(f=e.key)!==null&&f!==void 0?f:d.bc(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(g)){const D=v.get(g);return u?D.f32:D.f64}const T=J(e,this.worldSize);d.S(T,a?this._alignedProjMatrix:this._viewProjMatrix,T);const E={f64:T,f32:new Float32Array(T)};return v.set(g,E),u?E.f32:E.f64}calculateFogMatrix(e){const a=e.key,u=this._fogMatrixCacheF32;if(u.has(a))return u.get(a);const f=J(e,this.worldSize);return d.S(f,this._fogMatrix,f),u.set(a,new Float32Array(f)),u.get(a)}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}_calculateNearFarZIfNeeded(e,a,u){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-f*this._helper._pixelPerMeter/Math.cos(a),v=f<0?g:e,T=Math.PI/2+this.pitchInRadians,E=d.ap(this.fov)*(Math.abs(Math.cos(d.ap(this.roll)))*this.height+Math.abs(Math.sin(d.ap(this.roll)))*this.width)/this.height*(.5+u.y/this.height),D=Math.sin(E)*v/Math.sin(d.an(Math.PI-T-E,.01,Math.PI-.01)),z=St(this),B=Math.atan(z/this._helper.cameraToCenterDistance),k=d.ap(.75),V=B>k?2*B*(.5+u.y/(2*z)):k,H=Math.sin(V)*v/Math.sin(d.an(Math.PI-T-V,.01,Math.PI-.01)),W=Math.min(D,H);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*W+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,a=st(this.worldSize,this.center),u=a.x,f=a.y;this._helper._pixelPerMeter=d.as(1,this.center.lat)*this.worldSize;const g=d.ap(Math.min(this.pitch,$)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let T;this._calculateNearFarZIfNeeded(v,g,e),T=new Float64Array(16),d.bd(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aA(this._invProjMatrix,T),T[8]=2*-e.x/this._helper._width,T[9]=2*e.y/this._helper._height,this._projectionMatrix=d.be(T),d.Q(T,T,[1,-1,1]),d.O(T,T,[0,0,-this._helper.cameraToCenterDistance]),d.bf(T,T,-this.rollInRadians),d.bg(T,T,this.pitchInRadians),d.bf(T,T,-this.bearingInRadians),d.O(T,T,[-u,-f,0]),this._mercatorMatrix=d.Q([],T,[this.worldSize,this.worldSize,this.worldSize]),d.Q(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),d.O(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=d.aA([],T);const E=[0,0,-1,1];d.aG(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),d.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.O(this._fogMatrix,this._fogMatrix,[-u,-f,0]),d.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const D=this._helper._width%2/2,z=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),k=Math.sin(-this.bearingInRadians),V=u-Math.round(u)+B*D+k*z,H=f-Math.round(f)+B*z+k*D,W=new Float64Array(T);if(d.O(W,W,[V>.5?V-1:V,H>.5?H-1:H,0]),this._alignedProjMatrix=W,T=d.aA(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.aG(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.as(1,this.center.lat)*this.worldSize;return xt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){const u=d.aa.fromLngLat(e),f=[u.x*this.worldSize,u.y*this.worldSize,a,1];return d.aG(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(e){const{overscaledTileID:a,aligned:u,applyTerrainMatrix:f}=e,g=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,u,!0):null;let T;return T=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:v||d.bh(),{mainMatrix:T,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,u){return 1}transformLightDirection(e){return d.b0(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,u,f){const g=this.calculatePosMatrix(u);let v;f?(v=[e,a,f(e,a),1],d.aG(v,v,g)):(v=[e,a,0,1],Iu(v,v,g));const T=v[3];return{point:new d.P(v[0]/T,v[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(e){for(const a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){const u=d.aa.fromLngLat(e,a),f=u.meterInMercatorCoordinateUnits(),g=d.bi();return d.O(g,g,[u.x,u.y,u.z]),d.bf(g,g,Math.PI),d.bg(g,g,Math.PI/2),d.Q(g,g,[-f,f,f]),g}getProjectionDataForCustomLayer(e=!0){const a=new d.a1(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),f=J(a,this.worldSize);d.S(f,this._viewProjMatrix,f),u.tileMercatorCoords=[0,0,1,1];const g=[d.a4,d.a4,this.worldSize/this._helper.pixelsPerMeter],v=d.bj();return d.Q(v,f,g),u.fallbackMatrix=v,u.mainMatrix=v,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ks(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Bs(m){if(m.useSlerp)if(m.k<1){const e=d.bk(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=d.bk(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),u=new Float64Array(4);d.bl(u,e,a,m.k);const f=d.bm(u);m.tr.setRoll(f.roll),m.tr.setPitch(f.pitch),m.tr.setBearing(f.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function po(m,e,a,u,f){const g=f.padding,v=st(f.worldSize,a.getNorthWest()),T=st(f.worldSize,a.getNorthEast()),E=st(f.worldSize,a.getSouthEast()),D=st(f.worldSize,a.getSouthWest()),z=d.ap(-u),B=v.rotate(z),k=T.rotate(z),V=E.rotate(z),H=D.rotate(z),W=new d.P(Math.max(B.x,k.x,H.x,V.x),Math.max(B.y,k.y,H.y,V.y)),Q=new d.P(Math.min(B.x,k.x,H.x,V.x),Math.min(B.y,k.y,H.y,V.y)),et=W.sub(Q),at=(f.width-(g.left+g.right+e.left+e.right))/et.x,ct=(f.height-(g.top+g.bottom+e.top+e.bottom))/et.y;if(ct<0||at<0)return void ks();const nt=Math.min(d.at(f.scale*Math.min(at,ct)),m.maxZoom),ht=d.P.convert(m.offset),pt=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ap(u)),ot=ht.add(pt).mult(f.scale/d.aq(nt));return{center:ut(f.worldSize,v.add(E).div(2).sub(ot)),zoom:nt,bearing:u}}class rr{get useGlobeControls(){return!1}handlePanInertia(e,a){const u=e.mag(),f=Math.abs(St(a));return{easingOffset:e.mult(Math.min(.75*f/u,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,u){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,a,u,f,g){return po(e,a,u,f,g)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(d.V.convert(a.center))}handleEaseTo(e,a){const u=e.zoom,f=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},T=a.zoom!==void 0,E=!e.isPaddingEqual(a.padding);let D=!1;const z=T?+a.zoom:e.zoom;let B=e.centerPoint.add(a.offsetAsPoint);const k=e.screenPointToLocation(B),{center:V,zoom:H}=e.applyConstrain(d.V.convert(a.center||k),z??u);Lu(e,V);const W=st(e.worldSize,k),Q=st(e.worldSize,V).sub(W),et=d.aq(H-u);return D=H!==u,{easeFunc:at=>{if(D&&e.setZoom(d.G.number(u,H,at)),d.bn(g,v)||Bs({startEulerAngles:g,endEulerAngles:v,tr:e,k:at,useSlerp:g.roll!=v.roll}),E&&(e.interpolatePadding(f,a.padding,at),B=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{const ct=d.aq(e.zoom-u),nt=H>u?Math.min(2,et):Math.max(.5,et),ht=Math.pow(nt,1-at),pt=ut(e.worldSize,W.add(Q.mult(at*ht)).mult(ct));e.setLocationAtPoint(e.renderWorldCopies?pt.wrap():pt,B)}},isZooming:D,elevationCenter:V}}handleFlyTo(e,a){const u=a.zoom!==void 0,f=e.zoom,g=e.applyConstrain(d.V.convert(a.center||a.locationAtOffset),u?+a.zoom:f),v=g.center,T=g.zoom;Lu(e,v);const E=st(e.worldSize,a.locationAtOffset),D=st(e.worldSize,v).sub(E),z=D.mag(),B=d.aq(T-f);let k;if(a.minZoom!==void 0){const V=Math.min(+a.minZoom,f,T),H=e.applyConstrain(v,V).zoom;k=d.aq(H-f)}return{easeFunc:(V,H,W,Q)=>{e.setZoom(V===1?T:f+d.at(H));const et=V===1?v:ut(e.worldSize,E.add(D.mult(W)).mult(H));e.setLocationAtPoint(e.renderWorldCopies?et.wrap():et,Q)},scaleOfZoom:B,targetCenter:v,scaleOfMinZoom:k,pixelPathLength:z}}}class Gi{constructor(e,a,u){this.blendFunction=e,this.blendColor=a,this.mask=u}}Gi.Replace=[1,0],Gi.disabled=new Gi(Gi.Replace,d.bo.transparent,[!1,!1,!1,!1]),Gi.unblended=new Gi(Gi.Replace,d.bo.transparent,[!0,!0,!0,!0]),Gi.alphaBlended=new Gi([1,771],d.bo.transparent,[!0,!0,!0,!0]);const fn=2305;class $e{constructor(e,a,u){this.enable=e,this.mode=a,this.frontFace=u}}$e.disabled=new $e(!1,1029,fn),$e.backCCW=new $e(!0,1029,fn),$e.frontCCW=new $e(!0,1028,fn);class Ve{constructor(e,a,u){this.func=e,this.mask=a,this.range=u}}Ve.ReadOnly=!1,Ve.ReadWrite=!0,Ve.disabled=new Ve(519,Ve.ReadOnly,[0,1]);const us=7680;class ri{constructor(e,a,u,f,g,v){this.test=e,this.ref=a,this.mask=u,this.fail=f,this.depthFail=g,this.pass=v}}ri.disabled=new ri({func:519,mask:0},0,0,us,us,us);const mo=new WeakMap;function ta(m){var e;if(mo.has(m))return mo.get(m);{const a=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return mo.set(m,a),a}}class Fs{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const a=e.context,u=a.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const f=new d.aV;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const g=new d.aX;g.emplaceBack(0,1,2),this._fullscreenTriangle=new ls(a.createVertexBuffer(f,vn.members),a.createIndexBuffer(g),d.aW.simpleSegment(0,0,f.length,g.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(u.TEXTURE1);const v=u.createTexture();u.bindTexture(u.TEXTURE_2D,v),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ta(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){const u=this._cachedRenderContext.context,f=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:d.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,f.TRIANGLES,Ve.disabled,ri.disabled,Gi.unblended,$e.disabled,((g,v)=>({u_input:g,u_output_expected:v}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ta(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const g=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ta(e)){const a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}const cs=d.a4/128;function Ou(m,e){const a=m.granularity!==void 0?Math.max(m.granularity,1):1,u=a+(m.generateBorders?2:0),f=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=u+1,v=f+1,T=m.generateBorders?-1:0,E=m.generateBorders||m.extendToNorthPole?-1:0,D=a+(m.generateBorders?1:0),z=a+(m.generateBorders||m.extendToSouthPole?1:0),B=g*v,k=u*f*6,V=g*v>65536;if(V&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const H=V||e==="32bit",W=new Int16Array(2*B);let Q=0;for(let ct=E;ct<=z;ct++)for(let nt=T;nt<=D;nt++){let ht=nt/a*d.a4;nt===-1&&(ht=-cs),nt===a+1&&(ht=d.a4+cs);let pt=ct/a*d.a4;ct===-1&&(pt=m.extendToNorthPole?d.bq:-cs),ct===a+1&&(pt=m.extendToSouthPole?d.br:d.a4+cs),W[Q++]=ht,W[Q++]=pt}const et=H?new Uint32Array(k):new Uint16Array(k);let at=0;for(let ct=0;ct<f;ct++)for(let nt=0;nt<u;nt++){const ht=nt+1+ct*g,pt=nt+(ct+1)*g,ot=nt+1+(ct+1)*g;et[at++]=nt+ct*g,et[at++]=pt,et[at++]=ht,et[at++]=ht,et[at++]=pt,et[at++]=ot}return{vertices:W.buffer.slice(0),indices:et.buffer.slice(0),uses32bitIndices:H}}const ku=new d.aU({fill:new d.bs(128,2),line:new d.bs(512,0),tile:new d.bs(128,32),stencil:new d.bs(128,1),circle:3});class Bu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Er.projectionGlobe}get vertexShaderPreludeCode(){return Er.projectionMercator.vertexSource}get subdivisionGranularity(){return ku}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Fs(e));const a=d.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,u),g=Lt();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=g);const v=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bu(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,u,f,g){const v=(g==="stencil"?ku.stencil:ku.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:v,generateBorders:u,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(e,a){const u=this._getMeshKey(a);if(u in this._tileMeshCache)return this._tileMeshCache[u];const f=(function(g,v){const T=Ou(v,"16bit"),E=d.aV.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),D=d.aX.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new ls(g.createVertexBuffer(E,vn.members),g.createIndexBuffer(D),d.aW.simpleSegment(0,0,E.length,D.length))})(e,a);return this._tileMeshCache[u]=f,f}recalculate(e){}hasTransition(){const e=Lt();let a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Oc=new d.t({type:new d.D(d.u.projection.type)});class go extends d.E{constructor(e){super(),this._transitionable=new d.x(Oc,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0)),this._mercatorProjection=new Pn,this._verticalPerspectiveProjection=new Bu}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bv){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,u,f,g){return this.currentProjection.getMeshFromTileID(e,a,u,f,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Xd(m){const e=kc(m.worldSize,m.center.lat);return 2*Math.PI*e}function hs(m,e,a,u,f){const g=1/(1<<f),v=e/d.a4*g+u*g,T=d.bx((m/d.a4*g+a*g)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,D=Math.cos(E),z=new Float64Array(3);return z[0]=Math.sin(T)*D,z[1]=Math.sin(E),z[2]=Math.cos(T)*D,z}function ar(m){return(function(e,a){const u=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(e)*u,f[1]=Math.sin(a),f[2]=Math.cos(e)*u,f})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function kc(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Yd(m){const e=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){const u=m[0]/a,f=Math.acos(m[2]/a),g=(u>0?f:-f)/Math.PI*180;return new d.V(d.W(g,-180,180),e)}return new d.V(0,e)}function tr(m){return Math.cos(m*Math.PI/180)}function Rn(m,e){const a=tr(m),u=tr(e);return d.at(u/a)}function Oa(m,e){const a=m.rotate(e.bearingInRadians),u=e.zoom+Rn(e.center.lat,0),f=d.bt(1/tr(e.center.lat),1/tr(Math.min(Math.abs(e.center.lat),60)),d.bw(u,7,3,0,1)),g=360/Xd({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.V(e.center.lng-a.x*g*f,d.an(e.center.lat+a.y*g,-d.ao,d.ao))}function Zl(m){const e=.5*m,a=Math.sin(e),u=Math.cos(e);return Math.log(a+u)-Math.log(u-a)}function Vh(m,e,a,u){const f=m.lat+a*u;if(Math.abs(a)>1){const g=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+a)*Math.PI/180,T=Zl(g+u*(v-g)),E=Zl(g),D=Zl(v);return new d.V(m.lng+e*((T-E)/(D-E)),f)}return new d.V(m.lng+e*u,f)}class Bc{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,u,f){const g=`${e.z}_${e.x}_${e.y}_${f?.terrain?"t":""}`,v=this._cache.get(g);if(v)return v;const T=this._cachePrevious.get(g);if(T)return this._cache.set(g,T),T;const E=this._boundingVolumeFactory(e,a,u,f);return this._cache.set(g,E),this._hadAnyChanges=!0,E}}class ka{constructor(e,a,u,f){this.min=u,this.max=f,this.points=e,this.planes=a}static fromAabb(e,a){const u=[];for(let f=0;f<8;f++)u.push([1&~f?e[0]:a[0],(f>>1&1)==1?a[1]:e[1],(f>>2&1)==1?a[2]:e[2]]);return new ka(u,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,u){const f=d.bA([],u[0],u[1],u[2]),g=d.bB([],[a[0],0,0],f),v=d.bB([],[0,a[1],0],f),T=d.bB([],[0,0,a[2]],f),E=[...e],D=[...e];for(let B=0;B<8;B++)for(let k=0;k<3;k++){const V=e[k]+g[k]*(1&~B?-1:1)+v[k]*((B>>1&1)==1?1:-1)+T[k]*((B>>2&1)==1?1:-1);E[k]=Math.min(E[k],V),D[k]=Math.max(D[k],V)}const z=[];for(let B=0;B<8;B++){const k=[...e];d.a$(k,k,d.a_([],g,1&~B?-1:1)),d.a$(k,k,d.a_([],v,(B>>1&1)==1?1:-1)),d.a$(k,k,d.a_([],T,(B>>2&1)==1?1:-1)),z.push(k)}return new ka(z,[[...g,-d.b4(g,z[0])],[...v,-d.b4(v,z[0])],[...T,-d.b4(T,z[0])],[-g[0],-g[1],-g[2],-d.b4(g,z[7])],[-v[0],-v[1],-v[2],-d.b4(v,z[7])],[-T[0],-T[1],-T[2],-d.b4(T,z[7])]],E,D)}intersectsFrustum(e){let a=!0;const u=this.points.length,f=this.planes.length,g=e.planes.length,v=e.points.length;for(let T=0;T<g;T++){const E=e.planes[T];let D=0;for(let z=0;z<u;z++){const B=this.points[z];E[0]*B[0]+E[1]*B[1]+E[2]*B[2]+E[3]>=0&&D++}if(D===0)return 0;D<u&&(a=!1)}if(a)return 2;for(let T=0;T<f;T++){const E=this.planes[T];let D=0;for(let z=0;z<v;z++){const B=e.points[z];E[0]*B[0]+E[1]*B[1]+E[2]*B[2]+E[3]>=0&&D++}if(D===0)return 0}return 1}intersectsPlane(e){const a=this.points.length;let u=0;for(let f=0;f<a;f++){const g=this.points[f];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&u++}return u===a?2:u===0?0:1}}function Fc(m,e,a){const u=m-e;return u<0?-u:Math.max(0,u-a)}function Uh(m,e,a,u,f){const g=m-a;let v;return v=g<0?Math.min(-g,1+g-f):g>1?Math.min(Math.max(g-f,0),1-g):0,Math.max(v,Fc(e,u,f))}class Wd{constructor(){this._boundingVolumeCache=new Bc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,u,f){const g=1<<u.z,v=1/g,T=u.x/g,E=u.y/g;let D=2;return D=Math.min(D,Uh(e,a,T,E,v)),D=Math.min(D,Uh(e,a,T+.5,-E-v,v)),D=Math.min(D,Uh(e,a,T+.5,2-E-v,v)),D}getWrap(e,a,u){const f=1<<a.z,g=1/f,v=a.x/f,T=Fc(e.x,v,g),E=Fc(e.x,v-1,g),D=Fc(e.x,v+1,g),z=Math.min(T,E,D);return z===D?1:z===E?-1:0}allowVariableZoom(e,a){return Te(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,u,f){return this._boundingVolumeCache.getTileBoundingVolume(e,a,u,f)}_computeTileBoundingVolume(e,a,u,f){var g,v;let T=0,E=0;if(f?.terrain){const D=new d.a1(e.z,a,e.z,e.x,e.y),z=f.terrain.getMinMaxElevation(D);T=(g=z.minElevation)!==null&&g!==void 0?g:Math.min(0,u),E=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}if(T/=d.bD,E/=d.bD,T+=1,E+=1,e.z<=0)return ka.fromAabb([-E,-E,-E],[E,E,E]);if(e.z===1)return ka.fromAabb([e.x===0?-E:0,e.y===0?0:-E,-E],[e.x===0?0:E,e.y===0?E:0,E]);{const D=[hs(0,0,e.x,e.y,e.z),hs(d.a4,0,e.x,e.y,e.z),hs(d.a4,d.a4,e.x,e.y,e.z),hs(0,d.a4,e.x,e.y,e.z)],z=[];for(const Ct of D)z.push(d.a_([],Ct,E));if(E!==T)for(const Ct of D)z.push(d.a_([],Ct,T));e.y===0&&z.push([0,1,0]),e.y===(1<<e.z)-1&&z.push([0,-1,0]);const B=[1,1,1],k=[-1,-1,-1];for(const Ct of z)for(let At=0;At<3;At++)B[At]=Math.min(B[At],Ct[At]),k[At]=Math.max(k[At],Ct[At]);const V=hs(d.a4/2,d.a4/2,e.x,e.y,e.z),H=d.b3([],[0,1,0],V);d.b2(H,H);const W=d.b3([],V,H);d.b2(W,W);const Q=d.b3([],D[2],D[1]);d.b2(Q,Q);const et=d.b3([],D[0],D[3]);d.b2(et,et),z.push(d.a_([],V,E)),e.y>=(1<<e.z)/2&&z.push(d.a_([],hs(d.a4/2,0,e.x,e.y,e.z),E)),e.y<(1<<e.z)/2&&z.push(d.a_([],hs(d.a4/2,d.a4,e.x,e.y,e.z),E));const at=Kd(V,z),ct=Kd(W,z),nt=[-V[0],-V[1],-V[2],at.max],ht=[V[0],V[1],V[2],-at.min],pt=[-W[0],-W[1],-W[2],ct.max],ot=[W[0],W[1],W[2],-ct.min],bt=[...Q,0],It=[...et,0],Mt=[];return e.y===0?Mt.push(d.bC(It,bt,nt),d.bC(It,bt,ht)):Mt.push(d.bC(pt,bt,nt),d.bC(pt,bt,ht),d.bC(pt,It,nt),d.bC(pt,It,ht)),e.y===(1<<e.z)-1?Mt.push(d.bC(It,bt,nt),d.bC(It,bt,ht)):Mt.push(d.bC(ot,bt,nt),d.bC(ot,bt,ht),d.bC(ot,It,nt),d.bC(ot,It,ht)),new ka(Mt,[nt,ht,pt,ot,bt,It],B,k)}}}function Kd(m,e){let a=1/0,u=-1/0;for(const f of e){const g=d.b4(m,f);a=Math.min(a,g),u=Math.max(u,g)}return{min:a,max:u}}class Nc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=d.bE(),this._projectionMatrix=d.bi(),this._globeViewProjMatrix32f=d.bh(),this._globeViewProjMatrixNoCorrection=d.bi(),this._globeViewProjMatrixNoCorrectionInverted=d.bi(),this._globeProjMatrixInverted=d.bi(),this._cameraPosition=d.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,u)=>{const f=d.an(a.lat,-d.ao,d.ao),g=d.an(+u,this.minZoom+Rn(0,f),this.maxZoom);return{center:new d.V(a.lng,f),zoom:g}},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new xn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._coveringTilesDetailsProvider=new Wd}clone(){const e=new Nc;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.by();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:a,applyGlobeMatrix:u}=e,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const a=this.pitchInRadians,u=this.cameraToCenterDistance/e,f=Math.sin(a)*u,g=Math.cos(a)*u+1,v=1/Math.sqrt(f*f+g*g)*1;let T=-f,E=g;const D=Math.sqrt(T*T+E*E);T/=D,E/=D;const z=[0,T,E];d.bF(z,z,[0,0,0],-this.bearingInRadians),d.bG(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bH(z,z,[0,0,0],this.center.lng*Math.PI/180);const B=1/d.b6(z);return d.a_(z,z,B),[...z,-v*B]}isLocationOccluded(e){return!this.isSurfacePointVisible(ar(e))}transformLightDirection(e){const a=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,f=Math.cos(u),g=[Math.sin(a)*f,Math.sin(u),Math.cos(a)*f],v=[g[2],0,-g[0]],T=[0,0,0];d.b3(T,v,g),d.b2(v,v),d.b2(T,T);const E=[0,0,0];return d.b2(E,[v[0]*e[0]+T[0]*e[1]+g[0]*e[2],v[1]*e[0]+T[1]*e[1]+g[1]*e[2],v[2]*e[0]+T[2]*e[1]+g[2]*e[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,u){const f=(function(T,E,D){const z=1/(1<<D.z);return new d.aa(T/d.a4*z+D.x*z,E/d.a4*z+D.y*z)})(e,a,u.canonical),g=(v=f.y,[d.bx(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,a,u,f){const g=u.canonical,v=hs(e,a,g.x,g.y,g.z),T=1+(f?f(e,a):0)/d.bD,E=[v[0]*T,v[1]*T,v[2]*T,1];d.aG(E,E,this._globeViewProjMatrixNoCorrection);const D=this._cachedClippingPlane,z=D[0]*v[0]+D[1]*v[1]+D[2]*v[2]+D[3]<0;return{point:new d.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=kc(this.worldSize,this.center.lat),a=d.bj(),u=d.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.bd(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=d.be(a),this._globeProjMatrixInverted=d.bj(),d.aA(this._globeProjMatrixInverted,a),d.O(a,a,[0,0,-this.cameraToCenterDistance]),d.bf(a,a,this.rollInRadians),d.bg(a,a,-this.pitchInRadians),d.bf(a,a,this.bearingInRadians),d.O(a,a,[0,0,-e]);const g=d.by();g[0]=e,g[1]=e,g[2]=e,d.bg(u,a,this.center.lat*Math.PI/180),d.bI(u,u,-this.center.lng*Math.PI/180),d.Q(u,u,g),this._globeViewProjMatrixNoCorrection=u,d.bg(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bI(a,a,-this.center.lng*Math.PI/180),d.Q(a,a,g),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=d.bj(),d.aA(this._globeViewProjMatrixNoCorrectionInverted,u);const v=d.by();this._cameraPosition=d.by(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bF(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),d.bG(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),d.bF(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),d.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bG(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),d.bH(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const T=d.be(this._globeViewProjMatrixNoCorrectionInverted);d.Q(T,T,[1,1,-1]),this._cachedFrustum=Mr.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const a=d.bj();return d.ar(a),a}getVisibleUnwrappedCoordinates(e){return[new d.bb(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=ar(e);d.a_(u,u,1+a/d.bD);const f=d.bE();return d.aG(f,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(e){}getBounds(){const e=.5*this.width,a=.5*this.height,u=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,a),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,a)],f=[];for(const B of u)f.push(this.unprojectScreenPoint(B));let g=0,v=0,T=0,E=0;const D=this.center;for(const B of f){const k=d.bJ(D.lng,B.lng),V=d.bJ(D.lat,B.lat);k<v&&(v=k),k>g&&(g=k),V<E&&(E=V),V>T&&(T=V)}const z=[D.lng+v,D.lat+E,D.lng+g,D.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new an(z)}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}setLocationAtPoint(e,a){const u=ar(this.unprojectScreenPoint(a)),f=ar(e),g=d.by();d.bK(g);const v=d.by();d.bH(v,u,g,-this.center.lng*Math.PI/180),d.bG(v,v,g,this.center.lat*Math.PI/180);const T=f[0]*f[0]+f[2]*f[2],E=v[0]*v[0];if(T<E)return;const D=Math.sqrt(T-E),z=-D,B=d.bL(f[0],f[2],v[0],D),k=d.bL(f[0],f[2],v[0],z),V=d.by();d.bH(V,f,g,-B);const H=d.bL(V[1],V[2],v[1],v[2]),W=d.by();d.bH(W,f,g,-k);const Q=d.bL(W[1],W[2],v[1],v[2]),et=.5*Math.PI,at=H>=-et&&H<=et,ct=Q>=-et&&Q<=et;let nt,ht;if(at&&ct){const It=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;d.bM(B,It)+d.bM(H,Mt)<d.bM(k,It)+d.bM(Q,Mt)?(nt=B,ht=H):(nt=k,ht=Q)}else if(at)nt=B,ht=H;else{if(!ct)return;nt=k,ht=Q}const pt=nt/Math.PI*180,ot=ht/Math.PI*180,bt=this.center.lat;this.setCenter(new d.V(pt,d.an(ot,-90,90))),this.setZoom(this.zoom+Rn(bt,this.center.lat))}locationToScreenPoint(e,a){const u=ar(e);if(a){const f=a.getElevationForLngLatZoom(e,this._helper._tileZoom);d.a_(u,u,1+f/d.bD)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const a=d.bE();return d.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new d.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){const u=a.pointCoordinate(e);if(u)return u}return d.aa.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var u;return(u=this.screenPointToMercatorCoordinate(e,a))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,a){const u=this._cameraPosition,f=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,f)}getRayDirectionFromPixel(e){const a=d.bE();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,d.aG(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const u=d.by();u[0]=a[0]-this._cameraPosition[0],u[1]=a[1]-this._cameraPosition[1],u[2]=a[2]-this._cameraPosition[2];const f=d.by();return d.b2(f,u),f}isSurfacePointVisible(e){const a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const a=d.bE();return d.aG(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){const u=d.b4(e,a),f=d.by(),g=d.by();d.a_(g,a,u),d.b1(f,e,g);const v=1-d.b4(f,f);if(v<0)return null;const T=d.b4(e,e)-1,E=-u+(u<0?1:-1)*Math.sqrt(v),D=T/E,z=E;return{tMin:Math.min(D,z),tMax:Math.max(D,z)}}unprojectScreenPoint(e){const a=this._cameraPosition,u=this.getRayDirectionFromPixel(e),f=this.rayPlanetIntersection(a,u);if(f){const z=d.by();d.a$(z,a,[u[0]*f.tMin,u[1]*f.tMin,u[2]*f.tMin]);const B=d.by();return d.b2(B,z),Yd(B)}const g=this._cachedClippingPlane,v=g[0]*u[0]+g[1]*u[1]+g[2]*u[2],T=-d.ba(g,a)/v,E=d.by();if(T>0)d.a$(E,a,[u[0]*T,u[1]*T,u[2]*T]);else{const z=d.by();d.a$(z,a,[2*u[0],2*u[1],2*u[2]]);const B=d.ba(this._cachedClippingPlane,z);d.b1(E,z,[this._cachedClippingPlane[0]*B,this._cachedClippingPlane[1]*B,this._cachedClippingPlane[2]*B])}const D=(function(z){const B=d.by();return B[0]=z[0]*-z[3],B[1]=z[1]*-z[3],B[2]=z[2]*-z[3],{center:B,radius:Math.sqrt(1-z[3]*z[3])}})(g);return Yd((function(z,B,k){const V=d.by();d.b1(V,k,z);const H=d.by();return d.bz(H,z,V,B/d.b8(V)),H})(D.center,D.radius,E))}getMatrixForModel(e,a){const u=d.V.convert(e),f=1/d.bD,g=d.bi();return d.bI(g,g,u.lng/180*Math.PI),d.bg(g,g,-u.lat/180*Math.PI),d.O(g,g,[0,0,1+a/d.bD]),d.bg(g,g,.5*Math.PI),d.Q(g,g,[f,f,f]),g}getProjectionDataForCustomLayer(e=!0){const a=this.getProjectionData({overscaledTileID:new d.a1(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class jc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,u=!0){this._helper.resize(e,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,u)=>this.currentTransform.defaultConstrain(a,u),this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new xn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._globeness=1,this._mercatorTransform=new Bi,this._verticalPerspectiveTransform=new Nc}clone(){const e=new jc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const a=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:a.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,u){const f=this._mercatorTransform.getPitchedTextCorrection(e,a,u),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,u);return d.bt(f,g,this._globeness)}projectTileCoordinates(e,a,u,f){return this.currentTransform.projectTileCoordinates(e,a,u,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=a.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class jr{get useGlobeControls(){return!0}handlePanInertia(e,a){const u=Oa(e,a);return Math.abs(u.lng-a.center.lng)>180&&(u.lng=a.center.lng+179.5*Math.sign(u.lng-a.center.lng)),{easingCenter:u,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){const u=e.around,f=a.screenPointToLocation(u);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);const g=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);const v=a.zoom-g;if(v===0)return;const T=d.bJ(a.center.lng,f.lng),E=T/(Math.abs(T/180)+1),D=d.bJ(a.center.lat,f.lat),z=a.getRayDirectionFromPixel(u),B=a.cameraPosition,k=-1*d.b4(B,z),V=d.by();d.a$(V,B,[z[0]*k,z[1]*k,z[2]*k]);const H=d.b6(V)-1,W=Math.exp(.5*-Math.max(H-.3,0)),Q=kc(a.worldSize,a.center.lat)/Math.min(a.width,a.height),et=d.bw(Q,.9,.5,1,.25),at=(1-d.aq(-v))*Math.min(W,et),ct=a.center.lat,nt=a.zoom,ht=new d.V(a.center.lng+E*at,d.an(a.center.lat+D*at,-d.ao,d.ao));a.setLocationAtPoint(f,u);const pt=a.center,ot=d.bw(Math.abs(T),45,85,0,1),bt=d.bw(Q,.75,.35,0,1),It=Math.pow(Math.max(ot,bt),.25),Mt=d.bJ(pt.lng,ht.lng),Ct=d.bJ(pt.lat,ht.lat);a.setCenter(new d.V(pt.lng+Mt*It,pt.lat+Ct*It).wrap()),a.setZoom(nt+Rn(ct,a.center.lat))}handleMapControlsPan(e,a,u){if(!e.panDelta)return;const f=a.center.lat,g=a.zoom;a.setCenter(Oa(e.panDelta,a).wrap()),a.setZoom(g+Rn(f,a.center.lat))}cameraForBoxAndBearing(e,a,u,f,g){const v=po(e,a,u,f,g),T=a.left/g.width*2-1,E=(g.width-a.right)/g.width*2-1,D=a.top/g.height*-2+1,z=(g.height-a.bottom)/g.height*-2+1,B=d.bJ(u.getWest(),u.getEast())<0,k=B?u.getEast():u.getWest(),V=B?u.getWest():u.getEast(),H=Math.max(u.getNorth(),u.getSouth()),W=Math.min(u.getNorth(),u.getSouth()),Q=k+.5*d.bJ(k,V),et=H+.5*d.bJ(H,W),at=g.clone();at.setCenter(v.center),at.setBearing(v.bearing),at.setPitch(0),at.setRoll(0),at.setZoom(v.zoom);const ct=at.modelViewProjectionMatrix,nt=[ar(u.getNorthWest()),ar(u.getNorthEast()),ar(u.getSouthWest()),ar(u.getSouthEast()),ar(new d.V(V,et)),ar(new d.V(k,et)),ar(new d.V(Q,H)),ar(new d.V(Q,W))],ht=ar(v.center);let pt=Number.POSITIVE_INFINITY;for(const ot of nt)T<0&&(pt=jr.getLesserNonNegativeNonNull(pt,jr.solveVectorScale(ot,ht,ct,"x",T))),E>0&&(pt=jr.getLesserNonNegativeNonNull(pt,jr.solveVectorScale(ot,ht,ct,"x",E))),D>0&&(pt=jr.getLesserNonNegativeNonNull(pt,jr.solveVectorScale(ot,ht,ct,"y",D))),z<0&&(pt=jr.getLesserNonNegativeNonNull(pt,jr.solveVectorScale(ot,ht,ct,"y",z)));if(Number.isFinite(pt)&&pt!==0)return v.zoom=at.zoom+d.at(pt),v;ks()}handleJumpToCenterZoom(e,a){const u=e.center.lat,f=e.applyConstrain(a.center?d.V.convert(a.center):e.center,e.zoom).center;e.setCenter(f.wrap());const g=a.zoom!==void 0?+a.zoom:e.zoom+Rn(u,f.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,a){const u=e.zoom,f=e.center,g=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},E=a.zoom!==void 0,D=!e.isPaddingEqual(a.padding);let z=!1;const B=a.center?d.V.convert(a.center):f,k=e.applyConstrain(B,u).center;Lu(e,k);const V=e.clone();V.setCenter(k),V.setZoom(E?+a.zoom:u+Rn(f.lat,B.lat)),V.setBearing(a.bearing);const H=new d.P(d.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));V.setLocationAtPoint(k,H);const W=(a.offset&&a.offsetAsPoint.mag())>0?V.center:k,Q=E?+a.zoom:u+Rn(f.lat,W.lat),et=u+Rn(f.lat,0),at=Q+Rn(W.lat,0),ct=d.bJ(f.lng,W.lng),nt=d.bJ(f.lat,W.lat),ht=d.aq(at-et);return z=Q!==u,{easeFunc:pt=>{if(d.bn(v,T)||Bs({startEulerAngles:v,endEulerAngles:T,tr:e,k:pt,useSlerp:v.roll!=T.roll}),D&&e.interpolatePadding(g,a.padding,pt),a.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{const ot=at>et?Math.min(2,ht):Math.max(.5,ht),bt=Math.pow(ot,1-pt),It=Vh(f,ct,nt,pt*bt);e.setCenter(It.wrap())}if(z){const ot=d.G.number(et,at,pt)+Rn(0,e.center.lat);e.setZoom(ot)}},isZooming:z,elevationCenter:W}}handleFlyTo(e,a){const u=a.zoom!==void 0,f=e.center,g=e.zoom,v=e.padding,T=!e.isPaddingEqual(a.padding),E=e.applyConstrain(d.V.convert(a.center||a.locationAtOffset),g).center,D=u?+a.zoom:e.zoom+Rn(e.center.lat,E.lat),z=e.clone();z.setCenter(E),z.setZoom(D),z.setBearing(a.bearing);const B=new d.P(d.an(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.an(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(E,B);const k=z.center;Lu(e,k);const V=(function(nt,ht,pt){const ot=ar(ht),bt=ar(pt),It=d.b4(ot,bt),Mt=Math.acos(It),Ct=Xd(nt);return Mt/(2*Math.PI)*Ct})(e,f,k),H=g+Rn(f.lat,0),W=D+Rn(k.lat,0),Q=d.aq(W-H);let et;if(typeof a.minZoom=="number"){const nt=+a.minZoom+Rn(k.lat,0),ht=Math.min(nt,H,W)+Rn(0,k.lat),pt=e.applyConstrain(k,ht).zoom+Rn(k.lat,0);et=d.aq(pt-H)}const at=d.bJ(f.lng,k.lng),ct=d.bJ(f.lat,k.lat);return{easeFunc:(nt,ht,pt,ot)=>{const bt=Vh(f,at,ct,pt);T&&e.interpolatePadding(v,a.padding,nt);const It=nt===1?k:bt;e.setCenter(It.wrap());const Mt=H+d.at(ht);e.setZoom(nt===1?D:Mt+Rn(0,It.lat))},scaleOfZoom:Q,targetCenter:k,scaleOfMinZoom:et,pixelPathLength:V}}static solveVectorScale(e,a,u,f,g){const v=f==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],T=[u[3],u[7],u[11],u[15]],E=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],D=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],z=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],B=a[0]*T[0]+a[1]*T[1]+a[2]*T[2];return z+g*D===E+g*B||T[3]*(E-z)+v[3]*(B-D)+E*B==z*D?null:(z+v[3]-g*B-g*T[3])/(z-E-g*B+g*D)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Vc{constructor(e){this._globe=e,this._mercatorCameraHelper=new rr,this._verticalPerspectiveCameraHelper=new jr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,u){this.currentHelper.handleMapControlsPan(e,a,u)}cameraForBoxAndBearing(e,a,u,f,g){return this.currentHelper.cameraForBoxAndBearing(e,a,u,f,g)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}const Qo=(m,e)=>d.B(m,e&&e.filter((a=>a.identifier!=="source.canvas"))),Gh=d.bN();class Fu extends d.E{constructor(e,a={}){var u,f;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const T=this.tileManagers[v].getSource().type;T!=="vector"&&T!=="geojson"||this.tileManagers[v].reload()}},this.map=e,this.dispatcher=new fa(Xi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,T)=>this.getGlyphs(v,T))),this.dispatcher.registerMessageHandler("GI",((v,T)=>this.getImages(v,T))),this.dispatcher.registerMessageHandler("GDA",((v,T)=>this.getDashes(v,T))),this.imageManager=new yi,this.imageManager.setEventedParent(this);const g=((u=e._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new ce(e._requestManager,a.localIdeographFontFamily,g),this.lineAtlas=new ge(256,512),this.crossTileSymbolIndex=new Ko,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",d.bO()),Tr().on(Rs,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const T=this.tileManagers[v.sourceId];if(!T)return;const E=T.getSource();if(E&&E.vectorLayerIds)for(const D in this._layers){const z=this._layers[D];z.source===E.id&&this._validateLayer(z)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,a){var u,f,g;this._checkLoaded();const v=a===null?(g=(f=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||f===void 0?void 0:f.default)!==null&&g!==void 0?g:null:a;if(d.bQ(v,this._globalState[e]))return this;this._globalState[e]=v,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const a=[];for(const u in e)!d.bQ(this._globalState[u],e[u].default)&&(a.push(u),this._globalState[u]=e[u].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;const a=new Set,u={};for(const f of e){u[f]=this._globalState[f];for(const g in this._layers){const v=this._layers[g],T=v.getLayoutAffectingGlobalStateRefs(),E=v.getPaintAffectingGlobalStateRefs();if(T.has(f)&&a.add(v.source),E.has(f))for(const{name:D,value:z}of E.get(f))this._updatePaintProperty(v,D,z)}}this.dispatcher.broadcast("UGS",u);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(e,a={},u){this.fire(new d.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;d.j(f,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,a,u)})).catch((v=>{this._loadStyleRequest=null,v&&!g.signal.aborted&&this.fire(new d.k(v))}))}loadJSON(e,a={},u){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Gt.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,u)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(Gh,{validate:!1})}_load(e,a,u){var f,g;let v=a.transformStyle?a.transformStyle(u,e):e;if(!a.validate||!Qo(this,d.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const T in v.sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new vi(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new Kt(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var e,a,u;const f=d.bR(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",f),this._order=f.map((g=>g.id)),this._layers={},this._serializedLayers=null;for(const g of f){const v=d.bS(g,this._globalState);if(v.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=v,d.bT(v)&&this.tileManagers[v.source]){const T=(u=(a=g.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&u!==void 0?u:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(T)}}}_loadSprite(e,a=!1,u=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,v,T,E){return d._(this,void 0,void 0,(function*(){const D=ii(g),z=T>1?"@2x":"",B={},k={};for(const{id:V,url:H}of D){const W=v.transformRequest(Pi(H,z,".json"),"SpriteJSON");B[V]=d.j(W,E);const Q=v.transformRequest(Pi(H,z,".png"),"SpriteImage");k[V]=be.getImage(Q,E)}return yield Promise.all([...Object.values(B),...Object.values(k)]),(function(V,H){return d._(this,void 0,void 0,(function*(){const W={};for(const Q in V){W[Q]={};const et=Gt.getImageCanvasContext((yield H[Q]).data),at=(yield V[Q]).data;for(const ct in at){const{width:nt,height:ht,x:pt,y:ot,sdf:bt,pixelRatio:It,stretchX:Mt,stretchY:Ct,content:At,textFitWidth:ie,textFitHeight:ne}=at[ct];W[Q][ct]={data:null,pixelRatio:It,sdf:bt,stretchX:Mt,stretchY:Ct,content:At,textFitWidth:ie,textFitHeight:ne,spriteData:{width:nt,height:ht,x:pt,y:ot,context:et}}}}return W}))})(B,k)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const v in g){this._spritesImagesIds[v]=[];const T=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((E=>!(E in g))):[];for(const E of T)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in g[v]){const D=v==="default"?E:`${v}:${E}`;this._spritesImagesIds[v].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,g[v][E],!1):this.imageManager.addImage(D,g[v][E]),a&&(this._changedImages[D]=!0)}}})).catch((g=>{this._spriteRequest=null,f=g,this.fire(new d.k(f))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),u&&u(f)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const a=this.tileManagers[e.source];if(!a)return;const u=e.sourceLayer;if(!u)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.k(new Error(`Source layer "${u}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?d.bU(u):u);const f=[];for(const g of e)if(u[g]){const v=a?d.bU(u[g]):u[g];f.push(v)}return f}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const f=this._layers[u];f.type!=="custom"&&(e[u]=f.serialize())}return e}hasTransitions(){var e,a,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(const v in this._updatedSources){const T=this._updatedSources[v];if(T==="reload")this._reloadSource(v);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const f in this.tileManagers){const g=this.tileManagers[f];u[f]=g.used,g.used=!1}for(const f of this._order){const g=this._layers[f];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.tileManagers[g.source].used=!0)}for(const f in u){const g=this.tileManagers[f];!!u[f]!=!!g.used&&g.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var u;this._checkLoaded();const f=this.serialize();if(e=a.transformStyle?a.transformStyle(f,e):e,((u=a.validate)===null||u===void 0||u)&&Qo(this,d.C(e)))return!1;(e=d.bU(e)).layers=d.bR(e.layers);const g=d.bV(f,e),v=this._getOperationsToPerform(g);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const T of v.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],u=[];for(const f of e)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:u.push(f.command)}return{operations:a,unimplemented:u}}addImage(e,a){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,u={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.C.source,`sources.${e}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[e]=new He(e,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e}))),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const a=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],a.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.tileManagers[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,a,u={}){this._checkLoaded();const f=e.id;if(this.getLayer(f))return void this.fire(new d.k(new Error(`Layer "${f}" already exists on this map.`)));let g;if(e.type==="custom"){if(Qo(this,d.bW(e)))return;g=d.bS(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=d.bU(e),e=d.e(e,{source:f})),this._validate(d.C.layer,`layers.${f}`,e,{arrayIndex:-1},u))return;g=d.bS(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new d.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){const T=this._removedLayers[f];delete this._removedLayers[f],T.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.tileManagers[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const u=this._order.indexOf(e);this._order.splice(u,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,u){this._checkLoaded();const f=this.getLayer(e);f?f.minzoom===a&&f.maxzoom===u||(a!=null&&(f.minzoom=a),u!=null&&(f.maxzoom=u),this._updateLayer(f)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,u={}){this._checkLoaded();const f=this.getLayer(e);if(f){if(!d.bQ(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(d.C.filter,`layers.${f.id}.filter`,a,null,u)||(f.setFilter(d.bU(a)),this._updateLayer(f)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.bU(this.getLayer(e).filter)}setLayoutProperty(e,a,u,f={}){this._checkLoaded();const g=this.getLayer(e);g?d.bQ(g.getLayoutProperty(a),u)||(g.setLayoutProperty(a,u,f),this._updateLayer(g)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const u=this.getLayer(e);if(u)return u.getLayoutProperty(a);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,u,f={}){this._checkLoaded();const g=this.getLayer(e);g?d.bQ(g.getPaintProperty(a),u)||this._updatePaintProperty(g,a,u,f):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,u,f={}){e.setPaintProperty(a,u,f)&&this._updateLayer(e),d.bT(e)&&a==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const u=e.source,f=e.sourceLayer,g=this.tileManagers[u];if(g===void 0)return void this.fire(new d.k(new Error(`The source '${u}' does not exist in the map's style.`)));const v=g.getSource().type;v==="geojson"&&f?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||f?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,e.id,a)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const u=e.source,f=this.tileManagers[u];if(f===void 0)return void this.fire(new d.k(new Error(`The source '${u}' does not exist in the map's style.`)));const g=f.getSource().type,v=g==="vector"?e.sourceLayer:void 0;g!=="vector"||v?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(v,e.id,a):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,u=e.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(u,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bX(this.tileManagers,(g=>g.serialize())),a=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,f=this.stylesheet;return d.bY({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:e,layers:a,terrain:u},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=v=>this._layers[v].type==="fill-extrusion",u={},f=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(a(T)){u[T]=v;for(const E of e){const D=E[T];if(D)for(const z of D)f.push(z)}}}f.sort(((v,T)=>T.intersectionZ-v.intersectionZ));const g=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(a(T))for(let E=f.length-1;E>=0;E--){const D=f[E].feature;if(u[D.layer.id]<v)break;g.push(D),f.pop()}else for(const E of e){const D=E[T];if(D)for(const z of D)g.push(z.feature)}}return g}queryRenderedFeatures(e,a,u){a&&a.filter&&this._validate(d.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const D of a.layers){const z=this._layers[D];if(!z)return this.fire(new d.k(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];f[z.source]=!0}}const g=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers(),T=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,E=Object.assign(Object.assign({},a),{layers:T,globalState:this._globalState});for(const D in this.tileManagers)a.layers&&!f[D]||g.push(Fl(this.tileManagers[D],this._layers,v,e,E,u,this.map.terrain?(z,B,k)=>this.map.terrain.getElevation(z,B,k):void 0));return this.placement&&g.push((function(D,z,B,k,V,H,W){const Q={},et=H.queryRenderedSymbols(k),at=[];for(const ct of Object.keys(et).map(Number))at.push(W[ct]);at.sort(Ci);for(const ct of at){const nt=ct.featureIndex.lookupSymbolFeatures(et[ct.bucketInstanceId],z,ct.bucketIndex,ct.sourceLayerIndex,{filterSpec:V.filter,globalState:V.globalState},V.layers,V.availableImages,D);for(const ht in nt){const pt=Q[ht]=Q[ht]||[],ot=nt[ht];ot.sort(((bt,It)=>{const Mt=ct.featureSortOrder;if(Mt){const Ct=Mt.indexOf(bt.featureIndex);return Mt.indexOf(It.featureIndex)-Ct}return It.featureIndex-bt.featureIndex}));for(const bt of ot)pt.push(bt)}}return(function(ct,nt,ht){for(const pt in ct)for(const ot of ct[pt])Kr(ot,ht[nt[pt].source]);return ct})(Q,D,B)})(this._layers,v,this.tileManagers,e,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,a){a?.filter&&this._validate(d.C.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.tileManagers[e];return u?(function(f,g){const v=f.getRenderableIds().map((D=>f.getTileByID(D))),T=[],E={};for(let D=0;D<v.length;D++){const z=v[D],B=z.tileID.canonical.key;E[B]||(E[B]=!0,z.querySourceFeatures(T,g))}return T})(u,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const u=this.light.getLight();let f=!1;for(const v in e)if(!d.bQ(e[v],u[v])){f=!0;break}if(!f)return;const g={now:Lt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();const u=this.getSky();let f=!1;if(!e&&!u)return;if(e&&!u)f=!0;else if(!e&&u)f=!0;else for(const v in e)if(!d.bQ(e[v],u[v])){f=!0;break}if(!f)return;const g={now:Lt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(g)}_setProjectionInternal(e){const a=(function(u,f){const g={constrainOverride:f};if(Array.isArray(u)){const v=new go({type:u});return{projection:v,transform:new jc(g),cameraHelper:new Vc(v)}}switch(u){case"mercator":return{projection:new Pn,transform:new Bi(g),cameraHelper:new rr};case"globe":{const v=new go({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new jc(g),cameraHelper:new Vc(v)}}case"vertical-perspective":return{projection:new Bu,transform:new Nc(g),cameraHelper:new jr};default:return d.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new Pn,transform:new Bi(g),cameraHelper:new rr}}})(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(e,a,u,f,g={}){return(!g||g.validate!==!1)&&Qo(this,e.call(d.C,d.e({key:a,style:this.serialize(),value:u,styleSpec:d.u},f)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Tr().off(Rs,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const u=this.tileManagers[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const a in this.tileManagers)this.tileManagers[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,a,u,f,g=!1){let v=!1,T=!1;const E={};for(const D of this._order){const z=this._layers[D];if(z.type!=="symbol")continue;if(!E[z.source]){const k=this.tileManagers[z.source];E[z.source]=k.getRenderableIds(!0).map((V=>k.getTileByID(V))).sort(((V,H)=>H.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(H.tileID)?-1:1)))}const B=this.crossTileSymbolIndex.addLayer(z,E[z.source],e.center.lng);v=v||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Lt(),e.zoom))&&(this.pauseablePlacement=new Wo(e,this.map.terrain,this._order,g,a,u,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Lt()),T=!0),v&&this.pauseablePlacement.placement.setStale()),T||v)for(const D of this._order){const z=this._layers[D];z.type==="symbol"&&this.placement.updateLayerOpacities(z,E[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Lt())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,a){return d._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),u}))}getGlyphs(e,a){return d._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(d.C.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return d._(this,void 0,void 0,(function*(){const u={};for(const[f,g]of Object.entries(a.dashes))u[f]=this.lineAtlas.getDash(g.dasharray,g.round);return u}))}addSprite(e,a,u={},f){this._checkLoaded();const g=[{id:e,url:a}],v=[...ii(this.stylesheet.sprite),...g];this._validate(d.C.sprite,"sprite",v,null,u)||(this.stylesheet.sprite=v,this._loadSprite(g,!0,f))}removeSprite(e){this._checkLoaded();const a=ii(this.stylesheet.sprite);if(a.find((u=>u.id===e))){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex((u=>u.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ii(this.stylesheet.sprite)}setSprite(e,a={},u){this._checkLoaded(),e&&this._validate(d.C.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const a=this.tileManagers[e];if(a.setEventedParent(null),a._tiles){for(const u in a._tiles)a._tiles[u].unloadVectorData();a._tiles={}}a._cache.reset(),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const a=this._layers[e];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var ds=d.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,u,f,g,v,T,E,D){this.context=e;let z=this.boundPaintVertexBuffers.length!==f.length;for(let B=0;!z&&B<f.length;B++)this.boundPaintVertexBuffers[B]!==f[B]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==g||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==D?this.freshBind(a,u,f,g,v,T,E,D):(e.bindVertexArray.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),D&&D.bind())}freshBind(e,a,u,f,g,v,T,E){const D=e.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=E,a.enableAttributes(B,e);for(const k of u)k.enableAttributes(B,e);v&&v.enableAttributes(B,e),T&&T.enableAttributes(B,e),E&&E.enableAttributes(B,e),a.bind(),a.setVertexAttribPointers(B,e,g);for(const k of u)k.bind(),k.setVertexAttribPointers(B,e,g);v&&(v.bind(),v.setVertexAttribPointers(B,e,g)),f&&f.bind(),T&&(T.bind(),T.setVertexAttribPointers(B,e,g)),E&&(E.bind(),E.setVertexAttribPointers(B,e,g)),z.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Jo=(m,e,a,u,f)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):d.bo.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(u):0,u_horizon_color:a?a.properties.get("horizon-color"):d.bo.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),Nu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ns(m){const e=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const u=m[a].split(" ");e.push(u.pop())}return e}class Qd{constructor(e,a,u,f,g,v,T,E,D=[]){const z=e.gl;this.program=z.createProgram();const B=Ns(a.staticAttributes),k=u?u.getBinderAttributes():[],V=B.concat(k),H=Er.prelude.staticUniforms?Ns(Er.prelude.staticUniforms):[],W=T.staticUniforms?Ns(T.staticUniforms):[],Q=a.staticUniforms?Ns(a.staticUniforms):[],et=u?u.getBinderUniforms():[],at=H.concat(W).concat(Q).concat(et),ct=[];for(const Mt of at)ct.indexOf(Mt)<0&&ct.push(Mt);const nt=u?u.defines():[];ta(z)&&nt.unshift("#version 300 es"),g&&nt.push("#define OVERDRAW_INSPECTOR;"),v&&nt.push("#define TERRAIN3D;"),E&&nt.push(E),D&&nt.push(...D);let ht=nt.concat(Er.prelude.fragmentSource,T.fragmentSource,a.fragmentSource).join(`
`),pt=nt.concat(Er.prelude.vertexSource,T.vertexSource,a.vertexSource).join(`
`);ta(z)||(ht=(function(Mt){return Mt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ht),pt=(function(Mt){return Mt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(pt));const ot=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ot,ht),z.compileShader(ot),!z.getShaderParameter(ot,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ot)}`);z.attachShader(this.program,ot);const bt=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(bt,pt),z.compileShader(bt),!z.getShaderParameter(bt,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(bt)}`);z.attachShader(this.program,bt),this.attributes={};const It={};this.numAttributes=V.length;for(let Mt=0;Mt<this.numAttributes;Mt++)V[Mt]&&(z.bindAttribLocation(this.program,Mt,V[Mt]),this.attributes[V[Mt]]=Mt);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(bt),z.deleteShader(ot);for(let Mt=0;Mt<ct.length;Mt++){const Ct=ct[Mt];if(Ct&&!It[Ct]){const At=z.getUniformLocation(this.program,Ct);At&&(It[Ct]=At)}}this.fixedUniforms=f(e,It),this.terrainUniforms=((Mt,Ct)=>({u_depth:new d.bZ(Mt,Ct.u_depth),u_terrain:new d.bZ(Mt,Ct.u_terrain),u_terrain_dim:new d.bp(Mt,Ct.u_terrain_dim),u_terrain_matrix:new d.b$(Mt,Ct.u_terrain_matrix),u_terrain_unpack:new d.c0(Mt,Ct.u_terrain_unpack),u_terrain_exaggeration:new d.bp(Mt,Ct.u_terrain_exaggeration)}))(e,It),this.projectionUniforms=((Mt,Ct)=>({u_projection_matrix:new d.b$(Mt,Ct.u_projection_matrix),u_projection_tile_mercator_coords:new d.c0(Mt,Ct.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.c0(Mt,Ct.u_projection_clipping_plane),u_projection_transition:new d.bp(Mt,Ct.u_projection_transition),u_projection_fallback_matrix:new d.b$(Mt,Ct.u_projection_fallback_matrix)}))(e,It),this.binderUniforms=u?u.getUniforms(e,It):[]}draw(e,a,u,f,g,v,T,E,D,z,B,k,V,H,W,Q,et,at,ct){const nt=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(f),e.setColorMode(g),e.setCullFace(v),E){e.activeTexture.set(nt.TEXTURE2),nt.bindTexture(nt.TEXTURE_2D,E.depthTexture),e.activeTexture.set(nt.TEXTURE3),nt.bindTexture(nt.TEXTURE_2D,E.texture);for(const pt in this.terrainUniforms)this.terrainUniforms[pt].set(E[pt])}if(D)for(const pt in D)this.projectionUniforms[Nu[pt]].set(D[pt]);if(T)for(const pt in this.fixedUniforms)this.fixedUniforms[pt].set(T[pt]);Q&&Q.setUniforms(e,this.binderUniforms,H,{zoom:W});let ht=0;switch(a){case nt.LINES:ht=2;break;case nt.TRIANGLES:ht=3;break;case nt.LINE_STRIP:ht=1}for(const pt of V.get()){const ot=pt.vaos||(pt.vaos={});(ot[z]||(ot[z]=new qh)).bind(e,this,B,Q?Q.getPaintVertexBuffers():[],k,pt.vertexOffset,et,at,ct),nt.drawElements(a,pt.primitiveLength*ht,nt.UNSIGNED_SHORT,pt.primitiveOffset*ht*2)}}}function Hl(m,e,a){const u=1/d.aM(a,1,e.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,e.transform.tileZoom)/f,v=g*(a.tileID.canonical.x+a.tileID.wrap*f),T=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Zh=(m,e,a,u)=>{const f=m.style.light,g=f.properties.get("position"),v=[g.x,g.y,g.z],T=d.c3();f.properties.get("anchor")==="viewport"&&d.c4(T,m.transform.bearingInRadians),d.c5(v,v,T);const E=m.transform.transformLightDirection(v),D=f.properties.get("color");return{u_lightpos:v,u_lightpos_globe:E,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:u}},tl=(m,e,a,u,f,g,v)=>d.e(Zh(m,e,a,u),Hl(g,m,v),{u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8}),el=(m,e,a,u)=>d.e(Hl(e,m,a),{u_fill_translate:u}),Jd=(m,e)=>({u_world:m,u_fill_translate:e}),ep=(m,e,a,u,f)=>d.e(el(m,e,a,f),{u_world:u}),tf=(m,e,a,u,f)=>{const g=m.transform;let v,T,E=0;if(a.paint.get("circle-pitch-alignment")==="map"){const D=d.aM(e,1,g.zoom);v=!0,T=[D,D],E=D/(d.a4*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*f}else v=!1,T=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:E,u_translate:u}},Uc=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Hh=m=>({u_viewport_size:[m.width,m.height]}),il=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),nl=(m,e,a,u)=>{const f=d.aM(m,1,e)/(d.a4*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:d.aM(m,1,e),u_intensity:a,u_globe_extrude_scale:f}},$h=(m,e,a,u)=>{const f=d.N();d.c6(f,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:f,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:a,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},fs=(m,e,a)=>{const u=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const g=a.getIlluminationProperties();for(let v=0;v<g.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Yh(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:u,u_method:f,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Xh=(m,e)=>{const a=e.stride,u=d.N();return d.c6(u,0,d.a4,-d.a4,0,0,1),d.O(u,u,[0,-d.a4,0]),{u_matrix:u,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Yh(m,e){const a=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.aa(0,u/a).toLngLat().lat,new d.aa(0,(u+1)/a).toLngLat().lat]}const rl=(m,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),$l=(m,e,a,u)=>{const f=m.transform;return{u_translation:Wh(m,e,a),u_ratio:u/d.aM(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Xl=(m,e,a,u,f)=>d.e($l(m,e,a,u),{u_image:0,u_image_height:f}),ef=(m,e,a,u,f)=>{const g=m.transform,v=Gc(e,g);return{u_translation:Wh(m,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:u/d.aM(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},nf=(m,e,a,u,f)=>{const g=Gc(e,m.transform);return d.e($l(m,e,a,u),{u_tileratio:g,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},rf=(m,e,a,u,f,g)=>{const v=Gc(e,m.transform);return d.e($l(m,e,a,u),{u_image:0,u_image_height:g,u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Gc(m,e){return 1/d.aM(m,1,e.tileZoom)}function Wh(m,e,a){return d.aN(m.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Kh=(m,e,a,u,f)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=u.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:af(u.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var g,v};function af(m){m*=Math.PI/180;const e=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const sr=(m,e,a,u,f,g,v,T,E,D,z,B,k)=>{const V=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:V.width/V.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+z,u_pitch_with_map:+u,u_is_along_line:f,u_is_variable_anchor:g,u_texsize:B,u_texture:0,u_translation:D,u_pitched_scale:k}},Vr=(m,e,a,u,f,g,v,T,E,D,z,B,k,V)=>{const H=v.transform;return d.e(sr(m,e,a,u,f,g,v,T,E,D,z,B,V),{u_gamma_scale:u?Math.cos(H.pitch*Math.PI/180)*H.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},qc=(m,e,a,u,f,g,v,T,E,D,z,B,k)=>d.e(Vr(m,e,a,u,f,g,v,T,E,D,!0,z,0,k),{u_texsize_icon:B,u_texture_icon:1}),Zc=(m,e)=>({u_opacity:m,u_color:e}),Hc=(m,e,a,u,f)=>d.e((function(g,v,T,E){const D=T.imageManager.getPattern(g.from.toString()),z=T.imageManager.getPattern(g.to.toString()),{width:B,height:k}=T.imageManager.getPixelSize(),V=Math.pow(2,E.tileID.overscaledZ),H=E.tileSize*Math.pow(2,T.transform.tileZoom)/V,W=H*(E.tileID.canonical.x+E.tileID.wrap*V),Q=H*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,k],u_mix:v.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/d.aM(E,1,T.transform.tileZoom),u_pixel_coord_upper:[W>>16,Q>>16],u_pixel_coord_lower:[65535&W,65535&Q]}})(a,f,e,u),{u_opacity:m}),$c=(m,e)=>{},ju={fillExtrusion:(m,e)=>({u_lightpos:new d.c1(m,e.u_lightpos),u_lightpos_globe:new d.c1(m,e.u_lightpos_globe),u_lightintensity:new d.bp(m,e.u_lightintensity),u_lightcolor:new d.c1(m,e.u_lightcolor),u_vertical_gradient:new d.bp(m,e.u_vertical_gradient),u_opacity:new d.bp(m,e.u_opacity),u_fill_translate:new d.c2(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new d.c1(m,e.u_lightpos),u_lightpos_globe:new d.c1(m,e.u_lightpos_globe),u_lightintensity:new d.bp(m,e.u_lightintensity),u_lightcolor:new d.c1(m,e.u_lightcolor),u_vertical_gradient:new d.bp(m,e.u_vertical_gradient),u_height_factor:new d.bp(m,e.u_height_factor),u_opacity:new d.bp(m,e.u_opacity),u_fill_translate:new d.c2(m,e.u_fill_translate),u_image:new d.bZ(m,e.u_image),u_texsize:new d.c2(m,e.u_texsize),u_pixel_coord_upper:new d.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.c2(m,e.u_pixel_coord_lower),u_scale:new d.c1(m,e.u_scale),u_fade:new d.bp(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new d.c2(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new d.bZ(m,e.u_image),u_texsize:new d.c2(m,e.u_texsize),u_pixel_coord_upper:new d.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.c2(m,e.u_pixel_coord_lower),u_scale:new d.c1(m,e.u_scale),u_fade:new d.bp(m,e.u_fade),u_fill_translate:new d.c2(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new d.c2(m,e.u_world),u_fill_translate:new d.c2(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new d.c2(m,e.u_world),u_image:new d.bZ(m,e.u_image),u_texsize:new d.c2(m,e.u_texsize),u_pixel_coord_upper:new d.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.c2(m,e.u_pixel_coord_lower),u_scale:new d.c1(m,e.u_scale),u_fade:new d.bp(m,e.u_fade),u_fill_translate:new d.c2(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new d.bp(m,e.u_camera_to_center_distance),u_scale_with_map:new d.bZ(m,e.u_scale_with_map),u_pitch_with_map:new d.bZ(m,e.u_pitch_with_map),u_extrude_scale:new d.c2(m,e.u_extrude_scale),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.bp(m,e.u_globe_extrude_scale),u_translate:new d.c2(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new d.c2(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new d.c2(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.b_(m,e.u_color),u_overlay:new d.bZ(m,e.u_overlay),u_overlay_scale:new d.bp(m,e.u_overlay_scale)}),depth:$c,clippingMask:$c,heatmap:(m,e)=>({u_extrude_scale:new d.bp(m,e.u_extrude_scale),u_intensity:new d.bp(m,e.u_intensity),u_globe_extrude_scale:new d.bp(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new d.b$(m,e.u_matrix),u_world:new d.c2(m,e.u_world),u_image:new d.bZ(m,e.u_image),u_color_ramp:new d.bZ(m,e.u_color_ramp),u_opacity:new d.bp(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new d.bZ(m,e.u_image),u_latrange:new d.c2(m,e.u_latrange),u_exaggeration:new d.bp(m,e.u_exaggeration),u_altitudes:new d.c8(m,e.u_altitudes),u_azimuths:new d.c8(m,e.u_azimuths),u_accent:new d.b_(m,e.u_accent),u_method:new d.bZ(m,e.u_method),u_shadows:new d.c7(m,e.u_shadows),u_highlights:new d.c7(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new d.b$(m,e.u_matrix),u_image:new d.bZ(m,e.u_image),u_dimension:new d.c2(m,e.u_dimension),u_zoom:new d.bp(m,e.u_zoom),u_unpack:new d.c0(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new d.bZ(m,e.u_image),u_unpack:new d.c0(m,e.u_unpack),u_dimension:new d.c2(m,e.u_dimension),u_elevation_stops:new d.bZ(m,e.u_elevation_stops),u_color_stops:new d.bZ(m,e.u_color_stops),u_color_ramp_size:new d.bZ(m,e.u_color_ramp_size),u_opacity:new d.bp(m,e.u_opacity)}),line:(m,e)=>({u_translation:new d.c2(m,e.u_translation),u_ratio:new d.bp(m,e.u_ratio),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.c2(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new d.c2(m,e.u_translation),u_ratio:new d.bp(m,e.u_ratio),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.c2(m,e.u_units_to_pixels),u_image:new d.bZ(m,e.u_image),u_image_height:new d.bp(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new d.c2(m,e.u_translation),u_texsize:new d.c2(m,e.u_texsize),u_ratio:new d.bp(m,e.u_ratio),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_image:new d.bZ(m,e.u_image),u_units_to_pixels:new d.c2(m,e.u_units_to_pixels),u_scale:new d.c1(m,e.u_scale),u_fade:new d.bp(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new d.c2(m,e.u_translation),u_ratio:new d.bp(m,e.u_ratio),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.c2(m,e.u_units_to_pixels),u_image:new d.bZ(m,e.u_image),u_mix:new d.bp(m,e.u_mix),u_tileratio:new d.bp(m,e.u_tileratio),u_crossfade_from:new d.bp(m,e.u_crossfade_from),u_crossfade_to:new d.bp(m,e.u_crossfade_to),u_lineatlas_width:new d.bp(m,e.u_lineatlas_width),u_lineatlas_height:new d.bp(m,e.u_lineatlas_height)}),lineGradientSDF:(m,e)=>({u_translation:new d.c2(m,e.u_translation),u_ratio:new d.bp(m,e.u_ratio),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.c2(m,e.u_units_to_pixels),u_image:new d.bZ(m,e.u_image),u_image_height:new d.bp(m,e.u_image_height),u_tileratio:new d.bp(m,e.u_tileratio),u_crossfade_from:new d.bp(m,e.u_crossfade_from),u_crossfade_to:new d.bp(m,e.u_crossfade_to),u_image_dash:new d.bZ(m,e.u_image_dash),u_mix:new d.bp(m,e.u_mix),u_lineatlas_width:new d.bp(m,e.u_lineatlas_width),u_lineatlas_height:new d.bp(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new d.c2(m,e.u_tl_parent),u_scale_parent:new d.bp(m,e.u_scale_parent),u_buffer_scale:new d.bp(m,e.u_buffer_scale),u_fade_t:new d.bp(m,e.u_fade_t),u_opacity:new d.bp(m,e.u_opacity),u_image0:new d.bZ(m,e.u_image0),u_image1:new d.bZ(m,e.u_image1),u_brightness_low:new d.bp(m,e.u_brightness_low),u_brightness_high:new d.bp(m,e.u_brightness_high),u_saturation_factor:new d.bp(m,e.u_saturation_factor),u_contrast_factor:new d.bp(m,e.u_contrast_factor),u_spin_weights:new d.c1(m,e.u_spin_weights),u_coords_top:new d.c0(m,e.u_coords_top),u_coords_bottom:new d.c0(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bZ(m,e.u_is_size_feature_constant),u_size_t:new d.bp(m,e.u_size_t),u_size:new d.bp(m,e.u_size),u_camera_to_center_distance:new d.bp(m,e.u_camera_to_center_distance),u_pitch:new d.bp(m,e.u_pitch),u_rotate_symbol:new d.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new d.bp(m,e.u_aspect_ratio),u_fade_change:new d.bp(m,e.u_fade_change),u_label_plane_matrix:new d.b$(m,e.u_label_plane_matrix),u_coord_matrix:new d.b$(m,e.u_coord_matrix),u_is_text:new d.bZ(m,e.u_is_text),u_pitch_with_map:new d.bZ(m,e.u_pitch_with_map),u_is_along_line:new d.bZ(m,e.u_is_along_line),u_is_variable_anchor:new d.bZ(m,e.u_is_variable_anchor),u_texsize:new d.c2(m,e.u_texsize),u_texture:new d.bZ(m,e.u_texture),u_translation:new d.c2(m,e.u_translation),u_pitched_scale:new d.bp(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bZ(m,e.u_is_size_feature_constant),u_size_t:new d.bp(m,e.u_size_t),u_size:new d.bp(m,e.u_size),u_camera_to_center_distance:new d.bp(m,e.u_camera_to_center_distance),u_pitch:new d.bp(m,e.u_pitch),u_rotate_symbol:new d.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new d.bp(m,e.u_aspect_ratio),u_fade_change:new d.bp(m,e.u_fade_change),u_label_plane_matrix:new d.b$(m,e.u_label_plane_matrix),u_coord_matrix:new d.b$(m,e.u_coord_matrix),u_is_text:new d.bZ(m,e.u_is_text),u_pitch_with_map:new d.bZ(m,e.u_pitch_with_map),u_is_along_line:new d.bZ(m,e.u_is_along_line),u_is_variable_anchor:new d.bZ(m,e.u_is_variable_anchor),u_texsize:new d.c2(m,e.u_texsize),u_texture:new d.bZ(m,e.u_texture),u_gamma_scale:new d.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_is_halo:new d.bZ(m,e.u_is_halo),u_translation:new d.c2(m,e.u_translation),u_pitched_scale:new d.bp(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.bZ(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bZ(m,e.u_is_size_feature_constant),u_size_t:new d.bp(m,e.u_size_t),u_size:new d.bp(m,e.u_size),u_camera_to_center_distance:new d.bp(m,e.u_camera_to_center_distance),u_pitch:new d.bp(m,e.u_pitch),u_rotate_symbol:new d.bZ(m,e.u_rotate_symbol),u_aspect_ratio:new d.bp(m,e.u_aspect_ratio),u_fade_change:new d.bp(m,e.u_fade_change),u_label_plane_matrix:new d.b$(m,e.u_label_plane_matrix),u_coord_matrix:new d.b$(m,e.u_coord_matrix),u_is_text:new d.bZ(m,e.u_is_text),u_pitch_with_map:new d.bZ(m,e.u_pitch_with_map),u_is_along_line:new d.bZ(m,e.u_is_along_line),u_is_variable_anchor:new d.bZ(m,e.u_is_variable_anchor),u_texsize:new d.c2(m,e.u_texsize),u_texsize_icon:new d.c2(m,e.u_texsize_icon),u_texture:new d.bZ(m,e.u_texture),u_texture_icon:new d.bZ(m,e.u_texture_icon),u_gamma_scale:new d.bp(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bp(m,e.u_device_pixel_ratio),u_is_halo:new d.bZ(m,e.u_is_halo),u_translation:new d.c2(m,e.u_translation),u_pitched_scale:new d.bp(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new d.bp(m,e.u_opacity),u_color:new d.b_(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new d.bp(m,e.u_opacity),u_image:new d.bZ(m,e.u_image),u_pattern_tl_a:new d.c2(m,e.u_pattern_tl_a),u_pattern_br_a:new d.c2(m,e.u_pattern_br_a),u_pattern_tl_b:new d.c2(m,e.u_pattern_tl_b),u_pattern_br_b:new d.c2(m,e.u_pattern_br_b),u_texsize:new d.c2(m,e.u_texsize),u_mix:new d.bp(m,e.u_mix),u_pattern_size_a:new d.c2(m,e.u_pattern_size_a),u_pattern_size_b:new d.c2(m,e.u_pattern_size_b),u_scale_a:new d.bp(m,e.u_scale_a),u_scale_b:new d.bp(m,e.u_scale_b),u_pixel_coord_upper:new d.c2(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.c2(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bp(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new d.bZ(m,e.u_texture),u_ele_delta:new d.bp(m,e.u_ele_delta),u_fog_matrix:new d.b$(m,e.u_fog_matrix),u_fog_color:new d.b_(m,e.u_fog_color),u_fog_ground_blend:new d.bp(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bp(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.b_(m,e.u_horizon_color),u_horizon_fog_blend:new d.bp(m,e.u_horizon_fog_blend),u_is_globe_mode:new d.bp(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new d.bp(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new d.bZ(m,e.u_texture),u_terrain_coords_id:new d.bp(m,e.u_terrain_coords_id),u_ele_delta:new d.bp(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new d.bp(m,e.u_input),u_output_expected:new d.bp(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new d.c1(m,e.u_sun_pos),u_atmosphere_blend:new d.bp(m,e.u_atmosphere_blend),u_globe_position:new d.c1(m,e.u_globe_position),u_globe_radius:new d.bp(m,e.u_globe_radius),u_inv_proj_matrix:new d.b$(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new d.b_(m,e.u_sky_color),u_horizon_color:new d.b_(m,e.u_horizon_color),u_horizon:new d.c2(m,e.u_horizon),u_horizon_normal:new d.c2(m,e.u_horizon_normal),u_sky_horizon_blend:new d.bp(m,e.u_sky_horizon_blend),u_sky_blend:new d.bp(m,e.u_sky_blend)})};class al{constructor(e,a,u){this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _o={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qh{constructor(e,a,u,f){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let u=0;u<this.attributes.length;u++){const f=a.attributes[this.attributes[u].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,a,u){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],v=a.attributes[g.name];v!==void 0&&e.vertexAttribPointer(v,g.components,e[_o[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ai{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jh extends ai{getDefault(){return d.bo.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class sf extends ai{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class yo extends ai{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Yl extends ai{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Xc extends ai{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Vu extends ai{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ps extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Uu extends ai{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Yc extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class vo extends ai{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Gu extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Wl extends ai{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ga extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class td extends ai{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ed extends ai{getDefault(){return d.bo.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class qu extends ai{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class or extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class sl extends ai{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Cr extends ai{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ms extends ai{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Kl extends ai{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Zu extends ai{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class js extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class xo extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class bo extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Wc extends ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class qe extends ai{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Vs extends ai{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const u=this.gl;ta(u)?u.bindVertexArray(e):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ip extends ai{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ur extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ol extends ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ba extends ai{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class of extends Ba{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Hu extends Ba{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ll extends Ba{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ql="Framebuffer is not complete";class $u{constructor(e,a,u,f,g){this.context=e,this.width=a,this.height=u;const v=e.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new of(e,T),f)this.depthAttachment=g?new ll(e,T):new Hu(e,T);else if(g)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(Ql)}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Jl{constructor(e){var a,u;if(this.gl=e,this.clearColor=new Jh(this),this.clearDepth=new sf(this),this.clearStencil=new yo(this),this.colorMask=new Yl(this),this.depthMask=new Xc(this),this.stencilMask=new Vu(this),this.stencilFunc=new ps(this),this.stencilOp=new Uu(this),this.stencilTest=new Yc(this),this.depthRange=new vo(this),this.depthTest=new Gu(this),this.depthFunc=new Wl(this),this.blend=new ga(this),this.blendFunc=new td(this),this.blendColor=new ed(this),this.blendEquation=new qu(this),this.cullFace=new or(this),this.cullFaceSide=new sl(this),this.frontFace=new Cr(this),this.program=new ms(this),this.activeTexture=new Kl(this),this.viewport=new Zu(this),this.bindFramebuffer=new js(this),this.bindRenderbuffer=new xo(this),this.bindTexture=new bo(this),this.bindVertexBuffer=new Wc(this),this.bindElementBuffer=new qe(this),this.bindVertexArray=new Vs(this),this.pixelStoreUnpack=new ip(this),this.pixelStoreUnpackPremultiplyAlpha=new Ur(this),this.pixelStoreUnpackFlipY=new ol(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ta(e)){this.HALF_FLOAT=e.HALF_FLOAT;const f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:f?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new al(this,e,a)}createVertexBuffer(e,a,u){return new Qh(this,e,a,u)}createRenderbuffer(e,a,u){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,e,a,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,a,u,f){return new $u(this,e,a,u,f)}clear({color:e,depth:a,stencil:u}){const f=this.gl;let g=0;e&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(g|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),f.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bQ(e.blendFunction,Gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ta(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return ta(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let wo;function Ar(m,e,a,u,f){const g=m.context,v=m.transform,T=g.gl,E=m.useProgram("collisionBox"),D=[];let z=0,B=0;for(let et=0;et<u.length;et++){const at=u[et],ct=e.getTile(at).getBucket(a);if(!ct)continue;const nt=f?ct.textCollisionBox:ct.iconCollisionBox,ht=ct.collisionCircleArray;ht.length>0&&(D.push({circleArray:ht,circleOffset:B,coord:at}),z+=ht.length/4,B=z),nt&&E.draw(g,T.LINES,Ve.disabled,ri.disabled,m.colorModeForRenderPass(),$e.disabled,Uc(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(at),v.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,m.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!f||!D.length)return;const k=m.useProgram("collisionCircle"),V=new d.c9;V.resize(4*z),V._trim();let H=0;for(const et of D)for(let at=0;at<et.circleArray.length/4;at++){const ct=4*at,nt=et.circleArray[ct+0],ht=et.circleArray[ct+1],pt=et.circleArray[ct+2],ot=et.circleArray[ct+3];V.emplace(H++,nt,ht,pt,ot,0),V.emplace(H++,nt,ht,pt,ot,1),V.emplace(H++,nt,ht,pt,ot,2),V.emplace(H++,nt,ht,pt,ot,3)}(!wo||wo.length<2*z)&&(wo=(function(et){const at=2*et,ct=new d.cb;ct.resize(at),ct._trim();for(let nt=0;nt<at;nt++){const ht=6*nt;ct.uint16[ht+0]=4*nt+0,ct.uint16[ht+1]=4*nt+1,ct.uint16[ht+2]=4*nt+2,ct.uint16[ht+3]=4*nt+2,ct.uint16[ht+4]=4*nt+3,ct.uint16[ht+5]=4*nt+0}return ct})(z));const W=g.createIndexBuffer(wo,!0),Q=g.createVertexBuffer(V,d.ca.members,!0);for(const et of D){const at=Hh(m.transform);k.draw(g,T.TRIANGLES,Ve.disabled,ri.disabled,m.colorModeForRenderPass(),$e.disabled,at,m.style.map.terrain&&m.style.map.terrain.getTerrainData(et.coord),null,a.id,Q,W,d.aW.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,m.transform.zoom,null,null,null)}Q.destroy(),W.destroy()}const ul=d.ar(new Float32Array(16));function Us(m,e,a,u,f,g){const{horizontalAlign:v,verticalAlign:T}=d.aR(m);return new d.P((-(v-.5)*e/f+u[0])*g,(-(T-.5)*a/f+u[1])*g)}function cl(m,e,a,u,f,g){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=u.mult(g);a||(T=T.rotate(-f));const E=v.add(T);return he(E.x,E.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){const T=pr(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),E=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return m.add(u.rotate(E))}return m.add(u)}function To(m,e,a,u,f,g,v,T,E,D,z,B){const k=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,W={};V.clear();for(let Q=0;Q<k.length;Q++){const et=k.get(Q),at=et.hidden||!et.crossTileID||m.allowVerticalPlacement&&!et.placedOrientation?null:u[et.crossTileID];if(at){const ct=new d.P(et.anchorX,et.anchorY),nt={getElevation:B,width:f.width,height:f.height,pitchedLabelPlaneMatrix:g,pitchWithMap:a,transform:f,tileAnchorPoint:ct,translation:D,unwrappedTileID:z},ht=a?La(ct.x,ct.y,nt):pr(ct.x,ct.y,nt),pt=Se(f.cameraToCenterDistance,ht.signedDistanceFromCamera);let ot=d.az(m.textSizeData,T,et)*pt/d.aL;a&&(ot*=m.tilePixelRatio/v);const{width:bt,height:It,anchor:Mt,textOffset:Ct,textBoxScale:At}=at,ie=Us(Mt,bt,It,Ct,At,ot),ne=f.getPitchedTextCorrection(ct.x+D[0],ct.y+D[1],z),qt=cl(ht.point,nt,e,ie,-f.bearingInRadians,ne),_e=m.allowVerticalPlacement&&et.placedOrientation===d.ay.vertical?Math.PI/2:0;for(let je=0;je<et.numGlyphs;je++)d.aF(V,qt,_e);E&&et.associatedIconIndex>=0&&(W[et.associatedIconIndex]={shiftedAnchor:qt,angle:_e})}else Sr(et.numGlyphs,V)}if(E){H.clear();const Q=m.icon.placedSymbolArray;for(let et=0;et<Q.length;et++){const at=Q.get(et);if(at.hidden)Sr(at.numGlyphs,H);else{const ct=W[et];if(ct)for(let nt=0;nt<at.numGlyphs;nt++)d.aF(H,ct.shiftedAnchor,ct.angle);else Sr(at.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function lr(m,e,a){return a.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Dr(m,e,a,u,f,g,v,T,E,D,z,B,k){const V=m.context,H=V.gl,W=m.transform,Q=T==="map",et=E==="map",at=T!=="viewport"&&a.layout.get("symbol-placement")!=="point",ct=Q&&!et&&!at,nt=!a.layout.get("symbol-sort-key").isConstant();let ht=!1;const pt=m.getDepthModeForSublayer(0,Ve.ReadOnly),ot=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),bt=[],It=W.getCircleRadiusCorrection();for(const Mt of u){const Ct=e.getTile(Mt),At=Ct.getBucket(a);if(!At)continue;const ie=f?At.text:At.icon;if(!ie||!ie.segments.get().length||!ie.hasVisibleVertices)continue;const ne=ie.programConfigurations.get(a.id),qt=f||At.sdfIcons,_e=f?At.textSizeData:At.iconSizeData,je=et||W.pitch!==0,Re=m.useProgram(lr(qt,f,At),ne),Hi=d.ax(_e,W.zoom),Fi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Mt);let en,zi,In,Yi,pn=[0,0],mn=null;if(f)zi=Ct.glyphAtlasTexture,In=H.LINEAR,en=Ct.glyphAtlasTexture.size,At.iconsInText&&(pn=Ct.imageAtlasTexture.size,mn=Ct.imageAtlasTexture,Yi=je||m.options.rotating||m.options.zooming||_e.kind==="composite"||_e.kind==="camera"?H.LINEAR:H.NEAREST);else{const ln=a.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear;zi=Ct.imageAtlasTexture,In=qt||m.options.rotating||m.options.zooming||ln||je?H.LINEAR:H.NEAREST,en=Ct.imageAtlasTexture.size}const bn=d.aM(Ct,1,m.transform.zoom),mr=En(Q,m.transform,bn),Es=d.N();d.aA(Es,mr);const Ua=fi(et,Q,m.transform,bn),Po=d.aN(W,Ct,g,v),Ms=W.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Ro=ot&&At.hasTextData(),na=a.layout.get("icon-text-fit")!=="none"&&Ro&&At.hasIconData();if(at){const ln=m.style.map.terrain?(wn,Ei)=>m.style.map.terrain.getElevation(Mt,wn,Ei):null,Ni=a.layout.get("text-rotation-alignment")==="map";$o(At,m,f,mr,Es,et,D,Ni,Mt.toUnwrapped(),W.width,W.height,Po,ln)}const Ga=f&&ot||na,Hr=at||Ga?ul:et?mr:m.transform.clipSpaceToPixelsMatrix,Cs=qt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vl;vl=qt?At.iconsInText?qc(_e.kind,Hi,ct,et,at,Ga,m,Hr,Ua,Po,en,pn,It):Vr(_e.kind,Hi,ct,et,at,Ga,m,Hr,Ua,Po,f,en,0,It):sr(_e.kind,Hi,ct,et,at,Ga,m,Hr,Ua,Po,f,en,It);const xl={program:Re,buffers:ie,uniformValues:vl,projectionData:Ms,atlasTexture:zi,atlasTextureIcon:mn,atlasInterpolation:In,atlasInterpolationIcon:Yi,isSDF:qt,hasHalo:Cs};if(nt&&At.canOverlap){ht=!0;const ln=ie.segments.get();for(const Ni of ln)bt.push({segments:new d.aW([Ni]),sortKey:Ni.sortKey,state:xl,terrainData:Fi})}else bt.push({segments:ie.segments,sortKey:0,state:xl,terrainData:Fi})}ht&&bt.sort(((Mt,Ct)=>Mt.sortKey-Ct.sortKey));for(const Mt of bt){const Ct=Mt.state;if(V.activeTexture.set(H.TEXTURE0),Ct.atlasTexture.bind(Ct.atlasInterpolation,H.CLAMP_TO_EDGE),Ct.atlasTextureIcon&&(V.activeTexture.set(H.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ct.isSDF){const At=Ct.uniformValues;Ct.hasHalo&&(At.u_is_halo=1,Gs(Ct.buffers,Mt.segments,a,m,Ct.program,pt,z,B,At,Ct.projectionData,Mt.terrainData)),At.u_is_halo=0}Gs(Ct.buffers,Mt.segments,a,m,Ct.program,pt,z,B,Ct.uniformValues,Ct.projectionData,Mt.terrainData)}}function Gs(m,e,a,u,f,g,v,T,E,D,z){const B=u.context;f.draw(B,B.gl.TRIANGLES,g,v,T,$e.backCCW,E,z,D,a.id,m.layoutVertexBuffer,m.indexBuffer,e,a.paint,u.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Gr(m,e,a,u,f){const g=m.context,v=g.gl,T=ri.disabled,E=new Gi([v.ONE,v.ONE],d.bo.transparent,[!0,!0,!0,!0]),D=e.getBucket(a);if(!D)return;const z=u.key;let B=a.heatmapFbos.get(z);B||(B=Fa(g,e.tileSize,e.tileSize),a.heatmapFbos.set(z,B)),g.bindFramebuffer.set(B.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:d.bo.transparent});const k=D.programConfigurations.get(a.id),V=m.useProgram("heatmap",k,!f),H=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=m.style.map.terrain.getTerrainData(u);V.draw(g,v.TRIANGLES,Ve.disabled,T,E,$e.disabled,nl(e,m.transform.zoom,a.paint.get("heatmap-intensity"),1),W,H,a.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,a.paint,m.transform.zoom,k)}function gs(m,e,a,u,f){const g=m.context,v=g.gl,T=m.transform;g.setColorMode(m.colorModeForRenderPass());const E=tu(g,e),D=a.key,z=e.heatmapFbos.get(D);if(!z)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1),E.bind(v.LINEAR,v.CLAMP_TO_EDGE);const B=T.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!u});m.useProgram("heatmapTexture").draw(g,v.TRIANGLES,Ve.disabled,ri.disabled,m.colorModeForRenderPass(),$e.disabled,$h(m,e,0,1),null,B,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,T.zoom),z.destroy(),e.heatmapFbos.delete(D)}function Fa(m,e,a){var u,f;const g=m.gl,v=g.createTexture();g.bindTexture(g.TEXTURE_2D,v),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const T=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:g.UNSIGNED_BYTE,E=(f=m.RGBA16F)!==null&&f!==void 0?f:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,E,e,a,0,g.RGBA,T,null);const D=m.createFramebuffer(e,a,!1,!1);return D.colorAttachment.set(v),D}function tu(m,e){return e.colorRampTexture||(e.colorRampTexture=new d.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function eu(m,e,a,u,f,g,v,T){let E=256;if(f.stepInterpolant){const D=e.getSource().maxzoom,z=v.canonical.z===D?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;E=d.an(d.cd(g.maxLineLength/d.a4*1024*z),256,a.maxTextureSize)}return T.gradient=d.ce({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:E,image:T.gradient||void 0,clips:g.lineClipsArray}),T.texture?T.texture.update(T.gradient):T.texture=new d.T(a,T.gradient,u.RGBA),T.version=f.gradientVersion,T.texture}function Kc(m,e,a,u,f){m.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),u.updatePaintBuffers(f)}function id(m,e,a,u,f,g){(f||m.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(e)),u.updatePaintBuffers(g)}function Ln(m,e,a,u,f,g,v){const T=g.gradients[f.id];let E=T.texture;f.gradientVersion!==T.version&&(E=eu(m,e,a,u,f,g,v,T)),a.activeTexture.set(u.TEXTURE0),E.bind(f.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function qi(m,e,a,u,f,g,v,T,E){const D=g.gradients[f.id];let z=D.texture;f.gradientVersion!==D.version&&(z=eu(m,e,a,u,f,g,v,D)),a.activeTexture.set(u.TEXTURE0),z.bind(f.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),a.activeTexture.set(u.TEXTURE1),m.lineAtlas.bind(a),T.updatePaintBuffers(E)}function si(m,e,a,u,f){if(!a||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let v=g[a.to.toString()],T=g[a.from.toString()];if(!v&&T&&(v=T),!T&&v&&(T=v),!v||!T){const E=f.getPaintProperty(e);v=g[E],T=g[E]}v&&T&&m.setConstantPatternPositions(v,T)}function _s(m,e,a,u,f,g,v,T){const E=m.context.gl,D="fill-pattern",z=a.paint.get(D),B=z&&z.constantOr(1),k=a.getCrossfadeParameters();let V,H,W,Q,et;const at=m.transform,ct=a.paint.get("fill-translate"),nt=a.paint.get("fill-translate-anchor");v?(H=B&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=E.LINES):(H=B?"fillPattern":"fill",V=E.TRIANGLES);const ht=z.constantOr(null);for(const pt of u){const ot=e.getTile(pt);if(B&&!ot.patternsLoaded())continue;const bt=ot.getBucket(a);if(!bt)continue;const It=bt.programConfigurations.get(a.id),Mt=m.useProgram(H,It),Ct=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pt);B&&(m.context.activeTexture.set(E.TEXTURE0),ot.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),It.updatePaintBuffers(k)),si(It,D,ht,ot,a);const At=at.getProjectionData({overscaledTileID:pt,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),ie=d.aN(at,ot,ct,nt);if(v){Q=bt.indexBuffer2,et=bt.segments2;const qt=[E.drawingBufferWidth,E.drawingBufferHeight];W=H==="fillOutlinePattern"&&B?ep(m,k,ot,qt,ie):Jd(qt,ie)}else Q=bt.indexBuffer,et=bt.segments,W=B?el(m,k,ot,ie):{u_fill_translate:ie};const ne=m.stencilModeForClipping(pt);Mt.draw(m.context,V,f,ne,g,$e.backCCW,W,Ct,At,a.id,bt.layoutVertexBuffer,Q,et,a.paint,m.transform.zoom,It)}}function ci(m,e,a,u,f,g,v,T){const E=m.context,D=E.gl,z="fill-extrusion-pattern",B=a.paint.get(z),k=B.constantOr(1),V=a.getCrossfadeParameters(),H=a.paint.get("fill-extrusion-opacity"),W=B.constantOr(null),Q=m.transform;for(const et of u){const at=e.getTile(et),ct=at.getBucket(a);if(!ct)continue;const nt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(et),ht=ct.programConfigurations.get(a.id),pt=m.useProgram(k?"fillExtrusionPattern":"fillExtrusion",ht);k&&(m.context.activeTexture.set(D.TEXTURE0),at.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ht.updatePaintBuffers(V));const ot=Q.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!T,applyTerrainMatrix:!0});si(ht,z,W,at,a);const bt=d.aN(Q,at,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),It=a.paint.get("fill-extrusion-vertical-gradient"),Mt=k?tl(m,It,H,bt,et,V,at):Zh(m,It,H,bt);pt.draw(E,E.gl.TRIANGLES,f,g,v,$e.backCCW,Mt,nt,ot,a.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,a.paint,m.transform.zoom,ht,m.style.map.terrain&&ct.centroidVertexBuffer)}}function Na(m,e,a,u,f,g,v,T,E){var D;const z=m.style.projection,B=m.context,k=m.transform,V=B.gl,H=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],W=m.useProgram("hillshade",null,!1,H),Q=!m.options.moving;for(const et of u){const at=e.getTile(et),ct=at.fbo;if(!ct)continue;const nt=z.getMeshFromTileID(B,et.canonical,T,!0,"raster"),ht=(D=m.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(et);B.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ct.colorAttachment.get());const pt=k.getProjectionData({overscaledTileID:et,aligned:Q,applyGlobeMatrix:!E,applyTerrainMatrix:!0});W.draw(B,V.TRIANGLES,g,f[et.overscaledZ],v,$e.backCCW,fs(m,at,a),ht,pt,a.id,nt.vertexBuffer,nt.indexBuffer,nt.segments)}}function An(m,e,a,u,f,g,v,T,E){var D;const z=m.style.projection,B=m.context,k=m.transform,V=B.gl,H=m.useProgram("colorRelief"),W=!m.options.moving;let Q=!0,et=0;for(const at of u){const ct=e.getTile(at),nt=ct.dem;if(Q){const Mt=V.getParameter(V.MAX_TEXTURE_SIZE),{elevationTexture:Ct,colorTexture:At}=a.getColorRampTextures(B,Mt,nt.getUnpackVector());B.activeTexture.set(V.TEXTURE1),Ct.bind(V.NEAREST,V.CLAMP_TO_EDGE),B.activeTexture.set(V.TEXTURE4),At.bind(V.LINEAR,V.CLAMP_TO_EDGE),Q=!1,et=Ct.size[0]}if(!nt||!nt.data)continue;const ht=nt.stride,pt=nt.getPixels();if(B.activeTexture.set(V.TEXTURE0),B.pixelStoreUnpackPremultiplyAlpha.set(!1),ct.demTexture=ct.demTexture||m.getTileTexture(ht),ct.demTexture){const Mt=ct.demTexture;Mt.update(pt,{premultiply:!1}),Mt.bind(V.LINEAR,V.CLAMP_TO_EDGE)}else ct.demTexture=new d.T(B,pt,V.RGBA,{premultiply:!1}),ct.demTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ot=z.getMeshFromTileID(B,at.canonical,T,!0,"raster"),bt=(D=m.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(at),It=k.getProjectionData({overscaledTileID:at,aligned:W,applyGlobeMatrix:!E,applyTerrainMatrix:!0});H.draw(B,V.TRIANGLES,g,f[at.overscaledZ],v,$e.backCCW,rl(a,ct.dem,et),bt,It,a.id,ot.vertexBuffer,ot.indexBuffer,ot.segments)}}const iu=[new d.P(0,0),new d.P(d.a4,0),new d.P(d.a4,d.a4),new d.P(0,d.a4)];function So(m,e,a,u,f,g,v,T,E=!1,D=!1){const z=u[u.length-1].overscaledZ,B=m.context,k=B.gl,V=m.useProgram("raster"),H=m.transform,W=m.style.projection,Q=m.colorModeForRenderPass(),et=!m.options.moving,at=a.paint.get("raster-opacity"),ct=a.paint.get("raster-resampling"),nt=a.paint.get("raster-fade-duration"),ht=!!m.style.map.terrain;for(const pt of u){const ot=m.getDepthModeForSublayer(pt.overscaledZ-z,at===1?Ve.ReadWrite:Ve.ReadOnly,k.LESS),bt=e.getTile(pt),It=ct==="nearest"?k.NEAREST:k.LINEAR;B.activeTexture.set(k.TEXTURE0),bt.texture.bind(It,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(k.TEXTURE1);const{parentTile:Mt,parentScaleBy:Ct,parentTopLeft:At,fadeValues:ie}=hl(bt,e,nt,ht);bt.fadeOpacity=ie.tileOpacity,Mt?(Mt.fadeOpacity=ie.parentTileOpacity,Mt.texture.bind(It,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST)):bt.texture.bind(It,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),bt.texture.useMipmap&&B.extTextureFilterAnisotropic&&m.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const ne=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pt),qt=H.getProjectionData({overscaledTileID:pt,aligned:et,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),_e=Kh(At,Ct,ie.fadeMix,a,T),je=W.getMeshFromTileID(B,pt.canonical,g,v,"raster");V.draw(B,k.TRIANGLES,ot,f?f[pt.overscaledZ]:ri.disabled,Q,E?$e.frontCCW:$e.backCCW,_e,ne,qt,a.id,je.vertexBuffer,je.indexBuffer,je.segments)}}function hl(m,e,a,u){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||u)return f;if(m.fadingParentID){const g=e.getLoadedTile(m.fadingParentID);if(!g)return f;const v=Math.pow(2,g.tileID.overscaledZ-m.tileID.overscaledZ),T=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],E=(function(D,z,B){const k=Lt(),V=(k-z.timeAdded)/B,H=D.fadingDirection===ft.Incoming,W=d.an((k-D.timeAdded)/B,0,1),Q=d.an(1-V,0,1),et=H?W:Q;return{tileOpacity:et,parentTileOpacity:H?Q:W,fadeMix:{opacity:1,mix:1-et}}})(m,g,a);return{parentTile:g,parentScaleBy:v,parentTopLeft:T,fadeValues:E}}if(m.selfFading){const g=(function(v,T){const E=(Lt()-v.timeAdded)/T,D=d.an(E,0,1);return{tileOpacity:D,fadeMix:{opacity:D,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:g}}return f}const _a=new d.bo(1,0,0,1),Xu=new d.bo(0,1,0,1),qs=new d.bo(0,0,1,1),Yu=new d.bo(1,0,1,1),Eo=new d.bo(0,1,1,1);function ja(m,e,a,u){ea(m,0,e+a/2,m.transform.width,a,u)}function ys(m,e,a,u){ea(m,e-a/2,0,a,m.transform.height,u)}function ea(m,e,a,u,f,g){const v=m.context,T=v.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*m.pixelRatio,a*m.pixelRatio,u*m.pixelRatio,f*m.pixelRatio),v.clear({color:g}),T.disable(T.SCISSOR_TEST)}function Qc(m,e,a){const u=m.context,f=u.gl,g=m.useProgram("debug"),v=Ve.disabled,T=ri.disabled,E=m.colorModeForRenderPass(),D="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);u.activeTexture.set(f.TEXTURE0);const B=e.getTileByID(a.key).latestRawTileData,k=Math.floor((B&&B.byteLength||0)/1024),V=e.getTile(a).tileSize,H=512/Math.min(V,512)*(a.overscaledZ/m.transform.zoom)*.5;let W=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(W+=` => ${a.overscaledZ}`),(function(et,at){et.initDebugOverlayCanvas();const ct=et.debugOverlayCanvas,nt=et.context.gl,ht=et.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,ct.width,ct.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(at,5,5),ht.strokeText(at,5,5),et.debugOverlayTexture.update(ct),et.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)})(m,`${W} ${k}kB`);const Q=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(u,f.TRIANGLES,v,T,Gi.alphaBlended,$e.disabled,il(d.bo.transparent,H),null,Q,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(u,f.LINE_STRIP,v,T,E,$e.disabled,il(d.bo.red),z,Q,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function vs(m,e,a,u){const{isRenderingGlobe:f}=u,g=m.context,v=g.gl,T=m.transform,E=m.colorModeForRenderPass(),D=m.getDepthModeFor3D(),z=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const B of a){const k=e.getTerrainMesh(B.tileID),V=m.renderToTexture.getTexture(B),H=e.getTerrainData(B.tileID);g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,V.texture);const W=e.getMeshFrameDelta(T.zoom),Q=T.calculateFogMatrix(B.tileID.toUnwrapped()),et=Jo(W,Q,m.style.sky,T.pitch,f),at=T.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(g,v.TRIANGLES,D,ri.disabled,E,$e.backCCW,et,H,at,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}function Mo(m,e){if(!e.mesh){const a=new d.aV;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const u=new d.aX;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new ls(m.createVertexBuffer(a,vn.members),m.createIndexBuffer(u),d.aW.simpleSegment(0,0,a.length,u.length))}return e.mesh}class Wu{constructor(e,a){this.context=new Jl(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=He.maxOverzooming+He.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ko}resize(e,a,u){if(this.width=Math.floor(e*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const e=this.context,a=new d.aV;a.emplaceBack(0,0),a.emplaceBack(d.a4,0),a.emplaceBack(0,d.a4),a.emplaceBack(d.a4,d.a4),this.tileExtentBuffer=e.createVertexBuffer(a,vn.members),this.tileExtentSegments=d.aW.simpleSegment(0,0,4,2);const u=new d.aV;u.emplaceBack(0,0),u.emplaceBack(d.a4,0),u.emplaceBack(0,d.a4),u.emplaceBack(d.a4,d.a4),this.debugBuffer=e.createVertexBuffer(u,vn.members),this.debugSegments=d.aW.simpleSegment(0,0,4,5);const f=new d.cg;f.emplaceBack(0,0,0,0),f.emplaceBack(d.a4,0,d.a4,0),f.emplaceBack(0,d.a4,0,d.a4),f.emplaceBack(d.a4,d.a4,d.a4,d.a4),this.rasterBoundsBuffer=e.createVertexBuffer(f,ds.members),this.rasterBoundsSegments=d.aW.simpleSegment(0,0,4,2);const g=new d.aV;g.emplaceBack(0,0),g.emplaceBack(d.a4,0),g.emplaceBack(0,d.a4),g.emplaceBack(d.a4,d.a4),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,vn.members),this.rasterBoundsSegmentsPosOnly=d.aW.simpleSegment(0,0,4,5);const v=new d.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,vn.members),this.viewportSegments=d.aW.simpleSegment(0,0,4,2);const T=new d.ch;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);const E=new d.aX;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(E);const D=this.context.gl;this.stencilClearMode=new ri({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.tileExtentMesh=new ls(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.N();d.c6(u,0,this.width,this.height,0,0,1),d.Q(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Ve.disabled,this.stencilClearMode,Gi.disabled,$e.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Gi.disabled),f.setDepthMode(Ve.disabled);const g={};for(const v of a)g[v.key]=this.nextStencilID++;this._renderTileMasks(g,a,u,!0),this._renderTileMasks(g,a,u,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,a,u,f){const g=this.context,v=g.gl,T=this.style.projection,E=this.transform,D=this.useProgram("clippingMask");for(const z of a){const B=e[z.key],k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),V=T.getMeshFromTileID(this.context,z.canonical,f,!0,"stencil"),H=E.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!u,applyTerrainMatrix:!0});D.draw(g,v.TRIANGLES,Ve.disabled,new ri({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),Gi.disabled,u?$e.disabled:$e.backCCW,null,k,H,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}_renderTilesDepthBuffer(){const e=this.context,a=e.gl,u=this.style.projection,f=this.transform,g=this.useProgram("depth"),v=this.getDepthModeFor3D(),T=Be(f,{tileSize:f.tileSize});for(const E of T){const D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),z=u.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),B=f.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,a.TRIANGLES,v,ri.disabled,Gi.disabled,$e.backCCW,null,D,B,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new ri({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new ri({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const a=this.context.gl,u=e.sort(((v,T)=>T.overscaledZ-v.overscaledZ)),f=u[u.length-1].overscaledZ,g=u[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let T=0;T<g;T++)v[T+f]=new ri({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[v,u]}return[{[f]:ri.disabled},u]}stencilConfigForOverlapTwoPass(e){const a=this.context.gl,u=e.sort(((v,T)=>T.overscaledZ-v.overscaledZ)),f=u[u.length-1].overscaledZ,g=u[0].overscaledZ-f+1;if(this.clearStencil(),g>1){const v={},T={};for(let E=0;E<g;E++)v[E+f]=new ri({func:a.GREATER,mask:255},g+1+E,255,a.KEEP,a.KEEP,a.REPLACE),T[E+f]=new ri({func:a.GREATER,mask:255},1+E,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*g+1,[v,T,u]}return this.nextStencilID=3,[{[f]:new ri({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new ri({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Gi([e.CONSTANT_COLOR,e.ONE],new d.bo(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gi.unblended:Gi.alphaBlended}getDepthModeForSublayer(e,a,u){if(!this.opaquePassEnabledForLayer())return Ve.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ve(u||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new Ve(this.context.gl.LEQUAL,Ve.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var u,f;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Lt()),this.imageManager.beginFrame();const g=this.style._order,v=this.style.tileManagers,T={},E={},D={},z={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const k in v){const V=v[k];V.used&&V.prepare(this.context),T[k]=V.getVisibleCoordinates(!1),E[k]=T[k].slice().reverse(),D[k]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<g.length;k++)if(this.style._layers[g[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of g){const V=this.style._layers[k];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const H=E[V.source];(V.type==="custom"||H.length)&&this.renderLayer(this,v[V.source],V,H,z)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:k=>this.useProgram(k)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.bo.black:d.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(k,V){const H=k.context,W=H.gl,Q=((pt,ot,bt)=>{const It=Math.cos(ot.rollInRadians),Mt=Math.sin(ot.rollInRadians),Ct=St(ot),At=ot.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:pt.properties.get("sky-color"),u_horizon_color:pt.properties.get("horizon-color"),u_horizon:[(ot.width/2-Ct*Mt)*bt,(ot.height/2+Ct*It)*bt],u_horizon_normal:[-Mt,It],u_sky_horizon_blend:pt.properties.get("sky-horizon-blend")*ot.height/2*bt,u_sky_blend:At}})(V,k.style.map.transform,k.pixelRatio),et=new Ve(W.LEQUAL,Ve.ReadWrite,[0,1]),at=ri.disabled,ct=k.colorModeForRenderPass(),nt=k.useProgram("sky"),ht=Mo(H,V);nt.draw(H,W.TRIANGLES,et,at,ct,$e.disabled,Q,null,void 0,"sky",ht.vertexBuffer,ht.indexBuffer,ht.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[g[this.currentLayer]],V=v[k.source],H=T[k.source];this._renderTileClippingMasks(k,H,!1),this.renderLayer(this,V,k,H,z)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const k=this.style._layers[g[this.currentLayer]],V=v[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k,z))continue;this.opaquePassEnabledForLayer()||B||(B=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const H=(k.type==="symbol"?D:E)[k.source];this._renderTileClippingMasks(k,T[k.source],!!this.renderToTexture),this.renderLayer(this,V,k,H,z)}if(z.isRenderingGlobe&&(function(k,V,H){const W=k.context,Q=W.gl,et=k.useProgram("atmosphere"),at=new Ve(Q.LEQUAL,Ve.ReadOnly,[0,1]),ct=k.transform,nt=(function(At,ie){const ne=At.properties.get("position"),qt=[-ne.x,-ne.y,-ne.z],_e=d.ar(new Float64Array(16));return At.properties.get("anchor")==="map"&&(d.bf(_e,_e,ie.rollInRadians),d.bg(_e,_e,-ie.pitchInRadians),d.bf(_e,_e,ie.bearingInRadians),d.bg(_e,_e,ie.center.lat*Math.PI/180),d.bI(_e,_e,-ie.center.lng*Math.PI/180)),d.cf(qt,qt,_e),qt})(H,k.transform),ht=ct.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),pt=V.properties.get("atmosphere-blend")*ht.projectionTransition;if(pt===0)return;const ot=kc(ct.worldSize,ct.center.lat),bt=ct.inverseProjectionMatrix,It=new Float64Array(4);It[3]=1,d.aG(It,It,ct.modelViewProjectionMatrix),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1,d.aG(It,It,bt),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1;const Mt=((At,ie,ne,qt,_e)=>({u_sun_pos:At,u_atmosphere_blend:ie,u_globe_position:ne,u_globe_radius:qt,u_inv_proj_matrix:_e}))(nt,pt,[It[0],It[1],It[2]],ot,bt),Ct=Mo(W,V);et.draw(W,Q.TRIANGLES,at,ri.disabled,Gi.alphaBlended,$e.disabled,Mt,null,null,"atmosphere",Ct.vertexBuffer,Ct.indexBuffer,Ct.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const k=(function(V,H){let W=null;const Q=Object.values(V._layers).flatMap((nt=>nt.source&&!nt.isHidden(H)?[V.tileManagers[nt.source]]:[])),et=Q.filter((nt=>nt.getSource().type==="vector")),at=Q.filter((nt=>nt.getSource().type!=="vector")),ct=nt=>{(!W||W.getSource().maxzoom<nt.getSource().maxzoom)&&(W=nt)};return et.forEach((nt=>ct(nt))),W||at.forEach((nt=>ct(nt))),W})(this.style,this.transform.zoom);k&&(function(V,H,W){for(let Q=0;Q<W.length;Q++)Qc(V,H,W[Q])})(this,k,k.getVisibleCoordinates())}this.options.showPadding&&(function(k){const V=k.transform.padding;ja(k,k.transform.height-(V.top||0),3,_a),ja(k,V.bottom||0,3,Xu),ys(k,V.left||0,3,qs),ys(k,k.transform.width-(V.right||0),3,Yu);const H=k.transform.centerPoint;(function(W,Q,et,at){ea(W,Q-1,et-10,2,20,at),ea(W,Q-10,et-1,20,2,at)})(k,H.x,k.transform.height-H.y,Eo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=e?!d.ci(a,u):!d.cj(a,u)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(d.ck(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,v){const T=g.context,E=T.gl,D=g.transform,z=Gi.unblended,B=new Ve(E.LEQUAL,Ve.ReadWrite,[0,1]),k=v.tileManager.getRenderableTiles(),V=g.useProgram("terrainDepth");T.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),T.clear({color:d.bo.transparent,depth:1});for(const H of k){const W=v.getTerrainMesh(H.tileID),Q=v.getTerrainData(H.tileID),et=D.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),at={u_ele_delta:v.getMeshFrameDelta(D.zoom)};V.draw(T,E.TRIANGLES,B,ri.disabled,z,$e.backCCW,at,Q,et,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,v){const T=g.context,E=T.gl,D=g.transform,z=Gi.unblended,B=new Ve(E.LEQUAL,Ve.ReadWrite,[0,1]),k=v.getCoordsTexture(),V=v.tileManager.getRenderableTiles(),H=g.useProgram("terrainCoords");T.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),T.clear({color:d.bo.transparent,depth:1}),v.coordsIndex=[];for(const W of V){const Q=v.getTerrainMesh(W.tileID),et=v.getTerrainData(W.tileID);T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,k.texture);const at={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(D.zoom)},ct=D.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});H.draw(T,E.TRIANGLES,B,ri.disabled,z,$e.backCCW,at,et,ct,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),v.coordsIndex.push(W.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,a,u,f,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(f||[]).length)&&(this.id=u.id,d.cl(u)?(function(v,T,E,D,z,B){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:k}=B,V=ri.disabled,H=v.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(W,Q,et,at,ct,nt,ht,pt,ot){const bt=Q.transform,It=Q.style.map.terrain,Mt=ct==="map",Ct=nt==="map";for(const At of W){const ie=at.getTile(At),ne=ie.getBucket(et);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const qt=d.ax(ne.textSizeData,bt.zoom),_e=d.aM(ie,1,Q.transform.zoom),je=En(Mt,Q.transform,_e),Re=et.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(qt){const Hi=Math.pow(2,bt.zoom-ie.tileID.overscaledZ),Fi=It?(en,zi)=>It.getElevation(At,en,zi):null;To(ne,Mt,Ct,ot,bt,je,Hi,qt,Re,d.aN(bt,ie,ht,pt),At.toUnwrapped(),Fi)}}})(D,v,E,T,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),z),E.paint.get("icon-opacity").constantOr(1)!==0&&Dr(v,T,E,D,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),V,H,k),E.paint.get("text-opacity").constantOr(1)!==0&&Dr(v,T,E,D,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),V,H,k),T.map.showCollisionBoxes&&(Ar(v,T,E,D,!0),Ar(v,T,E,D,!1))})(e,a,u,f,this.style.placement.variableOffsets,g):d.cm(u)?(function(v,T,E,D,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,k=E.paint.get("circle-opacity"),V=E.paint.get("circle-stroke-width"),H=E.paint.get("circle-stroke-opacity"),W=!E.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(V.constantOr(1)===0||H.constantOr(1)===0))return;const Q=v.context,et=Q.gl,at=v.transform,ct=v.getDepthModeForSublayer(0,Ve.ReadOnly),nt=ri.disabled,ht=v.colorModeForRenderPass(),pt=[],ot=at.getCircleRadiusCorrection();for(let bt=0;bt<D.length;bt++){const It=D[bt],Mt=T.getTile(It),Ct=Mt.getBucket(E);if(!Ct)continue;const At=E.paint.get("circle-translate"),ie=E.paint.get("circle-translate-anchor"),ne=d.aN(at,Mt,At,ie),qt=Ct.programConfigurations.get(E.id),_e=v.useProgram("circle",qt),je=Ct.layoutVertexBuffer,Re=Ct.indexBuffer,Hi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(It),Fi={programConfiguration:qt,program:_e,layoutVertexBuffer:je,indexBuffer:Re,uniformValues:tf(v,Mt,E,ne,ot),terrainData:Hi,projectionData:at.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(W){const en=Ct.segments.get();for(const zi of en)pt.push({segments:new d.aW([zi]),sortKey:zi.sortKey,state:Fi})}else pt.push({segments:Ct.segments,sortKey:0,state:Fi})}W&&pt.sort(((bt,It)=>bt.sortKey-It.sortKey));for(const bt of pt){const{programConfiguration:It,program:Mt,layoutVertexBuffer:Ct,indexBuffer:At,uniformValues:ie,terrainData:ne,projectionData:qt}=bt.state;Mt.draw(Q,et.TRIANGLES,ct,nt,ht,$e.backCCW,ie,ne,qt,E.id,Ct,At,bt.segments,E.paint,v.transform.zoom,It)}})(e,a,u,f,g):d.cn(u)?(function(v,T,E,D,z){if(E.paint.get("heatmap-opacity")===0)return;const B=v.context,{isRenderingToTexture:k,isRenderingGlobe:V}=z;if(v.style.map.terrain){for(const H of D){const W=T.getTile(H);T.hasRenderableParent(H)||(v.renderPass==="offscreen"?Gr(v,W,E,H,V):v.renderPass==="translucent"&&gs(v,E,H,k,V))}B.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(H,W,Q,et){const at=H.context,ct=at.gl,nt=H.transform,ht=ri.disabled,pt=new Gi([ct.ONE,ct.ONE],d.bo.transparent,[!0,!0,!0,!0]);(function(ot,bt,It){const Mt=ot.gl;ot.activeTexture.set(Mt.TEXTURE1),ot.viewport.set([0,0,bt.width/4,bt.height/4]);let Ct=It.heatmapFbos.get(d.cc);Ct?(Mt.bindTexture(Mt.TEXTURE_2D,Ct.colorAttachment.get()),ot.bindFramebuffer.set(Ct.framebuffer)):(Ct=Fa(ot,bt.width/4,bt.height/4),It.heatmapFbos.set(d.cc,Ct))})(at,H,Q),at.clear({color:d.bo.transparent});for(let ot=0;ot<et.length;ot++){const bt=et[ot];if(W.hasRenderableParent(bt))continue;const It=W.getTile(bt),Mt=It.getBucket(Q);if(!Mt)continue;const Ct=Mt.programConfigurations.get(Q.id),At=H.useProgram("heatmap",Ct),ie=nt.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ne=nt.getCircleRadiusCorrection();At.draw(at,ct.TRIANGLES,Ve.disabled,ht,pt,$e.backCCW,nl(It,nt.zoom,Q.paint.get("heatmap-intensity"),ne),null,ie,Q.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,Q.paint,nt.zoom,Ct)}at.viewport.set([0,0,H.width,H.height])})(v,T,E,D):v.renderPass==="translucent"&&(function(H,W){const Q=H.context,et=Q.gl;Q.setColorMode(H.colorModeForRenderPass());const at=W.heatmapFbos.get(d.cc);at&&(Q.activeTexture.set(et.TEXTURE0),et.bindTexture(et.TEXTURE_2D,at.colorAttachment.get()),Q.activeTexture.set(et.TEXTURE1),tu(Q,W).bind(et.LINEAR,et.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(Q,et.TRIANGLES,Ve.disabled,ri.disabled,H.colorModeForRenderPass(),$e.disabled,$h(H,W,0,1),null,null,W.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,W.paint,H.transform.zoom))})(v,E)})(e,a,u,f,g):d.co(u)?(function(v,T,E,D,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,k=E.paint.get("line-opacity"),V=E.paint.get("line-width");if(k.constantOr(1)===0||V.constantOr(1)===0)return;const H=v.getDepthModeForSublayer(0,Ve.ReadOnly),W=v.colorModeForRenderPass(),Q=E.paint.get("line-dasharray"),et=Q.constantOr(1),at=E.paint.get("line-pattern"),ct=at.constantOr(1),nt=E.paint.get("line-gradient"),ht=E.getCrossfadeParameters();let pt;pt=ct?"linePattern":et&&nt?"lineGradientSDF":et?"lineSDF":nt?"lineGradient":"line";const ot=v.context,bt=ot.gl,It=v.transform;let Mt=!0;for(const Ct of D){const At=T.getTile(Ct);if(ct&&!At.patternsLoaded())continue;const ie=At.getBucket(E);if(!ie)continue;const ne=ie.programConfigurations.get(E.id),qt=v.context.program.get(),_e=v.useProgram(pt,ne),je=Mt||_e.program!==qt,Re=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ct),Hi=at.constantOr(null),Fi=Q&&Q.constantOr(null);if(Hi&&At.imageAtlas){const pn=At.imageAtlas,mn=pn.patternPositions[Hi.to.toString()],bn=pn.patternPositions[Hi.from.toString()];mn&&bn&&ne.setConstantPatternPositions(mn,bn)}else if(Fi){const pn=E.layout.get("line-cap")==="round",mn=v.lineAtlas.getDash(Fi.to,pn),bn=v.lineAtlas.getDash(Fi.from,pn);ne.setConstantDashPositions(mn,bn)}const en=It.getProjectionData({overscaledTileID:Ct,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),zi=It.getPixelScale();let In;ct?(In=ef(v,At,E,zi,ht),Kc(ot,bt,At,ne,ht)):et&&nt?(In=rf(v,At,E,zi,ht,ie.lineClipsArray.length),qi(v,T,ot,bt,E,ie,Ct,ne,ht)):et?(In=nf(v,At,E,zi,ht),id(v,ot,bt,ne,je,ht)):nt?(In=Xl(v,At,E,zi,ie.lineClipsArray.length),Ln(v,T,ot,bt,E,ie,Ct)):In=$l(v,At,E,zi);const Yi=v.stencilModeForClipping(Ct);_e.draw(ot,bt.TRIANGLES,H,Yi,W,$e.disabled,In,Re,en,E.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,E.paint,v.transform.zoom,ne,ie.layoutVertexBuffer2),Mt=!1}})(e,a,u,f,g):d.cp(u)?(function(v,T,E,D,z){const B=E.paint.get("fill-color"),k=E.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const{isRenderingToTexture:V}=z,H=v.colorModeForRenderPass(),W=E.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!W.constantOr(1)&&B.constantOr(d.bo.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const et=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ve.ReadWrite:Ve.ReadOnly);_s(v,T,E,D,et,H,!1,V)}if(v.renderPass==="translucent"&&E.paint.get("fill-antialias")){const et=v.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Ve.ReadOnly);_s(v,T,E,D,et,H,!0,V)}})(e,a,u,f,g):d.cq(u)?(function(v,T,E,D,z){const B=E.paint.get("fill-extrusion-opacity");if(B===0)return;const{isRenderingToTexture:k}=z;if(v.renderPass==="translucent"){const V=new Ve(v.context.gl.LEQUAL,Ve.ReadWrite,v.depthRangeFor3D);if(B!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))ci(v,T,E,D,V,ri.disabled,Gi.disabled,k),ci(v,T,E,D,V,v.stencilModeFor3D(),v.colorModeForRenderPass(),k);else{const H=v.colorModeForRenderPass();ci(v,T,E,D,V,ri.disabled,H,k)}}})(e,a,u,f,g):d.cr(u)?(function(v,T,E,D,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,k=v.context,V=v.style.projection.useSubdivision,H=v.getDepthModeForSublayer(0,Ve.ReadOnly),W=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(Q,et,at,ct,nt,ht,pt){const ot=Q.context,bt=ot.gl;for(const It of at){const Mt=et.getTile(It),Ct=Mt.dem;if(!Ct||!Ct.data||!Mt.needsHillshadePrepare)continue;const At=Ct.dim,ie=Ct.stride,ne=Ct.getPixels();if(ot.activeTexture.set(bt.TEXTURE1),ot.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||Q.getTileTexture(ie),Mt.demTexture){const _e=Mt.demTexture;_e.update(ne,{premultiply:!1}),_e.bind(bt.NEAREST,bt.CLAMP_TO_EDGE)}else Mt.demTexture=new d.T(ot,ne,bt.RGBA,{premultiply:!1}),Mt.demTexture.bind(bt.NEAREST,bt.CLAMP_TO_EDGE);ot.activeTexture.set(bt.TEXTURE0);let qt=Mt.fbo;if(!qt){const _e=new d.T(ot,{width:At,height:At,data:null},bt.RGBA);_e.bind(bt.LINEAR,bt.CLAMP_TO_EDGE),qt=Mt.fbo=ot.createFramebuffer(At,At,!0,!1),qt.colorAttachment.set(_e.texture)}ot.bindFramebuffer.set(qt.framebuffer),ot.viewport.set([0,0,At,At]),Q.useProgram("hillshadePrepare").draw(ot,bt.TRIANGLES,nt,ht,pt,$e.disabled,Xh(Mt.tileID,Ct),null,null,ct.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(v,T,D,E,H,ri.disabled,W),k.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(V){const[Q,et,at]=v.stencilConfigForOverlapTwoPass(D);Na(v,T,E,at,Q,H,W,!1,B),Na(v,T,E,at,et,H,W,!0,B)}else{const[Q,et]=v.getStencilConfigForOverlapAndUpdateStencilID(D);Na(v,T,E,et,Q,H,W,!1,B)}})(e,a,u,f,g):d.cs(u)?(function(v,T,E,D,z){if(v.renderPass!=="translucent"||!D.length)return;const{isRenderingToTexture:B}=z,k=v.style.projection.useSubdivision,V=v.getDepthModeForSublayer(0,Ve.ReadOnly),H=v.colorModeForRenderPass();if(k){const[W,Q,et]=v.stencilConfigForOverlapTwoPass(D);An(v,T,E,et,W,V,H,!1,B),An(v,T,E,et,Q,V,H,!0,B)}else{const[W,Q]=v.getStencilConfigForOverlapAndUpdateStencilID(D);An(v,T,E,Q,W,V,H,!1,B)}})(e,a,u,f,g):d.bT(u)?(function(v,T,E,D,z){if(v.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!D.length)return;const{isRenderingToTexture:B}=z,k=T.getSource(),V=v.style.projection.useSubdivision;if(k instanceof kr)So(v,T,E,D,null,!1,!1,k.tileCoords,k.flippedWindingOrder,B);else if(V){const[H,W,Q]=v.stencilConfigForOverlapTwoPass(D);So(v,T,E,Q,H,!1,!0,iu,!1,B),So(v,T,E,Q,W,!0,!0,iu,!1,B)}else{const[H,W]=v.getStencilConfigForOverlapAndUpdateStencilID(D);So(v,T,E,W,H,!1,!0,iu,!1,B)}})(e,a,u,f,g):d.ct(u)?(function(v,T,E,D,z){const B=E.paint.get("background-color"),k=E.paint.get("background-opacity");if(k===0)return;const{isRenderingToTexture:V}=z,H=v.context,W=H.gl,Q=v.style.projection,et=v.transform,at=et.tileSize,ct=E.paint.get("background-pattern");if(v.isPatternMissing(ct))return;const nt=!ct&&B.a===1&&k===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==nt)return;const ht=ri.disabled,pt=v.getDepthModeForSublayer(0,nt==="opaque"?Ve.ReadWrite:Ve.ReadOnly),ot=v.colorModeForRenderPass(),bt=v.useProgram(ct?"backgroundPattern":"background"),It=D||Be(et,{tileSize:at,terrain:v.style.map.terrain});ct&&(H.activeTexture.set(W.TEXTURE0),v.imageManager.bind(v.context));const Mt=E.getCrossfadeParameters();for(const Ct of It){const At=et.getProjectionData({overscaledTileID:Ct,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),ie=ct?Hc(k,v,ct,{tileID:Ct,tileSize:at},Mt):Zc(k,B),ne=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ct),qt=Q.getMeshFromTileID(H,Ct.canonical,!1,!0,"raster");bt.draw(H,W.TRIANGLES,pt,ht,ot,$e.backCCW,ie,ne,At,E.id,qt.vertexBuffer,qt.indexBuffer,qt.segments)}})(e,0,u,f,g):d.cu(u)&&(function(v,T,E,D){const{isRenderingGlobe:z}=D,B=v.context,k=E.implementation,V=v.style.projection,H=v.transform,W=H.getProjectionDataForCustomLayer(z),Q={farZ:H.farZ,nearZ:H.nearZ,fov:H.fov*Math.PI/180,modelViewProjectionMatrix:H.modelViewProjectionMatrix,projectionMatrix:H.projectionMatrix,shaderData:{variantName:V.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${V.shaderPreludeCode.vertexSource}`,define:V.shaderDefine},defaultProjectionData:W},et=k.renderingMode?k.renderingMode:"2d";if(v.renderPass==="offscreen"){const at=k.prerender;at&&(v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),at.call(k,B.gl,Q),B.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),B.setStencilMode(ri.disabled);const at=et==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ve.ReadOnly);B.setDepthMode(at),k.render(B.gl,Q),B.setDirty(),v.setBaseState(),B.bindFramebuffer.set(null)}})(e,0,u,g))}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!a||!u}useProgram(e,a,u=!1,f=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,v=this.style.projection,T=u?Er.projectionMercator:v.shaderPreludeCode,E=u?Mn:v.shaderDefine,D=e+(a?a.cacheKey:"")+`/${u?Cn:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[D]||(this.cache[D]=new Qd(this.context,Er[e],a,ju[e],this._showOverdrawInspector,g,T,E,f)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,a;if(this._tileTextures){for(const u in this._tileTextures){const f=this._tileTextures[u];if(f)for(const g of f)g.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const f=this.cache[u];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function Zs(m,e){let a,u=!1,f=null,g=null;const v=()=>{f=null,u&&(m.apply(g,a),f=setTimeout(v,e),u=!1)};return(...T)=>(u=!0,g=this,a=T,f||v(),f)}class Gn{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(u=f)})),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const u=a.join("/");let f=u;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${u}`);let g=window.location.hash.replace(f,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let v=window.location.href.replace(/(#.+)?$/,g);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Zs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),v=Math.round(a.lng*g)/g,T=Math.round(a.lat*g)/g,E=this._map.getBearing(),D=this._map.getPitch();let z="";if(z+=e?`/${v}/${T}/${u}`:`${u}/${T}/${v}`,(E||D)&&(z+="/"+Math.round(10*E)/10),D&&(z+=`/${Math.round(D)}`),this._hashName){const B=this._hashName;let k=!1;const V=window.location.hash.slice(1).split("&").map((H=>{const W=H.split("=")[0];return W===B?(k=!0,`${W}=${z}`):H})).filter((H=>H));return k||V.push(`${B}=${z}`),`#${V.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.V(+e[2],+e[1])}catch{return!1}const a=+e[0],u=+(e[3]||0),f=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&u>=-180&&u<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Hs={linearity:.3,easing:d.cv(0,0,.3,1)},nd=d.e({deceleration:2500,maxSpeed:1400},Hs),lf=d.e({deceleration:20,maxSpeed:1400},Hs),uf=d.e({deceleration:1e3,maxSpeed:360},Hs),Jc=d.e({deceleration:1e3,maxSpeed:90},Hs),Dn=d.e({deceleration:1e3,maxSpeed:360},Hs);class qr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Lt(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=Lt();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,a.roll+=g.rollDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const g=xs(a.pan.mag(),u,d.e({},nd,e||{})),v=a.pan.mult(g.amount/a.pan.mag()),T=this._map.cameraHelper.handlePanInertia(v,this._map.transform);f.center=T.easingCenter,f.offset=T.easingOffset,qn(f,g)}if(a.zoom){const g=xs(a.zoom,u,lf);f.zoom=this._map.transform.zoom+g.amount,qn(f,g)}if(a.bearing){const g=xs(a.bearing,u,uf);f.bearing=this._map.transform.bearing+d.an(g.amount,-179,179),qn(f,g)}if(a.pitch){const g=xs(a.pitch,u,Jc);f.pitch=this._map.transform.pitch+g.amount,qn(f,g)}if(a.roll){const g=xs(a.roll,u,Dn);f.roll=this._map.transform.roll+d.an(g.amount,-179,179),qn(f,g)}if(f.zoom||f.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),d.e(f,{noMoveStart:!0})}}function qn(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function xs(m,e,a){const{maxSpeed:u,linearity:f,deceleration:g}=a,v=d.an(m*f/(e/1e3),-u,u),T=Math.abs(v)/(g*f);return{easing:a.easing,duration:1e3*T,amount:v*(T/2)}}class Ji extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u,f={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const g=_t.mousePos(a.getCanvas(),u),v=a.unproject(g);super(e,d.e({point:g,lngLat:v,originalEvent:u},f)),this._defaultPrevented=!1,this.target=a}}class bs extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){const f=e==="touchend"?u.changedTouches:u.touches,g=_t.touchPos(a.getCanvasContainer(),f),v=g.map((E=>a.unproject(E))),T=g.reduce(((E,D,z,B)=>E.add(D.div(B.length))),new d.P(0,0));super(e,{points:g,point:T,lngLats:v,lngLat:a.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class ya extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class np{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ya(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Ji(e.type,this._map,e))}mouseup(e){this._map.fire(new Ji(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Ji(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ji(e.type,this._map,e))}mouseover(e){this._map.fire(new Ji(e.type,this._map,e))}mouseout(e){this._map.fire(new Ji(e.type,this._map,e))}touchstart(e){return this._firePreventable(new bs(e.type,this._map,e))}touchmove(e){this._map.fire(new bs(e.type,this._map,e))}touchend(e){this._map.fire(new bs(e.type,this._map,e))}touchcancel(e){this._map.fire(new bs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cf{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ji(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ji(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ku{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class rd{constructor(e,a){this._map=e,this._tr=new Ku(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(_t.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=u,this._box||(this._box=_t.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(f.x,u.x),v=Math.max(f.x,u.x),T=Math.min(f.y,u.y),E=Math.max(f.y,u.y);_t.setTransform(this._box,`translate(${g}px,${T}px)`),this._box.style.width=v-g+"px",this._box.style.height=E-T+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const u=this._startPos,f=a;if(this.reset(),_t.suppressClick(),u.x!==f.x||u.y!==f.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_t.remove(this._box),this._box=null),_t.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new d.l(e,{originalEvent:a}))}}function ws(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const a={};for(let u=0;u<m.length;u++)a[m[u].identifier]=e[u];return a}class dl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=(function(f){const g=new d.P(0,0);for(const v of f)g._add(v);return g.div(f.length)})(a),this.touches=ws(u,a)))}touchmove(e,a,u){if(this.aborted||!this.centroid)return;const f=ws(u,a);for(const g in this.touches){const v=f[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,a,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Zr{constructor(e){this.singleTap=new dl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,u){this.singleTap.touchstart(e,a,u)}touchmove(e,a,u){this.singleTap.touchmove(e,a,u)}touchend(e,a,u){const f=this.singleTap.touchend(e,a,u);if(f){const g=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(g&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class de{constructor(e){this._tr=new Ku(e),this._zoomIn=new Zr({numTouches:1,numTaps:2}),this._zoomOut=new Zr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,u){this._zoomIn.touchstart(e,a,u),this._zoomOut.touchstart(e,a,u)}touchmove(e,a,u){this._zoomIn.touchmove(e,a,u),this._zoomOut.touchmove(e,a,u)}touchend(e,a,u){const f=this._zoomIn.touchend(e,a,u),g=this._zoomOut.touchend(e,a,u),v=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(f)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(u,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&_t.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qu=0,Ju=2,Co={[Qu]:1,[Ju]:2};class Ts{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=_t.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,u){const f=Co[u];return a.buttons===void 0||(a.buttons&f)!==f})(e,this._eventButton)}isValidEndEvent(e){return _t.mouseButton(e)===this._eventButton}}class th{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class fl{constructor(e=new Ts({checkCorrectEvent:()=>!0}),a=new th){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,u){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const va=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class ad{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,u){return this._calculateTransform(e,a,u)}touchmove(e,a,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,a,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,u){this._calculateTransform(e,a,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,u){u.length>0&&(this._active=!0);const f=ws(u,a),g=new d.P(0,0),v=new d.P(0,0);let T=0;for(const D in f){const z=f[D],B=this._touches[D];B&&(g._add(z),v._add(z.sub(B)),T++,f[D]=z)}if(this._touches=f,this._shouldBePrevented(T)||!v.mag())return;const E=v.div(T);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(T),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,u){if(!this._firstTwoTouches)return;e.preventDefault();const[f,g]=this._firstTwoTouches,v=$s(u,a,f),T=$s(u,a,g);if(!v||!T)return;const E=this._aroundCenter?null:v.add(T).div(2);return this._move([v,T],E,e)}touchend(e,a,u){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,v=$s(u,a,f),T=$s(u,a,g);v&&T||(this._active&&_t.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function $s(m,e,a){for(let u=0;u<m.length;u++)if(m[u].identifier===a)return e[u]}function pl(m,e){return Math.log(m/e)/Math.LN2}class tc extends nu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(pl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pl(this._distance,u),pinchAround:a}}}function ru(m,e){return 180*m.angleWith(e)/Math.PI}class au extends nu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,u){const f=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ru(this._vector,f),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,u=ru(e,this._startVector);return Math.abs(u)<a}}function eh(m){return Math.abs(m.y)>Math.abs(m.x)}class Xs extends nu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,u){super.touchstart(e,a,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,eh(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,u){if(this._valid!==void 0)return this._valid;const f=e.mag()>=2,g=a.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=e.y>0==a.y>0;return eh(e)&&eh(a)&&v}}const hf={panStep:100,bearingStep:15,pitchStep:10};class Ys{constructor(e){this._tr=new Ku(e);const a=hf;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,u=0,f=0,g=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,f=0),{cameraAnimation:T=>{const E=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Ss,zoom:a?Math.round(E.zoom)+a*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+u*this._bearingStep,pitch:E.pitch+f*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ss(m){return m*(2-m)}const Si=4.000244140625,Ao=1/450;class xa{constructor(e,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Ku(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ao}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Lt(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%Si==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=_t.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(d.V.convert(u.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const T=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Si?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&E!==0&&(E=1/E);const D=typeof this._targetZoom!="number"?e.scale:d.aq(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),d.at(D*E)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,f=this._easing;let g,v=!1;if(this._type==="wheel"&&u&&f){const T=Lt()-this._lastWheelEventTime,E=Math.min((T+5)/200,1),D=f(E);g=d.G.number(u,a,D),E<1?this._frameId||(this._frameId=!0):v=!0}else g=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=d.cx;if(this._prevEase){const u=this._prevEase,f=(Lt()-u.start)/u.duration,g=u.easing(f+.01)-u.easing(f),v=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-v*v);a=d.cv(v,T,.25,1)}return this._prevEase={start:Lt(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ws{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ec{constructor(e){this._tr=new Ku(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ih{constructor(){this._tap=new Zr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,u){if(!this._swipePoint)if(this._tapTime){const f=a[0],g=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(f)<30;g&&v?u.length>0&&(this._swipePoint=f,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,a,u)}touchmove(e,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const f=a[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,a,u)}touchend(e,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const f=this._tap.touchend(e,a,u);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ml{constructor(e,a,u){this._el=e,this._mousePan=a,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gl{constructor(e,a,u,f){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=u,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class sd{constructor(e,a,u,f){this._el=e,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ba{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=_t.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=u,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(_t.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const wa=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class ye extends d.l{}function Ae(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class _l{constructor(e,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,g)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=f.type==="renderFrame"?void 0:f,T={needsRenderFrame:!1},E={},D={};for(const{handlerName:k,handler:V,allowed:H}of this._handlers){if(!V.isEnabled())continue;let W;if(this._blockedByActive(D,H,k))V.reset();else if(V[g||f.type]){if(d.cy(f,g||f.type)){const Q=_t.mousePos(this._map.getCanvas(),f);W=V[g||f.type](f,Q)}else if(d.cz(f,g||f.type)){const Q=this._getMapTouches(f.touches),et=_t.touchPos(this._map.getCanvas(),Q);W=V[g||f.type](f,et,Q)}else d.cA(g||f.type)||(W=V[g||f.type](f));this.mergeHandlerResult(T,E,W,k,v),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||V.isActive())&&(D[k]=V)}const z={};for(const k in this._previousActiveHandlers)D[k]||(z[k]=v);this._previousActiveHandlers=D,(Object.keys(z).length||Ae(T))&&(this._changes.push([T,E,z]),this._triggerRenderFrame()),(Object.keys(D).length||Ae(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=T;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qr(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,v]of this._listeners)_t.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,a,u]of this._listeners)_t.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new np(a,e));const f=a.boxZoom=new rd(a,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();const g=a.cooperativeGestures=new ba(a,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const v=new de(a),T=new ec(a);a.doubleClickZoom=new Ws(T,v),this._add("tapZoom",v),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const E=new ih;this._add("tapDragZoom",E);const D=a.touchPitch=new Xs(a);this._add("touchPitch",D),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const z=()=>a.project(a.getCenter()),B=(function({enable:nt,clickTolerance:ht,aroundCenter:pt=!0,minPixelCenterThreshold:ot=100,rotateDegreesPerPixelMoved:bt=.8},It){const Mt=new Ts({checkCorrectEvent:Ct=>_t.mouseButton(Ct)===0&&Ct.ctrlKey||_t.mouseButton(Ct)===2&&!Ct.ctrlKey});return new Va({clickTolerance:ht,move:(Ct,At)=>{const ie=It();if(pt&&Math.abs(ie.y-Ct.y)>ot)return{bearingDelta:d.cw(new d.P(Ct.x,At.y),At,ie)};let ne=(At.x-Ct.x)*bt;return pt&&At.y<ie.y&&(ne=-ne),{bearingDelta:ne}},moveStateManager:Mt,enable:nt,assignEvents:va})})(e,z),k=(function({enable:nt,clickTolerance:ht,pitchDegreesPerPixelMoved:pt=-.5}){const ot=new Ts({checkCorrectEvent:bt=>_t.mouseButton(bt)===0&&bt.ctrlKey||_t.mouseButton(bt)===2});return new Va({clickTolerance:ht,move:(bt,It)=>({pitchDelta:(It.y-bt.y)*pt}),moveStateManager:ot,enable:nt,assignEvents:va})})(e),V=(function({enable:nt,clickTolerance:ht,rollDegreesPerPixelMoved:pt=.3},ot){const bt=new Ts({checkCorrectEvent:It=>_t.mouseButton(It)===2&&It.ctrlKey});return new Va({clickTolerance:ht,move:(It,Mt)=>{const Ct=ot();let At=(Mt.x-It.x)*pt;return Mt.y<Ct.y&&(At=-At),{rollDelta:At}},moveStateManager:bt,enable:nt,assignEvents:va})})(e,z);a.dragRotate=new gl(e,B,k,V),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",k,["mouseRotate","mouseRoll"]),this._add("mouseRoll",V,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const H=(function({enable:nt,clickTolerance:ht}){const pt=new Ts({checkCorrectEvent:ot=>_t.mouseButton(ot)===0&&!ot.ctrlKey});return new Va({clickTolerance:ht,move:(ot,bt)=>({around:bt,panDelta:bt.sub(ot)}),activateOnStart:!0,moveStateManager:pt,enable:nt,assignEvents:va})})(e),W=new ad(e,a);a.dragPan=new ml(u,H,W),this._add("mousePan",H),this._add("touchPan",W,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const Q=new au,et=new tc;a.touchZoomRotate=new sd(u,et,Q,E),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new cf(a));const at=a.scrollZoom=new xa(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",at,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const ct=a.keyboard=new Ys(a);this._add("keyboard",ct),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,u){this._handlers.push({handlerName:e,handler:a,allowed:u}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,u){for(const f in e)if(f!==u&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const u of e)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(e,a,u,f,g){if(!u)return;d.e(e,u);const v={handlerName:f,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(a.zoom=v),u.panDelta!==void 0&&(a.drag=v),u.rollDelta!==void 0&&(a.roll=v),u.pitchDelta!==void 0&&(a.pitch=v),u.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const e={},a={},u={};for(const[f,g,v]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(e.rollDelta=(e.rollDelta||0)+f.rollDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),d.e(a,g),d.e(u,v);this._updateMapTransform(e,a,u),this._changes=[]}_updateMapTransform(e,a,u){const f=this._map,g=f._getTransformForUpdate(),v=f.terrain;if(!(Ae(e)||v&&this._terrainMovement))return this._fireEvents(a,u,!0);f._stop(!0);let{panDelta:T,zoomDelta:E,bearingDelta:D,pitchDelta:z,rollDelta:B,around:k,pinchAround:V}=e;V!==void 0&&(k=V),k=k||f.transform.centerPoint,v&&!g.isPointOnMapSurface(k)&&(k=g.centerPoint);const H={panDelta:T,zoomDelta:E,rollDelta:B,pitchDelta:z,bearingDelta:D,around:k};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(k)&&(k=g.centerPoint);const W=k.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(T?k.sub(T):k);this._handleMapControls({terrain:v,tr:g,deltasForHelper:H,preZoomAroundLoc:W,combinedEventsInProgress:a,panDelta:T}),f._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,u,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:u,preZoomAroundLoc:f,combinedEventsInProgress:g,panDelta:v}){const T=this._map.cameraHelper;if(T.handleMapControlsRollPitchBearingZoom(u,a),e)return T.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void T.handleMapControlsPan(u,a,f)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&v?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(v))):T.handleMapControlsPan(u,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void T.handleMapControlsPan(u,a,f));T.handleMapControlsPan(u,a,f)}_fireEvents(e,a,u){const f=wa(this._eventsInProgress),g=wa(e),v={};for(const B in e){const{originalEvent:k}=e[B];this._eventsInProgress[B]||(v[`${B}start`]=k),this._eventsInProgress[B]=e[B]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const B in v)this._fireEvent(B,v[B]);g&&this._fireEvent("move",g.originalEvent);for(const B in e){const{originalEvent:k}=e[B];this._fireEvent(B,k)}const T={};let E;for(const B in this._eventsInProgress){const{handlerName:k,originalEvent:V}=this._eventsInProgress[B];this._handlersById[k].isActive()||(delete this._eventsInProgress[B],E=a[k]||V,T[`${B}end`]=E)}for(const B in T)this._fireEvent(B,T[B]);const D=wa(this._eventsInProgress),z=(f||g)&&!D;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(u&&z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!B||!B.essential&&Gt.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:E})),k(this._map.getBearing())&&this._map.resetNorth()):(k(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new d.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new ye("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class nh extends d.E{constructor(e,a,u){super(),this._renderFrameCallback=()=>{const f=Math.min((Lt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new d.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},a),u)}panTo(e,a,u){return this.easeTo(d.e({center:e},a),u)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,u){return this.easeTo(d.e({zoom:e},a),u)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)).fire(new d.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,u){return this.easeTo(d.e({bearing:e},a),u)}resetNorth(e,a){return this.rotateTo(0,d.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=an.convert(e).adjustAntiMeridian();const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,a)}_cameraForBoxAndBearing(e,a,u,f){const g={top:0,bottom:0,right:0,left:0};if(typeof(f=d.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const D=f.padding;f.padding={top:D,bottom:D,right:D,left:D}}const v=d.e(g,f.padding);f.padding=v;const T=this.transform,E=new an(e,a);return this.cameraHelper.cameraForBoxAndBearing(f,v,E,u,T)}fitBounds(e,a,u){return this._fitInternal(this.cameraForBounds(e,a),a,u)}fitScreenCoordinates(e,a,u,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(a)),u,f),f,g)}_fitInternal(e,a,u){return e?(delete(a=d.e(e,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(e,a){this.stop();const u=this._getTransformForUpdate();let f=!1,g=!1,v=!1;const T=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const E=u.zoom!==T;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(g=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(v=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)),E&&this.fire(new d.l("zoomstart",a)).fire(new d.l("zoom",a)).fire(new d.l("zoomend",a)),f&&this.fire(new d.l("rotatestart",a)).fire(new d.l("rotate",a)).fire(new d.l("rotateend",a)),g&&this.fire(new d.l("pitchstart",a)).fire(new d.l("pitch",a)).fire(new d.l("pitchend",a)),v&&this.fire(new d.l("rollstart",a)).fire(new d.l("roll",a)).fire(new d.l("rollend",a)),this.fire(new d.l("moveend",a))}calculateCameraOptionsFromTo(e,a,u,f=0){const g=d.aa.fromLngLat(e,a),v=d.aa.fromLngLat(u,f),T=v.x-g.x,E=v.y-g.y,D=v.z-g.z,z=Math.hypot(T,E,D);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(T,E),k=d.at(this.transform.cameraToCenterDistance/z/this.transform.tileSize),V=180*Math.atan2(T,-E)/Math.PI;let H=180*Math.acos(B/z)/Math.PI;return H=D<0?90-H:90+H,{center:v.toLngLat(),elevation:f,zoom:k,pitch:H,bearing:V}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,u,f,g){const v=this.transform.calculateCenterFromCameraLngLatAlt(e,a,u,f);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:u,pitch:f,roll:g}}easeTo(e,a){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.cx},e)).animate===!1||!e.essential&&Gt.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),f=this.getBearing(),g=u.pitch,v=u.roll,T="bearing"in e?this._normalizeBearing(e.bearing,f):f,E="pitch"in e?+e.pitch:g,D="roll"in e?this._normalizeBearing(e.roll,v):v,z="padding"in e?e.padding:u.padding,B=d.P.convert(e.offset);let k,V;e.around&&(k=d.V.convert(e.around),V=u.locationToScreenPoint(k));const H={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(u,{bearing:T,pitch:E,roll:D,padding:z,around:k,aroundPoint:V,offsetAsPoint:B,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||f!==T,this._pitching=this._pitching||E!==g,this._rolling=this._rolling||D!==v,this._padding=!u.isPaddingEqual(z),this._zooming=this._zooming||W.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,H),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease((Q=>{W.easeFunc(Q),this.terrain&&!e.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(Q=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,Q)}),e),this}_prepareEase(e,a,u={}){this._moving=!0,a||u.moving||this.fire(new d.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(a-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(d.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const a=e.getCameraLngLat(),u=e.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(u<f){const g=this.calculateCameraOptionsFromTo(a,f,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const u=e.clone();for(const f of a){const g=u.clone(),{center:v,zoom:T,roll:E,pitch:D,bearing:z,elevation:B}=f(g);v&&g.setCenter(v),B!==void 0&&g.setElevation(B),T!==void 0&&g.setZoom(T),E!==void 0&&g.setRoll(E),D!==void 0&&g.setPitch(D),z!==void 0&&g.setBearing(z),u.apply(g)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,f=this._rotating,g=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new d.l("zoomend",e)),f&&this.fire(new d.l("rotateend",e)),g&&this.fire(new d.l("pitchend",e)),v&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,a){if(!e.essential&&Gt.prefersReducedMotion){const At=d.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(At,a)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cx},e);const u=this._getTransformForUpdate(),f=u.bearing,g=u.pitch,v=u.roll,T=u.padding,E="bearing"in e?this._normalizeBearing(e.bearing,f):f,D="pitch"in e?+e.pitch:g,z="roll"in e?this._normalizeBearing(e.roll,v):v,B="padding"in e?e.padding:u.padding,k=d.P.convert(e.offset);let V=u.centerPoint.add(k);const H=u.screenPointToLocation(V),W=this.cameraHelper.handleFlyTo(u,{bearing:E,pitch:D,roll:z,padding:B,locationAtOffset:H,offsetAsPoint:k,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Q=e.curve;const et=Math.max(u.width,u.height),at=et/W.scaleOfZoom,ct=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(Q=Math.sqrt(et/W.scaleOfMinZoom/ct*2));const nt=Q*Q;function ht(At){const ie=(at*at-et*et+(At?-1:1)*nt*nt*ct*ct)/(2*(At?at:et)*nt*ct);return Math.log(Math.sqrt(ie*ie+1)-ie)}function pt(At){return(Math.exp(At)-Math.exp(-At))/2}function ot(At){return(Math.exp(At)+Math.exp(-At))/2}const bt=ht(!1);let It=function(At){return ot(bt)/ot(bt+Q*At)},Mt=function(At){return et*((ot(bt)*(pt(ie=bt+Q*At)/ot(ie))-pt(bt))/nt)/ct;var ie},Ct=(ht(!0)-bt)/Q;if(Math.abs(ct)<2e-6||!isFinite(Ct)){if(Math.abs(et-at)<1e-6)return this.easeTo(e,a);const At=at<et?-1:1;Ct=Math.abs(Math.log(at/et))/Q,Mt=()=>0,It=ie=>Math.exp(At*Q*ie)}return e.duration="duration"in e?+e.duration:1e3*Ct/("screenSpeed"in e?+e.screenSpeed/Q:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==E,this._pitching=D!==g,this._rolling=z!==v,this._padding=!u.isPaddingEqual(B),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease((At=>{const ie=At*Ct,ne=1/It(ie),qt=Mt(ie);this._rotating&&u.setBearing(d.G.number(f,E,At)),this._pitching&&u.setPitch(d.G.number(g,D,At)),this._rolling&&u.setRoll(d.G.number(v,z,At)),this._padding&&(u.interpolatePadding(T,B,At),V=u.centerPoint.add(k)),W.easeFunc(At,ne,qt,V),this.terrain&&!e.freezeElevation&&this._updateElevation(At),this._applyUpdatedTransform(u),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,a,u){u.animate===!1||u.duration===0?(e(1),a()):(this._easeStart=Lt(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=d.W(e,-180,180);const u=Math.abs(e-a);return Math.abs(e-360-a)<u&&(e-=360),Math.abs(e+360-a)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.V.convert(e),this.transform.tileZoom):null}}const ur={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Zi{constructor(e=ur){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=_t.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_t.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_t.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_t.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const u=this._map._getUIString(`AttributionControl.${a}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const g=a[f];if(g.used||g.usedForTerrain){const v=g.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((f=>String(f).trim())),e.sort(((f,g)=>f.length-g.length)),e=e.filter(((f,g)=>{for(let v=g+1;v<e.length;v++)if(e[v].indexOf(f)>=0)return!1;return!0}));const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=_t.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Zn{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=_t.create("div","maplibregl-ctrl");const a=_t.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_t.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class rh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const f of u)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var df=d.aT([{name:"a_pos3d",type:"Int16",components:3}]);class Do extends d.E{constructor(e){super(),this._lastTilesetChange=Lt(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,a){this.tileManager.update(e,a),this._renderableTilesKeys=[];const u={};for(const f of Be(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),d.c6(f.terrainRttPosMatrix32f,0,d.a4,d.a4,0,0,1),this._tiles[f.key]=new j(f,this.tileSize),this._lastTilesetChange=Lt());for(const f in this._tiles)u[f]||delete this._tiles[f]}freeRtt(e){for(const a in this._tiles){const u=this._tiles[a];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const a={};for(const u of this._renderableTilesKeys){const f=this._tiles[u].tileID,g=e.clone(),v=d.bj();if(f.canonical.equals(e.canonical))d.c6(v,0,d.a4,d.a4,0,0,1);else if(f.canonical.isChildOf(e.canonical)){const T=f.canonical.z-e.canonical.z,E=f.canonical.x-(f.canonical.x>>T<<T),D=f.canonical.y-(f.canonical.y>>T<<T),z=d.a4>>T;d.c6(v,0,z,z,0,0,1),d.O(v,v,[-E*z,-D*z,0])}else{if(!e.canonical.isChildOf(f.canonical))continue;{const T=e.canonical.z-f.canonical.z,E=e.canonical.x-(e.canonical.x>>T<<T),D=e.canonical.y-(e.canonical.y>>T<<T),z=d.a4>>T;d.c6(v,0,d.a4,d.a4,0,0,1),d.O(v,v,[E*z,D*z,0]),d.Q(v,v,[1/2**T,1/2**T,0])}}g.terrainRttPosMatrix32f=new Float32Array(v),a[u]=g}return a}_getTerrainCoordsForTileRanges(e,a){const u={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(!this._isWithinTileRanges(g,a))continue;const v=e.clone(),T=d.bj();if(g.canonical.z===e.canonical.z){const E=e.canonical.x-g.canonical.x,D=e.canonical.y-g.canonical.y;d.c6(T,0,d.a4,d.a4,0,0,1),d.O(T,T,[E*d.a4,D*d.a4,0])}else if(g.canonical.z>e.canonical.z){const E=g.canonical.z-e.canonical.z,D=g.canonical.x-(g.canonical.x>>E<<E),z=g.canonical.y-(g.canonical.y>>E<<E),B=e.canonical.x-(g.canonical.x>>E),k=e.canonical.y-(g.canonical.y>>E),V=d.a4>>E;d.c6(T,0,V,V,0,0,1),d.O(T,T,[-D*V+B*d.a4,-z*V+k*d.a4,0])}else{const E=e.canonical.z-g.canonical.z,D=e.canonical.x-(e.canonical.x>>E<<E),z=e.canonical.y-(e.canonical.y>>E<<E),B=(e.canonical.x>>E)-g.canonical.x,k=(e.canonical.y>>E)-g.canonical.y,V=d.a4<<E;d.c6(T,0,V,V,0,0,1),d.O(T,T,[D*d.a4+B*V,z*d.a4+k*V,0])}v.terrainRttPosMatrix32f=new Float32Array(T),u[f]=v}return u}getSourceTile(e,a){const u=this.tileManager._source;let f=e.overscaledZ-this.deltaZoom;if(f>u.maxzoom&&(f=u.maxzoom),f<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let g=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&a)for(;f>=u.minzoom&&(!g||!g.dem);)g=this.tileManager.getTileByID(e.scaledTo(f--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class ia{constructor(e,a,u){this._meshCache={},this.painter=e,this.tileManager=new Do(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,u,f=d.a4){var g;if(!(a>=0&&a<f&&u>=0&&u<f))return 0;const v=this.getTerrainData(e),T=(g=v.tile)===null||g===void 0?void 0:g.dem;if(!T)return 0;const E=d.cB([],[a/f*d.a4,u/f*d.a4],v.u_terrain_matrix),D=[E[0]*T.dim,E[1]*T.dim],z=Math.floor(D[0]),B=Math.floor(D[1]),k=D[0]-z,V=D[1]-B;return T.get(z,B)*(1-k)*(1-V)+T.get(z+1,B)*k*(1-V)+T.get(z,B+1)*(1-k)*V+T.get(z+1,B+1)*k*V}getElevationForLngLatZoom(e,a){if(!d.cC(a,e.wrap()))return 0;const{tileID:u,mercatorX:f,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(u,f%d.a4,g%d.a4,d.a4)}getElevation(e,a,u,f=d.a4){return this.getDEMElevation(e,a,u,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const f=this.painter.context,g=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(f,new d.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.ar([])}const a=this.tileManager.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new d.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const f=this.tileManager.getSource().maxzoom;let g=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?g=e.canonical.z-f:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>g<<g),T=e.canonical.y-(e.canonical.y>>g<<g),E=d.cD(new Float64Array(16),[1/(d.a4<<g),1/(d.a4<<g),0]);d.O(E,E,[v*d.a4,T*d.a4,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,u=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(a.context,{width:u,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(a.context,{width:u,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let T=0;T<this._coordsTextureSize;T++,v+=4)a[v+0]=255&T,a[v+1]=255&g,a[v+2]=T>>8<<4|g>>8,a[v+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new d.T(e,u,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,f=u.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(g,T-v-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const E=a[0]+(a[2]>>4<<8),D=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],B=z&&this.tileManager.getTileByID(z);if(!B)return null;const k=this._coordsTextureSize,V=(1<<B.tileID.canonical.z)*k;return new d.aa((B.tileID.canonical.x*k+E)/V+B.tileID.wrap,(B.tileID.canonical.y*k+D)/V,this.getElevation(B.tileID,E,D,k))}depthAtPoint(e){const a=new Uint8Array(4),u=this.painter.context,f=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;const u=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=u&&e.canonical.y===0,g=u&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${f?"n":""}_${g?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const T=this.painter.context,E=new d.cE,D=new d.aX,z=this.meshSize,B=d.a4/z,k=z*z;for(let ot=0;ot<=z;ot++)for(let bt=0;bt<=z;bt++)E.emplaceBack(bt*B,ot*B,0);for(let ot=0;ot<k;ot+=z+1)for(let bt=0;bt<z;bt++)D.emplaceBack(bt+ot,z+bt+ot+1,z+bt+ot+2),D.emplaceBack(bt+ot,z+bt+ot+2,bt+ot+1);const V=E.length,H=V+(z+1),W=(z+1)*z,Q=f?d.bq:0,et=f?0:1,at=g?d.br:d.a4,ct=g?0:1;for(let ot=0;ot<=z;ot++)E.emplaceBack(ot*B,Q,et);for(let ot=0;ot<=z;ot++)E.emplaceBack(ot*B,at,ct);for(let ot=0;ot<z;ot++)D.emplaceBack(W+ot,H+ot,H+ot+1),D.emplaceBack(W+ot,H+ot+1,W+ot+1),D.emplaceBack(0+ot,V+ot+1,V+ot),D.emplaceBack(0+ot,0+ot+1,V+ot+1);const nt=E.length,ht=nt+2*(z+1);for(const ot of[0,1])for(let bt=0;bt<=z;bt++)for(const It of[0,1])E.emplaceBack(ot*d.a4,bt*B,It);for(let ot=0;ot<2*z;ot+=2)D.emplaceBack(nt+ot,nt+ot+1,nt+ot+3),D.emplaceBack(nt+ot,nt+ot+3,nt+ot+2),D.emplaceBack(ht+ot,ht+ot+3,ht+ot+1),D.emplaceBack(ht+ot,ht+ot+2,ht+ot+3);const pt=new ls(T.createVertexBuffer(E,df.members),T.createIndexBuffer(D),d.aW.simpleSegment(0,0,E.length,D.length));return this._meshCache[v]=pt,pt}getMeshFrameDelta(e){return 2*Math.PI*d.bD/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var u;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(u=this.getMinMaxElevation(f).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,a){const u=d.aa.fromLngLat(e.wrap()),f=(1<<a)*d.a4,g=u.x*f,v=u.y*f,T=Math.floor(g/d.a4),E=Math.floor(v/d.a4);return{tileID:new d.a1(a,0,a,T,E),mercatorX:g,mercatorY:v}}}class tn{constructor(e,a,u){this._context=e,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:e,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const xi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ai{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new tn(e.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((u=>!e._layers[u].isHidden(a))),this._coordsAscending={};for(const u in e.tileManagers){this._coordsAscending[u]={};const f=e.tileManagers[u].getVisibleCoordinates(),g=e.tileManagers[u].getSource(),v=g instanceof kr?g.terrainTileRanges:null;for(const T of f){const E=this.terrain.tileManager.getTerrainCoords(T,v);for(const D in E)this._coordsAscending[u][D]||(this._coordsAscending[u][D]=[]),this._coordsAscending[u][D].push(E[D])}}this._coordsAscendingStr={};for(const u of e._order){const f=e._layers[u],g=f.source;if(xi[f.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const v in this._coordsAscending[g])this._coordsAscendingStr[g][v]=this._coordsAscending[g][v].map((T=>T.key)).sort().join()}}for(const u of this._renderableTiles)for(const f in this._coordsAscendingStr){const g=this._coordsAscendingStr[f][u.tileID.key];g&&g!==u.rttCoords[f]&&(u.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=e.type,g=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(xi[f]&&(this._prevType&&xi[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(xi[this._prevType]||xi[f]&&v){this._prevType=f;const T=this._stacks.length-1,E=this._stacks[T]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(vs(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[T]){const B=this.pool.getObjectForId(D.rtt[T].id);if(B.stamp===D.rtt[T].stamp){this.pool.useObject(B);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[T]={id:z.id,stamp:z.stamp},g.context.bindFramebuffer.set(z.fbo.framebuffer),g.context.clear({color:d.bo.transparent,stencil:0}),g.currentStencilSource=void 0;for(let B=0;B<E.length;B++){const k=g.style._layers[E[B]],V=k.source?this._coordsAscending[k.source][D.tileID.key]:[D.tileID];g.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),g._renderTileClippingMasks(k,V,!0),g.renderLayer(g,g.style.tileManagers[k.source],k,V,u),k.source&&(D.rttCoords[k.source]=this._coordsAscendingStr[k.source][D.tileID.key])}}return vs(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),xi[f]}return!1}}const Ze={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},bi=dt,sn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ur,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},su={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Io{constructor(e,a,u=!1){this.mousedown=g=>{this.startMove(g,_t.mousePos(this.element,g)),_t.addEventListener(window,"mousemove",this.mousemove),_t.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,_t.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_t.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),_t.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=_t.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new fl;this._rotatePitchHandler=new Va({clickTolerance:3,move:(g,v)=>{const T=a.getBoundingClientRect(),E=new d.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:d.cw(new d.P(g.x,v.y),v,E),pitchDelta:u?-.5*(v.y-g.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=e,_t.addEventListener(a,"mousedown",this.mousedown),_t.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),_t.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),_t.disableDrag()}move(e,a){const u=this.map,{bearingDelta:f,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,a)||{};f&&u.setBearing(u.getBearing()+f),g&&u.setPitch(u.getPitch()+g)}off(){const e=this.element;_t.removeEventListener(e,"mousedown",this.mousedown),_t.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),_t.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.removeEventListener(window,"touchend",this.touchend),_t.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){_t.enableDrag(),_t.removeEventListener(window,"mousemove",this.mousemove),_t.removeEventListener(window,"mouseup",this.mouseup),_t.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.removeEventListener(window,"touchend",this.touchend)}}let Ir;function Ks(m,e,a,u=!1){if(u||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const f=new d.V(m.lng,m.lat);if(m=new d.V(m.lng,m.lat),e){const g=new d.V(m.lng-360,m.lat),v=new d.V(m.lng+360,m.lat),T=a.locationToScreenPoint(m).distSqr(e);a.locationToScreenPoint(g).distSqr(e)<T?m=g:a.locationToScreenPoint(v).distSqr(e)<T&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const g=a.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=a.width&&g.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:f}const Qs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Js(m,e,a){const u=m.classList;for(const f in Qs)u.remove(`maplibregl-${a}-anchor-${f}`);u.add(`maplibregl-${a}-anchor-${e}`)}class ic extends d.E{constructor(e){if(super(),this._onKeyPress=a=>{const u=a.code,f=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,f=this._element;this._popup&&(u===f||f.contains(u))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Ks(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),_t.setTransform(this._element,`${Qs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${f}`),Gt.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=_t.create("div");const a=_t.createNS("http://www.w3.org/2000/svg","svg"),u=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${u}`);const g=_t.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const v=_t.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const T=_t.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const et of E){const at=_t.createNS("http://www.w3.org/2000/svg","ellipse");at.setAttributeNS(null,"opacity","0.04"),at.setAttributeNS(null,"cx","10.5"),at.setAttributeNS(null,"cy","5.80029008"),at.setAttributeNS(null,"rx",et.rx),at.setAttributeNS(null,"ry",et.ry),T.appendChild(at)}const D=_t.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const z=_t.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(z);const B=_t.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const k=_t.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(k);const V=_t.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const H=_t.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=_t.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const Q=_t.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),H.appendChild(W),H.appendChild(Q),v.appendChild(T),v.appendChild(D),v.appendChild(B),v.appendChild(V),v.appendChild(H),a.appendChild(v),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Js(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_t.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,u;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!f||g){const V=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==V&&(this._element.style.opacity=V))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,T=v.terrain.depthAtPoint(this._pos),E=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,E)-T<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*D,B=v.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),k=v.transform.lngLatToCameraDepth(this._lngLat,E+z)-B>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&k&&this._popup.remove(),this._element.style.opacity=k?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const on={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zo=0,to=!1;const ah={maxWidth:100,unit:"metric"};function nc(m,e,a){const u=a&&a.maxWidth||100,f=m._container.clientHeight/2,g=m._container.clientWidth/2,v=m.unproject([g-u/2,f]),T=m.unproject([g+u/2,f]),E=Math.round(m.project(T).x-m.project(v).x),D=Math.min(u,E,m._container.clientWidth),z=v.distanceTo(T);if(a&&a.unit==="imperial"){const B=3.2808*z;B>5280?yl(e,D,B/5280,m._getUIString("ScaleControl.Miles")):yl(e,D,B,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?yl(e,D,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?yl(e,D,z/1e3,m._getUIString("ScaleControl.Kilometers")):yl(e,D,z,m._getUIString("ScaleControl.Meters"))}function yl(m,e,a,u){const f=(function(g){const v=Math.pow(10,`${Math.floor(g)}`.length-1);let T=g/v;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:(function(E){const D=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*D)/D})(T),v*T})(a);m.style.width=e*(f/a)+"px",m.innerHTML=`${f}&nbsp;${u}`}const ou={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lu(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return lu(new d.P(0,0))}const er=dt;R.AJAXError=d.cI,R.Event=d.l,R.Evented=d.E,R.LngLat=d.V,R.MercatorCoordinate=d.aa,R.Point=d.P,R.addProtocol=d.cJ,R.config=d.a,R.removeProtocol=d.cK,R.AttributionControl=Zi,R.BoxZoomHandler=rd,R.CanvasSource=jl,R.CooperativeGesturesHandler=ba,R.DoubleClickZoomHandler=Ws,R.DragPanHandler=ml,R.DragRotateHandler=gl,R.EdgeInsets=Ii,R.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_t.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=_t.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_t.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},R.GeoJSONSource=Vn,R.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new d.V(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,f=this._map.getBearing(),g=d.e({bearing:f},this.options.fitBoundsOptions),v=an.fromLngLat(a,u);this._map.fitBounds(v,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new d.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&to)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=_t.create("button","maplibregl-ctrl-geolocate",this._container),_t.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_t.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ic({element:this._dotElement}),this._circleElement=_t.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ic({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const u=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},on,m)}onAdd(m){return this._map=m,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(e=!1){if(Ir!==void 0&&!e)return Ir;if(window.navigator.permissions===void 0)return Ir=!!window.navigator.geolocation,Ir;try{Ir=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ir=!!window.navigator.geolocation}return Ir}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_t.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,zo=0,to=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),a=m.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const e=this._map.project(m),a=this._map.unproject([e.x+100,e.y]),u=m.distanceTo(a)/100,f=2*this._accuracy/u;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zo--,to=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zo++,zo>1?(m={maximumAge:6e5,timeout:0},to=!0):(m=this.options.positionOptions,to=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},R.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=_t.create("button","maplibregl-ctrl-globe",this._container),_t.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){_t.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},R.Hash=Gn,R.ImageSource=kr,R.KeyboardHandler=Ys,R.LngLatBounds=an,R.LogoControl=Zn,R.Map=class extends nh{constructor(m){var e,a;d.cF.mark(d.cG.create);const u=Object.assign(Object.assign(Object.assign({},sn),m),{canvasContextAttributes:Object.assign(Object.assign({},sn.canvasContextAttributes),m.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Bi,g=new rr;if(u.minZoom!==void 0&&f.setMinZoom(u.minZoom),u.maxZoom!==void 0&&f.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&f.setMinPitch(u.minPitch),u.maxPitch!==void 0&&f.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&f.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&f.setConstrainOverride(u.transformConstrain),super(f,g,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new rh,this._controls=[],this._mapId=d.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const E of Object.values(this.style._layers))if(E.type==="custom"&&console.warn(`Custom layer with id '${E.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),E._listeners)for(const[D]of Object.entries(E._listeners))console.warn(`Custom layer with id '${E.id}' had event listeners for event '${D}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new d.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ze),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(Gt.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=be.addThrottleControl((()=>this.isMoving())),this._requestManager=new We(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const E=Zs((D=>{this._trackResize&&!this._removed&&(this.resize(D),this.redraw())}),50);this._resizeObserver=new ResizeObserver((D=>{T?E(D):T=!0})),this._resizeObserver.observe(this._container)}this.handlers=new _l(this,u),this._hash=u.hash&&new Gn(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,d.e({},u.fitBoundsOptions,{duration:0}))));const v=typeof u.style=="string"||((a=(e=u.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Zi(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new Zn,u.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const T=d.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}})),this.on("data",(T=>{this._update(T.dataType==="style"),this.fire(new d.l(`${T.dataType}data`,T))})),this.on("dataloading",(T=>{this.fire(new d.l(`${T.dataType}dataloading`,T))})),this.on("dataabort",(T=>{this.fire(new d.l("sourcedataabort",T))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Be(this.transform,m)}calculateCameraOptionsFromTo(m,e,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,a,u)}resize(m,e=!0){const[a,u]=this._containerDimensions(),f=this._getClampedPixelRatio(a,u);if(this._resizeCanvas(a,u,f),this.painter.resize(a,u,f),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const T=this._getClampedPixelRatio(a,u);this._resizeCanvas(a,u,T),this.painter.resize(a,u,T)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),g&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[a,u]=this._containerDimensions();this.transform.resize(a,u,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,u,m)}_getClampedPixelRatio(m,e){const{0:a,1:u}=this._maxCanvasSize,f=this.getPixelRatio(),g=m*f,v=e*f;return Math.min(g>a?a/g:1,v>u?u/v:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(an.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,a){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:g=>{const v=e.filter((E=>this.getLayer(E))),T=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];T.length?u||(u=!0,a.call(this,new Ji(m,this,g.originalEvent,{features:T}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:v=>{const T=e.filter((E=>this.getLayer(E)));(T.length!==0?this.queryRenderedFeatures(v.point,{layers:T}):[]).length?u=!0:u&&(u=!1,a.call(this,new Ji(m,this,v.originalEvent)))},mouseout:v=>{u&&(u=!1,a.call(this,new Ji(m,this,v.originalEvent)))}}}}{const u=f=>{const g=e.filter((T=>this.getLayer(T))),v=g.length!==0?this.queryRenderedFeatures(f.point,{layers:g}):[];v.length&&(f.features=v,a.call(this,f),delete f.features)};return{layers:e,listener:a,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let f=0;f<u.length;f++){const g=u[f];if(g.listener===a&&g.layers.length===e.length&&g.layers.every((v=>e.includes(v)))){for(const v in g.delegates)this.off(v,g.delegates[v]);return void u.splice(f,1)}}}on(m,e,a){if(a===void 0)return super.on(m,e);const u=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,u,a);this._saveDelegatedListener(m,f);for(const g in f.delegates)this.on(g,f.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,u,a)}}}once(m,e,a){if(a===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,u,a);for(const g in f.delegates){const v=f.delegates[g];f.delegates[g]=(...T)=>{this._removeDelegatedListener(m,u,a),v(...T)}}this._saveDelegatedListener(m,f);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(m,e,a){return a===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let a;const u=m instanceof d.P||Array.isArray(m),f=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},f instanceof d.P||typeof f[0]=="number")a=[d.P.convert(f)];else{const g=d.P.convert(f[0]),v=d.P.convert(f[1]);a=[g,new d.P(v.x,g.y),v,new d.P(g.x,v.y),g]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var a,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));const f=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Fu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,f):this.style.loadJSON(m,e,f),this):((u=(a=this.style)===null||a===void 0?void 0:a.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");d.j(a,new AbortController).then((u=>{this._updateDiff(u.data,e)})).catch((u=>{u&&this.fire(new d.k(u))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.tileManagers[m];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.tileManagers[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ia(this.painter,e,m),this.painter.renderToTexture=new Ai(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var u;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=a.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const e in m){const a=m[e]._tiles;for(const u in a){const f=a[u];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,a){if(a){const u=this.getSource(a);if(!u)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);u.calculateTileZoom=Ft(Math.max(1,m),Math.max(1,e))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=Ft(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((u=>new d.ad(u.z,u.x,u.y))))}addImage(m,e,a={}){const{pixelRatio:u=1,sdf:f=!1,stretchX:g,stretchY:v,content:T,textFitWidth:E,textFitHeight:D}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:B,data:k}=e,V=e;return this.style.addImage(m,{data:new d.R({width:z,height:B},new Uint8Array(k)),pixelRatio:u,stretchX:g,stretchY:v,content:T,textFitWidth:E,textFitHeight:D,sdf:f,version:0,userImage:V}),V.onAdd&&V.onAdd(this,m),this}}{const{width:z,height:B,data:k}=Gt.getImageData(e);this.style.addImage(m,{data:new d.R({width:z,height:B},k),pixelRatio:u,stretchX:g,stretchY:v,content:T,textFitWidth:E,textFitHeight:D,sdf:f,version:0})}}updateImage(m,e){const a=this.style.getImage(m);if(!a)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?Gt.getImageData(e):e,{width:f,height:g,data:v}=u;if(f===void 0||g===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||g!==a.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||d.b(e));return a.data.replace(v,T),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return be.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,a){return this.style.setLayerZoomRange(m,e,a),this._update(!0)}setFilter(m,e,a={}){return this.style.setFilter(m,e,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,a,u={}){return this.style.setPaintProperty(m,e,a,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,a,u={}){return this.style.setLayoutProperty(m,e,a,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,a,(u=>{u||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(a=>{a||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=_t.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=_t.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const f=this._controlContainer=_t.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{g[v]=_t.create("div",`maplibregl-ctrl-${v} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Wu(a,this.transform),fe.testSupport(a)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,a,u,f,g;const v=this._idleTriggered?this._fadeDuration:0,T=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,k=Lt();this.style.zoomHistory.update(B,k);const V=new d.H(B,{now:k,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=V.crossFadingFactor();H===1&&H===this._crossFadingFactor||(E=!0,this._crossFadingFactor=H),this.style.update(V)}const D=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==T;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||D)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,D),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cF.mark(d.cG.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cF.mark(d.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),be.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_t.remove(this._canvasContainer),_t.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cF.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Gt.frame(this._frameRequest,(m=>{d.cF.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!d.cH(e)&&!(function(a){return a.message===Ql})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return bi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},R.MapMouseEvent=Ji,R.MapTouchEvent=bs,R.MapWheelEvent=ya,R.Marker=ic,R.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},su,m),this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),_t.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),_t.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=_t.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Io(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_t.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const a=_t.create("button",m,this._container);return a.type="button",a.addEventListener("click",e),a}},R.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&_t.remove(this._content),this._container&&(_t.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=_t.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_t.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ks(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const f=lu(this.options.offset);if(!u){const v=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=a.y+f.bottom.y<T?["top"]:a.y>this._map.transform.height-T?["bottom"]:[],a.x<v/2?E.push("left"):a.x>this._map.transform.width-v/2&&E.push("right"),u=E.length===0?"bottom":E.join("-")}let g=a.add(f[u]);this.options.subpixelPositioning||(g=g.round()),_t.setTransform(this._container,`${Qs[u]} translate(${g.x}px,${g.y}px)`),Js(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(ou),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=m;u=a.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_t.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=_t.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(rc);m&&m.focus()}},R.RasterDEMTileSource=is,R.RasterTileSource=co,R.ScaleControl=class{constructor(m){this._onMove=()=>{nc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,nc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ah),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_t.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},R.ScrollZoomHandler=xa,R.Style=Fu,R.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_t.create("button","maplibregl-ctrl-terrain",this._container),_t.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_t.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},R.TwoFingersTouchPitchHandler=Xs,R.TwoFingersTouchRotateHandler=au,R.TwoFingersTouchZoomHandler=tc,R.TwoFingersTouchZoomRotateHandler=sd,R.VectorTileSource=ma,R.VideoSource=Nl,R.addSourceType=(m,e)=>d._(void 0,void 0,void 0,(function*(){if(Vl(m))throw new Error(`A source type called "${m}" already exists.`);((a,u)=>{rs[a]=u})(m,e)})),R.clearPrewarmedResources=function(){const m=Ke;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(xe),Ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},R.createTileMesh=Ou,R.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},R.getRTLTextPluginStatus=function(){return Tr().getRTLTextPluginStatus()},R.getVersion=function(){return er},R.getWorkerCount=function(){return Ne.workerCount},R.getWorkerUrl=function(){return d.a.WORKER_URL},R.importScriptInWorkers=function(m){return es().broadcast("IS",m)},R.isTimeFrozen=function(){return se.isFrozen()},R.now=Lt,R.prewarm=function(){Xi().acquire(xe)},R.restoreNow=function(){se.restoreNow()},R.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},R.setNow=function(m){se.setNow(m)},R.setRTLTextPlugin=function(m,e){return Tr().setRTLTextPlugin(m,e)},R.setWorkerCount=function(m){Ne.workerCount=m},R.setWorkerUrl=function(m){d.a.WORKER_URL=m}}));var lt=U;return lt}))})(pg)),pg.exports}var t0=Jy();const hm=pm(t0),zs={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},qo={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Nn={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ps={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Le={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Ti={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Ja={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},mm={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Ia={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Wr={ACTIVE:"true",INACTIVE:"false"},ay=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],e0=-90,n_=-85,i0=90,r_=85,n0=-270,r0=270,sy=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:i0,LAT_MIN:e0,LAT_RENDERED_MAX:r_,LAT_RENDERED_MIN:n_,LNG_MAX:r0,LNG_MIN:n0,activeStates:Wr,classes:zs,cursors:Nn,events:Ja,geojsonTypes:Le,interactions:ay,meta:Ia,modes:Ti,sources:qo,types:Ps,updateActions:mm},Symbol.toStringTag,{value:"Module"}));function yg(b){return function(A){const U=A.featureTarget;return!U||!U.properties?!1:U.properties.meta===b}}function oy(b){return!b.originalEvent||!b.originalEvent.shiftKey?!1:b.originalEvent.button===0}function Hd(b){return!b.featureTarget||!b.featureTarget.properties?!1:b.featureTarget.properties.active===Wr.ACTIVE&&b.featureTarget.properties.meta===Ia.FEATURE}function h_(b){return!b.featureTarget||!b.featureTarget.properties?!1:b.featureTarget.properties.active===Wr.INACTIVE&&b.featureTarget.properties.meta===Ia.FEATURE}function vg(b){return b.featureTarget===void 0}function d_(b){return!b.featureTarget||!b.featureTarget.properties?!1:b.featureTarget.properties.meta===Ia.FEATURE}function gm(b){const A=b.featureTarget;return!A||!A.properties?!1:A.properties.meta===Ia.VERTEX}function gg(b){return b.originalEvent?b.originalEvent.shiftKey===!0:!1}function xg(b){return b.key==="Escape"||b.keyCode===27}function bg(b){return b.key==="Enter"||b.keyCode===13}function a_(b){return b.key==="Backspace"||b.keyCode===8}function s_(b){return b.key==="Delete"||b.keyCode===46}function ly(b){return b.key==="1"||b.keyCode===49}function uy(b){return b.key==="2"||b.keyCode===50}function cy(b){return b.key==="3"||b.keyCode===51}function hy(b){const A=b.key||String.fromCharCode(b.keyCode);return A>="0"&&A<="9"}function a0(){return!0}const s0=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Hd,isBackspaceKey:a_,isDeleteKey:s_,isDigit1Key:ly,isDigit2Key:uy,isDigit3Key:cy,isDigitKey:hy,isEnterKey:bg,isEscapeKey:xg,isFeature:d_,isInactiveFeature:h_,isOfMetaType:yg,isShiftDown:gg,isShiftMousedown:oy,isTrue:a0,isVertex:gm,noTarget:vg},Symbol.toStringTag,{value:"Module"}));var hg={},dm={},B_;function o0(){return B_||(B_=1,dm.RADIUS=6378137,dm.FLATTENING=1/298.257223563,dm.POLAR_RADIUS=63567523142e-4),dm}var F_;function l0(){if(F_)return hg;F_=1;var b=o0();hg.geometry=A,hg.ring=Z;function A(lt){var R=0,d;switch(lt.type){case"Polygon":return U(lt.coordinates);case"MultiPolygon":for(d=0;d<lt.coordinates.length;d++)R+=U(lt.coordinates[d]);return R;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(d=0;d<lt.geometries.length;d++)R+=A(lt.geometries[d]);return R}}function U(lt){var R=0;if(lt&&lt.length>0){R+=Math.abs(Z(lt[0]));for(var d=1;d<lt.length;d++)R-=Math.abs(Z(lt[d]))}return R}function Z(lt){var R,d,dt,vt,Wt,ee,Bt,Gt=0,se=lt.length;if(se>2){for(Bt=0;Bt<se;Bt++)Bt===se-2?(vt=se-2,Wt=se-1,ee=0):Bt===se-1?(vt=se-1,Wt=0,ee=1):(vt=Bt,Wt=Bt+1,ee=Bt+2),R=lt[vt],d=lt[Wt],dt=lt[ee],Gt+=(it(dt[0])-it(R[0]))*Math.sin(it(d[1]));Gt=Gt*b.RADIUS*b.RADIUS/2}return Gt}function it(lt){return lt*Math.PI/180}return hg}var u0=l0();const c0=pm(u0),N_={Point:0,LineString:1,MultiLineString:1,Polygon:2};function h0(b,A){const U=N_[b.geometry.type]-N_[A.geometry.type];return U===0&&b.geometry.type===Le.POLYGON?b.area-A.area:U}function dy(b){return b.map(A=>(A.geometry.type===Le.POLYGON&&(A.area=c0.geometry({type:Le.FEATURE,property:{},geometry:A.geometry})),A)).sort(h0).map(A=>(delete A.area,A))}function fy(b,A=0){return[[b.point.x-A,b.point.y-A],[b.point.x+A,b.point.y+A]]}function Zo(b){if(this._items={},this._nums={},this._length=b?b.length:0,!!b)for(let A=0,U=b.length;A<U;A++)this.add(b[A]),b[A]!==void 0&&(typeof b[A]=="string"?this._items[b[A]]=A:this._nums[b[A]]=A)}Zo.prototype.add=function(b){return this.has(b)?this:(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length,this)};Zo.prototype.delete=function(b){return this.has(b)===!1?this:(this._length--,delete this._items[b],delete this._nums[b],this)};Zo.prototype.has=function(b){return typeof b!="string"&&typeof b!="number"?!1:this._items[b]!==void 0||this._nums[b]!==void 0};Zo.prototype.values=function(){const b=[];return Object.keys(this._items).forEach(A=>{b.push({k:A,v:this._items[A]})}),Object.keys(this._nums).forEach(A=>{b.push({k:JSON.parse(A),v:this._nums[A]})}),b.sort((A,U)=>A.v-U.v).map(A=>A.k)};Zo.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const d0=[Ia.FEATURE,Ia.MIDPOINT,Ia.VERTEX],Qf={click:f0,touch:p0};function f0(b,A,U){return py(b,A,U,U.options.clickBuffer)}function p0(b,A,U){return py(b,A,U,U.options.touchBuffer)}function py(b,A,U,Z){if(U.map===null)return[];const it=b?fy(b,Z):A,lt={};U.options.styles&&(lt.layers=U.options.styles.map(vt=>vt.id).filter(vt=>U.map.getLayer(vt)!=null));const R=U.map.queryRenderedFeatures(it,lt).filter(vt=>d0.indexOf(vt.properties.meta)!==-1),d=new Zo,dt=[];return R.forEach(vt=>{const Wt=vt.properties.id;d.has(Wt)||(d.add(Wt),dt.push(vt))}),dy(dt)}function mg(b,A){const U=Qf.click(b,null,A),Z={mouse:Nn.NONE};return U[0]&&(Z.mouse=U[0].properties.active===Wr.ACTIVE?Nn.MOVE:Nn.POINTER,Z.feature=U[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(Z.mouse=Nn.ADD),A.ui.queueMapClasses(Z),A.ui.updateMapClasses(),U[0]}function f_(b,A){const U=b.x-A.x,Z=b.y-A.y;return Math.sqrt(U*U+Z*Z)}const m0=4,g0=12,_0=500;function o_(b,A,U={}){const Z=U.fineTolerance!=null?U.fineTolerance:m0,it=U.grossTolerance!=null?U.grossTolerance:g0,lt=U.interval!=null?U.interval:_0;b.point=b.point||A.point,b.time=b.time||A.time;const R=f_(b.point,A.point);return R<Z||R<it&&A.time-b.time<lt}const y0=25,v0=250;function l_(b,A,U={}){const Z=U.tolerance!=null?U.tolerance:y0,it=U.interval!=null?U.interval:v0;return b.point=b.point||A.point,b.time=b.time||A.time,f_(b.point,A.point)<Z&&A.time-b.time<it}const u_=function(b,A){const U={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Z={on(lt,R,d){if(U[lt]===void 0)throw new Error(`Invalid event type: ${lt}`);U[lt].push({selector:R,fn:d})},render(lt){A.store.featureChanged(lt)}},it=function(lt,R){const d=U[lt];let dt=d.length;for(;dt--;){const vt=d[dt];if(vt.selector(R)){vt.fn.call(Z,R)||A.store.render(),A.ui.updateMapClasses();break}}};return b.start.call(Z),{render:b.render,stop(){b.stop&&b.stop()},trash(){b.trash&&(b.trash(),A.store.render())},combineFeatures(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures(){b.uncombineFeatures&&b.uncombineFeatures()},drag(lt){it("drag",lt)},click(lt){it("click",lt)},mousemove(lt){it("mousemove",lt)},mousedown(lt){it("mousedown",lt)},mouseup(lt){it("mouseup",lt)},mouseout(lt){it("mouseout",lt)},keydown(lt){it("keydown",lt)},keyup(lt){it("keyup",lt)},touchstart(lt){it("touchstart",lt)},touchmove(lt){it("touchmove",lt)},touchend(lt){it("touchend",lt)},tap(lt){it("tap",lt)}}};let x0=(b,A=21)=>(U=A)=>{let Z="",it=U|0;for(;it--;)Z+=b[Math.random()*b.length|0];return Z};const b0=x0("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function p_(){return b0()}const ts=function(b,A){this.ctx=b,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||p_(),this.type=A.geometry.type};ts.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};ts.prototype.incomingCoords=function(b){this.setCoordinates(b)};ts.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()};ts.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};ts.prototype.setProperty=function(b,A){this.properties[b]=A};ts.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Le.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};ts.prototype.internal=function(b){const A={id:this.id,meta:Ia.FEATURE,"meta:type":this.type,active:Wr.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(const U in this.properties)A[`user_${U}`]=this.properties[U];return{type:Le.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Oh=function(b,A){ts.call(this,b,A)};Oh.prototype=Object.create(ts.prototype);Oh.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Oh.prototype.updateCoordinate=function(b,A,U){arguments.length===3?this.coordinates=[A,U]:this.coordinates=[b,A],this.changed()};Oh.prototype.getCoordinate=function(){return this.getCoordinates()};const Du=function(b,A){ts.call(this,b,A)};Du.prototype=Object.create(ts.prototype);Du.prototype.isValid=function(){return this.coordinates.length>1};Du.prototype.addCoordinate=function(b,A,U){this.changed();const Z=parseInt(b,10);this.coordinates.splice(Z,0,[A,U])};Du.prototype.getCoordinate=function(b){const A=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[A]))};Du.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)};Du.prototype.updateCoordinate=function(b,A,U){const Z=parseInt(b,10);this.coordinates[Z]=[A,U],this.changed()};const uo=function(b,A){ts.call(this,b,A),this.coordinates=this.coordinates.map(U=>U.slice(0,-1))};uo.prototype=Object.create(ts.prototype);uo.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(b=>b.length>2)};uo.prototype.incomingCoords=function(b){this.coordinates=b.map(A=>A.slice(0,-1)),this.changed()};uo.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()};uo.prototype.addCoordinate=function(b,A,U){this.changed();const Z=b.split(".").map(lt=>parseInt(lt,10));this.coordinates[Z[0]].splice(Z[1],0,[A,U])};uo.prototype.removeCoordinate=function(b){this.changed();const A=b.split(".").map(Z=>parseInt(Z,10)),U=this.coordinates[A[0]];U&&(U.splice(A[1],1),U.length<3&&this.coordinates.splice(A[0],1))};uo.prototype.getCoordinate=function(b){const A=b.split(".").map(Z=>parseInt(Z,10)),U=this.coordinates[A[0]];return JSON.parse(JSON.stringify(U[A[1]]))};uo.prototype.getCoordinates=function(){return this.coordinates.map(b=>b.concat([b[0]]))};uo.prototype.updateCoordinate=function(b,A,U){this.changed();const Z=b.split("."),it=parseInt(Z[0],10),lt=parseInt(Z[1],10);this.coordinates[it]===void 0&&(this.coordinates[it]=[]),this.coordinates[it][lt]=[A,U]};const w0={MultiPoint:Oh,MultiLineString:Du,MultiPolygon:uo},wg=(b,A,U,Z,it)=>{const lt=U.split("."),R=parseInt(lt[0],10),d=lt[1]?lt.slice(1).join("."):null;return b[R][A](d,Z,it)},Qa=function(b,A){if(ts.call(this,b,A),delete this.coordinates,this.model=w0[A.geometry.type],this.model===void 0)throw new TypeError(`${A.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(A.geometry.coordinates)};Qa.prototype=Object.create(ts.prototype);Qa.prototype._coordinatesToFeatures=function(b){const A=this.model.bind(this);return b.map(U=>new A(this.ctx,{id:p_(),type:Le.FEATURE,properties:{},geometry:{coordinates:U,type:this.type.replace("Multi","")}}))};Qa.prototype.isValid=function(){return this.features.every(b=>b.isValid())};Qa.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()};Qa.prototype.getCoordinate=function(b){return wg(this.features,"getCoordinate",b)};Qa.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(b=>b.type===Le.POLYGON?b.getCoordinates():b.coordinates)))};Qa.prototype.updateCoordinate=function(b,A,U){wg(this.features,"updateCoordinate",b,A,U),this.changed()};Qa.prototype.addCoordinate=function(b,A,U){wg(this.features,"addCoordinate",b,A,U),this.changed()};Qa.prototype.removeCoordinate=function(b){wg(this.features,"removeCoordinate",b),this.changed()};Qa.prototype.getFeatures=function(){return this.features};function ui(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}ui.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)};ui.prototype.setSelectedCoordinates=function(b){this._ctx.store.setSelectedCoordinates(b),b.reduce((A,U)=>(A[U.feature_id]===void 0&&(A[U.feature_id]=!0,this._ctx.store.get(U.feature_id).changed()),A),{})};ui.prototype.getSelected=function(){return this._ctx.store.getSelected()};ui.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};ui.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)};ui.prototype.getFeature=function(b){return this._ctx.store.get(b)};ui.prototype.select=function(b){return this._ctx.store.select(b)};ui.prototype.deselect=function(b){return this._ctx.store.deselect(b)};ui.prototype.deleteFeature=function(b,A={}){return this._ctx.store.delete(b,A)};ui.prototype.addFeature=function(b,A={}){return this._ctx.store.add(b,A)};ui.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};ui.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};ui.prototype.setActionableState=function(b={}){const A={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(A)};ui.prototype.changeMode=function(b,A={},U={}){return this._ctx.events.changeMode(b,A,U)};ui.prototype.fire=function(b,A){return this._ctx.events.fire(b,A)};ui.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)};ui.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)};ui.prototype.featuresAt=function(b,A,U="click"){if(U!=="click"&&U!=="touch")throw new Error("invalid buffer type");return Qf[U](b,A,this._ctx)};ui.prototype.newFeature=function(b){const A=b.geometry.type;return A===Le.POINT?new Oh(this._ctx,b):A===Le.LINE_STRING?new Du(this._ctx,b):A===Le.POLYGON?new uo(this._ctx,b):new Qa(this._ctx,b)};ui.prototype.isInstanceOf=function(b,A){if(b===Le.POINT)return A instanceof Oh;if(b===Le.LINE_STRING)return A instanceof Du;if(b===Le.POLYGON)return A instanceof uo;if(b==="MultiFeature")return A instanceof Qa;throw new Error(`Unknown feature class: ${b}`)};ui.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)};ui.prototype.onSetup=function(){};ui.prototype.onDrag=function(){};ui.prototype.onClick=function(){};ui.prototype.onMouseMove=function(){};ui.prototype.onMouseDown=function(){};ui.prototype.onMouseUp=function(){};ui.prototype.onMouseOut=function(){};ui.prototype.onKeyUp=function(){};ui.prototype.onKeyDown=function(){};ui.prototype.onTouchStart=function(){};ui.prototype.onTouchMove=function(){};ui.prototype.onTouchEnd=function(){};ui.prototype.onTap=function(){};ui.prototype.onStop=function(){};ui.prototype.onTrash=function(){};ui.prototype.onCombineFeature=function(){};ui.prototype.onUncombineFeature=function(){};ui.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const my={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},T0=Object.keys(my);function S0(b){const A=Object.keys(b);return function(U,Z={}){let it={};const lt=A.reduce((d,dt)=>(d[dt]=b[dt],d),new ui(U));function R(d){return dt=>lt[d](it,dt)}return{start(){it=lt.onSetup(Z),T0.forEach(d=>{const dt=my[d];let vt=()=>!1;b[dt]&&(vt=()=>!0),this.on(d,vt,R(dt))})},stop(){lt.onStop(it)},trash(){lt.onTrash(it)},combineFeatures(){lt.onCombineFeatures(it)},uncombineFeatures(){lt.onUncombineFeatures(it)},render(d,dt){lt.toDisplayFeatures(it,d,dt)}}}}function E0(b){const A=Object.keys(b.options.modes).reduce((Bt,Gt)=>(Bt[Gt]=S0(b.options.modes[Gt]),Bt),{});let U={},Z={};const it={};let lt=null,R=null;it.drag=function(Bt,Gt){Gt({point:Bt.point,time:new Date().getTime()})?(b.ui.queueMapClasses({mouse:Nn.DRAG}),R.drag(Bt)):Bt.originalEvent.stopPropagation()},it.mousedrag=function(Bt){it.drag(Bt,Gt=>!o_(U,Gt))},it.touchdrag=function(Bt){it.drag(Bt,Gt=>!l_(Z,Gt))},it.mousemove=function(Bt){if((Bt.originalEvent.buttons!==void 0?Bt.originalEvent.buttons:Bt.originalEvent.which)===1)return it.mousedrag(Bt);const se=mg(Bt,b);Bt.featureTarget=se,R.mousemove(Bt)},it.mousedown=function(Bt){U={time:new Date().getTime(),point:Bt.point};const Gt=mg(Bt,b);Bt.featureTarget=Gt,R.mousedown(Bt)},it.mouseup=function(Bt){const Gt=mg(Bt,b);Bt.featureTarget=Gt,o_(U,{point:Bt.point,time:new Date().getTime()})?R.click(Bt):R.mouseup(Bt)},it.mouseout=function(Bt){R.mouseout(Bt)},it.touchstart=function(Bt){if(!b.options.touchEnabled)return;Z={time:new Date().getTime(),point:Bt.point};const Gt=Qf.touch(Bt,null,b)[0];Bt.featureTarget=Gt,R.touchstart(Bt)},it.touchmove=function(Bt){if(b.options.touchEnabled)return R.touchmove(Bt),it.touchdrag(Bt)},it.touchend=function(Bt){if(Bt.originalEvent.preventDefault(),!b.options.touchEnabled)return;const Gt=Qf.touch(Bt,null,b)[0];Bt.featureTarget=Gt,l_(Z,{time:new Date().getTime(),point:Bt.point})?R.tap(Bt):R.touchend(Bt)};const d=Bt=>{const Gt=a_(Bt),se=s_(Bt),Lt=hy(Bt);return!(Gt||se||Lt)};it.keydown=function(Bt){(Bt.srcElement||Bt.target).classList.contains(zs.CANVAS)&&((a_(Bt)||s_(Bt))&&b.options.controls.trash?(Bt.preventDefault(),R.trash()):d(Bt)?R.keydown(Bt):ly(Bt)&&b.options.controls.point?dt(Ti.DRAW_POINT):uy(Bt)&&b.options.controls.line_string?dt(Ti.DRAW_LINE_STRING):cy(Bt)&&b.options.controls.polygon&&dt(Ti.DRAW_POLYGON))},it.keyup=function(Bt){d(Bt)&&R.keyup(Bt)},it.zoomend=function(){b.store.changeZoom()},it.data=function(Bt){if(Bt.dataType==="style"){const{setup:Gt,map:se,options:Lt,store:_t}=b;Lt.styles.some(me=>se.getLayer(me.id))||(Gt.addLayers(),_t.setDirty(),_t.render())}};function dt(Bt,Gt,se={}){R.stop();const Lt=A[Bt];if(Lt===void 0)throw new Error(`${Bt} is not valid`);lt=Bt;const _t=Lt(b,Gt);R=u_(_t,b),se.silent||b.map.fire(Ja.MODE_CHANGE,{mode:Bt}),b.store.setDirty(),b.store.render()}const vt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function Wt(Bt){let Gt=!1;Object.keys(Bt).forEach(se=>{if(vt[se]===void 0)throw new Error("Invalid action type");vt[se]!==Bt[se]&&(Gt=!0),vt[se]=Bt[se]}),Gt&&b.map.fire(Ja.ACTIONABLE,{actions:vt})}return{start(){lt=b.options.defaultMode,R=u_(A[lt](b),b)},changeMode:dt,actionable:Wt,currentModeName(){return lt},currentModeRender(Bt,Gt){return R.render(Bt,Gt)},fire(Bt,Gt){b.map&&b.map.fire(Bt,Gt)},addEventListeners(){b.map.on("mousemove",it.mousemove),b.map.on("mousedown",it.mousedown),b.map.on("mouseup",it.mouseup),b.map.on("data",it.data),b.map.on("touchmove",it.touchmove),b.map.on("touchstart",it.touchstart),b.map.on("touchend",it.touchend),b.container.addEventListener("mouseout",it.mouseout),b.options.keybindings&&(b.container.addEventListener("keydown",it.keydown),b.container.addEventListener("keyup",it.keyup))},removeEventListeners(){b.map.off("mousemove",it.mousemove),b.map.off("mousedown",it.mousedown),b.map.off("mouseup",it.mouseup),b.map.off("data",it.data),b.map.off("touchmove",it.touchmove),b.map.off("touchstart",it.touchstart),b.map.off("touchend",it.touchend),b.container.removeEventListener("mouseout",it.mouseout),b.options.keybindings&&(b.container.removeEventListener("keydown",it.keydown),b.container.removeEventListener("keyup",it.keyup))},trash(Bt){R.trash(Bt)},combineFeatures(){R.combineFeatures()},uncombineFeatures(){R.uncombineFeatures()},getMode(){return lt}}}function _m(b){return[].concat(b).filter(A=>A!==void 0)}function M0(){const b=this;if(!(b.ctx.map&&b.ctx.map.getSource(qo.HOT)!==void 0))return dt();const U=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:U});let Z=[],it=[];b.isDirty?it=b.getAllIds():(Z=b.getChangedIds().filter(vt=>b.get(vt)!==void 0),it=b.sources.hot.filter(vt=>vt.properties.id&&Z.indexOf(vt.properties.id)===-1&&b.get(vt.properties.id)!==void 0).map(vt=>vt.properties.id)),b.sources.hot=[];const lt=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(vt=>{const Wt=vt.properties.id||vt.properties.parent;return Z.indexOf(Wt)===-1});const R=lt!==b.sources.cold.length||it.length>0;Z.forEach(vt=>d(vt,"hot")),it.forEach(vt=>d(vt,"cold"));function d(vt,Wt){const Bt=b.get(vt).internal(U);b.ctx.events.currentModeRender(Bt,Gt=>{Gt.properties.mode=U,b.sources[Wt].push(Gt)})}R&&b.ctx.map.getSource(qo.COLD).setData({type:Le.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(qo.HOT).setData({type:Le.FEATURE_COLLECTION,features:b.sources.hot}),dt();function dt(){b.isDirty=!1,b.clearChangedIds()}}function Sn(b){this._features={},this._featureIds=new Zo,this._selectedFeatureIds=new Zo,this._selectedCoordinates=[],this._changedFeatureIds=new Zo,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]};let A;this.render=()=>{A||(A=requestAnimationFrame(()=>{A=null,M0.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Ja.SELECTION_CHANGE,{features:this.getSelected().map(U=>U.toGeoJSON()),points:this.getSelectedCoordinates().map(U=>({type:Le.FEATURE,properties:{},geometry:{type:Le.POINT,coordinates:U.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Ja.RENDER,{})}))},this.isDirty=!1}Sn.prototype.createRenderBatch=function(){const b=this.render;let A=0;return this.render=function(){A++},()=>{this.render=b,A>0&&this.render()}};Sn.prototype.setDirty=function(){return this.isDirty=!0,this};Sn.prototype.featureCreated=function(b,A={}){if(this._changedFeatureIds.add(b),(A.silent!=null?A.silent:this.ctx.options.suppressAPIEvents)!==!0){const Z=this.get(b);this.ctx.events.fire(Ja.CREATE,{features:[Z.toGeoJSON()]})}return this};Sn.prototype.featureChanged=function(b,A={}){return this._changedFeatureIds.add(b),(A.silent!=null?A.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Ja.UPDATE,{action:A.action?A.action:mm.CHANGE_COORDINATES,features:[this.get(b).toGeoJSON()]}),this};Sn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Sn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Sn.prototype.getAllIds=function(){return this._featureIds.values()};Sn.prototype.add=function(b,A={}){return this._features[b.id]=b,this._featureIds.add(b.id),this.featureCreated(b.id,{silent:A.silent}),this};Sn.prototype.delete=function(b,A={}){const U=[];return _m(b).forEach(Z=>{this._featureIds.has(Z)&&(this._featureIds.delete(Z),this._selectedFeatureIds.delete(Z),A.silent||U.indexOf(this._features[Z])===-1&&U.push(this._features[Z].toGeoJSON()),delete this._features[Z],this.isDirty=!0)}),U.length&&this.ctx.events.fire(Ja.DELETE,{features:U}),gy(this,A),this};Sn.prototype.get=function(b){return this._features[b]};Sn.prototype.getAll=function(){return Object.keys(this._features).map(b=>this._features[b])};Sn.prototype.select=function(b,A={}){return _m(b).forEach(U=>{this._selectedFeatureIds.has(U)||(this._selectedFeatureIds.add(U),this._changedFeatureIds.add(U),A.silent||(this._emitSelectionChange=!0))}),this};Sn.prototype.deselect=function(b,A={}){return _m(b).forEach(U=>{this._selectedFeatureIds.has(U)&&(this._selectedFeatureIds.delete(U),this._changedFeatureIds.add(U),A.silent||(this._emitSelectionChange=!0))}),gy(this,A),this};Sn.prototype.clearSelected=function(b={}){return this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this};Sn.prototype.setSelected=function(b,A={}){return b=_m(b),this.deselect(this._selectedFeatureIds.values().filter(U=>b.indexOf(U)===-1),{silent:A.silent}),this.select(b.filter(U=>!this._selectedFeatureIds.has(U)),{silent:A.silent}),this};Sn.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this};Sn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Sn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Sn.prototype.getSelected=function(){return this.getSelectedIds().map(b=>this.get(b))};Sn.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(A=>({coordinates:this.get(A.feature_id).getCoordinate(A.coord_path)}))};Sn.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)};Sn.prototype.setFeatureProperty=function(b,A,U,Z={}){this.get(b).setProperty(A,U),this.featureChanged(b,{silent:Z.silent,action:mm.CHANGE_PROPERTIES})};function gy(b,A={}){const U=b._selectedCoordinates.filter(Z=>b._selectedFeatureIds.has(Z.feature_id));b._selectedCoordinates.length!==U.length&&!A.silent&&(b._emitSelectionChange=!0),b._selectedCoordinates=U}Sn.prototype.storeMapConfig=function(){ay.forEach(b=>{this.ctx.map[b]&&(this._mapInitialConfig[b]=this.ctx.map[b].isEnabled())})};Sn.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(b=>{this._mapInitialConfig[b]?this.ctx.map[b].enable():this.ctx.map[b].disable()})};Sn.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]!==void 0?this._mapInitialConfig[b]:!0};const C0=["mode","feature","mouse"];function A0(b){const A={};let U=null,Z={mode:null,feature:null,mouse:null},it={mode:null,feature:null,mouse:null};function lt(){R({mode:null,feature:null,mouse:null}),d()}function R(Gt){it=Object.assign(it,Gt)}function d(){if(!b.container)return;const Gt=[],se=[];C0.forEach(Lt=>{it[Lt]!==Z[Lt]&&(Gt.push(`${Lt}-${Z[Lt]}`),it[Lt]!==null&&se.push(`${Lt}-${it[Lt]}`))}),Gt.length>0&&b.container.classList.remove(...Gt),se.length>0&&b.container.classList.add(...se),Z=Object.assign(Z,it)}function dt(Gt,se={}){const Lt=document.createElement("button");return Lt.className=`${zs.CONTROL_BUTTON} ${se.className}`,Lt.setAttribute("title",se.title),se.container.appendChild(Lt),Lt.addEventListener("click",_t=>{if(_t.preventDefault(),_t.stopPropagation(),_t.target===U){vt(),se.onDeactivate();return}Wt(Gt),se.onActivate()},!0),Lt}function vt(){U&&(U.classList.remove(zs.ACTIVE_BUTTON),U=null)}function Wt(Gt){vt();const se=A[Gt];se&&se&&Gt!=="trash"&&(se.classList.add(zs.ACTIVE_BUTTON),U=se)}function ee(){const Gt=b.options.controls,se=document.createElement("div");return se.className=`${zs.CONTROL_GROUP} ${zs.CONTROL_BASE}`,Gt&&(Gt[Ps.POINT]&&(A[Ps.POINT]=dt(Ps.POINT,{container:se,className:zs.CONTROL_BUTTON_POINT,title:`Marker tool ${b.options.keybindings?"(1)":""}`,onActivate:()=>b.events.changeMode(Ti.DRAW_POINT),onDeactivate:()=>b.events.trash()})),Gt[Ps.LINE]&&(A[Ps.LINE]=dt(Ps.LINE,{container:se,className:zs.CONTROL_BUTTON_LINE,title:`LineString tool ${b.options.keybindings?"(2)":""}`,onActivate:()=>b.events.changeMode(Ti.DRAW_LINE_STRING),onDeactivate:()=>b.events.trash()})),Gt[Ps.POLYGON]&&(A[Ps.POLYGON]=dt(Ps.POLYGON,{container:se,className:zs.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${b.options.keybindings?"(3)":""}`,onActivate:()=>b.events.changeMode(Ti.DRAW_POLYGON),onDeactivate:()=>b.events.trash()})),Gt.trash&&(A.trash=dt("trash",{container:se,className:zs.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{b.events.trash()}})),Gt.combine_features&&(A.combine_features=dt("combineFeatures",{container:se,className:zs.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{b.events.combineFeatures()}})),Gt.uncombine_features&&(A.uncombine_features=dt("uncombineFeatures",{container:se,className:zs.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{b.events.uncombineFeatures()}}))),se}function Bt(){Object.keys(A).forEach(Gt=>{const se=A[Gt];se.parentNode&&se.parentNode.removeChild(se),delete A[Gt]})}return{setActiveButton:Wt,queueMapClasses:R,updateMapClasses:d,clearMapClasses:lt,addButtons:ee,removeButtons:Bt}}function D0(b){let A=null,U=null;const Z={onRemove(){return b.map.off("load",Z.connect),clearInterval(U),Z.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.boxZoomInitial&&b.map.boxZoom.enable(),b.map=null,b.container=null,b.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect(){b.map.off("load",Z.connect),clearInterval(U),Z.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd(it){if(b.map=it,b.events=E0(b),b.ui=A0(b),b.container=it.getContainer(),b.store=new Sn(b),A=b.ui.addButtons(),b.options.boxSelect){b.boxZoomInitial=it.boxZoom.isEnabled(),it.boxZoom.disable();const lt=it.dragPan.isEnabled();it.dragPan.disable(),it.dragPan.enable(),lt||it.dragPan.disable()}return it.loaded()?Z.connect():(it.on("load",Z.connect),U=setInterval(()=>{it.loaded()&&Z.connect()},16)),b.events.start(),A},addLayers(){b.map.addSource(qo.COLD,{data:{type:Le.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(qo.HOT,{data:{type:Le.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(it=>{b.map.addLayer(it)}),b.store.setDirty(!0),b.store.render()},removeLayers(){b.options.styles.forEach(it=>{b.map.getLayer(it.id)&&b.map.removeLayer(it.id)}),b.map.getSource(qo.COLD)&&b.map.removeSource(qo.COLD),b.map.getSource(qo.HOT)&&b.map.removeSource(qo.HOT)}};return b.setup=Z,Z}const Jg="#3bb2d0",fm="#fbb03b",j_="#fff",_y=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],fm,Jg],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],fm,Jg],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":j_}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],fm,Jg]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":j_}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":fm}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":fm}}];function Lh(b,A){this.x=b,this.y=A}Lh.prototype={clone(){return new Lh(this.x,this.y)},add(b){return this.clone()._add(b)},sub(b){return this.clone()._sub(b)},multByPoint(b){return this.clone()._multByPoint(b)},divByPoint(b){return this.clone()._divByPoint(b)},mult(b){return this.clone()._mult(b)},div(b){return this.clone()._div(b)},rotate(b){return this.clone()._rotate(b)},rotateAround(b,A){return this.clone()._rotateAround(b,A)},matMult(b){return this.clone()._matMult(b)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(b){return this.x===b.x&&this.y===b.y},dist(b){return Math.sqrt(this.distSqr(b))},distSqr(b){const A=b.x-this.x,U=b.y-this.y;return A*A+U*U},angle(){return Math.atan2(this.y,this.x)},angleTo(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith(b){return this.angleWithSep(b.x,b.y)},angleWithSep(b,A){return Math.atan2(this.x*A-this.y*b,this.x*b+this.y*A)},_matMult(b){const A=b[0]*this.x+b[1]*this.y,U=b[2]*this.x+b[3]*this.y;return this.x=A,this.y=U,this},_add(b){return this.x+=b.x,this.y+=b.y,this},_sub(b){return this.x-=b.x,this.y-=b.y,this},_mult(b){return this.x*=b,this.y*=b,this},_div(b){return this.x/=b,this.y/=b,this},_multByPoint(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint(b){return this.x/=b.x,this.y/=b.y,this},_unit(){return this._div(this.mag()),this},_perp(){const b=this.y;return this.y=this.x,this.x=-b,this},_rotate(b){const A=Math.cos(b),U=Math.sin(b),Z=A*this.x-U*this.y,it=U*this.x+A*this.y;return this.x=Z,this.y=it,this},_rotateAround(b,A){const U=Math.cos(b),Z=Math.sin(b),it=A.x+U*(this.x-A.x)-Z*(this.y-A.y),lt=A.y+Z*(this.x-A.x)+U*(this.y-A.y);return this.x=it,this.y=lt,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Lh};Lh.convert=function(b){if(b instanceof Lh)return b;if(Array.isArray(b))return new Lh(+b[0],+b[1]);if(b.x!==void 0&&b.y!==void 0)return new Lh(+b.x,+b.y);throw new Error("Expected [x, y] or {x, y} point format")};function m_(b,A){const U=A.getBoundingClientRect();return new Lh(b.clientX-U.left-(A.clientLeft||0),b.clientY-U.top-(A.clientTop||0))}function Jf(b,A,U,Z){return{type:Le.FEATURE,properties:{meta:Ia.VERTEX,parent:b,coord_path:U,active:Z?Wr.ACTIVE:Wr.INACTIVE},geometry:{type:Le.POINT,coordinates:A}}}function I0(b){return!isNaN(b)&&b!==null&&!Array.isArray(b)}function yy(b,A,U){if(b!==null)for(var Z,it,lt,R,d,dt,vt,Wt=0,ee=0,Bt,Gt=b.type,se=Gt==="FeatureCollection",Lt=Gt==="Feature",_t=se?b.features.length:1,fe=0;fe<_t;fe++){vt=se?b.features[fe].geometry:Lt?b.geometry:b,Bt=vt?vt.type==="GeometryCollection":!1,d=Bt?vt.geometries.length:1;for(var me=0;me<d;me++){var le=0,mi=0;if(R=Bt?vt.geometries[me]:vt,R!==null){dt=R.coordinates;var ue=R.type;switch(Wt=0,ue){case null:break;case"Point":if(A(dt,ee,fe,le,mi)===!1)return!1;ee++,le++;break;case"LineString":case"MultiPoint":for(Z=0;Z<dt.length;Z++){if(A(dt[Z],ee,fe,le,mi)===!1)return!1;ee++,ue==="MultiPoint"&&le++}ue==="LineString"&&le++;break;case"Polygon":case"MultiLineString":for(Z=0;Z<dt.length;Z++){for(it=0;it<dt[Z].length-Wt;it++){if(A(dt[Z][it],ee,fe,le,mi)===!1)return!1;ee++}ue==="MultiLineString"&&le++,ue==="Polygon"&&mi++}ue==="Polygon"&&le++;break;case"MultiPolygon":for(Z=0;Z<dt.length;Z++){for(mi=0,it=0;it<dt[Z].length;it++){for(lt=0;lt<dt[Z][it].length-Wt;lt++){if(A(dt[Z][it][lt],ee,fe,le,mi)===!1)return!1;ee++}mi++}le++}break;case"GeometryCollection":for(Z=0;Z<R.geometries.length;Z++)if(yy(R.geometries[Z],A)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function z0(b){if(!b)throw new Error("geojson is required");switch(b.type){case"Feature":return vy(b);case"FeatureCollection":return P0(b);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return g_(b);default:throw new Error("unknown GeoJSON type")}}function vy(b){const A={type:"Feature"};return Object.keys(b).forEach(U=>{switch(U){case"type":case"properties":case"geometry":return;default:A[U]=b[U]}}),A.properties=xy(b.properties),b.geometry==null?A.geometry=null:A.geometry=g_(b.geometry),A}function xy(b){const A={};return b&&Object.keys(b).forEach(U=>{const Z=b[U];typeof Z=="object"?Z===null?A[U]=null:Array.isArray(Z)?A[U]=Z.map(it=>it):A[U]=xy(Z):A[U]=Z}),A}function P0(b){const A={type:"FeatureCollection"};return Object.keys(b).forEach(U=>{switch(U){case"type":case"features":return;default:A[U]=b[U]}}),A.features=b.features.map(U=>vy(U)),A}function g_(b){const A={type:b.type};return b.bbox&&(A.bbox=b.bbox),b.type==="GeometryCollection"?(A.geometries=b.geometries.map(U=>g_(U)),A):(A.coordinates=by(b.coordinates),A)}function by(b){const A=b;return typeof A[0]!="object"?A.slice():A.map(U=>by(U))}function V_(b,A={}){return wy(b,"mercator",A)}function R0(b,A={}){return wy(b,"wgs84",A)}function wy(b,A,U={}){U=U||{};var Z=U.mutate;if(!b)throw new Error("geojson is required");return Array.isArray(b)&&I0(b[0])?b=A==="mercator"?U_(b):G_(b):(Z!==!0&&(b=z0(b)),yy(b,function(it){var lt=A==="mercator"?U_(it):G_(it);it[0]=lt[0],it[1]=lt[1]})),b}function U_(b){var A=Math.PI/180,U=6378137,Z=20037508342789244e-9,it=Math.abs(b[0])<=180?b[0]:b[0]-L0(b[0])*360,lt=[U*it*A,U*Math.log(Math.tan(Math.PI*.25+.5*b[1]*A))];return lt[0]>Z&&(lt[0]=Z),lt[0]<-Z&&(lt[0]=-Z),lt[1]>Z&&(lt[1]=Z),lt[1]<-Z&&(lt[1]=-Z),lt}function G_(b){var A=180/Math.PI,U=6378137;return[b[0]*A/U,(Math.PI*.5-2*Math.atan(Math.exp(-b[1]/U)))*A]}function L0(b){return b<0?-1:b>0?1:0}function Ty(b,A,U){const Z=A.geometry.coordinates,it=U.geometry.coordinates;if(Z[1]>r_||Z[1]<n_||it[1]>r_||it[1]<n_)return null;const lt=V_(Z),R=V_(it),d=ee=>Number(ee.toFixed(8)),dt=(ee,Bt)=>(ee+Bt)/2,vt=R0([dt(lt[0],R[0]),dt(lt[1],R[1])]),Wt=[d(vt[0]),d(vt[1])];return{type:Le.FEATURE,properties:{meta:Ia.MIDPOINT,parent:b,lng:Wt[0],lat:Wt[1],coord_path:U.properties.coord_path},geometry:{type:Le.POINT,coordinates:Wt}}}function Tg(b,A={},U=null){const{type:Z,coordinates:it}=b.geometry,lt=b.properties&&b.properties.id;let R=[];Z===Le.POINT?R.push(Jf(lt,it,U,dt(U))):Z===Le.POLYGON?it.forEach((Wt,ee)=>{d(Wt,U!==null?`${U}.${ee}`:String(ee))}):Z===Le.LINE_STRING?d(it,U):Z.indexOf(Le.MULTI_PREFIX)===0&&vt();function d(Wt,ee){let Bt="",Gt=null;Wt.forEach((se,Lt)=>{const _t=ee!=null?`${ee}.${Lt}`:String(Lt),fe=Jf(lt,se,_t,dt(_t));if(A.midpoints&&Gt){const le=Ty(lt,Gt,fe);le&&R.push(le)}Gt=fe;const me=JSON.stringify(se);Bt!==me&&R.push(fe),Lt===0&&(Bt=me)})}function dt(Wt){return A.selectedPaths?A.selectedPaths.indexOf(Wt)!==-1:!1}function vt(){const Wt=Z.replace(Le.MULTI_PREFIX,"");it.forEach((ee,Bt)=>{const Gt={type:Le.FEATURE,properties:b.properties,geometry:{type:Wt,coordinates:ee}};R=R.concat(Tg(Gt,A,Bt))})}return R}const Ol={enable(b){setTimeout(()=>{!b.map||!b.map.doubleClickZoom||!b._ctx||!b._ctx.store||!b._ctx.store.getInitialConfigValue||b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable(b){setTimeout(()=>{!b.map||!b.map.doubleClickZoom||b.map.doubleClickZoom.disable()},0)}},{LAT_MIN:dg,LAT_MAX:fg,LAT_RENDERED_MIN:q_,LAT_RENDERED_MAX:Z_,LNG_MIN:H_,LNG_MAX:$_}=sy;function O0(b){const A={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[b.geometry.type],U=[b.geometry.coordinates].flat(A),Z=U.map(d=>d[0]),it=U.map(d=>d[1]),lt=d=>Math.min.apply(null,d),R=d=>Math.max.apply(null,d);return[lt(Z),lt(it),R(Z),R(it)]}function __(b,A){let U=dg,Z=fg,it=dg,lt=fg,R=$_,d=H_;b.forEach(vt=>{const Wt=O0(vt),ee=Wt[1],Bt=Wt[3],Gt=Wt[0],se=Wt[2];ee>U&&(U=ee),Bt<Z&&(Z=Bt),Bt>it&&(it=Bt),ee<lt&&(lt=ee),Gt<R&&(R=Gt),se>d&&(d=se)});const dt=A;return U+dt.lat>Z_&&(dt.lat=Z_-U),it+dt.lat>fg&&(dt.lat=fg-it),Z+dt.lat<q_&&(dt.lat=q_-Z),lt+dt.lat<dg&&(dt.lat=dg-lt),R+dt.lng<=H_&&(dt.lng+=Math.ceil(Math.abs(dt.lng)/360)*360),d+dt.lng>=$_&&(dt.lng-=Math.ceil(Math.abs(dt.lng)/360)*360),dt}function y_(b,A){const U=__(b.map(Z=>Z.toGeoJSON()),A);b.forEach(Z=>{const it=Z.getCoordinates(),lt=vt=>{const Wt={lng:vt[0]+U.lng,lat:vt[1]+U.lat};return[Wt.lng,Wt.lat]},R=vt=>vt.map(Wt=>lt(Wt)),d=vt=>vt.map(Wt=>R(Wt));let dt;Z.type===Le.POINT?dt=lt(it):Z.type===Le.LINE_STRING||Z.type===Le.MULTI_POINT?dt=it.map(lt):Z.type===Le.POLYGON||Z.type===Le.MULTI_LINE_STRING?dt=it.map(R):Z.type===Le.MULTI_POLYGON&&(dt=it.map(d)),Z.incomingCoords(dt)})}const _n={};_n.onSetup=function(b){const A={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(A.initiallySelectedFeatureIds.filter(U=>this.getFeature(U)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),A};_n.fireUpdate=function(){this.fire(Ja.UPDATE,{action:mm.MOVE,features:this.getSelected().map(b=>b.toGeoJSON())})};_n.fireActionable=function(){const b=this.getSelected(),A=b.filter(lt=>this.isInstanceOf("MultiFeature",lt));let U=!1;if(b.length>1){U=!0;const lt=b[0].type.replace("Multi","");b.forEach(R=>{R.type.replace("Multi","")!==lt&&(U=!1)})}const Z=A.length>0,it=b.length>0;this.setActionableState({combineFeatures:U,uncombineFeatures:Z,trash:it})};_n.getUniqueIds=function(b){return b.length?b.map(U=>U.properties.id).filter(U=>U!==void 0).reduce((U,Z)=>(U.add(Z),U),new Zo).values():[]};_n.stopExtendedInteractions=function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),(b.canDragMove||b.canBoxSelect)&&b.initialDragPanState===!0&&this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1};_n.onStop=function(){Ol.enable(this)};_n.onMouseMove=function(b,A){return d_(A)&&b.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(b),!0};_n.onMouseOut=function(b){return b.dragMoving?this.fireUpdate():!0};_n.onTap=_n.onClick=function(b,A){if(vg(A))return this.clickAnywhere(b,A);if(yg(Ia.VERTEX)(A))return this.clickOnVertex(b,A);if(d_(A))return this.clickOnFeature(b,A)};_n.clickAnywhere=function(b){const A=this.getSelectedIds();A.length&&(this.clearSelectedFeatures(),A.forEach(U=>this.doRender(U))),Ol.enable(this),this.stopExtendedInteractions(b)};_n.clickOnVertex=function(b,A){this.changeMode(Ti.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:Nn.MOVE})};_n.startOnActiveFeature=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=A.lngLat};_n.clickOnFeature=function(b,A){Ol.disable(this),this.stopExtendedInteractions(b);const U=gg(A),Z=this.getSelectedIds(),it=A.featureTarget.properties.id,lt=this.isSelected(it);if(!U&&lt&&this.getFeature(it).type!==Le.POINT)return this.changeMode(Ti.DIRECT_SELECT,{featureId:it});lt&&U?(this.deselect(it),this.updateUIClasses({mouse:Nn.POINTER}),Z.length===1&&Ol.enable(this)):!lt&&U?(this.select(it),this.updateUIClasses({mouse:Nn.MOVE})):!lt&&!U&&(Z.forEach(R=>this.doRender(R)),this.setSelected(it),this.updateUIClasses({mouse:Nn.MOVE})),this.doRender(it)};_n.onMouseDown=function(b,A){if(b.initialDragPanState=this.map.dragPan.isEnabled(),Hd(A))return this.startOnActiveFeature(b,A);if(this.drawConfig.boxSelect&&oy(A))return this.startBoxSelect(b,A)};_n.startBoxSelect=function(b,A){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=m_(A.originalEvent,this.map.getContainer()),b.canBoxSelect=!0};_n.onTouchStart=function(b,A){if(Hd(A))return this.startOnActiveFeature(b,A)};_n.onDrag=function(b,A){if(b.canDragMove)return this.dragMove(b,A);if(this.drawConfig.boxSelect&&b.canBoxSelect)return this.whileBoxSelect(b,A)};_n.whileBoxSelect=function(b,A){b.boxSelecting=!0,this.updateUIClasses({mouse:Nn.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(zs.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));const U=m_(A.originalEvent,this.map.getContainer()),Z=Math.min(b.boxSelectStartLocation.x,U.x),it=Math.max(b.boxSelectStartLocation.x,U.x),lt=Math.min(b.boxSelectStartLocation.y,U.y),R=Math.max(b.boxSelectStartLocation.y,U.y),d=`translate(${Z}px, ${lt}px)`;b.boxSelectElement.style.transform=d,b.boxSelectElement.style.WebkitTransform=d,b.boxSelectElement.style.width=`${it-Z}px`,b.boxSelectElement.style.height=`${R-lt}px`};_n.dragMove=function(b,A){b.dragMoving=!0,A.originalEvent.stopPropagation();const U={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};y_(this.getSelected(),U),b.dragMoveLocation=A.lngLat};_n.onTouchEnd=_n.onMouseUp=function(b,A){if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){const U=[b.boxSelectStartLocation,m_(A.originalEvent,this.map.getContainer())],Z=this.featuresAt(null,U,"click"),it=this.getUniqueIds(Z).filter(lt=>!this.isSelected(lt));it.length&&(this.select(it),it.forEach(lt=>this.doRender(lt)),this.updateUIClasses({mouse:Nn.MOVE}))}this.stopExtendedInteractions(b)};_n.toDisplayFeatures=function(b,A,U){A.properties.active=this.isSelected(A.properties.id)?Wr.ACTIVE:Wr.INACTIVE,U(A),this.fireActionable(),!(A.properties.active!==Wr.ACTIVE||A.geometry.type===Le.POINT)&&Tg(A).forEach(U)};_n.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};_n.onCombineFeatures=function(){const b=this.getSelected();if(b.length===0||b.length<2)return;const A=[],U=[],Z=b[0].type.replace("Multi","");for(let it=0;it<b.length;it++){const lt=b[it];if(lt.type.replace("Multi","")!==Z)return;lt.type.includes("Multi")?lt.getCoordinates().forEach(R=>{A.push(R)}):A.push(lt.getCoordinates()),U.push(lt.toGeoJSON())}if(U.length>1){const it=this.newFeature({type:Le.FEATURE,properties:U[0].properties,geometry:{type:`Multi${Z}`,coordinates:A}});this.addFeature(it),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([it.id]),this.fire(Ja.COMBINE_FEATURES,{createdFeatures:[it.toGeoJSON()],deletedFeatures:U})}this.fireActionable()};_n.onUncombineFeatures=function(){const b=this.getSelected();if(b.length===0)return;const A=[],U=[];for(let Z=0;Z<b.length;Z++){const it=b[Z];this.isInstanceOf("MultiFeature",it)&&(it.getFeatures().forEach(lt=>{this.addFeature(lt),lt.properties=it.properties,A.push(lt.toGeoJSON()),this.select([lt.id])}),this.deleteFeature(it.id,{silent:!0}),U.push(it.toGeoJSON()))}A.length>1&&this.fire(Ja.UNCOMBINE_FEATURES,{createdFeatures:A,deletedFeatures:U}),this.fireActionable()};const Sy=yg(Ia.VERTEX),Ey=yg(Ia.MIDPOINT),yn={};yn.fireUpdate=function(){this.fire(Ja.UPDATE,{action:mm.CHANGE_COORDINATES,features:this.getSelected().map(b=>b.toGeoJSON())})};yn.fireActionable=function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})};yn.startDragging=function(b,A){b.initialDragPanState==null&&(b.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=A.lngLat};yn.stopDragging=function(b){b.canDragMove&&b.initialDragPanState===!0&&this.map.dragPan.enable(),b.initialDragPanState=null,b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null};yn.onVertex=function(b,A){this.startDragging(b,A);const U=A.featureTarget.properties,Z=b.selectedCoordPaths.indexOf(U.coord_path);!gg(A)&&Z===-1?b.selectedCoordPaths=[U.coord_path]:gg(A)&&Z===-1&&b.selectedCoordPaths.push(U.coord_path);const it=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(it)};yn.onMidpoint=function(b,A){this.startDragging(b,A);const U=A.featureTarget.properties;b.feature.addCoordinate(U.coord_path,U.lng,U.lat),this.fireUpdate(),b.selectedCoordPaths=[U.coord_path]};yn.pathsToCoordinates=function(b,A){return A.map(U=>({feature_id:b,coord_path:U}))};yn.onFeature=function(b,A){b.selectedCoordPaths.length===0?this.startDragging(b,A):this.stopDragging(b)};yn.dragFeature=function(b,A,U){y_(this.getSelected(),U),b.dragMoveLocation=A.lngLat};yn.dragVertex=function(b,A,U){const Z=b.selectedCoordPaths.map(R=>b.feature.getCoordinate(R)),it=Z.map(R=>({type:Le.FEATURE,properties:{},geometry:{type:Le.POINT,coordinates:R}})),lt=__(it,U);for(let R=0;R<Z.length;R++){const d=Z[R];b.feature.updateCoordinate(b.selectedCoordPaths[R],d[0]+lt.lng,d[1]+lt.lat)}};yn.clickNoTarget=function(){this.changeMode(Ti.SIMPLE_SELECT)};yn.clickInactive=function(){this.changeMode(Ti.SIMPLE_SELECT)};yn.clickActiveFeature=function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()};yn.onSetup=function(b){const A=b.featureId,U=this.getFeature(A);if(!U)throw new Error("You must provide a featureId to enter direct_select mode");if(U.type===Le.POINT)throw new TypeError("direct_select mode doesn't handle point features");const Z={featureId:A,feature:U,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,Z.selectedCoordPaths)),this.setSelected(A),Ol.disable(this),this.setActionableState({trash:!0}),Z};yn.onStop=function(){Ol.enable(this),this.clearSelectedCoordinates()};yn.toDisplayFeatures=function(b,A,U){b.featureId===A.properties.id?(A.properties.active=Wr.ACTIVE,U(A),Tg(A,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(U)):(A.properties.active=Wr.INACTIVE,U(A)),this.fireActionable(b)};yn.onTrash=function(b){b.selectedCoordPaths.sort((A,U)=>U.localeCompare(A,"en",{numeric:!0})).forEach(A=>b.feature.removeCoordinate(A)),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(Ti.SIMPLE_SELECT,{}))};yn.onMouseMove=function(b,A){const U=Hd(A),Z=Sy(A),it=Ey(A),lt=b.selectedCoordPaths.length===0;return U&&lt?this.updateUIClasses({mouse:Nn.MOVE}):Z&&!lt?this.updateUIClasses({mouse:Nn.MOVE}):this.updateUIClasses({mouse:Nn.NONE}),(Z||U||it)&&b.dragMoving&&this.fireUpdate(),this.stopDragging(b),!0};yn.onMouseOut=function(b){return b.dragMoving&&this.fireUpdate(),!0};yn.onTouchStart=yn.onMouseDown=function(b,A){if(Sy(A))return this.onVertex(b,A);if(Hd(A))return this.onFeature(b,A);if(Ey(A))return this.onMidpoint(b,A)};yn.onDrag=function(b,A){if(b.canDragMove!==!0)return;b.dragMoving=!0,A.originalEvent.stopPropagation();const U={lng:A.lngLat.lng-b.dragMoveLocation.lng,lat:A.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,A,U):this.dragFeature(b,A,U),b.dragMoveLocation=A.lngLat};yn.onClick=function(b,A){if(vg(A))return this.clickNoTarget(b,A);if(Hd(A))return this.clickActiveFeature(b,A);if(h_(A))return this.clickInactive(b,A);this.stopDragging(b)};yn.onTap=function(b,A){if(vg(A))return this.clickNoTarget(b,A);if(Hd(A))return this.clickActiveFeature(b,A);if(h_(A))return this.clickInactive(b,A)};yn.onTouchEnd=yn.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};const Au={};Au.onSetup=function(){const b=this.newFeature({type:Le.FEATURE,properties:{},geometry:{type:Le.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Nn.ADD}),this.activateUIButton(Ps.POINT),this.setActionableState({trash:!0}),{point:b}};Au.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT)};Au.onTap=Au.onClick=function(b,A){this.updateUIClasses({mouse:Nn.MOVE}),b.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.fire(Ja.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.point.id]})};Au.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})};Au.toDisplayFeatures=function(b,A,U){const Z=A.properties.id===b.point.id;if(A.properties.active=Z?Wr.ACTIVE:Wr.INACTIVE,!Z)return U(A)};Au.onTrash=Au.stopDrawingAndRemove;Au.onKeyUp=function(b,A){if(xg(A)||bg(A))return this.stopDrawingAndRemove(b,A)};function _g(b,A){return b.lngLat?b.lngLat.lng===A[0]&&b.lngLat.lat===A[1]:!1}const kl={};kl.onSetup=function(){const b=this.newFeature({type:Le.FEATURE,properties:{},geometry:{type:Le.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),Ol.disable(this),this.updateUIClasses({mouse:Nn.ADD}),this.activateUIButton(Ps.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}};kl.clickAnywhere=function(b,A){if(b.currentVertexPosition>0&&_g(A,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:Nn.ADD}),b.polygon.updateCoordinate(`0.${b.currentVertexPosition}`,A.lngLat.lng,A.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate(`0.${b.currentVertexPosition}`,A.lngLat.lng,A.lngLat.lat)};kl.clickOnVertex=function(b){return this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.polygon.id]})};kl.onMouseMove=function(b,A){b.polygon.updateCoordinate(`0.${b.currentVertexPosition}`,A.lngLat.lng,A.lngLat.lat),gm(A)&&this.updateUIClasses({mouse:Nn.POINTER})};kl.onTap=kl.onClick=function(b,A){return gm(A)?this.clickOnVertex(b,A):this.clickAnywhere(b,A)};kl.onKeyUp=function(b,A){xg(A)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT)):bg(A)&&this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.polygon.id]})};kl.onStop=function(b){this.updateUIClasses({mouse:Nn.NONE}),Ol.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate(`0.${b.currentVertexPosition}`),b.polygon.isValid()?this.fire(Ja.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT,{},{silent:!0})))};kl.toDisplayFeatures=function(b,A,U){const Z=A.properties.id===b.polygon.id;if(A.properties.active=Z?Wr.ACTIVE:Wr.INACTIVE,!Z)return U(A);if(A.geometry.coordinates.length===0)return;const it=A.geometry.coordinates[0].length;if(!(it<3)){if(A.properties.meta=Ia.FEATURE,U(Jf(b.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),it>3){const lt=A.geometry.coordinates[0].length-3;U(Jf(b.polygon.id,A.geometry.coordinates[0][lt],`0.${lt}`,!1))}if(it<=4){const lt=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if(U({type:Le.FEATURE,properties:A.properties,geometry:{coordinates:lt,type:Le.LINE_STRING}}),it===3)return}return U(A)}};kl.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT)};const Bl={};Bl.onSetup=function(b){b=b||{};const A=b.featureId;let U,Z,it="forward";if(A){if(U=this.getFeature(A),!U)throw new Error("Could not find a feature with the provided featureId");let lt=b.from;if(lt&&lt.type==="Feature"&&lt.geometry&&lt.geometry.type==="Point"&&(lt=lt.geometry),lt&&lt.type==="Point"&&lt.coordinates&&lt.coordinates.length===2&&(lt=lt.coordinates),!lt||!Array.isArray(lt))throw new Error("Please use the `from` property to indicate which point to continue the line from");const R=U.coordinates.length-1;if(U.coordinates[R][0]===lt[0]&&U.coordinates[R][1]===lt[1])Z=R+1,U.addCoordinate(Z,...U.coordinates[R]);else if(U.coordinates[0][0]===lt[0]&&U.coordinates[0][1]===lt[1])it="backwards",Z=0,U.addCoordinate(Z,...U.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else U=this.newFeature({type:Le.FEATURE,properties:{},geometry:{type:Le.LINE_STRING,coordinates:[]}}),Z=0,this.addFeature(U);return this.clearSelectedFeatures(),Ol.disable(this),this.updateUIClasses({mouse:Nn.ADD}),this.activateUIButton(Ps.LINE),this.setActionableState({trash:!0}),{line:U,currentVertexPosition:Z,direction:it}};Bl.clickAnywhere=function(b,A){if(b.currentVertexPosition>0&&_g(A,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&_g(A,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:Nn.ADD}),b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):b.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)};Bl.clickOnVertex=function(b){return this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.line.id]})};Bl.onMouseMove=function(b,A){b.line.updateCoordinate(b.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),gm(A)&&this.updateUIClasses({mouse:Nn.POINTER})};Bl.onTap=Bl.onClick=function(b,A){if(gm(A))return this.clickOnVertex(b,A);this.clickAnywhere(b,A)};Bl.onKeyUp=function(b,A){bg(A)?this.changeMode(Ti.SIMPLE_SELECT,{featureIds:[b.line.id]}):xg(A)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT))};Bl.onStop=function(b){Ol.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(`${b.currentVertexPosition}`),b.line.isValid()?this.fire(Ja.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT,{},{silent:!0})))};Bl.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(Ti.SIMPLE_SELECT)};Bl.toDisplayFeatures=function(b,A,U){const Z=A.properties.id===b.line.id;if(A.properties.active=Z?Wr.ACTIVE:Wr.INACTIVE,!Z)return U(A);A.geometry.coordinates.length<2||(A.properties.meta=Ia.FEATURE,U(Jf(b.line.id,A.geometry.coordinates[b.direction==="forward"?A.geometry.coordinates.length-2:1],`${b.direction==="forward"?A.geometry.coordinates.length-2:1}`,!1)),U(A))};const My={simple_select:_n,direct_select:yn,draw_point:Au,draw_polygon:kl,draw_line_string:Bl},k0={defaultMode:Ti.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:_y,modes:My,controls:{},userProperties:!1,suppressAPIEvents:!0},B0={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},F0={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function X_(b,A){return b.map(U=>U.source?U:Object.assign({},U,{id:`${U.id}.${A}`,source:A==="hot"?qo.HOT:qo.COLD}))}function N0(b={}){let A=Object.assign({},b);return b.controls||(A.controls={}),b.displayControlsDefault===!1?A.controls=Object.assign({},F0,b.controls):A.controls=Object.assign({},B0,b.controls),A=Object.assign({},k0,A),A.styles=X_(A.styles,"cold").concat(X_(A.styles,"hot")),A}var t_,Y_;function j0(){return Y_||(Y_=1,t_=function b(A,U){if(A===U)return!0;if(A&&U&&typeof A=="object"&&typeof U=="object"){if(A.constructor!==U.constructor)return!1;var Z,it,lt;if(Array.isArray(A)){if(Z=A.length,Z!=U.length)return!1;for(it=Z;it--!==0;)if(!b(A[it],U[it]))return!1;return!0}if(A.constructor===RegExp)return A.source===U.source&&A.flags===U.flags;if(A.valueOf!==Object.prototype.valueOf)return A.valueOf()===U.valueOf();if(A.toString!==Object.prototype.toString)return A.toString()===U.toString();if(lt=Object.keys(A),Z=lt.length,Z!==Object.keys(U).length)return!1;for(it=Z;it--!==0;)if(!Object.prototype.hasOwnProperty.call(U,lt[it]))return!1;for(it=Z;it--!==0;){var R=lt[it];if(!b(A[R],U[R]))return!1}return!0}return A!==A&&U!==U}),t_}var V0=j0();const W_=pm(V0);var e_,K_;function U0(){if(K_)return e_;K_=1,e_=A;var b={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function A(U){if(!U||!U.type)return null;var Z=b[U.type];if(!Z)return null;if(Z==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:U}]};if(Z==="feature")return{type:"FeatureCollection",features:[U]};if(Z==="featurecollection")return U}return e_}var G0=U0();const q0=pm(G0);function Cy(b,A){return b.length!==A.length?!1:JSON.stringify(b.map(U=>U).sort())===JSON.stringify(A.map(U=>U).sort())}const Z0={Polygon:uo,LineString:Du,Point:Oh,MultiPolygon:Qa,MultiLineString:Qa,MultiPoint:Qa};function H0(b,A){A.modes=Ti;const U=b.options.suppressAPIEvents!==void 0?!!b.options.suppressAPIEvents:!0;return A.getFeatureIdsAt=function(Z){return Qf.click({point:Z},null,b).map(lt=>lt.properties.id)},A.getSelectedIds=function(){return b.store.getSelectedIds()},A.getSelected=function(){return{type:Le.FEATURE_COLLECTION,features:b.store.getSelectedIds().map(Z=>b.store.get(Z)).map(Z=>Z.toGeoJSON())}},A.getSelectedPoints=function(){return{type:Le.FEATURE_COLLECTION,features:b.store.getSelectedCoordinates().map(Z=>({type:Le.FEATURE,properties:{},geometry:{type:Le.POINT,coordinates:Z.coordinates}}))}},A.set=function(Z){if(Z.type===void 0||Z.type!==Le.FEATURE_COLLECTION||!Array.isArray(Z.features))throw new Error("Invalid FeatureCollection");const it=b.store.createRenderBatch();let lt=b.store.getAllIds().slice();const R=A.add(Z),d=new Zo(R);return lt=lt.filter(dt=>!d.has(dt)),lt.length&&A.delete(lt),it(),R},A.add=function(Z){const lt=JSON.parse(JSON.stringify(q0(Z))).features.map(R=>{if(R.id=R.id||p_(),R.geometry===null)throw new Error("Invalid geometry: null");if(b.store.get(R.id)===void 0||b.store.get(R.id).type!==R.geometry.type){const d=Z0[R.geometry.type];if(d===void 0)throw new Error(`Invalid geometry type: ${R.geometry.type}.`);const dt=new d(b,R);b.store.add(dt,{silent:U})}else{const d=b.store.get(R.id),dt=d.properties;d.properties=R.properties,W_(dt,R.properties)||b.store.featureChanged(d.id,{silent:U}),W_(d.getCoordinates(),R.geometry.coordinates)||d.incomingCoords(R.geometry.coordinates)}return R.id});return b.store.render(),lt},A.get=function(Z){const it=b.store.get(Z);if(it)return it.toGeoJSON()},A.getAll=function(){return{type:Le.FEATURE_COLLECTION,features:b.store.getAll().map(Z=>Z.toGeoJSON())}},A.delete=function(Z){return b.store.delete(Z,{silent:U}),A.getMode()===Ti.DIRECT_SELECT&&!b.store.getSelectedIds().length?b.events.changeMode(Ti.SIMPLE_SELECT,void 0,{silent:U}):b.store.render(),A},A.deleteAll=function(){return b.store.delete(b.store.getAllIds(),{silent:U}),A.getMode()===Ti.DIRECT_SELECT?b.events.changeMode(Ti.SIMPLE_SELECT,void 0,{silent:U}):b.store.render(),A},A.changeMode=function(Z,it={}){return Z===Ti.SIMPLE_SELECT&&A.getMode()===Ti.SIMPLE_SELECT?(Cy(it.featureIds||[],b.store.getSelectedIds())||(b.store.setSelected(it.featureIds,{silent:U}),b.store.render()),A):(Z===Ti.DIRECT_SELECT&&A.getMode()===Ti.DIRECT_SELECT&&it.featureId===b.store.getSelectedIds()[0]||b.events.changeMode(Z,it,{silent:U}),A)},A.getMode=function(){return b.events.getMode()},A.trash=function(){return b.events.trash({silent:U}),A},A.combineFeatures=function(){return b.events.combineFeatures({silent:U}),A},A.uncombineFeatures=function(){return b.events.uncombineFeatures({silent:U}),A},A.setFeatureProperty=function(Z,it,lt){return b.store.setFeatureProperty(Z,it,lt,{silent:U}),A},A}const $0=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:s0,ModeHandler:u_,StringSet:Zo,constrainFeatureMovement:__,createMidPoint:Ty,createSupplementaryPoints:Tg,createVertex:Jf,doubleClickZoom:Ol,euclideanDistance:f_,featuresAt:Qf,getFeatureAtAndSetCursors:mg,isClick:o_,isEventAtCoordinates:_g,isTap:l_,mapEventToBoundingBox:fy,moveFeatures:y_,sortFeatures:dy,stringSetsAreEqual:Cy,theme:_y,toDenseArray:_m},Symbol.toStringTag,{value:"Module"})),X0=function(b,A){b=N0(b);const U={options:b};A=H0(U,A),U.api=A;const Z=D0(U);return A.onAdd=Z.onAdd,A.onRemove=Z.onRemove,A.types=Ps,A.options=b,A};function Sg(b){X0(b,this)}Sg.modes=My;Sg.constants=sy;Sg.lib=$0;const Q_=b=>{let A;const U=new Set,Z=(vt,Wt)=>{const ee=typeof vt=="function"?vt(A):vt;if(!Object.is(ee,A)){const Bt=A;A=Wt??(typeof ee!="object"||ee===null)?ee:Object.assign({},A,ee),U.forEach(Gt=>Gt(A,Bt))}},it=()=>A,d={setState:Z,getState:it,getInitialState:()=>dt,subscribe:vt=>(U.add(vt),()=>U.delete(vt))},dt=A=b(Z,it,d);return d},Y0=(b=>b?Q_(b):Q_),W0=b=>b;function K0(b,A=W0){const U=cg.useSyncExternalStore(b.subscribe,cg.useCallback(()=>A(b.getState()),[b,A]),cg.useCallback(()=>A(b.getInitialState()),[b,A]));return cg.useDebugValue(U),U}const J_=b=>{const A=Y0(b),U=Z=>K0(A,Z);return Object.assign(U,A),U},Q0=(b=>b?J_(b):J_);var i_={exports:{}},ty;function J0(){return ty||(ty=1,(function(b){(function(A){A.version="0.5.0",A.defaults={doThrows:{invalidGeometry:!1}};function U(){var Lt=1<=arguments.length?[].slice.call(arguments,0):[],_t=Lt.shift(),fe=Lt.shift();Error.apply(this,Lt),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(_t)+", params: "+JSON.stringify(fe)}U.prototype=Error,A.errors={InvalidGeometryError:U},A.isGeometryValid=function(Lt){return!Lt||!Object.keys(Lt).length?!1:!!Lt.type&&!!Lt.coordinates&&Array.isArray(Lt.coordinates)&&!!Lt.coordinates.length},A.parse=function(Lt,_t,fe){var me,le=lt(_t,this.defaults),mi;if(it.length=0,dt(le),mi=Gt(le),Array.isArray(Lt)?(me={type:"FeatureCollection",features:[]},Lt.forEach(function(ue){me.features.push(Wt({item:ue,params:le,propFunc:mi}))}),R(me,le)):(me=Wt({item:Lt,params:le,propFunc:mi}),R(me,le)),fe&&typeof fe=="function")fe(me);else return me};var Z=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],it=[];function lt(Lt,_t){var fe=Lt||{};for(var me in _t)_t.hasOwnProperty(me)&&!fe[me]&&(fe[me]=_t[me]);return fe}function R(Lt,_t){if(_t.crs&&d(_t.crs)&&(_t.isPostgres?Lt.geometry.crs=_t.crs:Lt.crs=_t.crs),_t.bbox&&(Lt.bbox=_t.bbox),_t.extraGlobal){Lt.properties={};for(var fe in _t.extraGlobal)Lt.properties[fe]=_t.extraGlobal[fe]}}function d(Lt){if(Lt.type==="name"){if(Lt.properties&&Lt.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}else if(Lt.type==="link"){if(Lt.properties&&Lt.properties.href&&Lt.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}else throw new Error('Invald CRS. Type attribute must be "name" or "link"')}function dt(Lt){Lt.geom={};for(var _t in Lt)Lt.hasOwnProperty(_t)&&Z.indexOf(_t)!==-1&&(Lt.geom[_t]=Lt[_t],delete Lt[_t]);vt(Lt.geom)}function vt(Lt){for(var _t in Lt)Lt.hasOwnProperty(_t)&&(typeof Lt[_t]=="string"?it.push(Lt[_t]):typeof Lt[_t]=="object"&&(it.push(Lt[_t][0]),it.push(Lt[_t][1])));if(it.length===0)throw new Error("No geometry attributes specified")}function Wt(Lt){var _t=Lt.item,fe=Lt.params,me=Lt.propFunc,le={type:"Feature"};return le.geometry=Bt(_t,fe),le.properties=me.call(_t),le}function ee(Lt){return/^.+\..+$/.test(Lt)}function Bt(Lt,_t){var fe={};for(var me in _t.geom){var le=_t.geom[me];if(typeof le=="string"&&Lt.hasOwnProperty(le))me==="GeoJSON"?fe=Lt[le]:(fe.type=me,fe.coordinates=Lt[le]);else if(typeof le=="object"&&!Array.isArray(le)){var mi=Object.keys(le).map(function(Pi){var Wi=le[Pi],yi=Lt[Pi];return Bt(yi,{geom:{Point:Wi}})});fe.type=me,fe.coordinates=[].concat(mi.map(function(Pi){return Pi.coordinates}))}else if(Array.isArray(le)&&Lt.hasOwnProperty(le[0])&&Lt.hasOwnProperty(le[1]))fe.type=me,fe.coordinates=[Number(Lt[le[1]]),Number(Lt[le[0]])];else if(Array.isArray(le)&&ee(le[0])&&ee(le[1])){for(var ue=[],Ye=0;Ye<le.length;Ye++){for(var be=le[Ye].split("."),We=Lt,ii=0;ii<be.length;ii++){if(!We.hasOwnProperty(be[ii]))return!1;We=We[be[ii]]}ue[Ye]=We}fe.type=me,fe.coordinates=[Number(ue[1]),Number(ue[0])]}}if(_t.doThrows&&_t.doThrows.invalidGeometry&&!A.isGeometryValid(fe))throw new U(Lt,_t);return fe}function Gt(Lt){var _t;return!Lt.exclude&&!Lt.include?_t=function(fe){for(var me in this)this.hasOwnProperty(me)&&it.indexOf(me)===-1&&(fe[me]=this[me])}:Lt.include?_t=function(fe){Lt.include.forEach(function(me){fe[me]=this[me]},this)}:Lt.exclude&&(_t=function(fe){for(var me in this)this.hasOwnProperty(me)&&it.indexOf(me)===-1&&Lt.exclude.indexOf(me)===-1&&(fe[me]=this[me])}),function(){var fe={};return _t.call(this,fe),Lt.extra&&se(fe,Lt.extra),fe}}function se(Lt,_t){for(var fe in _t)_t.hasOwnProperty(fe)&&(Lt[fe]=_t[fe]);return Lt}})(b.exports)})(i_)),i_.exports}J0();const da=Q0(b=>({map:null,isDrawing:!1,drawnFeatures:[],contextMenu:{position:null,feature:null},sidebar:{isOpen:!1,feature:null},notificationSidebar:{isOpen:!1},setMap:A=>b({map:A}),setIsDrawing:A=>b({isDrawing:A}),setDrawnFeatures:A=>b({drawnFeatures:A}),addDrawnFeature:A=>b(U=>({drawnFeatures:[...U.drawnFeatures,A]})),clearDrawnFeatures:()=>b({drawnFeatures:[]}),setContextMenu:(A,U)=>b({contextMenu:{position:A,feature:U}}),closeContextMenu:()=>b({contextMenu:{position:null,feature:null}}),openSidebar:A=>b({sidebar:{isOpen:!0,feature:A}}),closeSidebar:()=>b({sidebar:{isOpen:!1,feature:null}}),openNotificationSidebar:()=>b({notificationSidebar:{isOpen:!0}}),closeNotificationSidebar:()=>b({notificationSidebar:{isOpen:!1}})})),tv=()=>da(b=>b.contextMenu),ev=()=>da(b=>b.closeContextMenu),iv=()=>da(b=>b.setIsDrawing),nv=()=>da(b=>b.clearDrawnFeatures),rv=()=>da(b=>b.sidebar),av=()=>da(b=>b.openSidebar),sv=()=>da(b=>b.closeSidebar),ov=()=>da(b=>b.notificationSidebar),lv=()=>da(b=>b.openNotificationSidebar),uv=()=>da(b=>b.closeNotificationSidebar),cv=({draw:b,map:A})=>{const U=iv(),Z=nv(),{isDrawing:it}=da(),lt=d=>{b.current&&A.current&&(it?(b.current.changeMode("simple_select"),U(!1)):(b.current.changeMode(d),U(!0)))},R=()=>{b.current&&A.current&&(b.current.deleteAll(),Z())};return Ht.jsx("div",{className:"absolute top-4 left-4 bg-white rounded shadow-md shadow-black/20 z-10",children:Ht.jsxs("div",{className:"flex flex-col",children:[Ht.jsx("button",{onClick:()=>lt("draw_polygon"),className:`p-2 transition-colors border-b border-gray-200 rounded-t ${it?"bg-blue-500 text-white hover:bg-blue-600":"bg-white text-gray-700 hover:bg-gray-100"}`,title:it?"Stop Drawing":"Draw Polygon",children:Ht.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Ht.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),Ht.jsx("button",{onClick:R,className:"p-2 bg-white text-gray-700 hover:bg-gray-100 transition-colors rounded-b",title:"Clear All",children:Ht.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Ht.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},hv=[{text:"naval airbase",coordinates:[27.0405505,49.4002191],zoom:16},{text:"uae saudi border",coordinates:[23.04588187396214,2.49395029625795],zoom:16},{text:"barari reserved forest",coordinates:[24.181269031333503,55.316612230452535],zoom:16}],dv=({onSearch:b,onSuggestionSelect:A})=>{const[U,Z]=rn.useState(""),[it,lt]=rn.useState(!1),R=hv,d=rn.useRef(null),dt=rn.useMemo(()=>U.length>0?R.filter(Gt=>Gt.text.toLowerCase().includes(U.toLowerCase())):R,[U,R]);rn.useEffect(()=>{const Gt=se=>{d.current&&!d.current.contains(se.target)&&lt(!1)};return document.addEventListener("mousedown",Gt),()=>{document.removeEventListener("mousedown",Gt)}},[]);const vt=Gt=>{Z(Gt.target.value),lt(!0)},Wt=Gt=>{Z(Gt.text),lt(!1),A?A(Gt):b&&b(Gt.text)},ee=Gt=>{Gt.preventDefault(),lt(!1),b&&U.trim()&&b(U.trim())},Bt=()=>{lt(!0)};return Ht.jsx("div",{ref:d,className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-20 w-full max-w-md",children:Ht.jsxs("form",{onSubmit:ee,className:"relative",children:[Ht.jsxs("div",{className:"relative",children:[Ht.jsx("input",{type:"text",value:U,onChange:vt,onFocus:Bt,placeholder:"Search locations...",className:"w-full px-4 py-3 pr-10 text-gray-900 bg-white border border-gray-300 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",autoComplete:"off"}),Ht.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-gray-600 hover:text-blue-600 focus:outline-none transition-colors duration-200",children:Ht.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:Ht.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),it&&dt.length>0&&Ht.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-30",children:Ht.jsx("ul",{className:"py-2",children:dt.map((Gt,se)=>Ht.jsx("li",{children:Ht.jsx("button",{type:"button",onClick:()=>Wt(Gt),className:"w-full px-4 py-2 text-left text-gray-700 hover:bg-blue-50 hover:text-blue-600 focus:bg-blue-50 focus:text-blue-600 transition-colors duration-150",children:Ht.jsxs("div",{className:"flex items-center",children:[Ht.jsx("svg",{className:"w-4 h-4 mr-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:Ht.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Ht.jsx("span",{children:Gt.text})]})})},se))})})]})})};const fv=b=>b.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pv=b=>b.replace(/^([A-Z])|[\s-_]+(\w)/g,(A,U,Z)=>Z?Z.toUpperCase():U.toLowerCase()),ey=b=>{const A=pv(b);return A.charAt(0).toUpperCase()+A.slice(1)},Ay=(...b)=>b.filter((A,U,Z)=>!!A&&A.trim()!==""&&Z.indexOf(A)===U).join(" ").trim(),mv=b=>{for(const A in b)if(A.startsWith("aria-")||A==="role"||A==="title")return!0};var gv={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const _v=rn.forwardRef(({color:b="currentColor",size:A=24,strokeWidth:U=2,absoluteStrokeWidth:Z,className:it="",children:lt,iconNode:R,...d},dt)=>rn.createElement("svg",{ref:dt,...gv,width:A,height:A,stroke:b,strokeWidth:Z?Number(U)*24/Number(A):U,className:Ay("lucide",it),...!lt&&!mv(d)&&{"aria-hidden":"true"},...d},[...R.map(([vt,Wt])=>rn.createElement(vt,Wt)),...Array.isArray(lt)?lt:[lt]]));const zc=(b,A)=>{const U=rn.forwardRef(({className:Z,...it},lt)=>rn.createElement(_v,{ref:lt,iconNode:A,className:Ay(`lucide-${fv(ey(b))}`,`lucide-${b}`,Z),...it}));return U.displayName=ey(b),U};const yv=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],vv=zc("bell",yv);const xv=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],bv=zc("circle-alert",xv);const wv=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Tv=zc("flame",wv);const Sv=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ev=zc("map-pin",Sv);const Mv=[["path",{d:"M12 10.189V14",key:"1p8cqu"}],["path",{d:"M12 2v3",key:"qbqxhf"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76",key:"7tigtc"}],["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"1924j5"}]],Cv=zc("ship",Mv);const Av=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Dv=zc("trash-2",Av);const Iv=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],zv=zc("trending-up",Iv);const Pv=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],iy=zc("triangle-alert",Pv);const Rv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Dy=zc("x",Rv),Lv=({position:b,feature:A,onClose:U,onStartWatch:Z,onDelete:it})=>{const lt=rn.useRef(null);if(rn.useEffect(()=>{const dt=Wt=>{lt.current&&!lt.current.contains(Wt.target)&&U()},vt=Wt=>{Wt.key==="Escape"&&U()};return b&&A&&(document.addEventListener("mousedown",dt),document.addEventListener("keydown",vt)),()=>{document.removeEventListener("mousedown",dt),document.removeEventListener("keydown",vt)}},[b,A,U]),!b||!A)return null;const R=()=>{Z(A),U()},d=()=>{it(A),U()};return Ht.jsxs("div",{ref:lt,className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[160px]",style:{left:`${b.x}px`,top:`${b.y}px`},children:[Ht.jsxs("button",{onClick:R,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors duration-150",children:[Ht.jsx(bv,{className:"w-4 h-4 text-blue-500"}),Ht.jsx("span",{children:"Start Watch"})]}),Ht.jsxs("button",{onClick:d,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors duration-150",children:[Ht.jsx(Dv,{className:"w-4 h-4 text-red-500"}),Ht.jsx("span",{children:"Delete"})]})]})},Ov=({onSubmitSuccess:b})=>{const[A,U]=rn.useState({name:"",vehicles:!1,trailsAndRoads:!1,buildingsAndInfrastructure:!1,fires:!1,forest:!1,temporarySettlements:!1,watchEvery:"daily"}),Z=vt=>{U(Wt=>({...Wt,[vt]:!Wt[vt]}))},it=vt=>{U(Wt=>({...Wt,watchEvery:vt.target.value}))},lt=()=>{const vt=!A.vehicles&&!A.trailsAndRoads&&!A.buildingsAndInfrastructure&&!A.fires&&!A.forest&&!A.temporarySettlements;U(Wt=>({...Wt,vehicles:vt,trailsAndRoads:vt,buildingsAndInfrastructure:vt,fires:vt,forest:vt,temporarySettlements:vt}))},R=vt=>{U(Wt=>({...Wt,name:vt.target.value}))},d=vt=>{vt.preventDefault();const Wt=Object.entries(A).filter(([ee,Bt])=>ee!=="name"&&ee!=="watchEvery"&&Bt).map(([ee])=>ee);if(!A.name.trim()){alert("Please provide a name for this watch location.");return}if(Wt.length===0){alert("Please select at least one category to watch.");return}console.log("Creating watch with data:",{name:A.name,categories:Wt,watchEvery:A.watchEvery,selectedArea:"120k Square kilometers"}),alert(`Watch "${A.name}" created successfully!`),b()},dt=A.vehicles&&A.trailsAndRoads&&A.buildingsAndInfrastructure&&A.fires&&A.forest&&A.temporarySettlements;return Ht.jsxs("form",{onSubmit:d,className:"space-y-6",children:[Ht.jsxs("div",{children:[Ht.jsx("label",{htmlFor:"watch-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Watch Location Name"}),Ht.jsx("input",{id:"watch-name",type:"text",value:A.name,onChange:R,placeholder:"Enter a name for this watch location",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all duration-200"})]}),Ht.jsxs("div",{children:[Ht.jsx("label",{htmlFor:"watch-every",className:"block text-sm font-medium text-gray-700 mb-2",children:"Watch Every"}),Ht.jsxs("select",{id:"watch-every",value:A.watchEvery,onChange:it,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all duration-200",children:[Ht.jsx("option",{value:"hourly",children:"Hour"}),Ht.jsx("option",{value:"daily",children:"Day"}),Ht.jsx("option",{value:"weekly",children:"Week"}),Ht.jsx("option",{value:"monthly",children:"Month"})]})]}),Ht.jsxs("div",{children:[Ht.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ht.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Watch for"}),Ht.jsx("button",{type:"button",onClick:lt,className:"text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors duration-150",children:dt?"Unselect All":"Select All"})]}),Ht.jsxs("div",{className:"space-y-3",children:[Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.vehicles,onChange:()=>Z("vehicles"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Vehicles"})]}),Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.trailsAndRoads,onChange:()=>Z("trailsAndRoads"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Trails and roads"})]}),Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.buildingsAndInfrastructure,onChange:()=>Z("buildingsAndInfrastructure"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Buildings and infrastructure"})]}),Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.fires,onChange:()=>Z("fires"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Smoke"})]}),Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.forest,onChange:()=>Z("forest"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Wildlife"})]}),Ht.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:[Ht.jsx("input",{type:"checkbox",checked:A.temporarySettlements,onChange:()=>Z("temporarySettlements"),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Ht.jsx("span",{className:"ml-3 text-sm text-gray-700",children:"Temporary settlements"})]})]})]}),Ht.jsx("div",{className:"pt-4 border-t border-gray-200",children:Ht.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200 font-medium",children:"Create Watch"})})]})},kv=({isOpen:b,feature:A,onClose:U})=>b?Ht.jsx("div",{className:"fixed inset-y-0 right-0 w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",children:Ht.jsxs("div",{className:"flex flex-col h-full",children:[Ht.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[Ht.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Create Watch"}),Ht.jsx("button",{onClick:U,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors duration-150","aria-label":"Close sidebar",children:Ht.jsx(Dy,{className:"w-5 h-5 text-gray-500"})})]}),Ht.jsx("div",{className:"flex-1 overflow-y-auto",children:A&&Ht.jsxs("div",{className:"p-6",children:[Ht.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[Ht.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Selected Area"}),Ht.jsx("p",{className:"text-sm text-gray-800",children:"120k Square kilometers"})]}),Ht.jsx(Ov,{onSubmitSuccess:U})]})})]})}):null,Bv=({notificationCount:b=0,onClick:A})=>{const U=b>0;return Ht.jsxs("button",{onClick:A,className:`fixed bottom-16 left-10 z-50 bg-blue-600 hover:bg-blue-700 
text-white rounded-full p-4 shadow-lg transition-all duration-200 
hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 
focus:ring-offset-2`,"aria-label":"Notifications",children:[Ht.jsx(vv,{className:"w-6 h-6"}),U&&Ht.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full min-w-[20px] h-[20px] flex items-center justify-center text-xs font-bold shadow-md animate-pulse",children:b>99?"99+":b})]})},Iy=[{id:"1",title:"New vehicles detected",location:"Military basecamp",section:"Deep Insights",insights:["30% increase in vehicles over 1 month","Unusual night activity detected"],icon:"TrendingUp",severity:"medium",timestamp:"2 hours ago",coordinates:[49.4002191,27.0405505],address:"Near Tunis-Carthage Airport",region:"Northern Tunisia",country:"Tunisia",mapPosition:{center:[49.4002191,27.0405505],zoom:14,pitch:0,bearing:0},feature:{type:"polygon",geometry:{type:"Polygon",coordinates:[[[49.40193571376989,27.040617392072107],[49.40240778255642,27.040655616095933],[49.40241851139248,27.040282931308383],[49.40193571376989,27.040263819234653],[49.40193571376989,27.040617392072107]]]},properties:{name:"Military Basecamp Area",vehicleCount:45,lastActivity:new Date().toISOString()},style:{color:"#3b82f6",fillColor:"#3b82f6",strokeWidth:2,fillOpacity:.3}},category:"military",source:"satellite_imagery",confidence:85,status:"active",tags:["vehicles","military","north_africa"]},{id:"2",title:"Smoke detected",location:"Industrial Zone",section:"Surface Observations",insights:["Spike in CO2 detector logs","Unusual heat signature detected","Possible fire incident"],icon:"Flame",severity:"high",timestamp:"1 hour ago",coordinates:[55.316612230452535,24.181269031333503],address:"Industrial Area, Ashdod",region:"Southern District",country:"Israel",mapPosition:{center:[55.316612230452535,24.181269031333503],zoom:16,pitch:0,bearing:0},feature:{type:"polygon",geometry:{type:"Polygon",coordinates:[[[55.31556131481881,24.182184617771185],[55.31777145504657,24.182380364705608],[55.31791092991597,24.180510969224088],[55.3156471455066,24.180354369406516],[55.31556131481881,24.182184617771185]]]},properties:{name:"Fire Location",intensity:"high",temperature:"+45C above ambient"},style:{color:"#ef4444",fillColor:"#ef4444",strokeWidth:2,fillOpacity:.5,radius:50}},category:"fire",source:"thermal_sensors",confidence:92,status:"active",tags:["fire","smoke","industrial","emergency"]},{id:"3",title:"Tents Detected",location:"Eastern border",section:"Border Security",insights:["5 new vehicles crossing near border","20 phone numbers active within 48 hours near border","Temporary settlement detected"],icon:"AlertTriangle",severity:"high",timestamp:"30 minutes ago",coordinates:[55.2805774,24.2704484],address:"Near Jordan Border Crossing",region:"Eastern Border",country:"Israel",mapPosition:{center:[55.2805774,24.2704484],zoom:14,pitch:0,bearing:0},feature:{type:"polygon",geometry:{type:"Polygon",coordinates:[[[55.27948227061191,24.271199432273406],[55.2821434235897,24.27126412382269],[55.28221438766832,24.26951204940329],[55.27942904755193,24.269468921113415],[55.27948227061191,24.271199432273406]]]},properties:{name:"Tent Settlement",estimatedOccupancy:"50-100 people",activityLevel:"high"},style:{color:"#dc2626",strokeWidth:2,fillOpacity:.8,radius:8}},category:"security",source:"aerial_surveillance",confidence:78,status:"investigating",tags:["tents","border","security","settlement"]}],Fv=b=>{switch(b){case"AlertTriangle":return Ht.jsx(iy,{className:"w-5 h-5 text-red-600"});case"TrendingUp":return Ht.jsx(zv,{className:"w-5 h-5 text-blue-600"});case"Flame":return Ht.jsx(Tv,{className:"w-5 h-5 text-orange-600"});case"Ship":return Ht.jsx(Cv,{className:"w-5 h-5 text-purple-600"});default:return Ht.jsx(iy,{className:"w-5 h-5 text-gray-600"})}},Nv=({isOpen:b,onClose:A,onAlertClick:U,alerts:Z=Iy})=>{const it=d=>{U&&U(d)},lt=d=>{switch(d){case"high":return"border-red-200 bg-red-50";case"medium":return"border-yellow-200 bg-yellow-50";case"low":return"border-green-200 bg-green-50";default:return"border-gray-200 bg-gray-50"}},R=d=>{switch(d){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return b?Ht.jsx("div",{className:"fixed inset-y-0 right-0 w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",children:Ht.jsxs("div",{className:"flex flex-col h-full",children:[Ht.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[Ht.jsxs("div",{className:"flex items-center space-x-3",children:[Ht.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),Ht.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Alerts"}),Ht.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:[Z.length," Active"]})]}),Ht.jsx("button",{onClick:A,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors duration-150","aria-label":"Close sidebar",children:Ht.jsx(Dy,{className:"w-5 h-5 text-gray-500"})})]}),Ht.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:Z.map(d=>Ht.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-all duration-200 cursor-pointer hover:scale-[1.02] ${lt(d.severity)}`,onClick:()=>it(d),role:"button",tabIndex:0,onKeyDown:dt=>{(dt.key==="Enter"||dt.key===" ")&&(dt.preventDefault(),it(d))},"aria-label":`Alert: ${d.title} at ${d.location}`,children:[Ht.jsxs("div",{className:"flex items-start justify-between mb-3",children:[Ht.jsxs("div",{className:"flex items-center space-x-2",children:[Fv(d.icon),Ht.jsx("h3",{className:"font-semibold text-gray-800",children:d.title})]}),Ht.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${R(d.severity)}`,children:d.severity.toUpperCase()})]}),Ht.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[Ht.jsx(Ev,{className:"w-4 h-4 text-gray-500"}),Ht.jsx("span",{className:"text-sm text-gray-600",children:d.location})]}),Ht.jsx("div",{className:"mb-3",children:Ht.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:d.section})}),Ht.jsx("div",{className:"space-y-1",children:d.insights.map((dt,vt)=>Ht.jsxs("div",{className:"flex items-start space-x-2",children:[Ht.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mt-1.5 flex-shrink-0"}),Ht.jsx("p",{className:"text-sm text-gray-700",children:dt})]},vt))}),Ht.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:Ht.jsx("span",{className:"text-xs text-gray-500",children:d.timestamp})})]},d.id))}),Ht.jsx("div",{className:"p-4 border-t border-gray-200",children:Ht.jsx("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200",children:"View All Alerts"})})]})}):null},ny="SsUQTpcRoYxPgxTfpDyF",jv=()=>{const b=rn.useRef(null),A=rn.useRef(null),U=rn.useRef(null),Z=tv(),it=ev(),lt=rv(),R=av(),d=sv(),dt=ov(),vt=lv(),Wt=uv(),ee=rn.useCallback(ue=>{console.log("Searching for:",ue),A.current&&ue.toLowerCase().includes("israel")&&A.current.flyTo({center:[35.2433,31.7683],zoom:8,essential:!0})},[]),Bt=rn.useCallback(ue=>{console.log("Selected suggestion:",ue),A.current&&A.current.flyTo({center:[ue.coordinates[1],ue.coordinates[0]],zoom:ue.zoom,essential:!0})},[]),Gt=rn.useCallback(ue=>{console.log("Starting watch for feature:",ue),R(ue)},[R]),se=rn.useCallback(ue=>{U.current&&ue.id&&(U.current.delete(ue.id),console.log("Deleted feature:",ue))},[]),Lt=rn.useCallback(()=>{console.log("Notification button clicked"),vt()},[vt]),_t=rn.useCallback((ue,Ye)=>{if(!ue.geometry)return Ye;const{type:be}=ue.geometry;switch(be){case"Point":return ue.geometry.coordinates;case"Polygon":{const ii=ue.geometry.coordinates[0];let Pi=0,Wi=0,yi=0;if(ii.forEach(cn=>{cn.length>=2&&!isNaN(cn[0])&&!isNaN(cn[1])&&(Pi+=cn[0],Wi+=cn[1],yi++)}),yi>0)return[Pi/yi,Wi/yi];const jn=new hm.LngLatBounds;return ii.forEach(cn=>{cn.length>=2&&jn.extend([cn[0],cn[1]])}),jn.getCenter().toArray()}case"LineString":{const We=ue.geometry.coordinates;if(We.length>=2){const ii=Math.floor(We.length/2);return We[ii].slice(0,2)}return Ye}case"MultiPoint":{const We=ue.geometry.coordinates;return We.length>0?We[0].slice(0,2):Ye}default:return Ye}},[]),fe=rn.useCallback(()=>{A.current&&(A.current.getLayer("alert-features-layer")&&A.current.removeLayer("alert-features-layer"),A.current.getLayer("alert-features-outline")&&A.current.removeLayer("alert-features-outline"),A.current.getSource("alert-features-source")&&A.current.removeSource("alert-features-source"),document.querySelectorAll(".maplibregl-popup").forEach(Ye=>Ye.remove()))},[]),me=rn.useCallback(ue=>{if(console.log("Alert clicked:",ue),A.current){fe();const{center:Ye,pitch:be=0,bearing:We=0}=ue.mapPosition;if(A.current.flyTo({center:Ye,zoom:16,pitch:be,bearing:We,essential:!0}),ue.feature.geometry){A.current.addSource("alert-features-source",{type:"geojson",data:{type:"Feature",geometry:ue.feature.geometry,properties:ue.feature.properties||{}}});const{type:ii}=ue.feature,Pi="#ef4444";switch(ii){case"polygon":A.current.addLayer({id:"alert-features-outline",type:"line",source:"alert-features-source",paint:{"line-color":Pi,"line-width":2}});break;case"line":A.current.addLayer({id:"alert-features-layer",type:"line",source:"alert-features-source",paint:{"line-color":Pi,"line-width":2}});break;case"point":case"circle":A.current.addLayer({id:"alert-features-layer",type:"circle",source:"alert-features-source",paint:{"circle-radius":8,"circle-color":"transparent","circle-stroke-color":Pi,"circle-stroke-width":2,"circle-opacity":0}});break}if(ue.feature.properties?.name){const Wi={type:"Feature",geometry:ue.feature.geometry,properties:ue.feature.properties||{}},yi=_t(Wi,ue.coordinates);new hm.Popup({closeButton:!0,closeOnClick:!1,offset:[0,-10]}).setHTML(`
            <div class="p-2">
              <h3 class="font-semibold text-sm">${ue.title}</h3>
              <p class="text-xs text-gray-600 mt-1">${ue.feature.properties.name}</p>
              ${ue.feature.properties.vehicleCount?`<p class="text-xs text-gray-500">Vehicles: ${ue.feature.properties.vehicleCount}</p>`:""}
              ${ue.feature.properties.intensity?`<p class="text-xs text-gray-500">Intensity: ${ue.feature.properties.intensity}</p>`:""}
            </div>
          `).setLngLat(yi).addTo(A.current)}}}},[fe,_t]),le=rn.useCallback(ue=>{if(ue.preventDefault(),A.current&&U.current){const Ye=A.current.queryRenderedFeatures(ue.point,{layers:[]}),be=U.current.getAll().features,We=Ye.find(ii=>be.some(Pi=>Pi.id===ii.id||ii.properties&&Object.prototype.hasOwnProperty.call(ii.properties,"user_"+ii.type)));if(We||be&&be.length>0){const ii=We||be[0];if(A.current?.getContainer().getBoundingClientRect()){const Wi=ue.originalEvent.clientX,yi=ue.originalEvent.clientY,{setContextMenu:jn}=da.getState();console.log("Setting context menu for feature:",ii),jn({x:Wi,y:yi},ii)}}}},[]);rn.useEffect(()=>{if(!(!b.current||A.current))return A.current=new hm.Map({container:b.current,style:`https://api.maptiler.com/maps/satellite/style.json?key=${ny}`,center:[54.4156268,24.4525537],zoom:12,pitch:0,bearing:0}),A.current.addControl(new hm.NavigationControl,"top-right"),A.current.addControl(new hm.ScaleControl,"bottom-left"),U.current=new Sg({displayControlsDefault:!1,controls:{point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1},defaultMode:"simple_select",styles:[{id:"gl-draw-lines",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":3}},{id:"gl-draw-lines-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-width":3}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-outline",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-outline-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-width":2}},{id:"gl-draw-points",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#3bb2d0","circle-stroke-color":"#fff","circle-stroke-width":2}},{id:"gl-draw-points-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":"#fbb03b","circle-stroke-color":"#fff","circle-stroke-width":2}}]}),A.current.on("load",()=>{const{setMap:ue}=da.getState();ue(A.current),A.current&&U.current&&A.current.addControl(U.current)}),A.current.on("draw.create",ue=>{const{addDrawnFeature:Ye,setIsDrawing:be}=da.getState(),We=ue.features[0];console.log("Drawn shape GeoJSON:",We),Ye(We),be(!1)}),A.current.on("draw.delete",()=>{const{clearDrawnFeatures:ue}=da.getState();ue()}),A.current.on("draw.update",ue=>{const{clearDrawnFeatures:Ye,addDrawnFeature:be}=da.getState();Ye(),ue.features.forEach(We=>be(We))}),A.current.on("draw.modechange",ue=>{const{setIsDrawing:Ye}=da.getState();console.log("Drawing mode changed to:",ue.mode),Ye(ue.mode==="draw_polygon")}),A.current.on("contextmenu",le),()=>{A.current&&(A.current.remove(),A.current=null)}},[]);const mi=rn.useCallback(()=>{fe(),Wt()},[fe,Wt]);return Ht.jsxs("div",{className:"w-full h-screen",children:[Ht.jsx("div",{ref:b,className:"absolute inset-0 w-full h-screen"}),Ht.jsx(dv,{onSearch:ee,onSuggestionSelect:Bt}),Ht.jsx(cv,{draw:U,map:A}),Ht.jsx(Lv,{position:Z.position,feature:Z.feature,onClose:it,onStartWatch:Gt,onDelete:se}),Ht.jsx(kv,{isOpen:lt.isOpen,feature:lt.feature,onClose:d}),Ht.jsx(Bv,{notificationCount:Iy.length,onClick:Lt}),Ht.jsx(Nv,{isOpen:dt.isOpen,onClose:mi,onAlertClick:me}),ny==="YOUR_MAPTILER_API_KEY"]})};function Vv(){return Ht.jsx("div",{className:"w-full h-screen overflow-hidden",children:Ht.jsx(jv,{})})}Ky.createRoot(document.getElementById("root")).render(Ht.jsx(rn.StrictMode,{children:Ht.jsx(Vv,{})}));
